/*
 * wallaby-core - v1.0.1715
 * https://wallabyjs.com
 * Copyright (c) 2014-2025 Wallaby.js - All Rights Reserved.
 *
 * This source code file is a part of wallaby-core and is a proprietary (closed source) software.

 * IMPORTANT:
 * Wallaby.js is a tool made by software developers for software developers with passion and love for what we do.
 * Pirating the tool is not only illegal and just morally wrong,
 * it is also unfair to other fellow programmers who are using it legally,
 * and very harmful for the tool and its future.
 */
!function r(i,n,o){function a(t,e){if(!n[t]){if(!i[t]){var s="function"==typeof require&&require;if(!e&&s)return s(t,!0);if(l)return l(t,!0);throw(e=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",e}s=n[t]={exports:{}},i[t][0].call(s.exports,function(e){return a(i[t][1][e]||e)},s,s.exports,r,i,n,o)}return n[t].exports}for(var l="function"==typeof require&&require,e=0;e<o.length;e++)a(o[e]);return a}({1:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.OutputLogger=void 0;const n=e("npmlog"),r=e("path"),i=e("fs"),o=e("./rotatingLogStream"),a=e("os");s.OutputLogger=class{constructor(e,t){this.traceDir=r.join((0,a.homedir)(),"wallaby"===e?".wallaby":".quokka","logs",t),this.removeAllTraceFiles();e=new o.RotatingLogStream(r.join(this.traceDir,"trace.log"),{size:10485760,maxRotations:10});try{n.stream=e,n.level="info",n.emitLog=function(r){var e,i;this._paused?this._buffer.push(r):(this.progressEnabled&&this.gauge.pulse(r.prefix),void 0===(e=this.levels[r.level])||e<this.levels[this.level]||0<e&&!isFinite(e)||(i=null!==n.disp[r.level]?n.disp[r.level]:r.level,this.clearProgress(),r.message.split(/\r?\n/).forEach(function(e){var t=new Date;let s=`${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}:${String(t.getSeconds()).padStart(2,"0")}.${String(t.getMilliseconds()).padStart(3,"0")} `;t=n.heading,t&&(s=s+t+" "),s+=i,t=r.prefix||"";t&&(s+=" "),s=s+t+" "+e+"\n",n.write(s)},this),this.showProgress()))}}catch(e){console.error("failed to initialize npmlog",null==e?void 0:e.message)}}removeAllTraceFiles(){try{i.readdirSync(this.traceDir).forEach(e=>{e=r.join(this.traceDir,e);try{i.unlinkSync(e)}catch(e){}})}catch(e){}}logInfo(e,...t){return this.log("info",e,...t)}logError(e,...t){return this.log("error",e,...t)}logWarn(e,...t){return this.log("warn",e,...t)}log(e,t,...s){try{return n.log(e,"",t,...s)}catch(e){}}}},{"./rotatingLogStream":76,fs:void 0,npmlog:void 0,os:void 0,path:void 0}],2:[function(s,e,t){const i="{".charCodeAt(0),n=" ".charCodeAt(0),o="with",a="assert";e.exports=function(e){const{tokTypes:l,TokenType:t}=e.acorn||s("acorn");return class extends e{constructor(...e){super(...e),this.withToken=new t(o),this.assertToken=new t(a)}_codeAt(e){return this.input.charCodeAt(e)}_eat(e){this.type!==e&&this.unexpected(),this.next()}_collectionName(e){return e===this.assertToken?"assertions":"attributes"}readToken(e){let t=0,s=this.withToken,r=o;for(;t<o.length;t++)if(this._codeAt(this.pos+t)!==o.charCodeAt(t)){s=void 0,r=void 0;break}if(!s)for(s=this.assertToken,r=a,t=0;t<a.length;t++)if(this._codeAt(this.pos+t)!==a.charCodeAt(t))return super.readToken(e);for(;this._codeAt(this.pos+t)!==i;t++)if(this._codeAt(this.pos+t)!==n)return super.readToken(e);return"{"===this.type.label?super.readToken(e):(this.pos+=r.length,this.finishToken(s))}parseDynamicImport(e){var t;return this.next(),e.source=this.parseMaybeAssign(),this.eat(l.comma)&&(t=this.parseExpression(),e.arguments=[t]),this._eat(l.parenR),this.finishNode(e,"ImportExpression")}parseExport(e,t){var s,r,i;if(this.next(),this.eat(l.star))return 11<=this.options.ecmaVersion&&(this.eatContextual("as")?(e.exported=this.parseIdent(!0),this.checkExport(t,e.exported.name,this.lastTokStart)):e.exported=null),this.expectContextual("from"),this.type!==l.string&&this.unexpected(),e.source=this.parseExprAtom(),(this.type===this.withToken||this.type===this.assertToken||this.type===l._with)&&(r=this._collectionName(this.type),this.next(),s=this.parseImportAttributes())&&(e[r]=s),this.semicolon(),this.finishNode(e,"ExportAllDeclaration");if(this.eat(l._default))return this.checkExport(t,"default",this.lastTokStart),this.type===l._function||(i=this.isAsyncFunction())?(r=this.startNode(),this.next(),i&&this.next(),e.declaration=this.parseFunction(r,5,!1,i)):this.type===l._class?(s=this.startNode(),e.declaration=this.parseClass(s,"nullableID")):(e.declaration=this.parseMaybeAssign(),this.semicolon()),this.finishNode(e,"ExportDefaultDeclaration");if(this.shouldParseExportStatement())e.declaration=this.parseStatement(null),"VariableDeclaration"===e.declaration.type?this.checkVariableExport(t,e.declaration.declarations):this.checkExport(t,e.declaration.id.name,e.declaration.id.start),e.specifiers=[],e.source=null;else{if(e.declaration=null,e.specifiers=this.parseExportSpecifiers(t),this.eatContextual("from"))this.type!==l.string&&this.unexpected(),e.source=this.parseExprAtom(),(this.type===this.withToken||this.type===this.assertToken||this.type===l._with)&&(r=this._collectionName(this.type),this.next(),i=this.parseImportAttributes())&&(e[r]=i);else{for(var n=0,o=e.specifiers;n<o.length;n+=1){var a=o[n];this.checkUnreserved(a.local),this.checkLocalExport(a.local)}e.source=null}this.semicolon()}return this.finishNode(e,"ExportNamedDeclaration")}parseImport(e){var t,s;return this.next(),this.type===l.string?(e.specifiers=[],e.source=this.parseExprAtom()):(e.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),e.source=this.type===l.string?this.parseExprAtom():this.unexpected()),(this.type===this.withToken||this.type===this.assertToken||this.type==l._with)&&(t=this._collectionName(this.type),this.next(),s=this.parseImportAttributes())&&(e[t]=s),this.semicolon(),this.finishNode(e,"ImportDeclaration")}parseImportAttributes(){this._eat(l.braceL);var e=this.parsewithEntries();return this._eat(l.braceR),e}parsewithEntries(){var t=[],s=new Set;do{if(this.type===l.braceR)break;var r=this.startNode();let e;e=this.type===l.string?this.parseLiteral(this.value):this.parseIdent(!0),this.next(),r.key=e,s.has(r.key.name)&&this.raise(this.pos,"Duplicated key in attributes"),s.add(r.key.name),this.type!==l.string&&this.raise(this.pos,"Only string is supported as an attribute value"),r.value=this.parseLiteral(this.value),t.push(this.finishNode(r,"ImportAttribute"))}while(this.eat(l.comma));return t}}}},{acorn:void 0}],3:[function(e,t,s){"use strict";const n=e("acorn").tokTypes,r=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,o=e=>{r.lastIndex=e.pos;var t=r.exec(e.input),t=e.pos+t[0].length;return"."===e.input.slice(t,t+1)};t.exports=function(e){return class extends e{parseExprAtom(e){if(this.type!==n._import||!o(this))return super.parseExprAtom(e);this.options.allowImportExportEverywhere||this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'");e=this.startNode();return this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import"),e.meta=this.parseIdent(!0),this.expect(n.dot),e.property=this.parseIdent(!0),"meta"!==e.property.name&&this.raiseRecoverable(e.property.start,"The only valid meta property for import is import.meta"),this.containsEsc&&this.raiseRecoverable(e.property.start,'"meta" in import.meta must not contain escape sequences'),this.finishNode(e,"MetaProperty")}parseStatement(e,t,s){var r,i;return this.type===n._import&&o(this)?(r=this.startNode(),i=this.parseExpression(),this.parseExpressionStatement(r,i)):super.parseStatement(e,t,s)}}}},{acorn:void 0}],4:[function(t,e,s){e.exports=function(e){const s=(e.acorn||t("acorn")).tokTypes;return class extends e{readToken_pipe_amp(e){let t=this.input.charCodeAt(this.pos+1);return t===e?61===(t=this.input.charCodeAt(this.pos+2))?this.finishOp(s.assign,3):this.finishOp(124===e?s.logicalOR:s.logicalAND,2):61===t?this.finishOp(s.assign,2):this.finishOp(124===e?s.bitwiseOR:s.bitwiseAND,1)}getTokenFromCode(e){return 63==e?this.readToken_question():super.getTokenFromCode(e)}readToken_question(){if(11<=this.options.ecmaVersion){var e=this.input.charCodeAt(this.pos+1);if(63===e&&61===this.input.charCodeAt(this.pos+2))return this.finishOp(s.assign,3)}return super.readToken_question?super.readToken_question():this.finishOp(s.question,1)}}}},{acorn:void 0}],5:[function(e,t,s){"use strict";const n=e("acorn");t.exports=function(e){return class extends e{readInt(s,e){if(null!=e)return super.readInt(s,e);let t=this.pos,r=0,i=!1;for(;;){let e=this.input.charCodeAt(this.pos),t;if(97<=e)t=e-97+10;else{if(95==e){i||this.raise(this.pos,"Invalid numeric separator"),++this.pos,i=!1;continue}t=65<=e?e-65+10:48<=e&&e<=57?e-48:1/0}if(t>=s)break;++this.pos,r=r*s+t,i=!0}return this.pos===t?null:(i||this.raise(this.pos-1,"Invalid numeric separator"),r)}readNumber(e){var t=this.pos;e||null!==this.readInt(10)||this.raise(t,"Invalid number");let s=2<=this.pos-t&&48===this.input.charCodeAt(t),r=!1,i=(s&&this.strict&&this.raise(t,"Invalid number"),this.input.charCodeAt(this.pos));if(!s&&!e&&11<=this.options.ecmaVersion&&110===i)return e=this.getNumberInput(t,this.pos),e="undefined"!=typeof BigInt?BigInt(e):null,++this.pos,n.isIdentifierStart(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(n.tokTypes.num,e);s&&/[89]/.test(this.input.slice(t,this.pos))&&(s=!1,r=!0),46!==i||s||(++this.pos,this.readInt(10),i=this.input.charCodeAt(this.pos)),69!==i&&101!==i||s||(43!==(i=this.input.charCodeAt(++this.pos))&&45!==i||++this.pos,null===this.readInt(10)&&this.raise(t,"Invalid number")),n.isIdentifierStart(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");e=this.getNumberInput(t,this.pos),(s||r)&&e.length<this.pos-t&&this.raise(t,"Invalid number"),t=s?parseInt(e,8):parseFloat(e);return this.finishToken(n.tokTypes.num,t)}parseLiteral(e){e=super.parseLiteral(e);return e.bigint&&(e.bigint=e.bigint.replace(/_/g,"")),e}readRadixNumber(e){var t=this.pos;this.pos+=2;let s=this.readInt(e);return null==s&&this.raise(this.start+2,"Expected number in radix "+e),11<=this.options.ecmaVersion&&110===this.input.charCodeAt(this.pos)?(e=this.getNumberInput(t,this.pos),s="undefined"!=typeof BigInt?BigInt(e):null,++this.pos):n.isIdentifierStart(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(n.tokTypes.num,s)}getNumberInput(e,t){return this.input.slice(e,t).replace(/_/g,"")}}}},{acorn:void 0}],6:[function(e,t,s){"use strict";t.exports=function(e){return class extends e{isDirectiveCandidate(){return!1}strictDirective(){return!1}canDeclareLexicalName(){return!0}canDeclareVarName(){return!0}isSimpleParamList(){return!0}adaptDirectivePrologue(){}checkParams(){}checkPatternErrors(){}checkPatternExport(){}checkPropClash(){}checkVariableExport(){}checkYieldAwaitInDefaultParams(){}declareLexicalName(){}declareVarName(){}enterFunctionScope(){}enterLexicalScope(){}exitFunctionScope(){}exitLexicalScope(){}invalidStringToken(){}}}},{}],7:[function(e,t,s){"use strict";t.exports=function(e){return class extends e{parseMaybeUnary(){return this.isContextual("await")?this.parseAwait():super.parseMaybeUnary.apply(this,arguments)}}}},{}],8:[function(e,t,s){t.exports=function(e){return e.JSXExpressionContainer=e.ExpressionStatement,e.JSXSpreadChild=e.ExpressionStatement,e.JSXClosingFragment=e.Identifier,e.JSXEmptyExpression=e.Identifier,e.JSXIdentifier=e.Identifier,e.JSXOpeningFragment=e.Identifier,e.JSXText=e.Identifier,e.JSXSpreadAttribute=e.SpreadElement,e.JSXAttribute=(e,t,s)=>{s(e.name,t),e.value&&s(e.value,t)},e.JSXMemberExpression=(e,t,s)=>{s(e.object,t),s(e.property,t)},e.JSXNamespacedName=(e,t,s)=>{s(e.namespace,t),s(e.name,t)},e.JSXOpeningElement=(t,s,r)=>{r(t.name,s);for(let e=0;e<t.attributes.length;++e)r(t.attributes[e],s)},e.JSXClosingElement=(e,t,s)=>{s(e.name,t)},e.JSXElement=(t,s,r)=>{r(t.openingElement,s);for(let e=0;e<t.children.length;++e)r(t.children[e],s);t.closingElement&&r(t.closingElement,s)},e.JSXFragment=(t,s,r)=>{r(t.openingFragment,s);for(let e=0;e<t.children.length;++e)r(t.children[e],s);r(t.closingFragment,s)},e}},{}],9:[function(u,e,t){u("./global");const p=u("path"),d=u("fs");process.on("uncaughtException",function(e){if(!(e&&"spawn"===e.syscall&&"OK"===e.code||(e&&e.message&&_.isString(e.message)&&0===e.message.indexOf("payload cannot exceed")&&(e.stack="One of the files specified in your `files`/`tests` list is too large, "+e.stack),e&&e.message&&_.isString(e.message)&&~e.message.indexOf("EADDRINUSE")&&~e.message.indexOf("51245")))){try{var s;e instanceof Error&&(s=u("path").dirname(process.mainModule.filename),e.stack=_.filter(e.stack.split("\n"),(e,t)=>!t||!_.contains(e,s)).join("\n"))}catch(e){}emitDiagnostic({name:"genericError",message:e instanceof Error?e.stack:u("util").inspect(e)})}});let h=!1;e.exports={start:function(t){t.onConnected=function(s){t.Project=u("./project").Project,t.diffMatchPatch=new(u("./diffMatchPatch"));function r(){if(a(!0),!h){h=!0,i.stop(i._emergencyExit,!0);var e=i.shutdown();const t=arguments,s=()=>{if(!process.env.quokka)try{d.unlinkSync(p.join(i.projectCachePath,"running"))}catch(e){}console.log(process.env.quokka?"quokka.js stopped":"wallaby.js stopped"),n.apply(process,t)};!e||i._emergencyExit?s():Promise.race([e.finally(()=>s()),new Promise(e=>{setTimeout(()=>{s(),e()},1e4)})])}}var i=new t.Receiver(t),n=process.exit,e=process.exit=function(){r.apply(null,arguments)};process.on("SIGINT",function(){e.apply(null,[0])});let o;var a=e=>{clearTimeout(o),e&&(l=()=>{})},l=t=>{o=setTimeout(()=>{try{s.send({type:"ping"}),c()}catch(e){t?(i._emergencyExit=!0,r()):l(!0)}},t?1e3:1e4)},c=()=>{a(),l()};return i.on("message",function(e){if(!e._internal)try{s.send(e)}finally{c()}}),s.receive=function(e){c();var t="unknown";try{if(!("string"==typeof(t=e.type)&&0<t.length&&"_"!==t[0]))throw new Error("Incorrect incoming message format");var s=i[t](e);s&&s.catch&&s.catch(function(e){e.noDetails?emitDiagnostic({name:"genericError",message:e.message}):emitDiagnostic({name:"genericError",message:"Failed to execute "+t+" operation, "+e.stack})})}catch(e){emitDiagnostic({name:"genericError",message:"Failed to start "+t+" operation, "+e.stack})}},i.configure(),i}}}},{"./diffMatchPatch":51,"./global":56,"./project":75,fs:void 0,path:void 0,util:void 0}],10:[function(n,e,t){"use strict";var o,a,l=n("path"),c=n("semver"),u=n("./utils").default,r=n("./babelVisitor");let p=!0;const d="babel-core",h="@babel/core";class g{constructor(e,t,s){_.isEmpty(e)||e.babelrc||(e.babelrc=!1),this._opts=_.extend({filename:t},e||{}),!this._opts.filename&&t&&(this._opts.filename=t),this._opts.filenameRelative||delete this._opts.filenameRelative,this._opts.sourceMaps=this._opts.sourceMap=!0,c.valid(o.version)&&c.gte(o.version,"7.0.0-beta.0")&&delete this._opts.sourceMap,this._opts.retainLines=this._opts.retainLines||!1,this._opts.compact=this._opts.compact||!1,this._opts.comments=!1!==this._opts.comments,_.isString(this._opts.plugins)&&(this._opts.plugins=[this._opts.plugins]),this._opts.plugins=(this._opts.plugins||[]).slice(),this._opts.plugins.unshift(new a("wallaby.js",r(_.bind(this._pushRange,this)))),s&&(this._opts.presets=(this._opts.presets||[]).slice(),this._opts.presets.push(s))}_pushRange(e){e&&this._ranges.push([e.start.line,e.start.column,e.end.line,e.end.column])}run(e){this._ranges=[];var t=(o.transformSync||o.transform)(e.content,this._opts);return"ts"!==e.type&&"tsx"!==e.type||!p||e.changeExt("js"),{map:t.map,code:t.code,ranges:this._ranges}}runAsync(s,r){this._ranges=[],o.transform(s.content,this._opts,(e,t)=>{e?r(e):("ts"!==s.type&&"tsx"!==s.type||!p||s.changeExt("js"),r({map:t.map,code:t.code,ranges:this._ranges}))})}}e.exports=s=>r=>{if(r=r||{},process.env.BABEL_ENV&&"undefined"!==process.env.BABEL_ENV||(process.env.BABEL_ENV="test"),u.patchModule("test-exclude",()=>()=>({shouldInstrument:_.noop})),r.babel)o=r.babel;else{try{const t=n(l.join(s,"package.json"));var e=_.find([h,d,"babel-cli","babel"],e=>t.devDependencies[e]||t.dependencies[e]);"babel-cli"===e?o=u.requireModuleFrom(l.join(s,"node_modules/babel-cli"),d):e&&(o=u.requireModuleFrom(s,e))}catch(e){}if(!o)try{o=u.requireModuleFrom(s,h)}catch(e){try{o=u.requireModuleFrom(s,d)}catch(e){try{o=u.requireModuleFrom(s,"babel")}catch(e){throw new Error("babel, babel-core or @babel/core must be installed locally or babel instance must be passed in opts.babel, for example `wallaby.compilers.babel({ babel: require('@babel/core') })`")}}}}if(!c.valid(o.version)||!c.lt(o.version,"5.0.9")){const i=r.asyncTransform;return a=o.Transformer||function(e,s){return _.each(s,(t,e)=>{s[e]=e=>t(e.node)}),{visitor:{Program(e){e.traverse(s)}}}},p=!1!==r.renameTypeScriptFiles,delete r.babel,delete r.asyncTransform,delete r.renameTypeScriptFiles,(e,t)=>{var s=e.additionalPreset;if(delete e.additionalPreset,i)new g(r,e.path,s).runAsync(e,t);else try{t(new g(r,e.path,s).run(e))}catch(e){t(e)}}}emitDiagnostic({name:"invalidBabelVersion",minVersion:"5.0.9"})}},{"./babelVisitor":11,"./utils":88,path:void 0,semver:void 0}],11:[function(e,t,s){t.exports=(t,e)=>{var s={Statement(e){switch(e.type){case"DoWhileStatement":case"WhileStatement":case"IfStatement":case"ForStatement":e.test&&t(e.test.loc);break;case"ForOfStatement":case"ForInStatement":e.right&&t(e.right.loc);break;case"SwitchStatement":t(e.discriminant.loc);break;case"BreakStatement":case"ContinueStatement":case"ThrowStatement":case"VariableDeclaration":case"ExpressionStatement":case"ReturnStatement":t(e.loc)}},ArrowFunctionExpression(e){e.body&&"BlockStatement"!==e.body.type&&t(e.body.loc)},LogicalExpression(e){t(e.left.loc),t(e.right.loc)},ConditionalExpression(e){t(e.consequent.loc),t(e.alternate.loc)}};return e&&e.visitImports&&(s.ImportDeclaration=function(e){t(e.loc)}),s}},{}],12:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.BrowserEnvironment=void 0;const r=e("path"),i=e("compression"),n=e("express"),o=e("./fileCacheMiddleware");var a=e("graceful-fs");const l=e("./utils"),d=a.readFileSync(r.join(__dirname,"runners","browser","sandbox.html")).toString(),h="__wallaby__",g=logger.create("browserRunner")["debug"];s.BrowserEnvironment=class{constructor(e,t){var s=this;this._project=e,this._workerPool=t,this._baseDir=s._project._instrumentedRoot+r.sep,this._initializer=e.settings().bootstrap,this._reportUnhandledPromises=!!e.settings().reportUnhandledPromises,this._throwOnBeforeunload=!!e.settings().throwOnBeforeUnload,this._maxLogEntrySize=e.settings().maxLogEntrySize,this._maxTraceSteps=e.settings().maxTraceSteps,this._maxTraceStepsForWatchExpressionPrefetch=e.settings().maxTraceStepsForWatchExpressionPrefetch,this._resolveGetters=e.settings().resolveGetters,this._logLimits=e.settings().logLimits,this._sandboxHtml={},this._report404AsError=e.settings().env.report404AsError,this._lruCache=s._project._lruCache,this._wallabyFileIdPrefix=s._workerPool.wallabyFileIdPrefix(),this._app=n(),this._app.use(i({filter:e=>!!~e.url.indexOf("____wallaby-bundle")})),this._app.use("/wallaby_sandbox:id.html",(e,t)=>{t.send(s._sandboxHtml[e.params.id])}),e.settings().testFramework.path&&this._app.use("/"+h+"/"+e.settings().testFramework.version+"/framework.js",o.fileCacheMiddleware.create({main:{root:r.join(e._localRoot,e.settings().testFramework.path)}})),this._app.use("/"+h+"/tracer.js",o.fileCacheMiddleware.create({main:{root:r.join(__dirname,"tracer.js")}})),this._app.use("/"+h,o.fileCacheMiddleware.create({main:{root:r.join(__dirname,"runners","browser")}})),e.settings().middleware(s._app,n),this._project.isNativeBundler()?this._app.use(o.fileCacheMiddleware.create({main:{root:s._baseDir,cache:s._lruCache},alt:{root:s._project._localProjectDir,read:(e,t)=>{e=l.default.normalizePath(r.relative(s._project._localProjectDir,e));s._project.idByPath(e)?s._project.getLatestOriginalFileContentByPathAsync(e).then(e=>t(null,e)).catch(e=>t(e)):t(new Error(`File '${e}' is not registered.`))}}},s._report404AsError)):this._app.use(o.fileCacheMiddleware.create({main:{root:s._baseDir,cache:s._lruCache}},s._report404AsError))}async prepareSandbox(t,e,s,r){var i=this,n=(t.allFilesHash=_.reduce(t.allFiles.concat(t.allTestFiles),(e,t)=>(e[t.normalizedRelativePath]={ts:t.ts,id:t.tmp&&t.originalId?t.originalId:t.id},e),{}),t.allFiles.concat(t.allTestFiles)),o=t.filesToLoad.concat(t.testFilesToLoad),a=_.reduce(t.testFilesToLoad,function(e,t){return e[t.id]=t,e},{}),l=(g("Total files to load in sandbox: "+o.length),i._workerPool.receiverPort());const c=i._project.settings();var u=r||"127.0.0.1";i._anyIncludedEsm=!1;const p=i._project.isNativeBundler();i._sandboxHtml[s]=d.replace("<inject/>",()=>_.reduce(n,function(e,t){return e+(_.isNumber(t.id)?"file = window.$_$coverage["+t.id+"]=[]; for(i=0, len="+t.rangesLength+"; i < len; i++) file[i] = {};":"")},"<script>(function() {window.$_$receiverPort = "+l+";window.$_$receiverHost = '"+u+"';window.$_$session=\""+e+'";window.$_$baseDir='+JSON.stringify(p?i._project._localProjectDir:i._baseDir)+";window.$_$initialSpecId="+1e5*(s+1)+";window.$_$reportUnhandledPromises="+i._reportUnhandledPromises+";window.$_$throwOnBeforeunload="+i._throwOnBeforeunload+";window.$_$maxLogEntrySize="+i._maxLogEntrySize+";window.$_$maxTraceSteps="+i._maxTraceSteps+";window.$_$maxTraceStepsForWatchExpressionPrefetch="+i._maxTraceStepsForWatchExpressionPrefetch+";"+(i._resolveGetters?"window.$_$resolveGetters=true;":"")+"window.$_$logLimits="+JSON.stringify(i._logLimits)+";window.$_$traceContext="+JSON.stringify(i._workerPool.traceContext())+";window.$_$coverage=[]; var file, i, len;")+(t.profileRun?"window.$_$profileRun=true;":"")+"window.$_$slow="+c.slowTestThreshold+";window.$_$expressionsToEvaluate="+JSON.stringify(t.expressionsToEvaluate)+";window.$_$files="+JSON.stringify(t.allFilesHash)+";window.$_$tests="+(t.tests?JSON.stringify(t.tests):"null")+";window.$_$testFiles="+JSON.stringify(_.chain(t.allTestFiles).filter(e=>!e.shadowed).map(e=>({path:p?e.normalizedRelativePath:e.relativePath,loaded:e.include&&!!a[e.id],id:(t.allFilesHash[e.normalizedRelativePath]||{}).id})).value())+";"+(c.noLogThrottling?"window.$_$noLogThrottling="+c.noLogThrottling+";":"")+(process.env.WALLABY2?"window.$_$v2=true;":"")+'})();<\/script><script src="'+h+'/tracer.js"><\/script><script src="'+h+"/"+t.framework.version+'/framework.js"><\/script><script src="'+h+"/"+t.framework.configurator+'/configurator.js"><\/script><script src="'+h+"/"+t.framework.reporter+'/reporter.js"><\/script>'+_.reduce(o,function(e,t){i._anyIncludedEsm=i._anyIncludedEsm||t.esm;var s=t.tmp,r=t.ts+(s?t.originalId?i._wallabyFileIdPrefix+t.originalId:"":i._wallabyFileIdPrefix+t.id);switch(t.type){case"js":case"mjs":case"jsx":case"es6":case"es7":return e+"<script "+(t.esm?'type="module"':"")+' src="'+t.normalizedRelativePath+"?"+r+'"><\/script>';case"html":case"htm":return e+'<link href="'+t.normalizedRelativePath+"?"+t.ts+'" rel="import">';case"css":return e+'<link rel="stylesheet" type="text/css" href="'+t.normalizedRelativePath+"?"+r+'"></link>';default:return e}},"")+(i._initializer&&n.length?"<script>$_$tracer.setInitializeResult(("+i._initializer+")(window.wallaby));<\/script>":"")+"<script "+(i._anyIncludedEsm?'type="module"':"")+' src="'+h+"/"+t.framework.starter+'/starter.js"><\/script>');r=i.sandboxRootUrl()+"wallaby_sandbox"+s+".html";return g("Sandbox is generated [%s]: %s",i.sandboxName(s,e),r),r}doesSandboxContainESModules(){return this._anyIncludedEsm}sandboxRootUrl(){return this._sandboxRootUrl||(this._sandboxRootUrl="http://localhost:"+this._workerPool.receiverPort()+"/"),this._sandboxRootUrl}webApp(){return this._app}sandboxName(e,t){return"worker #"+e+", session #"+t}}},{"./fileCacheMiddleware":55,"./utils":88,compression:void 0,express:void 0,"graceful-fs":void 0,path:void 0}],13:[function(t,e,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.ProfileViewer=void 0;let a,l;s.ProfileViewer=class{constructor(e){a=t("chrome-launcher"),l=t("chrome-remote-interface"),this._project=e}async show(e,t,s){this.stop(),this._chrome||(this._chrome=await a.launch({chromeFlags:["--disable-background-networking","--enable-features=NetworkService,NetworkServiceInProcess","--disable-background-timer-throttling","--disable-backgrounding-occluded-windows","--disable-breakpad","--disable-devTools-side-phishing-detection","--disable-component-extensions-with-background-pages","--disable-default-apps","--disable-dev-shm-usage","--disable-extensions","--disable-features=TranslateUI","--disable-hang-monitor","--disable-ipc-flooding-protection","--disable-popup-blocking","--disable-prompt-on-repost","--disable-renderer-backgrounding","--disable-sync","--force-color-profile=srgb","--metrics-recording-only","--no-first-run","--password-store=basic","--use-mock-keychain","--auto-open-devtools-for-tabs"],logLevel:"silent"}));var r={port:this._chrome.port,host:"127.0.0.1"},i=(this._startChecking(r),await l.List(r)),n=i.find(e=>e.url.startsWith("devtools:")),i=i.find(e=>e.url.startsWith("about:")),[i,n]=await Promise.all([l(Object.assign({target:i},r)),l(Object.assign({target:n},r))]);await i.Page.navigate({url:"devtools://devtools/bundled/devtools_app.html"}),await n.Runtime.evaluate({expression:`
        const checker = setInterval(() => {
          if (window.UI && (window.UI.viewManager || window.DevToolsAPI)
            && document.querySelector('.main-tabbed-pane').shadowRoot
            && document.querySelector('.main-tabbed-pane').shadowRoot.querySelector('.tabbed-pane-right-toolbar')
            && document.querySelector('.main-tabbed-pane').shadowRoot.querySelector('.tabbed-pane-right-toolbar').shadowRoot
            && document.querySelector('.main-tabbed-pane').shadowRoot.querySelector('.tabbed-pane-right-toolbar').shadowRoot.querySelector('.largeicon-delete')
          ) {
              clearInterval(checker);
              document.querySelector('.main-tabbed-pane').shadowRoot.querySelector('.tabbed-pane-right-toolbar').shadowRoot.querySelector('.largeicon-delete').click();
          }

          if (window.UI && (window.UI.viewManager || window.DevToolsAPI)
            && document.querySelector('.main-tabbed-pane').shadowRoot
            && document.querySelector('.main-tabbed-pane').shadowRoot.querySelector('.tabbed-pane-right-toolbar')
            && document.querySelector('.main-tabbed-pane').shadowRoot.querySelector('.tabbed-pane-right-toolbar').shadowRoot
            && document.querySelector('.main-tabbed-pane').shadowRoot.querySelector('.tabbed-pane-right-toolbar').shadowRoot.querySelector('.close-devtools')
          ) {
              clearInterval(checker);
              document.querySelector('.main-tabbed-pane').shadowRoot.querySelector('.tabbed-pane-right-toolbar').shadowRoot.querySelector('.close-devtools').click();
          }
        }, 5);
    `});const o="pageDataEvent";await i.send("Runtime.addBinding",{name:o}),i.Runtime.bindingCalled(({name:e,payload:t})=>{e===o&&(e=JSON.parse(t))&&"link"===e.type&&this._project.navigationRequested(e.href)}),await i.Runtime.evaluate({expression:`
        const checker = setInterval(async () => {
            if (window.UI && (window.UI.viewManager || window.DevToolsAPI) && document.querySelector('.main-tabbed-pane')
            && document.querySelector('.main-tabbed-pane').shadowRoot
            && document.querySelector('.main-tabbed-pane').shadowRoot.querySelector('.tabbed-pane-header')
            ) {
                clearInterval(checker);
                
                document.title = '${process.env.quokka?"Quokka Profile":s}';
                var link = document.querySelector("link[rel~='icon']");
                if (!link) {
                    link = document.createElement('link');
                    link.rel = 'icon';
                    document.getElementsByTagName('head')[0].appendChild(link);
                }
                link.href = '${process.env.quokka?"https://quokkajs.com/assets/img/favicon.ico":"https://wallabyjs.com/assets/img/favicon.ico"}';
                
                document.querySelector('.main-tabbed-pane').shadowRoot.querySelector('.tabbed-pane-header').style.display = 'none';
                var viewManagerInstance = UI.ViewManager && UI.ViewManager.instance() || window.UI.viewManager;
                var viewName = window.UI.viewManager && window.UI.viewManager.views.has('js_profiler') ? 'js_profiler' : 'timeline';
                if (viewName === 'timeline') {
                  const consoleCloser = setInterval(() => {
                    if (document.querySelector('.drawer-tabbed-pane') ) {
                      clearInterval(consoleCloser);
                      document.querySelector('.drawer-tabbed-pane').shadowRoot.querySelector('.tabbed-pane-header .tabbed-pane-right-toolbar').shadowRoot.querySelector('.toolbar-button').click();
                    }
                  }, 5);
                }
                if (window.UI.viewManager) {
                  await window.UI.viewManager.showView(viewName, true);
                } else {
                  window.DevToolsAPI.showPanel(viewName);
                  await new Promise(resolve => {
                    const checker = setInterval(() => {
                      if (window.UI.panels.timeline) {
                        clearInterval(checker);
                        resolve();
                      }
                    }, 5);
                  });
                }
                var profilerWidget = viewManagerInstance ? viewManagerInstance.materializedWidget(viewName) : window.UI.panels.timeline;
                var cpuProfileType = profilerWidget._findProfileTypeByExtension && profilerWidget._findProfileTypeByExtension('.cpuprofile') || profilerWidget;
                
                await cpuProfileType.loadFromFile(new File([decodeURIComponent('${encodeURIComponent(JSON.stringify(e))}')], '${t}.cpuprofile'));
                
                if (profilerWidget.showProfile) {
                  var profileToLoad = cpuProfileType._profiles && cpuProfileType._profiles[0] || cpuProfileType.selectedProfileType && cpuProfileType.selectedProfileType.profiles[0];

                  await profilerWidget.showProfile(profileToLoad);
                
                  var profileView = viewManagerInstance.materializedWidget(viewName).visibleView;

                  const selectFlameChart = () => {
                    if (!profileView.viewSelectComboBox) return setTimeout(() => selectFlameChart(), 10);
                    profileView.viewSelectComboBox.select(profileView.viewSelectComboBox.options()[0]);
                    profileView._changeView && profileView._changeView() || profileView.changeView();
                    profileView.viewSelectComboBox.selectElement().addEventListener('change', () => {
                      setTimeout(() => {
                        var allLinks = document.querySelectorAll('.profile-node-file.devtools-link');
                        for (var i = 0; i < allLinks.length; i++) {
                          let link = allLinks[i];
                          if (link.fixed) continue;
                          let newLink = link.cloneNode(true);
                          newLink.href = link.href + ':' + link.innerText.split(':').pop();
                          newLink.fixed = true;
                          link.parentNode.replaceChild(newLink, link);
                        }
                      }, 100);
                    });
                  };
                  
                  selectFlameChart();
                }
                
                window.history.replaceState({}, null, '/${process.env.quokka?"quokka":"wallaby"}');
                
                document.addEventListener('click', e => {
                  if (e && e.srcElement && e.srcElement.href) {
                    window.${o}(JSON.stringify({ type: 'link', href: e.srcElement.href }));
                  } else if (e && e.path && e.path[1]) {
                    var parent = e.path[1];
                    var hover = parent.querySelector('.flame-chart-entry-info table');
                    if (hover && hover.rows) {
                      window.${o}(JSON.stringify({ type: 'link', href: 'file://' + hover.rows[3].cells[1].innerHTML }));
                    }
                  }                  
                });
            }
        }, 5);
      `})}_startChecking(e){clearTimeout(this._checker),this._checker=setTimeout(async()=>{try{if(!(await l.List(e)).length)throw new Error("Profile closed");this._startChecking(e)}catch(e){this.stop()}},300)}stop(){if(clearTimeout(this._checker),this._chrome){try{process.kill(this._chrome.pid)}catch(e){}delete this._chrome}}}},{"chrome-launcher":void 0,"chrome-remote-interface":void 0}],14:[function(a,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Runner=void 0;const r=a("child_process"),d=a("chrome-remote-interface"),s=a("./runWorkerPool"),n=a("./browserEnvironment"),o=a("net"),l=a("./utils"),h=logger.create("chromeRunner")["debug"];t.Runner=class{constructor(e){this._chromeInstances=new Map,this.screenShotReady=Promise.resolve(),this._profilerStopped=Promise.resolve({});var t=(this._project=e).settings().env;this._useWsl=l.default.isWsl()&&!t.runner,this._useWsl||l.default.patchModulesCode([{files:["chrome-launcher/dist/utils.js"],replacements:[{from:'const isWsl = require("is-wsl");',to:"const isWsl = false;",optional:!1}]}]),this._Launcher=a("chrome-launcher").Launcher;const i=this;this._Launcher.prototype.isDebuggerReady=function(){return new Promise((e,t)=>{const s=i._useWsl?l.default.wslHostIpAddress():"127.0.0.1",r=o.createConnection({port:this.port,host:s,timeout:5e3});r.once("error",e=>{h(`Connection to Chrome Debugger Protocol on ${s}:${this.port} failed: `+e),this.cleanup(r),t(e)}),r.once("timeout",()=>{h(`Connection to Chrome Debugger Protocol on ${s}:${this.port} timed out`),this.cleanup(r);var e=`Chrome instance is not available on ${s}:`+this.port+(i._useWsl?". Please verify that your network settings allow your WSL instance to connect to your Windows operating system. For more information please refer to https://wallabyjs.com/docs/intro/get-started-vscode.html#wsl-2":"");t({message:e})}),r.once("connect",()=>{h(`Connection to Chrome Debugger Protocol on ${s}:${this.port} succeeded`),this.cleanup(r),e(void 0)})})},this._path=t.runner,t.params&&t.params.runner&&(this._flags=t.params.runner.split(" ")),t.keepTabsOpened&&(this._keepTabsOpened=t.keepTabsOpened),this._workerPool=new s.WorkerPool(this._project,{create:_.bind(this._create,this),recycle:_.bind(this._recycle,this),healthy:()=>!0,prepare:_.bind(this._prepareTab,this)}),this._browserEnvironment=new n.BrowserEnvironment(e,this._workerPool)}run(e){return this._workerPool.run(e)}cancel(e){return this._workerPool.cancel(e)}async start(){await this._workerPool.start(this._browserEnvironment.webApp()),this._workerPool.setFileRoot(this._browserEnvironment.sandboxRootUrl())}stop(){this._workerPool.stop(),this._chromeInstances.forEach(e=>{try{process.kill(e.pid)}catch(e){}})}mapStack(e,t){return this._workerPool._mapStackEntries(e,t)}async _create(e,t){var s;this._chromeInstances.has(e)||(s=await this._launchChromeInstance())&&this._chromeInstances.set(e,s),t({workerId:e,chrome:this._chromeInstances.get(e)})}_recycle(e){h("Closing tab as a result of recycle call"),this._closeTab(e)}async _prepareTab(r,e){const i=this;var t=_.randomId(),s=this._browserEnvironment.sandboxName(e,t);h("Starting sandbox [%s]",s);const n=await this._workerPool.getWorker(e);if(n instanceof Error||n.runCancelled)return Promise.reject(n);this._checkCancelled(),h("Preparing sandbox [%s]",s);const o=await this._browserEnvironment.prepareSandbox(r,t,e,this._useWsl?"localhost":void 0);return this._checkCancelled(),h("Prepared sandbox [%s]",s),{name:s,sessionId:t,workerId:e,instance:{resume(){i._evaluateOnTab(n.client,function(){$_$tracer.resume()})},ping(e){i._evaluateOnTab(n.client,function(){},e)},close(e){if(r.profileRun){const t={client:n&&n.client};n&&(h("Deleting worker client for profile run"),delete n.client),i._profilerStopped.then(function(e){i._workerPool["worker:profile"](e&&e.profile||{}),h("Closing tab for profile run"),i._closeTab(t)})}else if(r.screen){const s={client:n&&n.client};n&&(h("Deleting worker client for screen run"),delete n.client),i.screenShotReady.then(function(){h("Closing tab for screen run"),i._closeTab(s)})}else h("Closing tab as requested"),i._closeTab(n);e(!0)},closing(){try{r.profileRun?i._profilerStopped=n.client.Profiler.stop():r.screen&&(i.screenShotReady=n.client.Page.captureScreenshot().then(function(e){e=Buffer.from(e.data,"base64");a("fs").writeFileSync(r.screen,e,"base64")}))}catch(e){i.screenShotReady=Promise.resolve(),i._profilerStopped=Promise.resolve({})}},start(t){n.profileRun=r.profileRun,i._openTab(n,o,e=>{t(e.status)?i._evaluateOnTab(n.client,`function() {
              if (document.readyState === 'complete') {
                $_$tracer.start();
              } else {
                window.addEventListener('load', function() { $_$tracer.start() });
              }
            }`):h("Failed to open chrome tab: "+e.status)})}}}}_checkCancelled(){if(this._workerPool.cancelled())throw{runCancelled:!0}}_connectionOptions(e,t={}){var s=this._useWsl?l.default.wslHostIpAddress():"127.0.0.1";return _.extend({port:e.chrome.port,host:s},t)}async _evaluateOnTab(e,t,s=_.noop){var r,i="Failed to evaluate code on Chrome Tab:";try{e.Runtime&&((r=(await e.Runtime.evaluate({expression:`(${t.toString()})()`})).exceptionDetails)?(this._handleHostError({message:r.exception&&r.exception.description}),h(i+" "+JSON.stringify(r))):s())}catch(e){h(i+" "+e.message)}}async _openTab(t,e,s=_.noop){try{if(!t.chrome)throw new Error("Chrome is not running");var r=this._connectionOptions(t,{url:"about:blank"}),i=await d.New(r),n=(t.client={target:{id:i.id}},this._checkCancelled(),await d({host:r.host,port:r.port,tab:i,target:i.id}));if(t.client=n,t.client.target={id:i.id},!t.client.Runtime)throw h(`Failed to create Chrome Tab (url: ${e}, host: ${r.host}, port: ${r.port}, wsl: ${this._useWsl})`),await this._closeTab(t),new Error("Failed to create Chrome Tab");this._checkCancelled();const{Page:c,Network:u,Profiler:p}=n;try{var o=!!this._browserEnvironment.doesSandboxContainESModules(),a=t.profileRun,l=[c.enable()];if(o&&l.push(u.enable()),a&&l.push(p.enable()),await Promise.all(l),this._checkCancelled(),o){u.requestIntercepted(({interceptionId:e,request:t})=>u.continueInterceptedRequest({interceptionId:e,url:this._updateTrackedFileUrlIfRequired(t.url)}).catch(e=>{}));try{await n.send("Network.setRequestInterception",{patterns:[{urlPattern:"*"}]})}catch(e){try{await u.setRequestInterceptionEnabled({enabled:!0})}catch(e){emitDiagnostic({name:"genericWarning",message:"Unable to configure network request interception in Chrome"})}}this._checkCancelled()}await c.navigate({url:e}),this._checkCancelled(),await c.loadEventFired(),this._checkCancelled(),a&&(await p.start(),this._checkCancelled()),s({status:"success"})}catch(e){h("Closing tab because failed to open it"),this._closeTab(t),s({status:"failed: "+(e.message||"unknown")})}}catch(e){s({status:"failed: "+(e.message||"unknown")})}}async _closeTab(e){if(h("Closing Chrome Tab"),delete this.screenShotReady,delete this._profilerStopped,e&&e.client){var t=e.client;delete e.client;try{this._keepTabsOpened||await d.Close(this._connectionOptions(e,{id:t.target.id}))}catch(e){h("Failed to close Chrome Tab: "+e.message)}try{t.close()}catch(e){h("Failed to close Chrome Tab client: "+e.message)}}}async _launchChromeInstance(){try{var e=["--headless","--disable-gpu","--deterministic-fetch"],t=("Linux"!==a("os").type()||this._useWsl||(e.push("--no-sandbox"),e.push("--disable-setuid-sandbox")),this._flags||e),s=(this._useWsl&&t.push("--remote-debugging-address="+l.default.wslHostIpAddress()),h(`launch new instance (path: ${this._path||"<default>"}, flags: ${t.join(" ")})`),new this._Launcher({chromeFlags:t,chromePath:this._path,logLevel:"true"===process.env.WALLABY_DEBUG_ENABLED?"error":"silent",maxConnectionRetries:20},{spawn:(e,t,s)=>(s.detached=!1,r.spawn)(e,t,s)}));return await s.launch(),{pid:s.pid,port:s.port,process:s.chrome}}catch(e){this._handleHostError(e)}}_updateTrackedFileUrlIfRequired(e){if(!e||~e.indexOf("wallabyFileId")||~e.indexOf("__wallaby__"))return e;let t=e;var s,r;return(t=t.replace(this._browserEnvironment.sandboxRootUrl(),""))!==e&&(s=t.lastIndexOf("?"),r=(t=0<=s?t.substring(0,s):t)&&this._project.getFileMetadataByPath(t))?e+(~s?"&":"?")+r.changeTs+"&wallabyFileId="+r.id:e}_handleHostError(e){this._project._cleanStack(e=e||{});var t="Chrome runner error: "+(e.message||"unknown"),e=e.stack||t;emitDiagnostic({name:"genericError",message:e}),this._project.emitTestRunError({text:t,header:"Chrome Runner"})}}},{"./browserEnvironment":12,"./runWorkerPool":77,"./utils":88,child_process:void 0,"chrome-launcher":void 0,"chrome-remote-interface":void 0,fs:void 0,net:void 0,os:void 0}],15:[function(a,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Runner=void 0;const r=a("child_process"),d=a("chrome-remote-interface"),s=a("./runWorkerPool"),n=a("./browserEnvironment"),o=a("net"),l=a("./utils"),h=logger.create("chromeRunner")["debug"];t.Runner=class{constructor(e){this.screenShotReady=Promise.resolve(),this._profilerStopped=Promise.resolve({});var t=(this._project=e).settings().env;this._useWsl=l.default.isWsl()&&!t.runner,this._useWsl||l.default.patchModulesCode([{files:["chrome-launcher/dist/utils.js"],replacements:[{from:'const isWsl = require("is-wsl");',to:"const isWsl = false;",optional:!1}]}]),this._Launcher=a("chrome-launcher").Launcher;const i=this;this._Launcher.prototype.isDebuggerReady=function(){return new Promise((e,t)=>{const s=i._useWsl?l.default.wslHostIpAddress():"127.0.0.1",r=o.createConnection({port:this.port,host:s,timeout:5e3});r.once("error",e=>{h(`Connection to Chrome Debugger Protocol on ${s}:${this.port} failed: `+e),this.cleanup(r),t(e)}),r.once("timeout",()=>{h(`Connection to Chrome Debugger Protocol on ${s}:${this.port} timed out`),this.cleanup(r);var e=`Chrome instance is not available on ${s}:`+this.port+(i._useWsl?". Please verify that your network settings allow your WSL instance to connect to your Windows operating system. For more information please refer to https://wallabyjs.com/docs/intro/get-started-vscode.html#wsl-2":"");t({message:e})}),r.once("connect",()=>{h(`Connection to Chrome Debugger Protocol on ${s}:${this.port} succeeded`),this.cleanup(r),e(void 0)})})},this._path=t.runner,t.params&&t.params.runner&&(this._flags=t.params.runner.split(" ")),t.keepTabsOpened&&(this._keepTabsOpened=t.keepTabsOpened),this._chromePromise=this._launchChromeInstance(),this._workerPool=new s.WorkerPool(this._project,{create:_.bind(this._create,this),recycle:_.bind(this._recycle,this),healthy:()=>!0,prepare:_.bind(this._prepareTab,this)}),this._browserEnvironment=new n.BrowserEnvironment(e,this._workerPool)}run(e){return this._workerPool.run(e)}cancel(e){return this._workerPool.cancel(e)}async start(){await this._workerPool.start(this._browserEnvironment.webApp()),this._workerPool.setFileRoot(this._browserEnvironment.sandboxRootUrl())}stop(){if(this._workerPool.stop(),this._chrome)try{process.kill(this._chrome.pid)}catch(e){}}mapStack(e,t){return this._workerPool._mapStackEntries(e,t)}async _create(e,t){await this._chromePromise,t({workerId:e})}_recycle(e){h("Closing tab as a result of recycle call"),this._closeTab(e)}async _prepareTab(r,e){const i=this;var t=_.randomId(),s=this._browserEnvironment.sandboxName(e,t);h("Starting sandbox [%s]",s);const n=await this._workerPool.getWorker(e);if(n instanceof Error||n.runCancelled)return Promise.reject(n);this._checkCancelled(),h("Preparing sandbox [%s]",s);const o=await this._browserEnvironment.prepareSandbox(r,t,e,this._useWsl?"localhost":void 0);return this._checkCancelled(),h("Prepared sandbox [%s]",s),{name:s,sessionId:t,workerId:e,instance:{resume(){i._evaluateOnTab(n.client,function(){$_$tracer.resume()})},ping(e){i._evaluateOnTab(n.client,function(){},e)},close(e){if(r.profileRun){const t={client:n&&n.client};n&&(h("Deleting worker client for profile run"),delete n.client),i._profilerStopped.then(function(e){i._workerPool["worker:profile"](e&&e.profile||{}),h("Closing tab for profile run"),i._closeTab(t)})}else if(r.screen){const s={client:n&&n.client};n&&(h("Deleting worker client for screen run"),delete n.client),i.screenShotReady.then(function(){h("Closing tab for screen run"),i._closeTab(s)})}else h("Closing tab as requested"),i._closeTab(n);e(!0)},closing(){try{r.profileRun?i._profilerStopped=n.client.Profiler.stop():r.screen&&(i.screenShotReady=n.client.Page.captureScreenshot().then(function(e){e=Buffer.from(e.data,"base64");a("fs").writeFileSync(r.screen,e,"base64")}))}catch(e){i.screenShotReady=Promise.resolve(),i._profilerStopped=Promise.resolve({})}},start(t){n.profileRun=r.profileRun,i._openTab(n,o,e=>{t(e.status)?i._evaluateOnTab(n.client,`function() {
              if (document.readyState === 'complete') {
                $_$tracer.start();
              } else {
                window.addEventListener('load', function() { $_$tracer.start() });
              }
            }`):h("Failed to open chrome tab: "+e.status)})}}}}_checkCancelled(){if(this._workerPool.cancelled())throw{runCancelled:!0}}_connectionOptions(e={}){var t=this._useWsl?l.default.wslHostIpAddress():"127.0.0.1";return _.extend({port:this._chrome.port,host:t},e)}async _evaluateOnTab(e,t,s=_.noop){var r,i="Failed to evaluate code on Chrome Tab:";try{e.Runtime&&((r=(await e.Runtime.evaluate({expression:`(${t.toString()})()`})).exceptionDetails)?(this._handleHostError({message:r.exception&&r.exception.description}),h(i+" "+JSON.stringify(r))):s())}catch(e){h(i+" "+e.message)}}async _openTab(t,e,s=_.noop){try{if(!this._chrome)throw new Error("Chrome is not running");var r=this._connectionOptions({url:"about:blank"}),i=await d.New(r),n=(t.client={target:{id:i.id}},this._checkCancelled(),await d({host:r.host,port:r.port,tab:i,target:i.id}));if(t.client=n,t.client.target={id:i.id},!t.client.Runtime)throw h(`Failed to create Chrome Tab (url: ${e}, host: ${r.host}, port: ${r.port}, wsl: ${this._useWsl})`),await this._closeTab(t),new Error("Failed to create Chrome Tab");this._checkCancelled();const{Page:c,Network:u,Profiler:p}=n;try{var o=!!this._browserEnvironment.doesSandboxContainESModules(),a=t.profileRun,l=[c.enable()];if(o&&l.push(u.enable()),a&&l.push(p.enable()),await Promise.all(l),this._checkCancelled(),o){u.requestIntercepted(({interceptionId:e,request:t})=>u.continueInterceptedRequest({interceptionId:e,url:this._updateTrackedFileUrlIfRequired(t.url)}).catch(e=>{}));try{await n.send("Network.setRequestInterception",{patterns:[{urlPattern:"*"}]})}catch(e){try{await u.setRequestInterceptionEnabled({enabled:!0})}catch(e){emitDiagnostic({name:"genericWarning",message:"Unable to configure network request interception in Chrome"})}}this._checkCancelled()}await c.navigate({url:e}),this._checkCancelled(),await c.loadEventFired(),this._checkCancelled(),a&&(await p.start(),this._checkCancelled()),s({status:"success"})}catch(e){h("Closing tab because failed to open it"),this._closeTab(t),s({status:"failed: "+(e.message||"unknown")})}}catch(e){s({status:"failed: "+(e.message||"unknown")})}}async _closeTab(e){if(h("Closing Chrome Tab"),delete this.screenShotReady,delete this._profilerStopped,e&&e.client){var t=e.client;delete e.client;try{this._keepTabsOpened||await d.Close(this._connectionOptions({id:t.target.id}))}catch(e){h("Failed to close Chrome Tab: "+e.message)}try{t.close()}catch(e){h("Failed to close Chrome Tab client: "+e.message)}}}async _launchChromeInstance(){try{var e=["--headless=old","--disable-gpu","--deterministic-fetch"],t=("Linux"!==a("os").type()||this._useWsl||(e.push("--no-sandbox"),e.push("--disable-setuid-sandbox")),this._flags||e),s=(this._useWsl&&t.push("--remote-debugging-address="+l.default.wslHostIpAddress()),h(`launch new instance (path: ${this._path||"<default>"}, flags: ${t.join(" ")})`),new this._Launcher({chromeFlags:t,chromePath:this._path,logLevel:"true"===process.env.WALLABY_DEBUG_ENABLED?"error":"silent",maxConnectionRetries:20},{spawn:(e,t,s)=>(s.detached=!1,r.spawn)(e,t,s)}));await s.launch(),this._chrome={pid:s.pid,port:s.port,process:s.chrome}}catch(e){this._handleHostError(e)}}_updateTrackedFileUrlIfRequired(e){if(!e||~e.indexOf("wallabyFileId")||~e.indexOf("__wallaby__"))return e;let t=e;var s,r;return(t=t.replace(this._browserEnvironment.sandboxRootUrl(),""))!==e&&(s=t.lastIndexOf("?"),r=(t=0<=s?t.substring(0,s):t)&&this._project.getFileMetadataByPath(t))?e+(~s?"&":"?")+r.changeTs+"&wallabyFileId="+r.id:e}_handleHostError(e){this._project._cleanStack(e=e||{});var t="Chrome runner error: "+(e.message||"unknown"),e=e.stack||t;emitDiagnostic({name:"genericError",message:e}),this._project.emitTestRunError({text:t,header:"Chrome Runner"})}}},{"./browserEnvironment":12,"./runWorkerPool":77,"./utils":88,child_process:void 0,"chrome-launcher":void 0,"chrome-remote-interface":void 0,fs:void 0,net:void 0,os:void 0}],16:[function(s,e,t){"use strict";var r,i,n,o=s("path"),a={},l={};class c{constructor(e){var t=this;this._opts=_.extend({},e||{}),this._noRename=this._opts.noFileRename,delete this._opts.noFileRename,this._nodeVisitor("Block",function(e){_.each(e.expressions,function(e){e.expression?t._pushRange(e.expression):t._pushRange(e)})}),this._nodeVisitor("Op",function(e){"&&"!==e.operator&&"||"!==e.operator&&"?"!==e.operator||(t._pushRange(e.first),t._pushRange(e.second))})}_nodeVisitor(e,t){var s;l[e]=t,a[e]||(s=r[e].prototype.compileNode,r[e].prototype.compileNode=function(){return l[e](this),s.apply(this,arguments)},a[e]=!0)}_pushRange(e){var t;e&&((t=e.locationData)?this._ranges.push([t.first_line+1,t.first_column,t.last_line+1,t.last_column+1]):e.args&&e.args.length&&this._pushRange(e.args[0]))}run(e){this._ranges=[];var t=i.compile(e.content,_.extend({},this._opts,{filename:e.path,sourceMap:!0,literate:n.isLiterate(e.path)}));return this._noRename||e.changeExt("js"),{map:t.v3SourceMap,code:t.js,ranges:this._ranges}}}const u=(e,t)=>{try{r=s(o.join(e,t)),i=s(e)}catch(e){return!1}return!0};e.exports=s=>t=>{var e=Error.prepareStackTrace;return u(o.join(s,"node_modules","coffeescript"),"lib/coffee-script/nodes")||u(o.join(s,"node_modules","coffee-script"),"lib/coffee-script/nodes")||u(o.join(s,"node_modules","coffeescript"),"lib/coffeescript/nodes")||u("coffee-script","lib/coffee-script/nodes"),Error.prepareStackTrace=e,n=i.helpers,e=>new c(t).run(e)}},{path:void 0}],17:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const path=require("path"),os=require("os"),fs=require("fs"),semver=require("semver"),url=require("url"),micromatch_1=require("micromatch"),utils_1=require("./utils"),{debug}=logger.create("config"),supportedTestFrameworks={node:{"mocha@2.1.0":{},"jest@0.4.3":{},"jest@24.8.0":{},"jasmine@2.3.4":{},"ava@1.0.0":{jsPreprocessor:e=>e.replace(/import test from ["|']ava["|']/,'var test = require("ava")')},"tape@4.2.2":{jsPreprocessor:e=>e.replace(/import test from ["|']tape["|']/,'var test = require("tape")')},"vitest@0.14.0":{},"node@1.0.0":{}},browser:{"jasmine@1.3.1":{},"jasmine@2.1.3":{},"jasmine@2.2.1":{configurator:"jasmine@2.1.3",reporter:"jasmine@2.1.3",starter:"jasmine@2.1.3"},"jasmine@2.3.4":{configurator:"jasmine@2.1.3",reporter:"jasmine@2.1.3",starter:"jasmine@2.1.3"},"jasmine@2.4.1":{configurator:"jasmine@2.1.3",reporter:"jasmine@2.1.3",starter:"jasmine@2.1.3"},"jasmine@2.5.1":{configurator:"jasmine@2.1.3",reporter:"jasmine@2.1.3",starter:"jasmine@2.1.3"},"jasmine@2.5.2":{configurator:"jasmine@2.1.3",reporter:"jasmine@2.1.3",starter:"jasmine@2.1.3"},"jasmine@2.6.3":{configurator:"jasmine@2.1.3",reporter:"jasmine@2.1.3",starter:"jasmine@2.1.3"},"jasmine@2.8.0":{configurator:"jasmine@2.1.3",reporter:"jasmine@2.1.3",starter:"jasmine@2.1.3"},"jasmine@3.2.1":{configurator:"jasmine@2.1.3",reporter:"jasmine@2.1.3",starter:"jasmine@2.1.3"},"jasmine@3.4.0":{configurator:"jasmine@2.1.3",reporter:"jasmine@2.1.3",starter:"jasmine@2.1.3"},"jasmine@3.5.0":{configurator:"jasmine@2.1.3",reporter:"jasmine@2.1.3",starter:"jasmine@2.1.3"},"jasmine@3.6.0":{configurator:"jasmine@2.1.3",reporter:"jasmine@2.1.3",starter:"jasmine@2.1.3"},"jasmine@4.6.0":{configurator:"jasmine@4.6.0",reporter:"jasmine@2.1.3",starter:"jasmine@2.1.3"},"jasmine@5.1.1":{configurator:"jasmine@4.6.0",reporter:"jasmine@2.1.3",starter:"jasmine@2.1.3"},"jasmine@3.10.0":{configurator:"jasmine@2.1.3",reporter:"jasmine@2.1.3",starter:"jasmine@2.1.3"},"mocha@2.0.1":{},"mocha@2.2.4":{configurator:"mocha@2.0.1",reporter:"mocha@2.0.1",starter:"mocha@2.0.1"},"mocha@3.2.0":{configurator:"mocha@2.0.1",reporter:"mocha@2.0.1",starter:"mocha@2.0.1"},"qunit@1.16.0":{},"qunit@1.18.0":{configurator:"qunit@1.16.0",reporter:"qunit@1.16.0",starter:"qunit@1.16.0"},"qunit@2.4.0":{configurator:"qunit@1.16.0",reporter:"qunit@2.4.0",starter:"qunit@1.16.0"}}},defaultPatterns={typeScript:"**/*.ts?(x)",coffeeScript:"**/*.?(lit)coffee?(.md)"};var defaults,config;class Config{constructor(e,t,s,r){this._onStartupEvent=s,defaults={files:{ignore:!1,trigger:!0,load:!0},tests:{ignore:!1,trigger:!0,load:!0}};const i=this._localProjectDir=path.dirname(e);this._configFile=e,this._root=t,this._cli=r,this._builtinCompilers={coffeeScript:require("./coffeeScriptCompiler")(i),babel:require("./babelCompiler")(i),typeScript:e=>e&&e.isolatedModules?require("./typeScriptCompiler")(i)(e):{replaceWithPostprocessor:!0,localProjectDir:i,opts:e}},this._builtinPostprocessors={typeScript:require("./typeScriptPostprocessor")(i),webpack:require("./postprocessors/webpack/initialize")(i)}}async load(){var _a,_b,_c,_d,_e,_f,_g;if(this._settings)return this._settings;let packageJson={};try{packageJson=require(path.join(this._localProjectDir,"package.json"))}catch(e){}const wallaby={localProjectDir:path.dirname(this._configFile)+path.sep,projectCacheDir:this._root,compilers:this._builtinCompilers,postprocessors:this._builtinPostprocessors,override:e=>({override:e}),defaults:{files:_.extend({},defaults.files),tests:_.extend({},defaults.tests)}};let esmConfig=!1,settings,configFilePath=this._configFile;if("auto.detect"!==path.basename(configFilePath)){let config;const startTime=(new Date).getTime();this._onStartupEvent("loadConfigFileStarted");try{try{config=require(configFilePath)}catch(cjsErr){if(process.env.WALLABY_INTEGRATION_TEST_RUN||process.env.WALLABY_UNIT_TEST_RUN)throw cjsErr;try{try{configFilePath=require("url").pathToFileURL(configFilePath)}catch(e){}config=await eval(_e1c‍.c("import(configFilePath)")),esmConfig=!0}catch(mjsErr){throw new Error("We have tried both CommonJs require and ESM import to load the config, you may find errors for each attempt below.\n-----------------------------\nCommonJs config loading error\n-----------------------------\n"+cjsErr.stack+"\n------------------------------\nES module config loading error\n------------------------------\n"+mjsErr.stack)}}if(config&&(config.__esModule||esmConfig)&&config.default&&(config=config.default),_.isFunction(config)){if(2===config.length?settings=await new Promise(t=>config(wallaby,e=>t(e))):(settings=config(wallaby),settings&&settings.constructor&&"Promise"===settings.constructor.name&&(settings=await settings)),!settings)throw new Error("Configuration function did not return an object.")}else settings=config;void 0!==settings.autoDetect||settings.files&&!_.isFunction(settings.files.override)||settings.tests&&!_.isFunction(settings.tests.override)||(settings.autoDetect=!0)}finally{this._onStartupEvent("loadConfigFileComplete")}}else settings={noSettingsFile:!0};const validateFileTestsPatterns=(e,t)=>{e&&_.isArray(e)&&e.forEach(e=>{if(_.isString(e)){if(-1!==e.indexOf("\\"))throw new Error(t+" Pattern contains backslashes, please use forward slashes instead.")}else if(_.isObject(e)&&e.pattern&&-1!==e.pattern.indexOf("\\"))throw new Error(t+" Pattern contains backslashes, please use forward slashes instead.")})},noSettingsFile=(validateFileTestsPatterns(settings.files,"File"),validateFileTestsPatterns(settings.tests,"Test"),settings.diagnostics=settings.diagnostics||{},settings=this._mergePackageFileSettings(settings,packageJson),settings.debug&&logger.enableDebug(),settings.trace&&logger.enableTrace(),this._settings=settings,settings.noSettingsFile);delete settings.noSettingsFile;let autoDetectSettings="autoDetect"===(_.isString(settings.testFramework||"")?settings.testFramework:settings.testFramework.type)||settings.testFramework&&settings.testFramework.autoDetected||settings.autoDetect,availableAutomaticConfigurationProviders=_.isArray(settings.autoDetect)?settings.autoDetect:["angular","jest","vitest","node:test"];if(packageJson){const dependencies=Object.assign(Object.assign({},packageJson.dependencies),packageJson.devDependencies);availableAutomaticConfigurationProviders.some(e=>"vitest"===e)&&dependencies.vitest&&(availableAutomaticConfigurationProviders=["vitest",...availableAutomaticConfigurationProviders.filter(e=>"vitest"!==e)])}delete settings.autoDetect;const autoDetectedSettings={original:void 0,hard:{},soft:{}};if(noSettingsFile||autoDetectSettings){noSettingsFile&&(settings.testFramework="autoDetect",autoDetectSettings=!0),settings.env&&settings.env.params&&settings.env.params.env&&_.reduce(settings.env.params.env.split(";"),function(e,t){var s=t.split("=");return e[_.trimLeft(s[0])]=t.substring(s[0].length+1),e},process.env);const automaticConfigurationProviders=[...availableAutomaticConfigurationProviders.map(e=>{switch(e){case"angular":return{provider:e,configure:require("./configurators/angular-cli/configure").configure};case"jest":return{provider:e,configure:require("./configurators/jest/configure").configure};case"vitest":return{provider:e,configure:require("./configurators/vitest/configure").configure};case"node:test":return{provider:e,configure:require("./configurators/nodeNative/configure").configure}}})].filter(e=>!!e),startTime=(new Date).getTime();this._onStartupEvent("testConfigDiscoveryStarted");try{const errors=(await automaticConfigurationProviders.reduce(async(e,t)=>{e=await e;if(!e.success){var s=(new Date).getTime(),r=(debug("Attempting automatic configuration for %s",t.provider),await t.configure(this._localProjectDir,autoDetectedSettings,settings,packageJson)),i=(new Date).getTime();if(debug("Finished attempting automatic configuration for %s (%sms)",t.provider,i-s),r.success)return Promise.resolve({success:!0,errors:[]});r&&r.errors&&e.errors.push(...r.errors)}return Promise.resolve(e)},Promise.resolve({success:!1,errors:[]}))).errors;if(errors.length){if(1===errors.length)throw errors[0];{let message=""+errors[0].message;throw errors.shift(),errors.forEach(e=>message+=""+os.EOL+e.message),new Error(message)}}}finally{this._onStartupEvent("testConfigDiscoveryComplete")}}let filesOrTestsAutoPopulated=!1;if(!settings.files||_.isFunction(settings.files.override)){let files=[];if(filesOrTestsAutoPopulated=!0,settings.testFramework&&"jest"===settings.testFramework.type){const jestWallabyConfig=settings.testFramework.originalConfig.wallaby;files=_.map(jestWallabyConfig.watchPathIgnorePatterns,e=>({pattern:e,regexp:new RegExp(e),ignore:!0})),files.push({pattern:"**/**"}),jestWallabyConfig.roots.length&&(files=files.concat(_.map(jestWallabyConfig.roots,e=>({pattern:e+"/**"}))))}settings.files=settings.files&&_.isFunction(settings.files.override)?settings.files.override(files):files}if(void 0===settings.captureConsoleLog)settings.captureConsoleLog=!0;else if(!1!==settings.captureConsoleLog&&!0!==settings.captureConsoleLog)throw new Error("captureConsoleLog property must be either true or false");if(!_.isArray(settings.files)||!settings.files.length)throw new Error("Files property must be non-empty array of files/file patterns");if(!settings.tests||_.isFunction(settings.tests.override)){let tests=[];if(filesOrTestsAutoPopulated=!0,"jest"===settings.testFramework.type){const jestWallabyConfig=settings.testFramework.originalConfig.wallaby;tests=_.map(jestWallabyConfig.testPathIgnorePatterns,e=>({pattern:e,regexp:new RegExp(e),ignore:!0})),jestWallabyConfig.roots.length&&jestWallabyConfig.testMatch.length&&_.every(jestWallabyConfig.testMatch,e=>_.startsWith(e,"**"))?tests=tests.concat(_.reduce(jestWallabyConfig.roots,(e,t)=>e.concat(_.map(jestWallabyConfig.testMatch,e=>({pattern:t+"/"+e}))),[])):(jestWallabyConfig.testMatch.length&&(tests=tests.concat(_.map(jestWallabyConfig.testMatch,e=>({pattern:e})))),jestWallabyConfig.testRegex.length&&(tests=tests.concat(_.map(jestWallabyConfig.testRegex,e=>({pattern:e,regexp:new RegExp(e)})))))}settings.tests=settings.tests&&_.isFunction(settings.tests.override)?settings.tests.override(tests):tests}if(!_.isArray(settings.tests)||!settings.tests.length)throw new Error("Tests property must be non-empty array of test files/file patterns");if(settings.filesWithNoCoverageCalculated=settings.filesWithNoCoverageCalculated||[],settings.runAllTestsInAffectedTestFile=settings.runAllTestsInAffectedTestFile||!1,settings.updateNoMoreThanOneSnapshotPerTestFileRun=settings.updateNoMoreThanOneSnapshotPerTestFileRun||!1,void 0!==settings.addModifiedTestFileToExclusiveTestRun)throw settings.addModifiedTestFileToExclusiveTestRun?new Error(`addModifiedTestFileToExclusiveTestRun has been deprecated, use smartStart settings instead:
...
  smartStart: [
    { startMode: 'edit' }, // Supported Options: 'edit', 'open', 'never'
  ],
...
`):new Error(`addModifiedTestFileToExclusiveTestRun has been deprecated, use smartStart settings instead:
...
  smartStart: [
    { startMode: 'never' },  // Supported Options: 'edit', 'open', 'never'
  ],
...
`);if(settings.compilers=settings.compilers||{},!_.isObject(settings.compilers))throw new Error("If defined, compilers property must be an object.");const isNativeBundler=settings.postprocessor&&settings.postprocessor.bundler&&settings.postprocessor.bundler.native;if(isNativeBundler||(settings.compilers[defaultPatterns.coffeeScript]||autoDetectedSettings.hard.noCompilers||(settings.compilers[defaultPatterns.coffeeScript]=this._builtinCompilers.coffeeScript()),autoDetectedSettings.hard.noCompilers)||settings.compilers[defaultPatterns.typeScript]||_.find(_.keys(settings.compilers),e=>(0,micromatch_1.isMatch)("a.ts",e))||settings.noDefaultTypeScriptCompiler||(settings.compilers[defaultPatterns.typeScript]=this._builtinCompilers.typeScript()),this._configureSmartStart(settings),this._configureLogLimits(settings),settings.preprocessors=settings.preprocessors||{},!_.isObject(settings.preprocessors))throw new Error("If defined, preprocessors property must be an object.");if(_.values(settings.preprocessors).length&&autoDetectedSettings.hard.noPreprocessors)throw new Error("Preprocessors cannot be set.");if(settings.postprocessor&&!_.isFunction(settings.postprocessor))throw new Error("Postprocessor must be a function if set");if(settings.testRunComplete&&!_.isFunction(settings.testRunComplete))throw new Error("TestRunComplete hook must be a function if set");if(settings.postprocessor&&autoDetectedSettings.hard.noPostprocessor)throw new Error("Postprocessor cannot be set.");if(isNativeBundler){if(_.values(settings.compilers).length)throw new Error("Compilers cannot be set if built in webpack postprocessor is used.");if(_.values(settings.preprocessors).length)throw new Error("Preprocessors cannot be set if built in webpack postprocessor is used.")}if(autoDetectedSettings.hard.noCompilers||isNativeBundler||this._adjustTypeScriptCompilers(settings),_.isFunction(settings.middleware)||(settings.middleware=_.noop),settings.maxConsoleMessagesPerTest=settings.maxConsoleMessagesPerTest||100,settings.maxTraceSteps=settings.maxTraceSteps||999999,settings.maxTraceStepsForWatchExpressionPrefetch=process.env.WALLABY2&&!process.env.WALLABY_UNIT_TEST_RUN?null!=(_a=settings.maxTraceStepsForWatchExpressionPrefetch)?_a:10:0,settings.telemetry=!1!==settings.telemetry,settings.autoConsoleLog=!1!==settings.autoConsoleLog,settings.delays=settings.delays||{},settings.delays.run=settings.delays.run||0,settings.delays.run?settings.delays.edit=0:settings.delays.edit=settings.delays.edit||100,settings.delays.update=settings.delays.update||0,settings.workers=settings.workers||{},settings.workers.initial=settings.workers.initial||0,settings.workers.regular=settings.workers.regular||0,_.isBoolean(settings.workers.restart)?settings.workers.recycle=settings.workers.restart:settings.workers.recycle=!!settings.workers.recycle,settings.bootstrap&&settings.setup)throw new Error("The `setup` and `bootstrap` functions are alias of the same setting, so only one of them is allowed in the config.");var setup=settings.bootstrap||settings.setup,modulePrototype,compile;if(settings.bootstrap=setup&&setup.toString(),delete settings.setup,settings.teardown=settings.teardown&&settings.teardown.toString(),this._normalizeFunction(settings,"bootstrap"),this._normalizeFunction(settings,"teardown"),settings.hints=settings.hints||{},settings.hints.ignoreCoverage=utils_1.default.serializeRegExp(settings.hints.ignoreCoverage||/ignore coverage|istanbul ignore|c8 ignore/),settings.hints.ignoreCoverageForFile=utils_1.default.serializeRegExp(settings.hints.ignoreCoverageForFile||/ignore file coverage/),settings.hints.commentAutoLog=settings.hints.commentAutoLog||"?",settings.hints.testFileSelection=settings.hints.testFileSelection||{},settings.hints.testFileSelection.include=utils_1.default.serializeRegExp(settings.hints.testFileSelection.include||/file\.only/),settings.hints.testFileSelection.exclude=utils_1.default.serializeRegExp(settings.hints.testFileSelection.exclude||/file\.skip/),settings.automaticTestFileSelection=!1!==settings.automaticTestFileSelection,settings.runSelectedTestsOnly=!0===settings.runSelectedTestsOnly,settings.mapConsoleMessagesStackTrace=!0===settings.mapConsoleMessagesStackTrace,settings.extensions=settings.extensions||{},settings.env||(settings.env=autoDetectedSettings.hard.env||{type:"browser",kind:"chrome"}),!_.isObject(settings.env))throw new Error("Environment is not specified correctly");if(settings.env.type=autoDetectedSettings.hard.env&&autoDetectedSettings.hard.env.type||settings.env.type||"browser",settings.env.params=settings.env.params||{},settings.env.params.runner=(null==(_d=null==(_c=null==(_b=autoDetectedSettings.hard)?void 0:_b.env)?void 0:_c.params)?void 0:_d.runner)||(null==(_f=null==(_e=settings.env)?void 0:_e.params)?void 0:_f.runner),void 0===settings.env.params.runner&&delete settings.env.params.runner,"browser"!==settings.env.type||settings.env.kind||(settings.env.kind="chrome"),settings.env.kind&&"phantomjs"!==settings.env.kind&&"electron"!==settings.env.kind&&"chrome"!==settings.env.kind&&"chrome-new"!==settings.env.kind)throw new Error('Specified browser environment kind "'+settings.env.kind+'" is not supported');if("node"!==settings.env.type||settings.env.runner||(settings.env.runner=process.execPath),"node"===settings.env.type){const pathParts=(process.env.PATH||"").split(":"),runnerPath=path.dirname(settings.env.runner);pathParts.includes(runnerPath)||(process.env.PATH=[runnerPath,...pathParts].join(":"))}if("electron"===settings.env.kind&&!settings.env.runner)try{try{settings.env.runner=utils_1.default.requireModuleFrom(wallaby.localProjectDir,"electron")}catch(ignored){settings.env.runner=utils_1.default.requireModuleFrom(wallaby.localProjectDir,"electron-prebuilt")}}catch(e){throw new Error("Electron runner path is not specified and `electron` module was not found.\nEither specify a path in `env.runner` or install the electron module by running `npm install electron --save-dev`")}if("phantomjs"===settings.env.kind&&!settings.env.runner)try{try{settings.env.runner=utils_1.default.requireModuleFrom(wallaby.localProjectDir,"phantomjs").path}catch(ignored){settings.env.runner=utils_1.default.requireModuleFrom(wallaby.localProjectDir,"phantomjs-prebuilt").path}}catch(e){throw new Error("From June 2019, Wallaby.js no longer ships with PhantomJs version 2.1.1.\nPhantomJs runner path is not specified and neither `phantomjs` nor `phantomjs-prebuilt` modules were found.\nEither specify a path in `env.runner` or install the phantomjs module by running `npm install phantomjs-prebuilt --save-dev`\nRead more in our docs: https://wallabyjs.com/docs/integration/phantomjs2.html ")}if(settings.reportUnhandledPromises="node"===settings.env.type?!1!==settings.reportUnhandledPromises:!0===settings.reportUnhandledPromises,"browser"===settings.env.type&&(settings.throwOnBeforeUnload=!1!==settings.throwOnBeforeUnload),settings.env.viewportSize=_.extend({width:800,height:600},settings.env.viewportSize||{}),settings.env.options=_.extend({},settings.env.viewportSize,settings.env.options||{}),!1!==settings.env.bundle&&(settings.env.bundle=!0),settings.testFramework=settings.testFramework||("browser"===settings.env.type?"jasmine@3.10.0":"mocha@2.1.0"),settings.testFramework=this._normalizeTestFramework(settings),"node@1.0.0"===settings.testFramework.version&&semver.lt(process.versions.node,"22.3.0"))throw new Error(`Node Native Test Runner for Node.js version ${process.versions.node} is not supported. Please use Node.js version 22.3.0 or higher.`);if(settings.env&&"node"===settings.env.type&&settings.env.params&&settings.env.params.runner&&-1!==settings.env.params.runner.indexOf("--experimental-vm-modules")&&settings.testFramework&&settings.testFramework.version){if(-1===settings.env.params.runner.indexOf("--experimental-loader")){const hooksV2Api=semver.gte(process.versions.node,"17.0.0")||semver.gte(process.versions.node,"16.12.0")&&semver.lt(process.versions.node,"17.0.0")||semver.gte(process.versions.node,"14.999.999")&&semver.lt(process.versions.node,"15.0.0")||semver.gte(process.versions.node,"12.999.999")&&semver.lt(process.versions.node,"13.0.0"),hookFilename=hooksV2Api?"hooks-v2.mjs":"hooks.mjs",hookPath=path.join(path.dirname(process.mainModule.filename),`runners/node/${settings.testFramework.version}/`+hookFilename);fs.existsSync(hookPath)&&(settings.env.params.runner+=` --experimental-loader "${url.pathToFileURL(hookPath)}"`)}-1!==settings.env.params.runner.indexOf("--experimental-loader")&&delete settings.testFramework.jsPreprocessor}_.values(settings.compilers).length&&(wallaby.defaults&&wallaby.defaults.files&&!1!==wallaby.defaults.files.instrument&&(wallaby.defaults.files.instrument=!0),wallaby.defaults&&wallaby.defaults.tests&&!1!==wallaby.defaults.tests.instrument&&(wallaby.defaults.files.instrument=!0),defaults.files.instrument=!0,defaults.tests.instrument=!0),settings.files=_.map(settings.files,this._normalizeFileObject.bind(this,wallaby.defaults&&wallaby.defaults.files||_.extend({},defaults.files))),settings.tests=_.map(settings.tests,this._normalizeFileObject.bind(this,wallaby.defaults&&wallaby.defaults.tests||_.extend({},defaults.tests))),filesOrTestsAutoPopulated&&_.each(_.filter(settings.tests,e=>!e.ignore),t=>{var e;_.find(settings.files,e=>e.ignore&&e.pattern===t.pattern)||((e=_.clone(t)).ignore=!0,settings.files.push(e))}),settings.slowTestThreshold=settings.slowTestThreshold||75,settings.lowCoverageThreshold=settings.lowCoverageThreshold||80,(process.env.WALLABY_INTEGRATION_TEST_RUN||settings.noLogThrottling)&&(settings.noLogThrottling=!0);const isJest=0===settings.testFramework.version.indexOf("jest"),isVitest=0===settings.testFramework.version.indexOf("vitest");if(void 0===settings.runAllTestsWhenNoAffectedTests&&(settings.runAllTestsWhenNoAffectedTests=!isJest&&!isNativeBundler&&!isVitest),isJest||"node"!==settings.env.type||void 0===settings.symlinkNodeModules&&(settings.symlinkNodeModules="module"===packageJson.type||void 0),isJest&&!autoDetectSettings){if(!_.find(settings.files,function(e){return e&&_.endsWith(e.pattern,".snap")})){const self=this;_.each(settings.tests,e=>{e&&e.pattern&&settings.files.push(self._normalizeFileObject({ignore:e.ignore,instrument:!1,trigger:!0,load:!0},e.pattern+".snap"))})}_.find(settings.files,function(e){return e&&"package.json"===e.pattern})||settings.files.push(this._normalizeFileObject({ignore:!1,instrument:!1,trigger:!0,load:!0},"package.json")),_.isEmpty(settings.preprocessors)||(modulePrototype=require("module").Module.prototype,compile=modulePrototype._compile,modulePrototype._compile=function(e,t){return t&&~t.indexOf("babel-plugin-jest-hoist")&&e&&((t=e.replace("if (!expr.isCallExpression())",'if(expr.isSequenceExpression()){const expressions = expr.get("expressions");if (!expressions || expressions.length !== 2) return false;expr = expressions[1];}if (!expr.isCallExpression())'))===e&&emitDiagnostic({name:"genericWarning",message:"Initialization of babel-plugin-jest-hoist preset has failed."}),arguments[0]=t),compile.apply(this,arguments)},global.$_$w)||(global.$_$w=global.$_$w_=global.$_$wf=global.$_$wv=global.$_$tracer=!0),settings.preprocessors&&!settings.preprocessors["package.json"]&&(settings.preprocessors["package.json"]=e=>{e=JSON.parse(e.content);return delete e.babel,JSON.stringify(e)})}if(-1===(null==(_g=settings.testFramework.version)?void 0:_g.indexOf("node"))){if(settings.esmHooks)throw new Error("esmHooks setting is only supported for Node Native Test Runner.");if(settings.esmHooks||settings.preloadModules)throw new Error("preloadModules setting is only supported for Node Native Test Runner.")}return settings}_normalizeFunction(e,t){var s,r,i;e[t]&&0!==e[t].indexOf("function")&&0!==e[t].indexOf("async function")&&(0===e[t].indexOf("async")?e[t]="async function "+e[t].substr("async".length):e[t]="function "+e[t],i=(s=e[t].split("\n")[0]).indexOf("=>"),r=s.indexOf("{"),0<i&&(-1===r||i<r)&&(e[t]=e[t].replace("=>","{")+"}"),0<i)&&s.indexOf("(")<0&&(r=(s=e[t].split("\n")[0]).indexOf("{"),i=s.substring("function ".length,r),e[t]=e[t].replace(i,"("+i+")"))}_configureLogLimits(a){const l={inline:{depth:5,elements:5e3},values:{default:{stringLength:8192},autoExpand:{elements:5e3,stringLength:8192,depth:10}}},i=(t,s)=>{if(s=s||[],_.isObject(t)){const r=[];return Object.keys(t).forEach(e=>{i(t[e],[...s,e]).filter(e=>!!e).forEach(e=>r.push(e))}),r}return[s]};var e=i(l);e.forEach(e=>{var s=["logLimits",...e.slice(0,-1)];{var r,i=s;let t=a;for(let e=0;e<i.length;e++){var n=i[e];if(t[n]){if(!_.isObject(t[n]))throw new Error(i.join(".")+" property must be an object.")}else t[n]={};t=t[n]}}{var o=e;let t=a.logLimits,s=l;for(let e=0;e<o.length-1;e++)t=t[o[e]],s=s[o[e]];if(t[o[o.length-1]]){if(!_.isNumber(t[o[o.length-1]]))throw new Error(`logLimits.${o.join(".")} property must be numeric.`);if(t[o[o.length-1]]<=0)throw new Error(`logLimits.${o.join(".")} property must be greater than zero.`)}else t[o[o.length-1]]=s[o[o.length-1]]}})}_configureSmartStart(e){if(e.smartStart){if(!_.isArray(e.smartStart))throw new Error("smartStart property must be an array of options");if(0===e.smartStart.length)throw new Error("smartStart array must contain at least one option.");e.smartStart=e.smartStart.map(t=>{var e={};if(!_.isObject(t))throw new Error("smartStart option must be an object.");if(t.test){if(!_.isBoolean(t.test))throw new Error("smartStart option.test must be a boolean.");e.test=t.test}if(t.source)throw new Error("smartStart option.source is not a supported option.");if(e.source=!1,void 0!==e.test||e.source||(e.test=!0),t.pattern){if(!_.isString(t.pattern))throw new Error("smartStart option.pattern must be a string.");e.pattern=t.pattern}else e.pattern="**/*";if(t.path){if(t.pattern)throw new Error("smartStart only one of option.path and option.pattern may be specified.");if(!_.isString(t.path))throw new Error("smartStart option.path must be a string.");e.path=t.path}if(t.startMode){var s=["always","never","edit","open"];if(!s.find(e=>t.startMode===e))throw new Error("smartStart option.pattern must one of ["+s.join(", ")+"].");e.startMode=t.startMode}return e})}else e.smartStart=[];e.smartStart.push({test:!0,source:!1,pattern:"**/*",startMode:this._cli?"edit":"open"}),e.smartStart.push({test:!1,source:!0,pattern:"**/*",startMode:"edit"})}_normalizeTestFramework(e){var t,s=supportedTestFrameworks[e.env.type];if(s)return t=this._resolveTestFrameworkVersion(e,s),s=_.extend({version:t,configurator:t,reporter:t,starter:t},s[t]),e.testFramework.path&&(s.path=e.testFramework.path),e.testFramework.configFile&&(s.configFile=e.testFramework.configFile),e.testFramework.autoDetected&&(s.autoDetected=!0,delete s.originalConfig),e.testFramework.toolVersion&&(s.toolVersion=e.testFramework.toolVersion),s;throw new Error("Environment ["+e.env.type+"] is not supported")}_resolveTestFrameworkVersion(e,t){var s=_.isString(e.testFramework)?e.testFramework:e.testFramework.type;if("jest"!==s||e.testFramework.autoDetected||(s+="@0.4.3"),~s.indexOf("@")){if(t[s])return s;throw new Error("Test framework ["+s+"] is not supported")}{let r={};_.each(t,(e,t)=>{var s=t.substr(0,t.indexOf("@"));r[s]=t});e=r[s];if(e)return e;throw new Error("Test framework ["+s+"] is not supported")}}_adjustTypeScriptCompilers(s){var e,r=!!s.postprocessor,i={files:{}};_.each(s.compilers,(e,t)=>{e&&e.replaceWithPostprocessor&&(i.postprocessor=e.postprocessor,delete s.compilers[t],r&&(e.opts=e.opts||{}),i.files[t]=e.opts,e.opts)&&e.opts.typescript&&(i.typescript=e.opts.typescript,delete e.opts.typescript)}),_.isEmpty(i.files)||(e=i.postprocessor||this._builtinPostprocessors.typeScript(i),s.postprocessor=r?[e,s.postprocessor]:e)}_normalizeFileObject(e,t){if(_.isString(t))t={pattern:t};else if(!t.pattern)throw new Error("File/test entry must either be a string or an object that contains pattern property");t=_.defaults(t,e);return t.regexp||("!"===t.pattern[0]&&(t.ignore=!t.ignore,t.pattern=t.pattern.substring(1)),"/"===t.pattern[0]&&(t.pattern=t.pattern.substring(1)),"."===t.pattern[0]&&"/"===t.pattern[1]&&(t.pattern=t.pattern.substring(2))),t}_mergePackageFileSettings(e,t){return t&&t.wallaby?_.merge(t.wallaby,e):e}}function default_1(e,t,{forceUpdate:s,cli:r}={},i=()=>{}){return(config=config&&!s?config:new Config(e,t,i,r)).load()}exports.default=default_1},{"./babelCompiler":10,"./coffeeScriptCompiler":16,"./configurators/angular-cli/configure":18,"./configurators/jest/configure":44,"./configurators/nodeNative/configure":46,"./configurators/vitest/configure":47,"./postprocessors/webpack/initialize":64,"./typeScriptCompiler":82,"./typeScriptPostprocessor":83,"./utils":88,fs:void 0,micromatch:void 0,module:void 0,os:void 0,path:void 0,semver:void 0,url:void 0}],18:[function(F,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.configure=void 0;const C=F("path");var s=F("fs"),r=F("util");const T=F("semver"),E=F("../../utils"),j=r.promisify(s.exists),R=F("../../utils/joinWithLookUp").default,{debug:I,trace:O}=logger.create("angular/cli config");t.configure=async function(s,r,i,n){try{O("Detecting Angular CLI.");const{path:b,type:w,content:k}=await(0,F("./detect").default)(s)||{};if(!b)return I("Angular CLI not found."),{success:!1,errors:[]};I("Detected Angular CLI."),i.diagnostics.angular={workspace:k};try{if(!k.version||!Object.keys(k.projects||{}).length)throw new Error(`'${b}' is not a valid Angular CLI file.`);if("nx"===w&&k.projects){F("./nxModulePatch");for(const S in k.projects){var o=k.projects[S];o.targets&&o.targets.test&&(o.architect=o.targets,o.targets.test.executor)&&(o.targets.test.builder=o.targets.test.executor)}}const x=C.dirname(b);let e,t;if("ng"===w||"nx"===w){var a=R([x,"node_modules","@angular","cli","package.json"]);if(await j(a)){var l=F(C.resolve(a));if(e=l.version,!T.valid(e)||T.lt(e,"8.2.0"))throw new Error("Only Angular CLI v8.2.0 or higher is supported.")}else if("ng"===w)throw new Error("Cannot detect @angular/cli package version, is the package installed?")}if("nx"===w){var c=E.default.tryRequireModuleWithPathFrom(x,"@nrwl/workspace/package.json",!1)||E.default.tryRequireModuleWithPathFrom(x,"@nx/workspace/package.json",!1);if(!c)throw new Error("Cannot detect @nx/workspace package version, is the package installed?");var u=F(C.resolve(c.path));if(t=u.version,!T.valid(t)||T.lt(t,"8.0.0"))throw new Error("Only @nrwl/workspace v8.0.0 or higher is supported.")}if(I('Angular currentDirPath: "%s", workspaceDirPath: "%s"',s,x),s===x){var p=i["angular-cli"];const P=p&&Array.isArray(p.excludedProjects)?new Set(p.excludedProjects):new Set;var d,h,g=Object.keys(k.projects).map(e=>({name:e,configuration:k.projects[e]})).filter(e=>e.configuration.architect&&e.configuration.architect.test&&("@angular-devkit/build-angular:karma"===e.configuration.architect.test.builder||"@angular-builders/custom-webpack:karma"===e.configuration.architect.test.builder||"@ngx-env/builder:karma"===e.configuration.architect.test.builder)).filter(e=>!P.has(e.name)),f=Object.keys(k.projects).map(e=>({name:e,configuration:k.projects[e]})).filter(e=>e.configuration.architect&&e.configuration.architect.test&&"@angular-builders/jest:run"===e.configuration.architect.test.builder).filter(e=>!P.has(e.name)),m=Object.keys(k.projects).map(e=>({name:e,configuration:k.projects[e]})).filter(e=>e.configuration.architect&&e.configuration.architect.test&&("@nrwl/jest:jest"===e.configuration.architect.test.builder||"@nx/jest:jest"===e.configuration.architect.test.builder)).filter(e=>!P.has(e.name));if(!g.length&&!f.length&&!m.length)throw new Error("None of your projects are configured with `@angular-devkit/build-angular:karma`, `@angular-builders/custom-webpack:karma`, `@ngx-env/builder:karma`, `@angular-builders/jest:run`, `@nrwl/jest:jest` or `@nx/jest:jest` builders as their test architect or all your projects are excluded.");g.length&&e?(d=T.major(e),h=T.minor(e),1<g.length?await new(F(8===d?"./karma/v8/WorkspaceConfigurator":d<12?"./karma/v9/WorkspaceConfigurator":d<13?"./karma/v12/WorkspaceConfigurator":d<14?h<1?"./karma/v13/WorkspaceConfigurator":"./karma/v13.1/WorkspaceConfigurator":d<15?"./karma/v13.1/WorkspaceConfigurator":d<16?"./karma/v15/WorkspaceConfigurator":d<19?"./karma/v16/WorkspaceConfigurator":"./karma/v19/WorkspaceConfigurator").WorkspaceConfigurator)(x,b,k,e).configure(i):await new(F(8===d?"./karma/v8/ProjectConfigurator":d<12?"./karma/v9/ProjectConfigurator":d<13?"./karma/v12/ProjectConfigurator":d<14?h<1?"./karma/v13/ProjectConfigurator":"./karma/v13.1/ProjectConfigurator":d<15?"./karma/v13.1/ProjectConfigurator":d<16?"./karma/v15/ProjectConfigurator":d<19?"./karma/v16/ProjectConfigurator":"./karma/v19/ProjectConfigurator").ProjectConfigurator)(x,b,k,g[0]).configure(!0,i)):f.length?1<f.length?await new(F("./v8-jest/WorkspaceConfigurator").WorkspaceConfigurator)(s,r,i,n,x,k).configure():await new(F("./v8-jest/ProjectConfigurator").ProjectConfigurator)(s,r,i,n,x,f[0]).configure():m.length&&(1<m.length?await new(F("./v8-nrwl-jest/WorkspaceConfigurator").WorkspaceConfigurator)(s,r,i,n,x,k).configure():await new(F("./v8-nrwl-jest/ProjectConfigurator").ProjectConfigurator)(s,r,i,n,x,m[0]).configure())}else{var _=Object.keys(k.projects).map(e=>({name:e,configuration:k.projects[e]})).find(e=>C.resolve(C.join(x,e.configuration.root))===s);if(!_)throw new Error(`A project for '${s}' directory cannot be detected.`);if(!_.configuration.architect||!_.configuration.architect.test||"@angular-devkit/build-angular:karma"!==_.configuration.architect.test.builder&&"@angular-builders/custom-webpack:karma"!==_.configuration.architect.test.builder&&"@ngx-env/builder:karma"!==_.configuration.architect.test.builder&&"@angular-builders/jest:run"!==_.configuration.architect.test.builder&&"@nx/jest:jest"!==_.configuration.architect.test.builder&&"@nrwl/jest:jest"!==_.configuration.architect.test.builder)throw new Error(`The project ${_.name} is not configured with \`@angular-devkit/build-angular:karma\`, \`@angular-builders/custom-webpack:karma\`, \`@ngx-env/builder:karma\`, \`@angular-builders/jest:run\`, \`@nrwl/jest:jest\` or \`@nx/jest:jest\` builder as its test architect.`);if("@angular-devkit/build-angular:karma"===_.configuration.architect.test.builder||"@angular-builders/custom-webpack:karma"===_.configuration.architect.test.builder||"@ngx-env/builder:karma"===_.configuration.architect.test.builder){var v=T.major(e),y=T.minor(e);await new(F(8===v?"./karma/v8/ProjectConfigurator":v<12?"./karma/v9/ProjectConfigurator":v<13?"./karma/v12/ProjectConfigurator":v<14?y<1?"./karma/v13/ProjectConfigurator":"./karma/v13.1/ProjectConfigurator":v<15?"./karma/v13.1/ProjectConfigurator":v<16?"./karma/v15/ProjectConfigurator":v<19?"./karma/v16/ProjectConfigurator":"./karma/v19/ProjectConfigurator").ProjectConfigurator)(x,b,k,_).configure(!1,i)}else if("@angular-builders/jest:run"===_.configuration.architect.test.builder)await new(F("./v8-jest/ProjectConfigurator").ProjectConfigurator)(s,r,i,n,x,_).configure();else if("@nrwl/jest:jest"===_.configuration.architect.test.builder||"@nx/jest:jest"===_.configuration.architect.test.builder){if(!T.valid(t)||T.gt(t,"11.1.4"))return delete i.diagnostics.angular,I("@nx/workspace v11.1.4 and higher uses jest automatic configuration."),{success:!1,errors:[]};await new(F("./v8-nrwl-jest/ProjectConfigurator"))(s,r,i,n,x,_).configure()}}return{success:!0,errors:[]}}catch(e){throw I(e),I("Angular.json: \n %O",k),e}}catch(e){return I(e),{success:!1,errors:[new Error("Automatic Angular CLI configuration error: "+e.message)]}}}},{"../../utils":88,"../../utils/joinWithLookUp":90,"./detect":19,"./karma/v12/ProjectConfigurator":20,"./karma/v12/WorkspaceConfigurator":21,"./karma/v13.1/ProjectConfigurator":22,"./karma/v13.1/WorkspaceConfigurator":23,"./karma/v13/ProjectConfigurator":24,"./karma/v13/WorkspaceConfigurator":26,"./karma/v15/ProjectConfigurator":27,"./karma/v15/WorkspaceConfigurator":28,"./karma/v16/ProjectConfigurator":29,"./karma/v16/WorkspaceConfigurator":30,"./karma/v19/ProjectConfigurator":31,"./karma/v19/WorkspaceConfigurator":32,"./karma/v8/ProjectConfigurator":33,"./karma/v8/WorkspaceConfigurator":34,"./karma/v9/ProjectConfigurator":36,"./karma/v9/WorkspaceConfigurator":37,"./nxModulePatch":38,"./v8-jest/ProjectConfigurator":39,"./v8-jest/WorkspaceConfigurator":40,"./v8-nrwl-jest/ProjectConfigurator":41,"./v8-nrwl-jest/WorkspaceConfigurator":42,fs:void 0,path:void 0,semver:void 0,util:void 0}],19:[function(c,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const u=c("path");var s=c("fs"),r=c("util");const p=c("../../utils"),d=logger.create("angular/cli config")["debug"],i="angular.json",n="workspace.json",o="nx.json",a=r.promisify(s.exists);t.default=async function(e){var t=u.parse(e).root,s=async(s,r,e)=>{if("nx"===r){process.env.NX_DAEMON="false";try{if(2===c(s).version||e){var i=u.dirname(s),n=(p.default.tryRequireModuleWithPathFrom(i,"nx/src/adapter/compat",!1),p.default.tryRequireModuleWithPathFrom(i,"nx/src/project-graph/project-graph",!1));if(n&&n.module&&n.module.buildProjectGraphWithoutDaemon){process.env.NX_CACHE_PROJECT_GRAPH="false",d("Loading nx workspace using buildProjectGraphWithoutDaemon");try{const l=(await n.module.buildProjectGraphWithoutDaemon()).nodes;return Object.keys(l).forEach(e=>{l[e]=Object.assign(Object.assign({},l[e]),l[e].data),delete l[e].type,delete l[e].data}),{path:s,type:r,content:{version:1,configFileName:s,nxWorkspace:!0,projects:l}}}catch(e){}}let t=p.default.tryRequireModuleWithPathFrom(i,"nx/src/config/workspaces",!1);if((t=t&&t.module?t:p.default.tryRequireModuleWithPathFrom(i,"@nrwl/tao/src/shared/workspace",!1))&&t.module){var o=new t.module.Workspaces(i);let e;return t.module.resolveOldFormatWithInlineProjects?(d("Loading nx workspace using resolveOldFormatWithInlineProjects"),e=t.module.resolveOldFormatWithInlineProjects(o.readWorkspaceConfiguration())):o.readWorkspaceConfiguration?(d("Loading nx workspace using readWorkspaceConfiguration"),(e=o.readWorkspaceConfiguration()).version=e.version||1):d("Missing readWorkspaceConfiguration and resolveOldFormatWithInlineProjects from "+t.path),e.configFileName=s,e.nxWorkspace=!0,{path:s,type:r,content:e}}var a=p.default.tryRequireModuleWithPathFrom(i,"nx/src/project-graph/utils/retrieve-workspace-files",!1);if(a&&a.module)return d("Loading nx workspace using retrieveProjectConfigurationsWithoutPluginInference"),{path:s,type:r,content:{version:1,configFileName:s,nxWorkspace:!0,projects:await a.module.retrieveProjectConfigurationsWithoutPluginInference(i)}}}else d("Failed to detect nx workspace module")}catch(e){d(`Failed to load nx workspace: ${e.toString()} `+(e.stack||""))}}return{path:s,type:r,content:c(s)}};let r=e;if(await a(u.join(r,o)))return await a(u.join(r,i))?s(u.join(r,i),"nx"):await a(u.join(r,n))?s(u.join(r,n),"nx"):s(u.join(r,o),"nx",!0);if(await a(u.join(r,i)))return s(u.join(r,i),"ng");for(;;){if(r===t)return;if(r=u.resolve(r,".."),await a(u.join(r,o)))return await a(u.join(r,i))?s(u.join(r,i),"nx"):await a(u.join(r,n))?s(u.join(r,n),"nx"):s(u.join(r,o),"nx",!0);if(await a(u.join(r,i)))return s(u.join(r,i),"ng")}}},{"../../utils":88,fs:void 0,path:void 0,util:void 0}],20:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.ProjectConfigurator=void 0;class r extends e("../v9/ProjectConfigurator").ProjectConfigurator{constructor(e,t,s,r){super(e,t,s,r)}_getWebpackConfigurations(e,t){var{getCommonConfig:e,getTypeScriptConfig:s,getStylesConfig:r,getTestConfig:i,getWorkerConfig:n}=e;return[e(t),r(t),s(t),i(t),n(t)]}_adjustPostprocessor(e){const n=e._prepareCompiler.bind(e);e._prepareCompiler=(e,t,s,r,i)=>{i.watchMode=!0,n(e,i)}}_adjustPlugins(e){const t="zone.js/testing fix: https://github.com/angular/angular/issues/42260";e.push({apply:e=>{e.hooks.normalModuleFactory.tap(t,e=>{e.hooks.createModule.tap(t,e=>{"zone.js/testing"!==e.rawRequest&&"zone.js/dist/zone-testing"!==e.rawRequest||e.resourceResolveData&&(e.resourceResolveData.patch=e=>e.replace("instance.install = function () {","instance.install = function () { var process = {listeners: function(){},removeAllListeners: function(){}};"))})})}})}_getZoneImportStatement(){return"import 'zone.js';"}_getZoneTestingImportStatement(){return"import 'zone.js/testing';"}_getAllLoaders(e){var t=e.filter(e=>e.rules).map(e=>e.rules).flat(),e=e.filter(e=>e.use).map(e=>e.use).flat(),s=t.filter(e=>e.use).map(e=>e.use).flat(),t=t.filter(e=>e.oneOf).map(e=>e.oneOf).flat().filter(e=>e.use).map(e=>e.use).flat();return _.union(e,s,t)}}s.ProjectConfigurator=r},{"../v9/ProjectConfigurator":36}],21:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.WorkspaceConfigurator=void 0;const T=e("path"),r=e("semver"),E=e("../../../../utils");var i=e("../v9/WorkspaceConfigurator");const j=e("lodash"),R=logger.create("angular/cli karma workspace config")["trace"];class n extends i.WorkspaceConfigurator{constructor(e,t,s,r){super(e,t,s,r)}_getWebpackConfigurations(e,t){var{getCommonConfig:e,getTypeScriptConfig:s,getStylesConfig:r,getTestConfig:i,getWorkerConfig:n}=e;return[e(t),r(t),s(t),i(t),n(t)]}_adjustPostprocessor(e,n,r,i,o){const a=e._prepareCompiler.bind(e);let l=!1;const c=()=>{var e=o();const t=e.lstat,s=e.readFile;e.readFile=e=>e===r?i:s(e),e.lstat=e=>e===r?{isDirectory:()=>!1}:t(e)};e._prepareCompiler=(e,t,s,r,i)=>{i.watchMode=!0,a(e,i),e?n&&!l&&(c(),l=!0):n&&c()}}_adjustPlugins(e){const t="zone.js/testing fix: https://github.com/angular/angular/issues/42260";e.push({apply:e=>{e.hooks.normalModuleFactory.tap(t,e=>{e.hooks.createModule.tap(t,e=>{"zone.js/testing"!==e.rawRequest&&"zone.js/dist/zone-testing"!==e.rawRequest||e.resourceResolveData&&(e.resourceResolveData.patch=e=>e.replace("instance.install = function () {","instance.install = function () { var process = {listeners: function(){},removeAllListeners: function(){}};"))})})}})}_deduplicateMainFileContent(e){return e.replace(/import\s*'zone\.js'\s*;/,"").replace(/import\s*'zone\.js\/testing'\s*;/,"").replace(/import\s*{\s*getTestBed\s*}\s*from\s*'@angular\/core\/testing'\s*;/,"").replace(/declare\s+const\s+require\s*:\s*any\s*;/,"").replace(/declare\s*const\s*require\s*:\s*{\s*context\s*\(\s*path\s*:\s*string\s*,\s*deep\?\s*:\s*boolean\s*,\s*filter\?\s*:\s*RegExp\s*\)\s*:\s*{\s*keys\s*\(\s*\)\s*:\s*string\s*\[\s*]\s*;\s*<\s*T\s*>\s*\(\s*id\s*:\s*string\s*\)\s*:\s*T\s*;\s*}\s*;\s*}\s*;/,"").replace(/declare\s*const\s*require\s*:\s*{\s*context\s*\(\s*path\s*:\s*string\s*,\s*deep\?\s*:\s*boolean\s*,\s*filter\?\s*:\s*RegExp\s*\)\s*:\s*{\s*<\s*T\s*>\s*\(\s*id\s*:\s*string\s*\)\s*:\s*T\s*;\s*keys\s*\(\s*\)\s*:\s*string\s*\[\s*]\s*;\s*}\s*;\s*}\s*;\s*/,"").replace(/import\s*{\s*BrowserDynamicTestingModule\s*,\s*platformBrowserDynamicTesting,?\s*}\s*from\s*'@angular\/platform-browser-dynamic\/testing'\s*;/,"").replace(/getTestBed\s*\(\s*\)\s*.\s*initTestEnvironment\s*\(\s*BrowserDynamicTestingModule\s*,\s*platformBrowserDynamicTesting\s*\(\s*\)\s*,?\s*\)\s*;/,"").replace(/getTestBed\s*\(\s*\)\s*.\s*initTestEnvironment\s*\(\s*BrowserDynamicTestingModule\s*,\s*platformBrowserDynamicTesting\s*\(\s*\),\s*{\s*teardown\s*:\s*{\s*destroyAfterEach\s*:\s*true\s*}\s*,?\s*}\s*,?\s*\)\s*;/,"").replace(/getTestBed\s*\(\s*\)\s*.\s*initTestEnvironment\s*\(\s*BrowserDynamicTestingModule\s*,\s*platformBrowserDynamicTesting\s*\(\s*\),\s*{\s*teardown\s*:\s*{\s*destroyAfterEach\s*:\s*false\s*}\s*,?\s*}\s*,?\s*\)\s*;/,"")}_fixStyleRules(t,s){if(R("Sanitizing style rules."),s.module&&s.module.rules){var r=s.module.rules,s=r.filter(e=>e.rules).map(e=>e.rules).flat(),i=r.filter(e=>e.use).map(e=>e.use).flat(),n=s.filter(e=>e.use).map(e=>e.use).flat(),s=s.filter(e=>e.oneOf).map(e=>e.oneOf).flat().filter(e=>e.use).map(e=>e.use).flat();for(const w of j.union(i,n,s))"string"!=typeof w&&w.options&&(this._checkCssLoader(w.loader,"less-loader")||this._checkCssLoader(w.loader,"postcss-loader")||this._checkCssLoader(w.loader,"resolve-url-loader"))&&(w.options.sourceMap=!1);var o,a=new Map;for(let e=0;e<r.length;e++){var l=r[e],c=l.rules||[],c=(2===c.length&&c[0].oneOf&&c[0].oneOf.length&&c[1].use&&!c[1].use.length?c[0].oneOf.filter(e=>e.use).map(e=>e.use):c.filter(e=>e.use).map(e=>e.use)).flat();!l.mimetype&&c.length&&"string"!=typeof(c=c[c.length-1])&&(this._checkCssLoader(c.loader,"sass-loader")||this._checkCssLoader(c.loader,"less-loader")||this._checkCssLoader(c.loader,"stylus-loader")||this._checkCssLoader(c.loader,"postcss-loader"))&&a.set(e,l)}let e=0;for([o]of a)r.splice(o-e,1),e++;var u,p,d=new Map;for([,u]of a)if(u.test){let e={test:u.test,rules:[]};d.has(u.test.toString())?e=d.get(u.test.toString()):(e.rules.push({oneOf:[]}),e.rules.push({oneOf:[]}),d.set(u.test.toString(),e));var h=e.rules[0],g=e.rules[1],f=u.rules[0],m=u.rules[1],_=(e,t,s)=>{e.type&&(t.type=e.type),e.resourceQuery&&(t.resourceQuery=e.resourceQuery);for(const n of e.use){var r,i;"string"!=typeof n?((r=this._copyCssLoader(n)).options&&(i=s&&s.length?s.map(e=>E.default.normalizePath(T.resolve(T.join(this._workspaceDirPath,e)))):null,this._setCssLoaderOptionsPaths(r,i)),t.use.push(r)):t.use.push(n)}};for(const k of t){let s=null;if(k.configuration.architect.test.options){var v=k.configuration.architect.test.options.stylePreprocessorOptions;if(v&&v.includePaths){s=[];for(const P of v.includePaths)s.push(P)}}const x=[];t.filter(e=>e.name!==k.name).forEach(e=>{const t=T.resolve(T.join(this._workspaceDirPath,e.configuration.root));s&&s.length&&s.some(e=>T.resolve(T.join(this._workspaceDirPath,e)).startsWith(t))||x.push(t),(e.configuration.architect.test.options.styles||[]).forEach(e=>x.push(T.resolve(T.join(this._workspaceDirPath,"string"==typeof e?e:e.input))))});var y=k.configuration.architect.test.options.styles||[];let e=!0;for(const F of f.oneOf){const C={use:[]};if(_(F,C,s),e)e=!1,C.exclude=[],y.forEach(e=>C.exclude.push(T.resolve(T.join(this._workspaceDirPath,"string"==typeof e?e:e.input)))),x.forEach(e=>C.exclude.push(e));else{if(!y.length)continue;C.include=[],y.forEach(e=>C.include.push(T.resolve(T.join(this._workspaceDirPath,"string"==typeof e?e:e.input))))}C.use.length&&h.oneOf.push(C)}const S={use:[]};_(m,S,s),S.exclude=[],x.forEach(e=>S.exclude.push(e)),S.use.length&&g.oneOf.push(S)}var b={use:[]},b=(_(f.oneOf[0],b),b.use.length&&h.oneOf.push(b),{use:[]});_(m,b,null),b.use.length&&g.oneOf.push(b)}for([,p]of d)r.push(p)}}_getZoneImportStatement(e){return"import 'zone.js';"}_getZoneTestingImportStatement(e){return"import 'zone.js/testing';"}_getTestEnvironmentInitStatement(){return r.minor(this._version)<2?"getTestBed().initTestEnvironment(BrowserDynamicTestingModule, platformBrowserDynamicTesting());":"getTestBed().initTestEnvironment(BrowserDynamicTestingModule, platformBrowserDynamicTesting(), { teardown: { destroyAfterEach: true }});"}_copyCssLoader(e){return{loader:e.loader,options:this._copyCssLoaderOptions(e)}}}s.WorkspaceConfigurator=n},{"../../../../utils":88,"../v9/WorkspaceConfigurator":37,lodash:void 0,path:void 0,semver:void 0}],22:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.ProjectConfigurator=void 0;class r extends e("../v13/ProjectConfigurator").ProjectConfigurator{constructor(e,t,s,r){super(e,t,s,r)}_adjustBuildOptions(e){e.aot=!1,e.optimization=!1,e.buildOptimizer=!1}_adjustConfiguration(e){super._adjustConfiguration(e),e.experiments||(e.experiments={}),e.experiments.backCompat=!0}_getWebpackConfigurations(e,t){var{getCommonConfig:e,getStylesConfig:s}=e;return[e(t),s(t)]}}s.ProjectConfigurator=r},{"../v13/ProjectConfigurator":24}],23:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.WorkspaceConfigurator=void 0;const E=e("path"),j=e("../../../../utils");e=e("../v13/WorkspaceConfigurator");const R=logger.create("angular/cli karma workspace config")["trace"];class r extends e.WorkspaceConfigurator{constructor(e,t,s,r){super(e,t,s,r)}_adjustBuildOptions(e){e.aot=!1,e.optimization=!1,e.buildOptimizer=!1}_adjustConfiguration(e){super._adjustConfiguration(e),e.experiments||(e.experiments={}),e.experiments.backCompat=!0}_getWebpackConfigurations(e,t){var{getCommonConfig:e,getStylesConfig:s}=e;return[e(t),s(t)]}_fixStyleRules(t,s){if(R("Sanitizing style rules."),s.module&&s.module.rules){var r=s.module.rules,s=r.filter(e=>e.rules).map(e=>e.rules).flat(),i=r.filter(e=>e.use).map(e=>e.use).flat(),n=s.filter(e=>e.use).map(e=>e.use).flat(),s=s.filter(e=>e.oneOf).map(e=>e.oneOf).flat().filter(e=>e.use).map(e=>e.use).flat();for(const k of _.union(i,n,s))"string"!=typeof k&&k.options&&(this._checkCssLoader(k.loader,"less-loader")||this._checkCssLoader(k.loader,"postcss-loader")||this._checkCssLoader(k.loader,"resolve-url-loader"))&&(k.options.sourceMap=!1);var o,a=new Map;for(let e=0;e<r.length;e++){var l=r[e],c=l.rules||[],c=(2===c.length&&c[0].oneOf&&c[0].oneOf.length&&c[1].use&&!c[1].use.length?c[0].oneOf.filter(e=>e.use).map(e=>e.use):c.filter(e=>e.use).map(e=>e.use)).flat();!l.mimetype&&c.length&&"string"!=typeof(c=c[c.length-1])&&(this._checkCssLoader(c.loader,"sass-loader")||this._checkCssLoader(c.loader,"less-loader")||this._checkCssLoader(c.loader,"stylus-loader")||this._checkCssLoader(c.loader,"postcss-loader"))&&a.set(e,l)}let e=0;for([o]of a)r.splice(o-e,1),e++;var u,p,d=new Map;for([,u]of a)if(u.test){let e={test:u.test,rules:[]};d.has(u.test.toString())?e=d.get(u.test.toString()):(e.rules.push({oneOf:[]}),e.rules.push({oneOf:[]}),d.set(u.test.toString(),e));var h=e.rules[0],g=e.rules[1],f=u.rules[0],m=u.rules[1],v=(e,t,s)=>{e.type&&(t.type=e.type),e.resourceQuery&&(t.resourceQuery=e.resourceQuery);for(const n of e.use){var r,i;"string"!=typeof n?((r=this._copyCssLoader(n)).options&&(i=s&&s.length?s.map(e=>j.default.normalizePath(E.resolve(E.join(this._workspaceDirPath,e)))):null,this._setCssLoaderOptionsPaths(r,i)),t.use.push(r)):t.use.push(n)}};for(const x of t){let s=null;if(x.configuration.architect.test.options){var y=x.configuration.architect.test.options.stylePreprocessorOptions;if(y&&y.includePaths){s=[];for(const F of y.includePaths)s.push(F)}}const S=[];t.filter(e=>e.name!==x.name).forEach(e=>{const t=E.resolve(E.join(this._workspaceDirPath,e.configuration.root));s&&s.length&&s.some(e=>E.resolve(E.join(this._workspaceDirPath,e)).startsWith(t))||S.push(t),(e.configuration.architect.test.options.styles||[]).forEach(e=>S.push(E.resolve(E.join(this._workspaceDirPath,"string"==typeof e?e:e.input))))});var b=x.configuration.architect.test.options.styles||[];let e=!0;for(const C of f.oneOf){const T={use:[]};if(v(C,T,s),e){if(e=!1,!b.length)continue;T.include=[],b.forEach(e=>T.include.push(E.resolve(E.join(this._workspaceDirPath,"string"==typeof e?e:e.input))))}else T.exclude=[],b.forEach(e=>T.exclude.push(E.resolve(E.join(this._workspaceDirPath,"string"==typeof e?e:e.input)))),S.forEach(e=>T.exclude.push(e));T.use.length&&h.oneOf.push(T)}const P={use:[]};v(m,P,s),P.exclude=[],S.forEach(e=>P.exclude.push(e)),P.use.length&&g.oneOf.push(P)}var w={use:[]},w=(v(f.oneOf[0],w),w.use.length&&h.oneOf.push(w),{use:[]}),w=(v(f.oneOf[1],w),w.use.length&&h.oneOf.push(w),{use:[]});v(m,w,null),w.use.length&&g.oneOf.push(w)}for([,p]of d)r.push(p)}}}s.WorkspaceConfigurator=r},{"../../../../utils":88,"../v13/WorkspaceConfigurator":26,path:void 0}],24:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.ProjectConfigurator=void 0;var r=e("../v12/ProjectConfigurator");const i=e("./StyleLoaderResolverPlugin");class n extends r.ProjectConfigurator{constructor(e,t,s,r){super(e,t,s,r)}_adjustConfiguration(e){e.resolveLoader||(e.resolveLoader={}),e.resolveLoader.plugins||(e.resolveLoader.plugins=[]),e.resolveLoader.plugins.push(new i.StyleLoaderResolverPlugin),e.plugins=e.plugins.filter(e=>!(e.constructor&&e.constructor.name&&"MiniCssExtractPlugin"===e.constructor.name))}_replaceCssLoader(e){0<=e.loader.indexOf("mini-css-extract-plugin")&&(e.loader="style-loader",e.options={})}}s.ProjectConfigurator=n},{"../v12/ProjectConfigurator":20,"./StyleLoaderResolverPlugin":25}],25:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.StyleLoaderResolverPlugin=void 0;var r=e("../../../../utils");const i=e("style-loader");r.default.patchModule("style-loader",()=>i);s.StyleLoaderResolverPlugin=class{constructor(){}apply(e){e=e.ensureHook("file");e.tapAsync("WallabyPlugin",(e,t,s)=>{if("./node_modules/style-loader"===e.relativePath)return s(null,{path:"style-loader"});s()})}}},{"../../../../utils":88,"style-loader":void 0}],26:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.WorkspaceConfigurator=void 0;const url=require("url"),WorkspaceConfigurator_1=require("../v12/WorkspaceConfigurator"),StyleLoaderResolverPlugin_1=require("./StyleLoaderResolverPlugin"),joinWithLookUp=require("../../../../utils/joinWithLookUp").default;class WorkspaceConfigurator extends WorkspaceConfigurator_1.WorkspaceConfigurator{constructor(e,t,s,r){super(e,t,s,r)}async _getFileSystemGetter(){const path=joinWithLookUp([this._workspaceDirPath,"node_modules","@angular","compiler-cli","bundles","index.js"]);return eval(_e1c‍.c(`import('${url.pathToFileURL(path)}');`))}_getTestEnvironmentInitStatement(){return"getTestBed().initTestEnvironment(BrowserDynamicTestingModule, platformBrowserDynamicTesting());"}_copyCssLoader(e){return e.loader.indexOf("mini-css-extract-plugin")<0?{loader:e.loader,options:this._copyCssLoaderOptions(e)}:{loader:"style-loader",options:{}}}_adjustConfiguration(e){e.resolveLoader||(e.resolveLoader={}),e.resolveLoader.plugins||(e.resolveLoader.plugins=[]),e.resolveLoader.plugins.push(new StyleLoaderResolverPlugin_1.StyleLoaderResolverPlugin),e.plugins=e.plugins.filter(e=>!(e.constructor&&e.constructor.name&&"MiniCssExtractPlugin"===e.constructor.name))}}exports.WorkspaceConfigurator=WorkspaceConfigurator},{"../../../../utils/joinWithLookUp":90,"../v12/WorkspaceConfigurator":21,"./StyleLoaderResolverPlugin":25,url:void 0}],27:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.ProjectConfigurator=void 0;class r extends e("../v13.1/ProjectConfigurator").ProjectConfigurator{constructor(e,t,s,r){super(e,t,s,r)}_getMainFileContent(){return`
  ${"library"===this._project.configuration.projectType?this._getZoneImportStatement():""}
  ${this._getZoneTestingImportStatement()}
  import { getTestBed } from '@angular/core/testing';
  import {
    BrowserDynamicTestingModule,
    platformBrowserDynamicTesting,
   } from '@angular/platform-browser-dynamic/testing';

  // Initialize the Angular testing environment.
  getTestBed().initTestEnvironment(BrowserDynamicTestingModule, platformBrowserDynamicTesting(), {
    errorOnUnknownElements: true,
    errorOnUnknownProperties: true
  });`}_wrapStyleImport(e){return e+"?ngGlobalStyle"}_getMainFileExtension(){return".js"}get _isNoSpecMainFileAllowed(){return!0}}s.ProjectConfigurator=r},{"../v13.1/ProjectConfigurator":22}],28:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.WorkspaceConfigurator=void 0;class r extends e("../v13.1/WorkspaceConfigurator").WorkspaceConfigurator{constructor(e,t,s,r){super(e,t,s,r)}_deduplicateMainFileContent(e){return e.replace(/import\s*'zone\.js'\s*;/,"").replace(/import\s*'zone\.js\/testing'\s*;/,"").replace(/import\s*{\s*getTestBed\s*}\s*from\s*'@angular\/core\/testing'\s*;/,"").replace(/declare\s+const\s+require\s*:\s*any\s*;/,"").replace(/declare\s*const\s*require\s*:\s*{\s*context\s*\(\s*path\s*:\s*string\s*,\s*deep\?\s*:\s*boolean\s*,\s*filter\?\s*:\s*RegExp\s*\)\s*:\s*{\s*keys\s*\(\s*\)\s*:\s*string\s*\[\s*]\s*;\s*<\s*T\s*>\s*\(\s*id\s*:\s*string\s*\)\s*:\s*T\s*;\s*}\s*;\s*}\s*;/,"").replace(/declare\s*const\s*require\s*:\s*{\s*context\s*\(\s*path\s*:\s*string\s*,\s*deep\?\s*:\s*boolean\s*,\s*filter\?\s*:\s*RegExp\s*\)\s*:\s*{\s*<\s*T\s*>\s*\(\s*id\s*:\s*string\s*\)\s*:\s*T\s*;\s*keys\s*\(\s*\)\s*:\s*string\s*\[\s*]\s*;\s*}\s*;\s*}\s*;\s*/,"").replace(/import\s*{\s*BrowserDynamicTestingModule\s*,\s*platformBrowserDynamicTesting,?\s*}\s*from\s*'@angular\/platform-browser-dynamic\/testing'\s*;/,"").replace(/getTestBed\s*\(\s*\)\s*.\s*initTestEnvironment\s*\(\s*BrowserDynamicTestingModule\s*,\s*platformBrowserDynamicTesting\s*\(\s*\)(.|\n|\r\n)*\)\s*;/,"")}_getTestEnvironmentInitStatement(){return`getTestBed().initTestEnvironment(BrowserDynamicTestingModule, platformBrowserDynamicTesting(), {
    errorOnUnknownElements: true,
    errorOnUnknownProperties: true
  });`}_wrapStyleImport(e){return e+"?ngGlobalStyle"}_getMainFileExtension(){return".js"}_copyCssLoaderOptions(e){var t;if(e.options)return this._checkCssLoader(e.loader,"sass-loader")?("legacy"===(t=Object.assign({},e.options)).api&&(t.sassOptions=Object.assign({},e.options.sassOptions)),t):super._copyCssLoaderOptions(e)}_setCssLoaderOptionsPaths(e,t){if(this._checkCssLoader(e.loader,"sass-loader"))if("modern"===e.options.api){const s=e.options.sassOptions;e.options.sassOptions=e=>{e=s(e);return e.includePaths=t,e}}else super._setCssLoaderOptionsPaths(e,t);else super._setCssLoaderOptionsPaths(e,t)}get _isNoSpecMainFileAllowed(){return!0}}s.WorkspaceConfigurator=r},{"../v13.1/WorkspaceConfigurator":23}],29:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.ProjectConfigurator=void 0;class r extends e("../v15/ProjectConfigurator").ProjectConfigurator{constructor(e,t,s,r){super(e,t,s,r)}_getPolyfillImportStatement(e){return`import '${e}';`}}s.ProjectConfigurator=r},{"../v15/ProjectConfigurator":27}],30:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.WorkspaceConfigurator=void 0;class r extends e("../v15/WorkspaceConfigurator").WorkspaceConfigurator{constructor(e,t,s,r){super(e,t,s,r)}_getPolyfillImportStatement(e){return`import '${e}';`}_getTsPath(e){return e=e.startsWith("./")?e:"./"+e}}s.WorkspaceConfigurator=r},{"../v15/WorkspaceConfigurator":28}],31:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.ProjectConfigurator=void 0;class r extends e("../v16/ProjectConfigurator").ProjectConfigurator{constructor(e,t,s,r){super(e,t,s,r)}_getZoneImportStatement(){var e;return null!=(e=null==(e=null==(e=null==(e=null==(e=this._project.configuration)?void 0:e.architect)?void 0:e.test)?void 0:e.options)?void 0:e.polyfills)&&e.includes("zone.js")?super._getZoneImportStatement():""}_getZoneTestingImportStatement(){var e;return null!=(e=null==(e=null==(e=null==(e=null==(e=this._project.configuration)?void 0:e.architect)?void 0:e.test)?void 0:e.options)?void 0:e.polyfills)&&e.includes("zone.js")?super._getZoneTestingImportStatement():""}}s.ProjectConfigurator=r},{"../v16/ProjectConfigurator":29}],32:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.WorkspaceConfigurator=void 0;class r extends e("../v16/WorkspaceConfigurator").WorkspaceConfigurator{constructor(e,t,s,r){super(e,t,s,r)}_getZoneImportStatement(e){var t;return null!=(t=null==(t=null==(t=null==(t=null==(t=e.configuration)?void 0:t.architect)?void 0:t.test)?void 0:t.options)?void 0:t.polyfills)&&t.includes("zone.js")?super._getZoneImportStatement(e):""}_getZoneTestingImportStatement(e){var t;return null!=(t=null==(t=null==(t=null==(t=null==(t=e.configuration)?void 0:t.architect)?void 0:t.test)?void 0:t.options)?void 0:t.polyfills)&&t.includes("zone.js")?super._getZoneTestingImportStatement(e):""}}s.WorkspaceConfigurator=r},{"../v16/WorkspaceConfigurator":30}],33:[function(z,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ProjectConfigurator=void 0,z("./modulePatch");const U=z("../../../../utils/joinWithLookUp").default,J=z("path"),H=z("os"),G=z("fs");var s=z("util");const Q=z("semver"),Y=z("lodash"),Z=z("../../../../utils"),K=s.promisify(G.exists),X=s.promisify(G.readFile),{debug:ee,trace:te}=logger.create("angular/cli karma project config");process.env.NG_BUILD_IVY_LEGACY="1";t.ProjectConfigurator=class{constructor(e,t,s,r){this._workspaceDirPath=Z.default.normalizePath(e),this._workspaceConfigFilePath=Z.default.normalizePath(t),this._workspaceConfig=s,this._project=r}async configure(t,e){te("Configuring.");var s=Z.default.tryRequireModuleWithPathFrom(this._workspaceDirPath,"jasmine-core/package.json",!1),s=(e.testFramework&&(Y.isString(e.testFramework)&&e.testFramework.startsWith("jasmine")?e.testFramework={type:e.testFramework,autoDetected:!0}:e.testFramework.type&&e.testFramework.type.startsWith("jasmine")?e.testFramework.autoDetected=!0:delete e.testFramework),e.testFramework||(!s||!s.module||Q.lt(s.module.version,"4.0.0")?e.testFramework={type:"jasmine",autoDetected:!0}:Q.lt(s.module.version,"5.0.0")?e.testFramework={type:"jasmine@4.6.0",autoDetected:!0}:e.testFramework={type:"jasmine@5.1.1",autoDetected:!0}),e.env||(e.env={kind:"chrome"}),e.bootstrap||e.setup||(e.setup="function(){window.__moduleBundler.loadTests();}"),this._ts=Z.default.tryRequireModuleWithPathFrom(this._workspaceDirPath,"typescript",!0).module,Z.default.tryRequireModuleWithPathFrom(this._workspaceDirPath,"@angular/cli/commands/test-impl",!1)||Z.default.tryRequireModuleWithPathFrom(this._workspaceDirPath,"@angular/cli/src/commands/test/cli.js",!1));if(!s)throw new Error("Could not load Angular CLI package");var r=Z.default.tryRequireModuleWithPathFrom(this._workspaceDirPath,"@angular/cli/utilities/config.js",!1)||Z.default.tryRequireModuleWithPathFrom(this._workspaceDirPath,"@angular/cli/src/utilities/config.js",!1);const D=Z.default.tryRequireModuleWithPathFrom(this._workspaceDirPath,"@angular-builders/custom-webpack/dist/transform-factories.js");var{TestCommand:i,TestCommandModule:n}=s.module,o=Z.default.tryRequireModuleWithPathFrom(s.path,"@angular-devkit/core/src/logger/null-logger",!0).module["NullLogger"];const $=Z.default.tryRequireModuleWithPathFrom(s.path,"@angular-devkit/architect",!0).module["createBuilder"],N=Z.default.tryRequireModuleWithPathFrom(s.path,"@angular-devkit/build-angular/src/utils/webpack-browser-config",!0).module["generateBrowserWebpackConfigFromContext"],a=Z.default.tryRequireModuleWithPathFrom(s.path,"@angular-devkit/build-angular/src/angular-cli-files/models/webpack-configs",!1)||Z.default.tryRequireModuleWithPathFrom(s.path,"@angular-devkit/build-angular/src/webpack/configs",!1)||Z.default.tryRequireModuleWithPathFrom(s.path,"@angular-devkit/build-angular/src/tools/webpack/configs",!1);if(!a)throw new Error("Could not load Webpack configuration");let l;try{l=this._workspaceConfig.nxWorkspace?(c=await Z.default.tryRequireModuleWithPathFrom(J.dirname(this._workspaceConfig.configFileName),"@angular-devkit/core/src/workspace/json/reader",!1).module.readJsonWorkspace(J.basename(this._workspaceConfig.configFileName),{readFile:()=>this._convertFromNxWorkspaceConfig()}),{workspace:new r.module.AngularWorkspace(c,this._workspaceConfig.configFileName)}):{workspace:await r.module.AngularWorkspace.load(this._workspaceConfigFilePath)}}catch(e){l={workspace:{root:this._workspaceDirPath,configFile:"angular.json"}}}var c={name:"test",description:"",options:[],aliases:[],hidden:!(l.packageManager={name:"npm"}),scope:"default"};let u={};const A=this._getWebpackConfigurations,q=this;async function B(e,t){e.codeCoverage=!1,q._adjustBuildOptions(e);var s=(await N(Object.assign(Object.assign({},e),{outputPath:"",budgets:void 0}),t,e=>A(a.module,e)))["config"];return u=s[0]||s,t&&t.builder&&"@angular-builders/custom-webpack:karma"===t.builder.name&&(s=D.module.customWebpackConfigTransformFactory(e,t),u=s?await s(u):u),{success:!0}}r=new(i||n||s.module)(l,c,new o);r.initialize&&await r.initialize({}),(r._architectHost||r.getArchitectHost()).loadBuilder=()=>new Promise(e=>e($(B))),te("Calling test command for %s.",this._project.name),await r.run({project:this._project.name}),te("Initializing postprocessor.");i=z("../../../../postprocessors/webpack/initialize")(this._workspaceDirPath);if(delete u.output,delete u.performance,delete u.optimization,this._adjustConfiguration(u),te("Sanitizing style rules."),u.module&&u.module.rules){n=u.module.rules;for(const M of this._getAllLoaders(n))"string"!=typeof M&&(this._replaceCssLoader(M),M.options)&&(this._checkCssLoader(M.loader,"less-loader")||this._checkCssLoader(M.loader,"postcss-loader")||this._checkCssLoader(M.loader,"resolve-url-loader"))&&(M.options.sourceMap=!1)}te("Sanitizing plugins."),u.plugins=u.plugins.filter(e=>!e.sourceMappingURLComment&&!e.patterns&&!(e.options&&e.options.budgets||e.budgets||e.options&&e.modules||void 0!==e.profile&&void 0!==e.modulesCount&&void 0!==e.showEntries&&void 0!==e.showModules&&void 0!==e.showActiveModules||e.options&&e.options.scripts)),this._adjustPlugins(u.plugins);var p=this._project.configuration,s=p.architect.test.options,c=[],o=(te("Setting up polyfills."),u.entry.polyfills);if(o&&o.length){var d,h=[];for(d of o)h.push(this._getPolyfillImportStatement(Z.default.normalizePath(d)));h.length&&c.push({path:J.join(this._workspaceDirPath,"wallaby-polyfills.js"),code:""+h.join(H.EOL)+this._getExtraPolyfills()})}r=s.styles;if(r){te("Setting up styles.");var g,f,m=[];for(g of r){let e=!0;"string"!=typeof g&&(e=void 0===g.inject||g.inject,e=void 0===g.bundleName&&e,g=g.input),e&&(f=Z.default.normalizePath(J.resolve(J.join(this._workspaceDirPath,g))),G.existsSync(f)?m.push(`require('${this._wrapStyleImport(f)}');`):(f=Z.default.normalizePath(J.resolve(U([this._workspaceDirPath,"node_modules",g]))),G.existsSync(f)?m.push(`require('${this._wrapStyleImport(f)}');`):m.push(`require('${this._wrapStyleImport(g)}');`)))}m.length&&c.push({path:J.join(this._workspaceDirPath,"wallaby-styles.js"),code:m.join(H.EOL)})}te("Setting up main file.");n=p.sourceRoot||J.join(p.root,"src"),o=t?n:J.relative(p.root,n),r=J.join(this._workspaceDirPath,o)===J.join(this._workspaceDirPath,"./");let _=s.main?Z.default.normalizePath(J.resolve(J.join(this._workspaceDirPath,s.main))):void 0,v=_?await X(_,"utf-8"):void 0;var y=_?J.extname(_):".ts",b=_?J.posix.basename(_,y):"test";let w=Z.default.normalizePath(J.resolve(J.join(_?J.dirname(_):J.join(this._workspaceDirPath,n),b+".wallaby"+y))),k=(await K(w)||(w=null),Z.default.normalizePath(J.resolve(J.join(_?J.dirname(_):J.join(this._workspaceDirPath,n),b+".base"+y))));await K(k)||(k=null);var y=/const\s+context\s*=\s*require\s*\.\s*context\s*\(\s*'\.\/'\s*,\s*true\s*,\s*\/\\\.spec\\\.ts\$\/\s*\)\s*;/g,x=/context\s*\.\s*keys\s*\(\s*\)\s*\.map\s*\(\s*context\s*\)\s*;/g,S=/context\s*\.\s*keys\s*\(\s*\)\s*\.forEach\s*\(\s*context\s*\)\s*;/g,y=(v=w?(ee("Using physical %s.",w),await X(w,"utf-8")):void 0!==v&&(this._isNoSpecMainFileAllowed||v.match(y)&&(v.match(x)||v.match(S)))?(ee("Using virtual %s.",_),v.replace(y,"").replace(x,"").replace(S,"")):k?(ee("Using physical %s.",k),await X(k,"utf-8")):(_=s.main?Z.default.normalizePath(J.resolve(J.join(this._workspaceDirPath,s.main))):Z.default.normalizePath(J.resolve(J.join(this._workspaceDirPath,n,b+this._getMainFileExtension()))),ee("Using builtin %s.",_),this._getMainFileContent()),e.diagnostics.angular.main=v,c.push({path:_,code:v}),te("Creating postprocessor."),i(u,{setupFiles:c}));this._adjustPostprocessor(y.owner),e.postprocessor=y,te("Created postprocessor.");const P=[];x=[];P.push({pattern:Z.default.normalizePath(J.join(o,"/**/*.spec.ts")),ignore:!0}),p.architect.test.options.polyfills&&"string"==typeof p.architect.test.options.polyfills&&P.push({pattern:Z.default.normalizePath(t?p.architect.test.options.polyfills:J.relative(p.root,p.architect.test.options.polyfills)),ignore:!0}),p.architect.test.options.main&&P.push({pattern:Z.default.normalizePath(t?p.architect.test.options.main:J.relative(p.root,p.architect.test.options.main)),ignore:!0}),p.architect.build&&p.architect.build.options&&(p.architect.build.options.main&&P.push({pattern:Z.default.normalizePath(t?p.architect.build.options.main:J.relative(p.root,p.architect.build.options.main)),ignore:!0}),p.architect.build.options.index)&&(S=p.architect.build.options.index.input||p.architect.build.options.index,P.push({pattern:Z.default.normalizePath(t?S:J.relative(p.root,S)),ignore:!0})),P.push({pattern:Z.default.normalizePath(J.join(o,"/test.base.ts")),ignore:!0}),P.push({pattern:Z.default.normalizePath(J.join(o,"/test.wallaby.ts"))}),r&&x.push({pattern:"/node_modules/**",ignore:!0}),x.push({pattern:Z.default.normalizePath(J.join(o,"/**/*.spec.ts")),load:!1});const F=[];var C=new Set,n=s.scripts;if(n&&n.length){te("Setting up scripts.");var T,W,E,j,V=[];for(T of n){let e=!0;"string"!=typeof T&&(!(e=void 0===T.inject||T.inject)&&T.bundleName&&T.input?(j=Z.default.normalizePath(J.resolve(J.join(this._workspaceDirPath,T.input))),E=""+J.posix.sep+T.bundleName+".js",C.has(W=E+j)||(F.push({path:{virtual:E,physical:j}}),C.add(W))):(e=void 0===T.bundleName&&e,T=T.input)),e&&T&&(E=Z.default.normalizePath(J.resolve(J.join(this._workspaceDirPath,T))),(t?E.startsWith(this._workspaceDirPath):E.startsWith(Z.default.normalizePath(J.resolve(J.join(this._workspaceDirPath,p.root)))))?(j=Z.default.normalizePath(J.relative(t?this._workspaceDirPath:J.join(this._workspaceDirPath,p.root),E)),V.push(j),P.push({pattern:j,instrument:!1,load:!0})):emitDiagnostic({name:"genericWarning",message:`Angular CLI automatic configuration: the script ${T} is outside of the ${t?"workspace":"project folder"}, Wallaby.js ignores such files at the moment. Please let us know if this is an issue for you at https:/github.com/wallabyjs/public/issues.`}))}r&&Z.default.generateNodeModulesExcludesForIncludePatterns(V).forEach(e=>{P.push({pattern:e,ignore:!0})})}else r&&P.push({pattern:"/node_modules/**",ignore:!0});var R,I,O,b=s.assets;if(b&&b.length){te("Setting up assets.");for(var L of b)"string"==typeof L?(I=Z.default.normalizePath(J.resolve(J.join(this._workspaceDirPath,L))),await K(I)&&(R=""+J.posix.sep+J.basename(I),C.has(O=R+I)||(F.push({path:{virtual:R,physical:I}}),C.add(O)))):L&&L.input&&L.output&&(R=Z.default.normalizePath(J.resolve(J.join(this._workspaceDirPath,L.input))),I=L.output.startsWith(J.posix.sep)?L.output:""+J.posix.sep+L.output,C.has(O=""+I+R)||(F.push({path:{virtual:I,physical:R}}),C.add(O)))}F.length&&(i=(e,t)=>{for(const s of F)e.use(s.path.virtual,t.static(s.path.physical))},e.middleware?Y.isFunction(e.middleware.override)&&(e.middleware=e.middleware.override(i)):e.middleware=i),P.push({pattern:Z.default.normalizePath(J.join(o,"/**/*.+(ts|js)")),load:!1}),P.push({pattern:Z.default.normalizePath(J.join(o,"/**/*.+(css|less|scss|sass|styl|html|json|svg)")),instrument:!1,load:!1}),e.files?Y.isFunction(e.files.override)&&(e.files=e.files.override(P)):e.files=P,e.tests?Y.isFunction(e.tests.override)&&(e.tests=e.tests.override(x)):e.tests=x,te("Configured.")}_checkCssLoader(e,t){return e===t}_getWebpackConfigurations(e,t){var{getCommonConfig:e,getNonAotConfig:s,getStylesConfig:r,getTestConfig:i,getWorkerConfig:n}=e;return[e(t),r(t),s(t),i(t),n(t)]}_getExtraPolyfills(){return""}_adjustPostprocessor(e){const a=e._prepareCompiler.bind(e);e._prepareCompiler=(e,t,s,r,i)=>{a(e,i);for(const n of i.options.plugins)if(n._compilerHost){if(n._firstRun=!e,e)t?(n._moduleResolutionCache=this._ts.createModuleResolutionCache(n._basePath,e=>e),n._compilerHost.moduleResolutionCache=n._moduleResolutionCache):s||r.forEach(e=>n._compilerHost.invalidate(e.fullPath));else{i.watchMode=!0;const o=n._createOrUpdateProgram.bind(n);n._createOrUpdateProgram=async()=>{await o(),n._program.getSemanticDiagnostics=()=>[]}}break}}}_adjustBuildOptions(e){}_adjustConfiguration(e){}_adjustPlugins(e){}_getMainFileContent(){return`
  ${"library"===this._project.configuration.projectType?this._getZoneImportStatement():""}
  ${this._getZoneTestingImportStatement()}
  import { getTestBed } from '@angular/core/testing';

  import {
    BrowserDynamicTestingModule,
    platformBrowserDynamicTesting
  } from '@angular/platform-browser-dynamic/testing';

  getTestBed().initTestEnvironment(
    BrowserDynamicTestingModule,
    platformBrowserDynamicTesting()
  );`}_getPolyfillImportStatement(e){return`require('${e}');`}_getZoneImportStatement(){return"import 'zone.js/dist/zone';"}_getZoneTestingImportStatement(){return"import 'zone.js/dist/zone-testing';"}_replaceCssLoader(e){}_getAllLoaders(e){return Y.flatten(e.filter(e=>e.use).map(e=>e.use))}_wrapStyleImport(e){return e}_getMainFileExtension(){return".ts"}_convertFromNxWorkspaceConfig(){var e=JSON.parse(JSON.stringify(this._workspaceConfig));if(e.projects)for(const s of Object.keys(e.projects)){var t=e.projects[s],t=(delete t.name,t.targets||t.architect);t&&t.test&&(t=t.test.executor||t.test.builder)&&!t.startsWith("@angular")&&delete e.projects[s]}return JSON.stringify(e)}get _isNoSpecMainFileAllowed(){return!1}}},{"../../../../postprocessors/webpack/initialize":64,"../../../../utils":88,"../../../../utils/joinWithLookUp":90,"./modulePatch":35,fs:void 0,lodash:void 0,os:void 0,path:void 0,semver:void 0,util:void 0}],34:[function(A,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WorkspaceConfigurator=void 0,A("./modulePatch");const o=A("../../../../utils/joinWithLookUp").default,q=A("path"),u=A("os"),B=A("fs");var s=A("util");const W=A("semver"),V=A("lodash"),z=A("../../../../utils"),U=s.promisify(B.exists),h=s.promisify(B.readFile),{debug:J,trace:H}=logger.create("angular/cli karma workspace config");process.env.NG_BUILD_IVY_LEGACY="1";t.WorkspaceConfigurator=class{constructor(e,t,s,r){this._workspaceDirPath=z.default.normalizePath(e),this._workspaceConfigFilePath=z.default.normalizePath(t),this._workspaceConfig=s,this._version=r}async configure(e){H("Configuring.");var t=z.default.tryRequireModuleWithPathFrom(this._workspaceDirPath,"jasmine-core/package.json",!1),t=(e.testFramework&&(V.isString(e.testFramework)&&e.testFramework.startsWith("jasmine")?e.testFramework={type:e.testFramework,autoDetected:!0}:e.testFramework.type&&e.testFramework.type.startsWith("jasmine")?e.testFramework.autoDetected=!0:delete e.testFramework),e.testFramework||(!t||!t.module||W.lt(t.module.version,"4.0.0")?e.testFramework={type:"jasmine",autoDetected:!0}:W.lt(t.module.version,"5.0.0")?e.testFramework={type:"jasmine@4.6.0",autoDetected:!0}:e.testFramework={type:"jasmine@5.1.1",autoDetected:!0}),e.env||(e.env={kind:"chrome"}),e.setup||e.setup||(e.setup="function(){window.__moduleBundler.loadTests();}"),this._ts=z.default.tryRequireModuleWithPathFrom(this._workspaceDirPath,"typescript",!0).module,await this._getFileSystemGetter())["getFileSystem"],s=z.default.tryRequireModuleWithPathFrom(this._workspaceDirPath,"@angular/cli/commands/test-impl",!1)||z.default.tryRequireModuleWithPathFrom(this._workspaceDirPath,"@angular/cli/src/commands/test/cli.js",!1);if(!s)throw new Error("Could not load Angular CLI package");var r=z.default.tryRequireModuleWithPathFrom(this._workspaceDirPath,"@angular/cli/utilities/config.js",!1)||z.default.tryRequireModuleWithPathFrom(this._workspaceDirPath,"@angular/cli/src/utilities/config.js",!1);const i=z.default.tryRequireModuleWithPathFrom(this._workspaceDirPath,"@angular-builders/custom-webpack/dist/transform-factories.js");var{TestCommand:n,TestCommandModule:o}=s.module,a=z.default.tryRequireModuleWithPathFrom(s.path,"@angular-devkit/core/src/logger/null-logger",!0).module["NullLogger"];const l=z.default.tryRequireModuleWithPathFrom(s.path,"@angular-devkit/architect",!0).module["createBuilder"],c=z.default.tryRequireModuleWithPathFrom(s.path,"@angular-devkit/build-angular/src/utils/webpack-browser-config",!0).module["generateBrowserWebpackConfigFromContext"],u=z.default.tryRequireModuleWithPathFrom(s.path,"@angular-devkit/build-angular/src/angular-cli-files/models/webpack-configs",!1)||z.default.tryRequireModuleWithPathFrom(s.path,"@angular-devkit/build-angular/src/webpack/configs",!1)||z.default.tryRequireModuleWithPathFrom(s.path,"@angular-devkit/build-angular/src/tools/webpack/configs",!1);if(!u)throw new Error("Could not load Webpack configuration");let p;try{p=this._workspaceConfig.nxWorkspace?(d=await z.default.tryRequireModuleWithPathFrom(q.dirname(this._workspaceConfig.configFileName),"@angular-devkit/core/src/workspace/json/reader",!1).module.readJsonWorkspace(q.basename(this._workspaceConfig.configFileName),{readFile:()=>this._convertFromNxWorkspaceConfig()}),{workspace:new r.module.AngularWorkspace(d,this._workspaceConfig.configFileName)}):{workspace:await r.module.AngularWorkspace.load(this._workspaceConfigFilePath)}}catch(e){p={workspace:{root:this._workspaceDirPath,configFile:"angular.json"}}}var d={name:"test",description:"",options:[],aliases:[],hidden:!(p.packageManager={name:"npm"}),scope:"default"},r=e["angular-cli"];const h=r&&Array.isArray(r.excludedProjects)?new Set(r.excludedProjects):new Set,g=Object.keys(this._workspaceConfig.projects).map(e=>({name:e,configuration:this._workspaceConfig.projects[e]})).filter(e=>e.configuration.architect&&e.configuration.architect.test&&("@angular-devkit/build-angular:karma"===e.configuration.architect.test.builder||"@angular-builders/custom-webpack:karma"===e.configuration.architect.test.builder||"@ngx-env/builder:karma"===e.configuration.architect.test.builder)).filter(e=>!h.has(e.name));let f;r=g.filter(e=>"application"===e.configuration.projectType);f=1<r.length?((v=r.filter(e=>""===e.configuration.root)).length?v:(v=r.filter(e=>e.name===this._workspaceConfig.defaultProject)).length?v:r)[0]:r.length?r[0]:g.find(e=>"library"===e.configuration.projectType);let m="tsconfig.wallaby.spec.json",_=(await U(q.join(this._workspaceDirPath,m))||(m="tsconfig.workspace.spec.json",await U(q.join(this._workspaceDirPath,m)))||(m="tsconfig.wallaby.spec.json"),{});const D=this._getWebpackConfigurations,$=this;async function N(t,e){t.codeCoverage=!1,t.tsConfig=m,$._adjustBuildOptions(t),V.flatten(g.filter(e=>e.name!==f.name).map(e=>e.configuration).filter(e=>e.architect.test.options.fileReplacements).map(e=>e.architect.test.options.fileReplacements)).forEach(e=>t.fileReplacements.push(e));var s=(await c(Object.assign(Object.assign({},t),{outputPath:"",budgets:void 0}),e,e=>D(u.module,e)))["config"];return _=s[0]||s,e&&e.builder&&"@angular-builders/custom-webpack:karma"===e.builder.name&&(s=i.module.customWebpackConfigTransformFactory(t,e),_=s?await s(_):_),{success:!0}}var v=new(n||o||s.module)(p,d,new a),r=(v.initialize&&await v.initialize({}),(v._architectHost||v.getArchitectHost()).loadBuilder=()=>new Promise(e=>e(l(N))),await this._generateMainFiles(g));const y=q.join(this._workspaceDirPath,m),b=(H("Calling test command for %s.",f.name),z.default.normalizePath(y));n=!await U(y);let w="";if(n){J("Using virtual %s.",y);o=t();const E=o.lstat,j=B.statSync,R=this._ts.sys.readFile,I=o.readFile;w=await this._generateTsConfigFile(g,1===r.length?r[0].path:null),e.diagnostics.angular.tsConfig=w,o.lstat=e=>e===b?{isDirectory:()=>!1}:E(e),this._ts.sys.readFile=e=>e===b?w:R(e),B.statSync=(e,t)=>e===y?{isFile:()=>!0}:j(e,t),o.readFile=e=>e===b?w:I(e),await v.run({project:f.name}),B.statSync=j}else J("Using physical %s.",y),await v.run({project:f.name});H("Initializing postprocessor.");s=A("../../../../postprocessors/webpack/initialize")(this._workspaceDirPath);delete _.output,delete _.performance,delete _.optimization,this._adjustConfiguration(_),this._fixStyleRules(g,_),H("Sanitizing plugins."),_.plugins=_.plugins.filter(e=>!e.sourceMappingURLComment&&!e.patterns&&!(e.options&&e.options.budgets||e.budgets||e.options&&e.modules||e.generateName||void 0!==e.profile&&void 0!==e.modulesCount&&void 0!==e.showEntries&&void 0!==e.showModules&&void 0!==e.showActiveModules||e.options&&e.options.scripts)),this._adjustPlugins(_.plugins);const k=f.configuration.architect.test.options.polyfills&&"string"==typeof f.configuration.architect.test.options.polyfills?q.resolve(q.join(this._workspaceDirPath,f.configuration.architect.test.options.polyfills)):null;var d=(_.entry.polyfills||[]).filter(e=>null==k||k!==e),a=await this._generatePolyfillFile(g,d),o=this._generatesStyleFile(g),x=[];a&&(e.diagnostics.angular.polyfill=a,x.push(a)),e.diagnostics.angular.main=[];for(const O of r)void 0===O.code?x.push(O.path):(e.diagnostics.angular.main.push(O),x.push(O));o&&x.push(o);const S=await this._generatesAssetRoutes(g);S.length&&(v=(e,t)=>{for(const s of S)e.use(s.path.virtual,t.static(s.path.physical))},e.middleware?V.isFunction(e.middleware.override)&&(e.middleware=e.middleware.override(v)):e.middleware=v),H("Creating postprocessor.");var d=s(_,{setupFiles:x}),P=(this._adjustPostprocessor(d.owner,n,b,w,t),e.postprocessor=d,[]),F=[];for(const L of this._generatesScripts(g))P.push({pattern:L,instrument:!1,load:!0});for(const M of g.map(e=>e.configuration)){var C,T=M.sourceRoot||q.join(M.root,"src");M.architect.test.options.polyfills&&"string"==typeof M.architect.test.options.polyfills&&P.push({pattern:z.default.normalizePath(M.architect.test.options.polyfills),ignore:!0}),M.architect.test.options.main&&P.push({pattern:z.default.normalizePath(M.architect.test.options.main),ignore:!0}),M.architect.build&&M.architect.build.options&&(M.architect.build.options.main&&P.push({pattern:z.default.normalizePath(M.architect.build.options.main),ignore:!0}),M.architect.build.options.index)&&(C=M.architect.build.options.index.input||M.architect.build.options.index,P.push({pattern:z.default.normalizePath(C),ignore:!0})),P.push({pattern:z.default.normalizePath(q.join(T,"/test.base.ts")),ignore:!0}),P.push({pattern:z.default.normalizePath(q.join(T,"/test.wallaby.ts")),ignore:!0}),P.push({pattern:z.default.normalizePath(q.join(T,"/**/*.spec.ts")),ignore:!0}),P.push({pattern:z.default.normalizePath(q.join(T,"/**/*.+(ts|js)")),load:!1}),P.push({pattern:z.default.normalizePath(q.join(T,"/**/*.+(css|less|scss|sass|styl|html|json|svg)")),instrument:!1,load:!1}),F.push({pattern:z.default.normalizePath(q.join(T,"/**/*.spec.ts")),load:!1})}e.files?V.isFunction(e.files.override)&&(e.files=e.files.override(P)):e.files=P,e.tests?V.isFunction(e.tests.override)&&(e.tests=e.tests.override(F)):e.tests=F,H("Configured.")}async _generateMainFiles(e){var t="test.wallaby.ts",s=q.join(this._workspaceDirPath,t);if(await U(s))return J("Using physical %s.",t),[{path:s}];if(t="test.workspace.ts",s=q.join(this._workspaceDirPath,t),await U(s))return J("Using physical %s.",t),[{path:s}];var i=/const\s+context\s*=\s*require\s*\.\s*context\s*\(\s*'\.\/'\s*,\s*true\s*,\s*\/\\\.spec\\\.ts\$\/\s*\)\s*;/g,n=/context\s*\.\s*keys\s*\(\s*\)\s*\.map\s*\(\s*context\s*\)\s*;/g,o=/context\s*\.\s*keys\s*\(\s*\)\s*\.forEach\s*\(\s*context\s*\)\s*;/g,a=[];for(const d of e){var l=d.configuration.architect.test.options,c=d.configuration.sourceRoot||q.join(d.configuration.root,"src");let e=l.main?z.default.normalizePath(q.resolve(q.join(this._workspaceDirPath,l.main))):void 0,t=e?await h(e,"utf-8"):void 0;var u=e?q.extname(e):".ts",p=e?q.posix.basename(e,u):"test";let s=z.default.normalizePath(q.resolve(q.join(e?q.dirname(e):q.join(this._workspaceDirPath,c),p+".wallaby"+u))),r=(await U(s)||(s=null),z.default.normalizePath(q.resolve(q.join(e?q.dirname(e):q.join(this._workspaceDirPath,c),p+".base"+u))));await U(r)||(r=null),t=s?(J("Using physical %s.",s),await h(s,"utf-8")):void 0!==t&&(this._isNoSpecMainFileAllowed||t.match(i)&&(t.match(n)||t.match(o)))?(J("Using virtual %s.",e),t.replace(i,"").replace(n,"").replace(o,"")):r?(J("Using physical %s.",r),await h(r,"utf-8")):(e=l.main?z.default.normalizePath(q.resolve(q.join(this._workspaceDirPath,l.main))):z.default.normalizePath(q.resolve(q.join(this._workspaceDirPath,c,p+this._getMainFileExtension()))),J("Using builtin %s.",e),`
              ${"library"===d.configuration.projectType?this._getZoneImportStatement(d):""}
              ${this._getZoneTestingImportStatement(d)}
              import { getTestBed } from '@angular/core/testing';

              import {
                BrowserDynamicTestingModule,
                platformBrowserDynamicTesting
              } from '@angular/platform-browser-dynamic/testing';

              ${this._getTestEnvironmentInitStatement()}
              `),a.push({path:e,code:0<a.length?this._deduplicateMainFileContent(t):t})}return a}_readTsconfig(t){try{return this._ts.parseConfigFileTextToJson(t,B.readFileSync(t).toString()).config}catch(e){return A(t)}}async _generateTsConfigFile(e,t){let s=q.resolve(q.join(this._workspaceDirPath,"tsconfig.base.json"));if(await U(s)||(s=q.resolve(q.join(this._workspaceDirPath,"tsconfig.json"))),!await U(s))throw new Error(s+" file does not exist.");var r=this._readTsconfig(s),i=(r.compilerOptions=r.compilerOptions||{},r.compilerOptions.paths=r.compilerOptions.paths||{},r.compilerOptions.types=r.compilerOptions.types||[],[]),n=[],o=[],a=r.compilerOptions.paths,l=new Set;for(const f of e){var c=a[f.name],u=a[f.name+"/*"];if((c||u)&&f.configuration.architect.build&&f.configuration.architect.build.options&&f.configuration.architect.build.options.project){var p=q.resolve(q.join(this._workspaceDirPath,f.configuration.architect.build.options.project));if(await U(p)){var d=A(p);if(d.dest&&d.lib&&d.lib.entryFile){const m=z.default.normalizePath(q.relative(this._workspaceDirPath,q.resolve(q.join(q.dirname(p),d.dest))));c&&c.find(e=>e.includes(m))&&(c.splice(0,c.length),c.push(this._getTsPath(q.posix.join(f.configuration.root,d.lib.entryFile)))),u&&u.find(e=>e.includes(m))&&(u.splice(0,u.length),p=f.configuration.sourceRoot||q.join(f.configuration.root,"src"),u.push(this._getTsPath(q.posix.join(p,"*"))))}}}var c=q.resolve(q.join(this._workspaceDirPath,f.configuration.architect.test.options.tsConfig)),h=q.dirname(c);if(await U(c)){d=this._readTsconfig(c);if(d.compilerOptions&&d.compilerOptions.types)for(const _ of d.compilerOptions.types)l.add(_);if(d.files)for(var g of d.files)q.isAbsolute(g)||(g=z.default.normalizePath(q.join(q.relative(this._workspaceDirPath,h),g))),i.push(g);if(d.include)for(const v of d.include)n.push(z.default.normalizePath(q.join(q.relative(this._workspaceDirPath,h),v)));if(d.exclude)for(const y of d.exclude)o.push(z.default.normalizePath(q.join(q.relative(this._workspaceDirPath,h),y)))}}i.length&&(r.files=[]);for(const b of i)r.files.push(b);t&&r.files.push(t);e=q.join(this._workspaceDirPath,"polyfills.wallaby.ts");(await U(e)||(e=q.join(this._workspaceDirPath,"polyfills.workspace.ts"),await U(e)))&&r.files.push(e),n.length&&(r.include=[]);for(const w of n)r.include.push(w);o.length&&(r.exclude=[]);for(const k of o)r.exclude.push(k);l.size&&(r.compilerOptions.types=[]);for(const x of l)r.compilerOptions.types.push(x);return JSON.stringify(r)}async _generatePolyfillFile(e,t){var s,r=q.join(this._workspaceDirPath,"polyfills.wallaby.ts"),i=[];for(s of t)i.push(this._getPolyfillImportStatement(z.default.normalizePath(s)));if(await U(r))i.push(`require('${z.default.normalizePath(r)}');`);else if(r=q.join(this._workspaceDirPath,"polyfills.workspace.ts"),await U(r))i.push(`require('${z.default.normalizePath(r)}');`);else{const a=new Set;t.forEach(e=>a.add(e));for(const l of e)if(l.configuration.architect.test.options.polyfills)if("string"==typeof l.configuration.architect.test.options.polyfills){H("Setting up polyfills for %s.",l.name);var n,o=q.resolve(q.join(this._workspaceDirPath,l.configuration.architect.test.options.polyfills));await U(o)&&(n=await h(o,"utf-8"),a.has(n)||(a.add(n),i.push(this._getPolyfillImportStatement(z.default.normalizePath(o)))))}else if(Array.isArray(l.configuration.architect.test.options.polyfills))for(const c of l.configuration.architect.test.options.polyfills)"string"!=typeof c||a.has(c)||(H("Setting up polyfill %s from %s.",c,l.name),a.add(c),i.push(this._getPolyfillImportStatement(c)))}return i.length?{path:q.join(this._workspaceDirPath,"wallaby-polyfills.js"),code:""+i.join(u.EOL)+this._getExtraPolyfills()}:null}_generatesStyleFile(e){var t=[];for(const n of e){var s,r=n.configuration.architect.test.options.styles;if(r){H("Setting up styles for %s.",n.name);for(var i of r){let e=!0;"string"!=typeof i&&(e=void 0===i.inject||i.inject,e=void 0===i.bundleName&&e,i=i.input),e&&(s=z.default.normalizePath(q.resolve(q.join(this._workspaceDirPath,i))),B.existsSync(s)?t.push(`require('${this._wrapStyleImport(s)}');`):(s=z.default.normalizePath(q.resolve(o([this._workspaceDirPath,"node_modules",i]))),B.existsSync(s)?t.push(`require('${this._wrapStyleImport(s)}');`):t.push(`require('${this._wrapStyleImport(i)}');`)))}}}return t.length?{path:q.join(this._workspaceDirPath,"wallaby-styles.js"),code:t.join(u.EOL)}:null}async _generatesAssetRoutes(e){var t=[];for(const p of e){var s,r,i,n=new Set,o=p.configuration.architect.test.options.assets;if(o&&o.length){H("Setting up assets for %s.",p.name);for(var a of o)"string"==typeof a?(r=z.default.normalizePath(q.resolve(q.join(this._workspaceDirPath,a))),await U(r)&&(s=""+q.posix.sep+q.basename(r),n.has(i=s+r)||(t.push({path:{virtual:s,physical:r}}),n.add(i)))):a&&a.input&&a.output&&(s=z.default.normalizePath(q.resolve(q.join(this._workspaceDirPath,a.input))),r=a.output.startsWith(q.posix.sep)?a.output:""+q.posix.sep+a.output,n.has(i=""+r+s)||(t.push({path:{virtual:r,physical:s}}),n.add(i)))}var l,c,o=p.configuration.architect.test.options.scripts;if(o&&o.length){H("Setting up non-injectable scripts for %s.",p.name);for(var u of o)"string"!=typeof u&&!u.inject&&u.bundleName&&u.input&&(l=z.default.normalizePath(q.resolve(q.join(this._workspaceDirPath,u.input))),u=""+q.posix.sep+u.bundleName+".js",n.has(c=u+l)||(t.push({path:{virtual:u,physical:l}}),n.add(c)))}}return t}_generatesScripts(e){var t=new Set,s=[];for(const o of e){var r,i=o.configuration.architect.test.options.scripts;if(i&&i.length){H("Setting up scripts for %s.",o.name);for(var n of i){let e=!0;"string"!=typeof n&&(e=void 0===n.inject||n.inject,e=void 0===n.bundleName&&e,n=n.input),n&&((r=z.default.normalizePath(q.resolve(q.join(this._workspaceDirPath,n)))).startsWith(this._workspaceDirPath)?e&&(n=z.default.normalizePath(q.relative(this._workspaceDirPath,r)),t.has(n)||(s.push(n),t.add(n))):emitDiagnostic({name:"genericWarning",message:`Angular CLI automatic configuration: the script ${n} is outside of the workspace, Wallaby.js ignores such files at the moment. Please let us know if this is an issue for you at https:/github.com/wallabyjs/public/issues.`}))}}}return s}_fixStyleRules(t,s){if(H("Sanitizing style rules."),s.module&&s.module.rules){var r=s.module.rules;for(const v of V.flatten(r.filter(e=>e.use).map(e=>e.use)))"string"!=typeof v&&v.options&&(this._checkCssLoader(v.loader,"less-loader")||this._checkCssLoader(v.loader,"postcss-loader")||this._checkCssLoader(v.loader,"resolve-url-loader"))&&(v.options.sourceMap=!1);var i,n=new Map;for(let e=0;e<r.length;e++){var o,a=r[e];a.use&&a.use.length&&"string"!=typeof(o=a.use[a.use.length-1])&&(this._checkCssLoader(o.loader,"sass-loader")||this._checkCssLoader(o.loader,"less-loader")||this._checkCssLoader(o.loader,"stylus-loader")||this._checkCssLoader(o.loader,"postcss-loader"))&&n.set(e,a)}let e=0;for([i]of n)r.splice(i-e,1),e++;var l,c,u,p,d,h=new Map;for([,l]of n){let e={test:l.test,oneOf:[]};h.has(l.test.toString())?e=h.get(l.test.toString()):h.set(l.test.toString(),e);for(const y of t){let s=null;if(y.configuration.architect.test.options){var g=y.configuration.architect.test.options.stylePreprocessorOptions;if(g&&g.includePaths){s=[];for(const k of g.includePaths)s.push(k)}}const b=[],w=(t.filter(e=>e.name!==y.name).forEach(e=>{const t=q.resolve(q.join(this._workspaceDirPath,e.configuration.root));s&&s.length&&s.some(e=>q.resolve(q.join(this._workspaceDirPath,e)).startsWith(t))||b.push(t),(e.configuration.architect.test.options.styles||[]).forEach(e=>b.push(q.resolve(q.join(this._workspaceDirPath,"string"==typeof e?e:e.input))))}),{use:[]});for(const x of l.use)"string"!=typeof x?((c={loader:x.loader,options:this._copyCssLoaderOptions(x)}).options&&(u=s&&s.length?s.map(e=>z.default.normalizePath(q.resolve(q.join(this._workspaceDirPath,e)))):null,this._setCssLoaderOptionsPaths(c,u)),w.use.push(c)):w.use.push(x);g=y.configuration.architect.test.options.styles||[];if(l.include&&l.include.length){if(w.include=[],!g.length)continue;g.forEach(e=>w.include.push(q.resolve(q.join(this._workspaceDirPath,"string"==typeof e?e:e.input))))}else w.exclude=[],g.forEach(e=>w.exclude.push(q.resolve(q.join(this._workspaceDirPath,"string"==typeof e?e:e.input)))),b.forEach(e=>w.exclude.push(e));e.oneOf.push(w)}}for([,p]of n)if((!p.include||!p.include.length)&&h.has(p.test.toString())){var f,m=h.get(p.test.toString()),_={use:[]};for(const S of p.use)"string"!=typeof S?((f={loader:S.loader,options:this._copyCssLoaderOptions(S)}).options&&this._setCssLoaderOptionsPaths(f,void 0),_.use.push(f)):_.use.push(S);m.oneOf.push(_)}for([,d]of h)r.push(d)}}_deduplicateMainFileContent(e){return e.replace(/import\s*'zone\.js\/dist\/zone'\s*;/,"").replace(/import\s*'zone\.js\/dist\/zone-testing'\s*;/,"").replace(/import\s*{\s*getTestBed\s*}\s*from\s*'@angular\/core\/testing'\s*;/,"").replace(/declare\s+const\s+require\s*:\s*any\s*;/,"").replace(/import\s*{\s*BrowserDynamicTestingModule\s*,\s*platformBrowserDynamicTesting,?\s*}\s*from\s*'@angular\/platform-browser-dynamic\/testing'\s*;/,"").replace(/getTestBed\s*\(\s*\)\s*.\s*initTestEnvironment\s*\(\s*BrowserDynamicTestingModule\s*,\s*platformBrowserDynamicTesting\s*\(\s*\)\s*,?\s*\)\s*;/,"")}_checkCssLoader(e,t){return e===t}_copyCssLoaderOptions(e){return e.options?Object.assign({},e.options):void 0}_setCssLoaderOptionsPaths(e,t){(this._checkCssLoader(e.loader,"less-loader")||this._checkCssLoader(e.loader,"stylus-loader"))&&(e.options.paths=t),this._checkCssLoader(e.loader,"sass-loader")&&(e.options.includePaths=t)}_getWebpackConfigurations(e,t){var{getCommonConfig:e,getNonAotConfig:s,getStylesConfig:r,getTestConfig:i,getWorkerConfig:n}=e;return[e(t),r(t),s(t),i(t),n(t)]}_getExtraPolyfills(){return""}_adjustPostprocessor(e,a,r,i,n){const l=e._prepareCompiler.bind(e);let c=!1;const u=()=>{var e=n();const t=e.lstat,s=e.readFile;e.readFile=e=>e===r?i:s(e),e.lstat=e=>e===r?{isDirectory:()=>!1}:t(e)};e._prepareCompiler=(e,t,s,r,i)=>{l(e,i);for(const n of i.options.plugins)if(n._compilerHost){if(n._firstRun=!e,e)a&&!c&&(u(),c=!0),t?(n._moduleResolutionCache=this._ts.createModuleResolutionCache(n._basePath,e=>e),n._compilerHost.moduleResolutionCache=n._moduleResolutionCache):s||r.forEach(e=>n._compilerHost.invalidate(e.fullPath));else{i.watchMode=!0,a&&u();const o=n._createOrUpdateProgram.bind(n);n._createOrUpdateProgram=async()=>{await o(),n._program.getSemanticDiagnostics=()=>[]}}break}}}_adjustBuildOptions(e){}_adjustConfiguration(e){}_adjustPlugins(e){}_getPolyfillImportStatement(e){return`require('${e}');`}_getZoneImportStatement(e){return"import 'zone.js/dist/zone';"}_getZoneTestingImportStatement(e){return"import 'zone.js/dist/zone-testing';"}_getTestEnvironmentInitStatement(){return"getTestBed().initTestEnvironment(BrowserDynamicTestingModule, platformBrowserDynamicTesting());"}_getTsPath(e){return e}async _getFileSystemGetter(){return z.default.tryRequireModuleWithPathFrom(this._workspaceDirPath,"@angular/compiler-cli/src/ngtsc/file_system",!0).module}_getMainFileExtension(){return".ts"}_wrapStyleImport(e){return e}_convertFromNxWorkspaceConfig(){var e=JSON.parse(JSON.stringify(this._workspaceConfig));if(e.projects)for(const s of Object.keys(e.projects)){var t=e.projects[s],t=(delete t.name,t.targets||t.architect);t&&t.test&&(t=t.test.executor||t.test.builder)&&!t.startsWith("@angular")&&delete e.projects[s]}return JSON.stringify(e)}get _isNoSpecMainFileAllowed(){return!1}}},{"../../../../postprocessors/webpack/initialize":64,"../../../../utils":88,"../../../../utils/joinWithLookUp":90,"./modulePatch":35,fs:void 0,lodash:void 0,os:void 0,path:void 0,semver:void 0,util:void 0}],35:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),e("../../../../utils").default.patchModulesCode([{files:["ora/index.js"],replacements:[{from:"stream: process.stderr,",to:"stream: process.stdout,",optional:!0}]}],"Possibly unsupported version of angular"),s.default={}},{"../../../../utils":88}],36:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.ProjectConfigurator=void 0;const r=e("path");class i extends e("../v8/ProjectConfigurator").ProjectConfigurator{constructor(e,t,s,r){super(e,t,s,r)}_checkCssLoader(e,t){return 0<=e.indexOf(r.sep+"node_modules"+r.sep+t+r.sep)}}s.ProjectConfigurator=i},{"../v8/ProjectConfigurator":33,path:void 0}],37:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.WorkspaceConfigurator=void 0;const r=e("path");class i extends e("../v8/WorkspaceConfigurator").WorkspaceConfigurator{constructor(e,t,s,r){super(e,t,s,r)}_checkCssLoader(e,t){return 0<=e.indexOf(r.sep+"node_modules"+r.sep+t+r.sep)}_copyCssLoaderOptions(e){var t;if(e.options)return this._checkCssLoader(e.loader,"sass-loader")?((t=Object.assign({},e.options)).sassOptions=Object.assign({},e.options.sassOptions),t):this._checkCssLoader(e.loader,"less-loader")?((t=Object.assign({},e.options)).lessOptions=Object.assign({},e.options.lessOptions),t):Object.assign({},e.options)}_setCssLoaderOptionsPaths(e,t){this._checkCssLoader(e.loader,"sass-loader")&&(e.options.sassOptions.includePaths=t),this._checkCssLoader(e.loader,"less-loader")&&(e.options.lessOptions.paths=t),this._checkCssLoader(e.loader,"stylus-loader")&&(e.options.paths=t)}}s.WorkspaceConfigurator=i},{"../v8/WorkspaceConfigurator":34,path:void 0}],38:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var r=["tags","implicitDependencies","configFilePath","$schema","generators","nxWorkspace","configFileName","npmScope","affected","tasksRunnerOptions","targetDefaults"];e("../../utils").default.patchModulesCode([{files:["@angular-devkit/core/src/workspace/json/reader.js"],replacements:[{from:"if (formatVersion !== 1) {",to:"if (formatVersion === 0) {",optional:!0},{from:"if (version !== 1) {",to:"if (version === 0) {",optional:!0},{from:"trackChanges: true,",to:"trackChanges: false,"},{from:"targets[name] = value;",to:"if (name === 'test') { value && value.executor && (value.builder = value.executor) && (delete value.executor); }; targets[name] = value;",optional:!0},{from:"targets[name] = value.value;",to:"if (name === 'test') { value.value && value.value.executor && (value.value.builder = value.value.executor) && (delete value.value.executor); }; targets[name] = value.value;",optional:!0},{from:"unprefixedWorkspaceExtensions: new Set([",to:"unprefixedWorkspaceExtensions: new Set([ "+r.reduce((e,t)=>e+`'${t}', `,""),optional:!0},{from:"unprefixedProjectExtensions: new Set([",to:"unprefixedProjectExtensions: new Set([  "+r.reduce((e,t)=>e+`'${t}', `,""),optional:!0}]},{files:["@angular-devkit/build-angular/src/utils/version.js"],replacements:[{from:"function assertCompatibleAngularVersion(projectRoot) {",to:"function assertCompatibleAngularVersion(projectRoot) { return;",optional:!0}]},{files:["@angular/cli/src/command-builder/architect-base-command-module.js"],replacements:[{from:"await this.reportAnalytics({",to:"false && await this.reportAnalytics({",optional:!0},{from:"await this.getAnalytics()",to:"(false && await this.getAnalytics())",optional:!0}]}],"Possibly unsupported version of NX/Angular Workspace"),s.default={}},{"../../utils":88}],39:[function(s,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ProjectConfigurator=void 0;const c=s("../../../utils"),u=s("semver"),r=logger.create("angular/cli jest project config")["trace"];t.ProjectConfigurator=class{constructor(e,t,s,r,i,n){this._currentDirPath=e,this._autoDetectedSettings=t,this._settings=s,this._packageJson=r,this._workspaceDirPath=c.default.normalizePath(i),this._project=n}async getConfigurationOnly(){var e,t,s,r,i,n,o=this._settings,a=o&&!_.isString(o.testFramework||"")&&o.testFramework&&o.testFramework.path||"",o=o&&!_.isString(o.testFramework||"")&&o.testFramework&&o.testFramework.configFile||"",a=await c.default.loadJest(this._currentDirPath,a,o),o={workspace:{root:this._workspaceDirPath,configFile:"angular.json"},target:{project:this._project.name},workspaceRoot:this._workspaceDirPath},l=c.default.tryRequireModuleWithPathFrom(this._workspaceDirPath,"@angular/cli/commands/test-impl",!1)||c.default.tryRequireModuleWithPathFrom(this._workspaceDirPath,"@angular/cli/src/commands/test/cli.js",!1);if(l)return e=c.default.tryRequireModuleWithPathFrom(l.path,"@angular-devkit/core/src/logger/null-logger",!0).module["NullLogger"],s=c.default.tryRequireModuleWithPathFrom(l.path,"@angular-builders/jest/dist/index").moduleExports["getRoots"],i=c.default.tryRequireModuleWithPathFrom(l.path,"@angular-builders/jest/dist/jest-configuration-builder").moduleExports["JestConfigurationBuilder"],n=c.default.tryRequireModuleWithPathFrom(l.path,"@angular-builders/jest/dist/default-config.resolver").moduleExports["DefaultConfigResolver"],t=c.default.tryRequireModuleWithPathFrom(l.path,"@angular-builders/jest/dist/custom-config.resolver").moduleExports["CustomConfigResolver"],l=c.default.tryRequireModuleWithPathFrom(l.path,"@angular-builders/jest/package.json"),{workspaceRoot:s,projectRoot:o}=await s(o),r=this._project.configuration.architect.test.options||{},i=await new i(new n(l&&l.module&&l.module.version&&u.gte(l.module.version,"11.2.0")?{tsConfig:r.tsConfig}:r.tsConfig),new t(new e)).buildConfiguration(o,s,r.configPath),(n=await a.jestConfigLoader.module.readConfigs({config:JSON.stringify(i)},[this._currentDirPath])).globalConfig=Object.assign({},n.globalConfig),n.configs=(n.configs||[]).filter(e=>"jest-runner"===e.runner||~c.default.normalizePath(e.runner||"").indexOf("node_modules/jest-runner/")||"jest-runner-groups"===e.runner||~c.default.normalizePath(e.runner||"").indexOf("node_modules/jest-runner-groups/")).map(e=>Object.assign({},e)),n;throw new Error("Could not load Angular CLI package")}async configure(){r("Configuring.");var e=await this.getConfigurationOnly(),t=s("../../jest/configure")["applyJestAutoConfig"];await t(this._currentDirPath,this._settings,this._autoDetectedSettings,this._packageJson,e),this._settings.customJestConfig=e,r("Configured.")}}},{"../../../utils":88,"../../jest/configure":44,semver:void 0}],40:[function(r,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WorkspaceConfigurator=void 0;const o=r("../../../utils"),i=logger.create("angular/cli jest workspace config")["trace"],n=r("./ProjectConfigurator");t.WorkspaceConfigurator=class{constructor(e,t,s,r,i,n){this._currentDirPath=e,this._autoDetectedSettings=t,this._settings=s,this._packageJson=r,this._workspaceDirPath=o.default.normalizePath(i),this._workspaceConfig=n}async configure(){i("Configuring.");var e=this._settings["angular-cli"];const t=e&&Array.isArray(e.excludedProjects)?new Set(e.excludedProjects):new Set;var e=Object.keys(this._workspaceConfig.projects).map(e=>({name:e,configuration:this._workspaceConfig.projects[e]})).filter(e=>e.configuration.architect&&e.configuration.architect.test&&"@angular-builders/jest:run"===e.configuration.architect.test.builder).filter(e=>!t.has(e.name)),e=await Promise.all(e.map(e=>new n.ProjectConfigurator(this._currentDirPath,this._autoDetectedSettings,this._settings,this._packageJson,this._workspaceDirPath,e).getConfigurationOnly())),e=Object.assign(Object.assign({},e[0]),{configs:e.map(e=>e.configs).reduce((e,t)=>(e.push(...t),e),[])}),s=r("../../jest/configure")["applyJestAutoConfig"];await s(this._currentDirPath,this._settings,this._autoDetectedSettings,this._packageJson,e),this._settings.customJestConfig=e,i("Configured.")}}},{"../../../utils":88,"../../jest/configure":44,"./ProjectConfigurator":39}],41:[function(s,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ProjectConfigurator=void 0,s("./modulePatch");let r,i={};const o=s("../../../utils"),n=logger.create("angular/cli nrwl-jest project config")["trace"];t.ProjectConfigurator=class{constructor(e,t,s,r,i,n){this._currentDirPath=e,this._autoDetectedSettings=t,this._settings=s,this._packageJson=r,this._workspaceDirPath=o.default.normalizePath(i),this._project=n}async getConfigurationOnly(){var e=this._settings,t=e&&!_.isString(e.testFramework||"")&&e.testFramework&&e.testFramework.path||"",e=e&&!_.isString(e.testFramework||"")&&e.testFramework&&e.testFramework.configFile||"",s=this._currentDirPath+`|${t}|`+e,t=(i[s]||(i[s]=await o.default.loadJest(this._currentDirPath,t,e)),i[s]),e={root:this._workspaceDirPath,workspace:{root:this._workspaceDirPath,configFile:"angular.json"},target:{project:this._project.name},workspaceRoot:this._workspaceDirPath},s=(r=r||(r=(r=(r=o.default.tryRequireModuleWithPathFrom(this._workspaceDirPath,"@nx/jest/src/executors/jest/jest.impl",!1))||o.default.tryRequireModuleWithPathFrom(this._workspaceDirPath,"@nrwl/jest/src/executors/jest/jest.impl",!1))||o.default.tryRequireModuleWithPathFrom(this._workspaceDirPath,"@nrwl/jest/src/builders/jest/jest.impl",!0)).module,this._project.configuration.architect&&this._project.configuration.architect.test.options||{}),s=await r(s,e),e=await t.jestConfigLoader.module.readConfigs(s.config,[s.options.jestConfig]);return e.globalConfig=Object.assign({},e.globalConfig),e.configs=(e.configs||[]).filter(e=>"jest-runner"===e.runner||~o.default.normalizePath(e.runner||"").indexOf("node_modules/jest-runner/")||"jest-runner-groups"===e.runner||~o.default.normalizePath(e.runner||"").indexOf("node_modules/jest-runner-groups/")).map(e=>Object.assign({},e)),e}async configure(){n("Configuring.");var e=await this.getConfigurationOnly(),t=s("../../jest/configure")["applyJestAutoConfig"];await t(this._currentDirPath,this._settings,this._autoDetectedSettings,this._packageJson,e),this._settings.customJestConfig=e,n("Configured.")}}},{"../../../utils":88,"../../jest/configure":44,"./modulePatch":43}],42:[function(o,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WorkspaceConfigurator=void 0,o("./modulePatch");const a=o("../../../utils"),l=logger.create("angular/cli nrwl-jest workspace config")["trace"],c=o("./ProjectConfigurator");t.WorkspaceConfigurator=class{constructor(e,t,s,r,i,n){this._currentDirPath=e,this._autoDetectedSettings=t,this._settings=s,this._packageJson=r,this._workspaceDirPath=a.default.normalizePath(i),this._workspaceConfig=n}async configure(){l("Configuring.");var e=this._settings["angular-cli"];const t=e&&Array.isArray(e.excludedProjects)?new Set(e.excludedProjects):new Set;var s=Object.keys(this._workspaceConfig.projects).map(e=>({name:e,configuration:this._workspaceConfig.projects[e]})).filter(e=>e.configuration.architect&&e.configuration.architect.test&&("@nrwl/jest:jest"===e.configuration.architect.test.builder||"@nx/jest:jest"===e.configuration.architect.test.builder)).filter(e=>!t.has(e.name)),r=[];for(let e=0;e<s.length;e++){var i=s[e],i=await new c.ProjectConfigurator(this._currentDirPath,this._autoDetectedSettings,this._settings,this._packageJson,this._workspaceDirPath,i).getConfigurationOnly();r.push(i)}var e=Object.assign(Object.assign({},r[0]),{configs:r.map(e=>e.configs).reduce((e,t)=>(e.push(...t),e),[])}),n=o("../../jest/configure")["applyJestAutoConfig"];await n(this._currentDirPath,this._settings,this._autoDetectedSettings,this._packageJson,e),this._settings.customJestConfig=e,l("Configured.")}}},{"../../../utils":88,"../../jest/configure":44,"./ProjectConfigurator":41,"./modulePatch":43}],43:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0});e=e("../../../utils");e.default.patchModulesCode([{files:["@nrwl/jest/src/builders/jest/jest.impl.js"],replacements:[{from:"exports.default = architect_1.createBuilder(run);",to:""},{from:"function run(options, context) {",to:"exports.default = (options, context) => {"},{from:"if (options.testFile)",to:"return { config, options };\nif (options.testFile)"}]}],"Possibly incompatible/unsupported Nrwl version"),e.default.patchModulesCode([{files:["@nrwl/jest/src/executors/jest/jest.impl.js"],replacements:[{from:"exports.default = jestExecutor;",to:"exports.default = jestConfigParser;"},{from:"if (options.testFile)",to:"return { config, options };\nif (options.testFile)"}]}],"Possibly incompatible/unsupported Nrwl version"),e.default.patchModulesCode([{files:["@nx/jest/src/executors/jest/jest.impl.js"],replacements:[{from:"exports.default = jestExecutor;",to:"exports.default = jestConfigParser;"},{from:"if (options.testFile)",to:"return { config, options };\nif (options.testFile)"}]}],"Possibly incompatible/unsupported Nx version"),s.default={}},{"../../../utils":88}],44:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.applyJestAutoConfig=s.configure=void 0,e("./modulePatch");const g=e("path"),{debug:f,trace:m}=logger.create("jest/config"),v=e("../../utils");async function i(e,s,t,r,i){m("Detecting Jest.");var n=s&&!_.isString(s.testFramework||"")&&s.testFramework&&s.testFramework.path||"",o=s&&!_.isString(s.testFramework||"")&&s.testFramework&&s.testFramework.configFile||"",n=await v.default.loadJest(e,n,o);n.jestCLI.path;i=i||n.jestConfig,s.diagnostics.jest={config:i},f("Detected Jest.");const a=v.default.escapePathForRegex(g.sep+"node_modules"+g.sep),l=[v.default.escapePathForRegex("."+g.sep+"dist"+g.sep),v.default.escapePathForRegex("."+g.sep+"build"+g.sep),v.default.escapePathForRegex("."+g.sep+"coverage"+g.sep),v.default.escapePathForRegex("."+g.sep+"git"+g.sep),v.default.escapePathForRegex(g.sep)+"\\..+"+v.default.escapePathForRegex(g.sep)];r&&r.dependencies&&r.dependencies["react-native"]&&(l.push(v.default.escapePathForRegex("android"+g.sep)),l.push(v.default.escapePathForRegex("ios"+g.sep)));o=[a,l.join("|"),v.default.escapePathForRegex(".watchman-cookie")];const c=i.wallaby={roots:[],watchPathIgnorePatterns:o,testPathIgnorePatterns:o,testMatch:[],testRegex:[]},u=1<(i.configs||[]).length,p=e,d=v.default.normalizePath(p),h=(e,n,o,a,l)=>{const c=[];return _.each(e,e=>{e=e&&e.normalize();s=e,i=a;let t=(r=o)&&~s.indexOf(d)?s.split(d+"/").join("").split(d).join(""):!r&&~s.indexOf(p)?i?s.split(p).join(v.default.escapePathForRegex(".")):s.split(p+g.sep).join("").split(p).join(""):~s.indexOf(v.default.replacePathSepForRegex(p))?s.split(v.default.replacePathSepForRegex(p)).join(i?v.default.escapePathForRegex("."):""):s;var s,r,i;t&&!~n.indexOf(t)&&(t===e&&l&&(t=l+t),n.push(t),c.push(t))}),c};if(s.filesWithCoverageCalculated=[],_.each(i.configs,e=>{var t=`(${h(e.roots,c.roots,!1).map(e=>v.default.escapePathForRegex(v.default.platformDependentPath(e))).join("|")}.*)`;e.cacheDirectory&&h([e.cacheDirectory],c.watchPathIgnorePatterns,!1,!0,u&&t||void 0),c.roots.length&&(c.roots=c.roots.map(e=>v.default.normalizePath(e))),h(e.watchPathIgnorePatterns,c.watchPathIgnorePatterns,!1,!0,u&&t||void 0),h(e.testPathIgnorePatterns.concat(e.modulePathIgnorePatterns||[]),c.testPathIgnorePatterns,!1,!0,u&&t||void 0),h(e.testMatch,c.testMatch,!0,!1,void 0),h(e.testRegex,c.testRegex,!1,!0,u&&t||void 0),e.collectCoverageFrom&&(s.filesWithCoverageCalculated=s.filesWithCoverageCalculated.concat(e.collectCoverageFrom)),e.coveragePathIgnorePatterns&&(s.filesWithNoCoverageCalculated=(s.filesWithNoCoverageCalculated||[]).concat(e.coveragePathIgnorePatterns.filter(t=>t!==a&&!l.find(e=>e===t)).map(e=>new RegExp(e)))),s.globalSetup=s.globalSetup||!!e.globalSetup||!!e.globalTeardown||!!(i.globalConfig||{}).globalSetup||!!(i.globalConfig||{}).globalTeardown}),(i.globalConfig||{}).collectCoverageFrom&&(s.filesWithCoverageCalculated=Array.from(new Set(s.filesWithCoverageCalculated.concat((i.globalConfig||{}).collectCoverageFrom)))),(i.globalConfig||{}).coverageDirectory&&h([(i.globalConfig||{}).coverageDirectory],c.watchPathIgnorePatterns,!1,!0,void 0),(i.globalConfig||{}).coveragePathIgnorePatterns&&(s.filesWithNoCoverageCalculated=(s.filesWithNoCoverageCalculated||[]).concat((i.globalConfig||{}).coveragePathIgnorePatterns.filter(t=>t!==a&&!l.find(e=>e===t)).map(e=>new RegExp(e)))),s.filesWithCoverageCalculated=s.filesWithCoverageCalculated.map(e=>e.replace("<rootDir>/","")),!c.testMatch.length&&!c.testRegex.length)throw new Error("Can not autodetect test patterns, neither Jest testMatch nor testRegex is set.");_.isObject(s.testFramework)||(s.testFramework={}),s.testFramework.type="jest",s.testFramework.toolVersion=n.version,s.testFramework.originalConfig=i,s.testFramework.autoDetected=!0,s.dot=!0,t.hard.noCompilers=!0,t.hard.env={type:"node"},f("Configured Jest.")}s.applyJestAutoConfig=i,s.configure=async function(e,t,s,r){try{return await i(e,s,t,r,void 0),{success:!0,errors:[]}}catch(e){return f(e),{success:!1,errors:[new Error("Automatic Jest configuration error: "+e.message)]}}}},{"../../utils":88,"./modulePatch":45,path:void 0}],45:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0});e=e("../../utils");e.default.patchModulesCode([{files:["ts-node/dist/transpilers/swc.js"],replacements:[{from:"...swcOptions,",to:"...swcOptions, jsc: { ...(swcOptions || {}).jsc,  externalHelpers: false, },",optional:!0}]},{files:["ts-node/dist/ts-internals.js"],replacements:[{from:"/*conditionsOrIsConfigLookup*/ tsGte5_3_0 ? undefined : true, ",to:"/*conditionsOrIsConfigLookup*/ tsGte5_3_0 ? [] : true, ",optional:!0}]}]),e.default.patchModulesCode([{files:["react-app-rewired/scripts/test.js"],replacements:[{from:"require(`${scriptVersion}/scripts/test`);",to:"module.exports = require('../overrides/jest')();",optional:!0},{from:"if (paths.customScriptsIndex > -1) {",to:"module.exports = config; return; if (paths.customScriptsIndex > -1) {",optional:!0}]},{files:["jest-util/build/tryRealpath.js"],replacements:[{from:"path = _gracefulFs().realpathSync.native(path);",to:`const newPath = _gracefulFs().realpathSync.native(path);
        path = (process.platform === 'win32' && path.substr(0, 1).toLowerCase() !== newPath.substr(0, 1).toLowerCase()) ? path : newPath;`}]},e.default.jestTsNodePatch()]),s.default={}},{"../../utils":88}],46:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.configure=void 0;const g=e("path"),f=e("fs"),m=e("semver"),v=e("../../utils"),{debug:y,trace:b}=logger.create("vitest/config");s.configure=async function(t,s,r){try{if(b("Detecting node:test."),t.endsWith(g.sep)&&(t=t.slice(0,-1)),m.lt(process.versions.node,"22.3.0"))throw new Error("Wallaby node:test integration requires Node.js 22.3.0 or higher.");var i=["**/node_modules/**","**/dist/**","**/cypress/**","**/.{idea,git,cache,output,temp}/**","**/{karma,rollup,webpack,vite,vitest,jest,ava,babel,nyc,cypress,tsup,build}.config.*"],n=[...i.map(e=>"!"+e),"!**/*.{test,spec}.?(c|m)[jt]s?(x)","**/*.*"],o=[...i.map(e=>"!"+e),"**/*.{test,spec}.?(c|m)[jt]s?(x)"],a=r.files?_.isFunction(r.files.override)?r.files.override(n):r.files:n,l=r.tests?_.isFunction(r.tests.override)?r.tests.override(o):r.tests:o;var c=function s(r,i=[],n=new Set){return(0,f.readdirSync)(r).forEach(e=>{var e=(0,g.join)(r,e),t=(0,f.realpathSync)(e);if(!n.has(t)){n.add(t);try{(0,f.statSync)(e).isDirectory()?"node_modules"!==(0,g.basename)(r)&&s(e,i,n):i.push(e)}catch(e){}}}),i}(t),u=l.filter(e=>"string"==typeof e).map(e=>v.default.makeRe(e.startsWith("**/")?e:"**/"+e,{dot:!0}));let e=!1;for(const d of c)if(u.find(e=>e.test(d)))if(-1!==(0,f.readFileSync)(d,"utf8").indexOf("node:test")){e=!0;break}if(!e)throw new Error("node:test use not found.");r.tests=l,r.files=a,_.isObject(r.testFramework)||(r.testFramework={}),r.preserveComments=!1,r.extractComments=!0,r.testFramework.type="node",r.testFramework.autoDetected=!0;const p={"@swc-node/register":{esmHook:"@swc-node/register/esm-register",preloadModule:"@swc-node/register"},"ts-node":{esmHook:"ts-node/esm",preloadModule:"ts-node/register"},tsx:{esmHook:"tsx/esm",preloadModule:"tsx/cjs"},"esbuild-register":{esmHook:void 0,preloadModule:"esbuild-register"}};if(!r.esmHooks||!r.preloadModules)try{const h=JSON.parse((0,f.readFileSync)((0,g.join)(t,"package.json"),"utf8"));Object.keys(p).forEach(e=>{var t;null!=(t=h.devDependencies)&&t[e]||null!=(t=h.dependencies)&&t[e]||(t=p[e],delete p[e],p[e]=t)})}catch(e){}return r.esmHooks=r.esmHooks||Object.values(p).map(e=>e.esmHook).filter(e=>!!e),r.preloadModules=r.preloadModules||Object.values(p).map(e=>e.preloadModule).filter(e=>!!e),s.hard.noCompilers=!0,s.hard.env={type:"node"},s.hard.env.params={runner:"--expose-internals"},r.dot=!0,b("Configured node:test."),{success:!0,errors:[]}}catch(e){return y(e),{success:!1,errors:[new Error("Automatic node:test configuration error: "+e.message)]}}}},{"../../utils":88,fs:void 0,path:void 0,semver:void 0}],47:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.configure=void 0;const R=e("path"),I=e("url"),O=e("fs"),L=e("child_process"),M=e("semver"),{debug:D,trace:$}=logger.create("vitest/config"),N=e("../../utils").default["tryRequireModuleWithPathFrom"],A=e("./extract");s.configure=async function(t,s,r){var i,n,o,a,l;try{$("Detecting Vitest.");var c=r&&!_.isString(r.testFramework||"")&&r.testFramework&&r.testFramework.configFile||"",u=(t.endsWith(R.sep)&&(t=t.slice(0,-1)),r&&!_.isString(r.testFramework||"")&&r.testFramework&&r.testFramework.configFile||"");if(r.diagnostics.vitest={},u){var p=(0,R.join)(t,u);if(!(0,O.existsSync)(p))throw new Error(`Configuration file "${p} not found.`);r.diagnostics.vitest.file={config:(0,O.readFileSync)(p).toString()}}else{var d=["vitest.workspace.ts","vitest.workspace.js","vitest.workspace.json","vitest.projects.ts","vitest.projects.js","vitest.projects.json","vitest.config.ts","vitest.config.js","vitest.config.mjs","vite.config.ts","vite.config.js","vite.config.mjs"],h=(c&&d.unshift(c),d.find(e=>(0,O.existsSync)((0,R.join)(t,e))));h&&(r.diagnostics.vitest.file={config:(0,O.readFileSync)((0,R.join)(t,h)).toString()})}var g=N(t,"vitest/package.json",!1);if(!g)throw new Error("Vitest dependency not found.");if(D(`Detected Vitest (${g.module.version}).`),!(M.gte(process.versions.node,"17.0.0")||M.gte(process.versions.node,"16.12.0")&&M.lt(process.versions.node,"17.0.0")||M.gte(process.versions.node,"14.999.999")&&M.lt(process.versions.node,"15.0.0")||M.gte(process.versions.node,"12.999.999")&&M.lt(process.versions.node,"13.0.0")))throw new Error("Wallaby Vitest integration requires Node.js 16.12.0 or higher.");var f=(0,I.pathToFileURL)((0,R.join)((0,R.dirname)(process.mainModule.filename),"runners/node/hooks.mjs")),m="--experimental-loader",v=[],y=((M.gte(process.version,"19.0.0")&&M.lt(process.version,"20.0.0")||M.lt(process.version,"20.0.0")&&M.lt(process.version,"18.19.0")||M.gte(process.version,"20.0.0")&&M.lt(process.version,"20.6.0"))&&v.push(m+"="+f),v.push(process.mainModule.filename,"extractor","vitest"),v.push(JSON.stringify({moduleFolderPath:(0,R.dirname)(g.path),moduleVersion:g.module.version,hooksFileUrl:f,configFile:c})),r.env&&r.env.runner?r.env.runner:process.execPath),b=JSON.parse(JSON.stringify(process.env));if(process.env.WALLABY_PNP){let e="";-1===(e=b.NODE_OPTIONS?b.NODE_OPTIONS:e).indexOf("--require")&&(e=e+(e?" ":"")+process.env.WALLABY_PNP),b.NODE_OPTIONS=e}o=y,a=v,l={env:b};var w=await new Promise((t,s)=>{const r=(0,L.spawn)(o,a,l);let i="",n="";r.stdout.on("data",e=>{(i+=e.toString()).includes(A.wallabyMarkerEnd)&&(t({code:0,stdout:i,stderr:n}),r.kill("SIGKILL"))}),r.stderr.on("data",e=>{n+=e.toString()}),r.on("close",e=>{t({code:e,stdout:i,stderr:n})}),r.on("error",e=>{s(e)})}),k="Unable to extract Vitest configuration.";if(0!==w.code)throw w.stderr?new Error(w.stderr):new Error(k);if(!w.stdout)throw new Error(k);let e;var x=w.stdout.toString();try{e=JSON.parse(x.split(A.wallabyMarkerStart)[1].split(A.wallabyMarkerEnd)[0]);const E=e=>e.map(e=>e.startsWith(t)?e.slice(t.length+1):e),j=e=>{e.include&&(e.include=E(e.include)),e.exclude&&(e.exclude=E(e.exclude))};j(e.config),e.projects&&e.projects.forEach(t=>{t.config.root&&(t.config.include=t.config.include.map(e=>(0,R.join)(t.config.root,e)),t.config.exclude=t.config.exclude.map(e=>(0,R.join)(t.config.root,e))),j(t.config)})}catch(e){throw D("Failed to parse configuration\n%s\n%s",e.toString(),x),new Error(k)}if(null!=(n=null==(i=null===e||void 0===e?void 0:e.config)?void 0:i.browser)&&n.enabled)throw new Error("Vitest browser mode is not supported, see https://github.com/wallabyjs/public/issues/3282 for updates.");r.diagnostics.vitest.config=e,_.isObject(r.testFramework)||(r.testFramework={}),r.preserveComments=!1,r.extractComments=!0,r.testFramework.type="vitest",r.testFramework.autoDetected=!0,(M.gte(process.version,"19.0.0")&&M.lt(process.version,"20.0.0")||M.lt(process.version,"20.0.0")&&M.lt(process.version,"18.19.0")||M.gte(process.version,"20.0.0")&&M.lt(process.version,"20.6.0"))&&r.env&&r.env.params&&(r.env.params.runner?r.env.params.runner.indexOf(m)<0&&(r.env.params.runner+=` ${m}=`+f):r.env.params.runner=m+"="+f),s.hard.noCompilers=!0,s.hard.env={type:"node"},(M.gte(process.version,"19.0.0")&&M.lt(process.version,"20.0.0")||M.lt(process.version,"20.0.0")&&M.lt(process.version,"18.19.0")||M.gte(process.version,"20.0.0")&&M.lt(process.version,"20.6.0"))&&(s.hard.env.params={runner:m+"="+f});var S=[...new Set([...e.config.include,...e.projects?e.projects.map(e=>e.config.include).flat():[]])],P=[...new Set([...e.config.exclude,...e.projects?e.projects.map(e=>e.config.exclude).flat():[]])],F=[...new Set([...Array.isArray(e.config.globalSetup)?e.config.globalSetup:e.config.globalSetup?[e.config.globalSetup]:[],...e.projects?e.projects.map(e=>[...Array.isArray(e.config.globalSetup)?e.config.globalSetup:e.config.globalSetup?[e.config.globalSetup]:[]]).flat():[]])],C=[...new Set([...S.map(e=>"!"+e),...P.map(e=>"!"+e),...F.map(e=>"!"+e),"!**/*.timestamp-*","**/*.*"])],T=[...new Set([...P.map(e=>"!"+e),...F.map(e=>"!"+e),...S])];return r.files?_.isFunction(r.files.override)&&(r.files=r.files.override(C)):r.files=C,r.tests?_.isFunction(r.tests.override)&&(r.tests=r.tests.override(T)):r.tests=T,r.workers=r.workers||{},r.workers.initial=1,r.workers.regular=1,r.dot=!0,$("Configured Vitest."),{success:!0,errors:[]}}catch(e){return D(e),{success:!1,errors:[new Error("Automatic Vitest configuration error: "+e.message)]}}}},{"../../utils":88,"./extract":48,child_process:void 0,fs:void 0,path:void 0,semver:void 0,url:void 0}],48:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.wallabyMarkerEnd=exports.wallabyMarkerStart=exports.extract=void 0;const path_1=require("path"),url_1=require("url"),semver_1=require("semver"),utils_1=require("../../utils"),{findFirstFileMatchingContentInDirectory}=utils_1.default,minSupportedVersion="0.14.0",wallabyMarkerStart="####-WALLABY-MARKER-START-####",wallabyMarkerEnd=(exports.wallabyMarkerStart=wallabyMarkerStart,"####-WALLABY-MARKER-END-####");async function extract(moduleFolderPath,moduleVersion,hooksFileUrl,configFile){if(!(0,semver_1.valid)(moduleVersion)||(0,semver_1.lt)(moduleVersion,minSupportedVersion))throw new Error(`Only Vitest v${minSupportedVersion} or higher is supported.`);const{registerHook,patchFile}=await eval(_e1c‍.c(`import('${hooksFileUrl}')`)),moduleDistFolderPath=(await registerHook(),(0,path_1.join)(moduleFolderPath,"dist")),entryFilePath=findFirstFileMatchingContentInDirectory(moduleDistFolderPath,"const ctx = await createVitest(options, viteOverrides);")||findFirstFileMatchingContentInDirectory(moduleDistFolderPath,"const ctx = await createVitest(mode, options, viteOverrides);")||findFirstFileMatchingContentInDirectory(moduleDistFolderPath,"const ctx = await createVitest(mode, options, viteOverrides, vitestOptions);"),{startVitest}=(patchFile(entryFilePath,[{key:"createVitest",from:"const ctx = await createVitest(options, viteOverrides);",to:"const ctx = await createVitest(options, viteOverrides); await ctx.close(); return ctx;"},{key:"createVitest",from:"const ctx = await createVitest(mode, options, viteOverrides);",to:"const ctx = await createVitest(mode, options, viteOverrides); await ctx.close(); return ctx;"},{key:"createVitest",from:"const ctx = await createVitest(mode, options, viteOverrides, vitestOptions);",to:"const ctx = await createVitest(mode, options, viteOverrides, vitestOptions); await ctx.close(); return ctx;"},{from:"async function startVitest",to:"export async function startVitest"}]),(0,semver_1.gte)(moduleVersion,"1.6.0")&&patchFile(entryFilePath,[{from:"await ctx.start(cliFilters);",to:"await ctx.init();"}]),await eval(_e1c‍.c(`import('${(0,url_1.pathToFileURL)(entryFilePath)}')`)));try{const options={};configFile&&(options.config=configFile);let ctx;ctx=(0,semver_1.lt)(moduleVersion,"0.7.5")?await startVitest([],{},options):await startVitest("test",[],{},options);const projects=[];if(ctx.projects)for(const project of ctx.projects){const{config,path}=project;projects.push({path:path.toString(),config:config})}const configuration={config:ctx.config,projects:projects,package:{version:moduleVersion,urls:{hooks:hooksFileUrl},paths:{root:moduleFolderPath,dist:moduleDistFolderPath}}};return wallabyMarkerStart+JSON.stringify(configuration)+wallabyMarkerEnd}catch(e){throw emitDiagnostic({name:"genericError",message:`Error extracting vitest configuration
`+`Please contact Wallaby support and provide the contents of this file '${entryFilePath}'`}),e}}exports.wallabyMarkerEnd=wallabyMarkerEnd,exports.extract=extract},{"../../utils":88,path:void 0,semver:void 0,url:void 0}],49:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.emitDiagnostic=s.Emitter=s.DiagnosticEventEmitter=void 0;const r=e("events"),i=e("./diagnosticMapping"),n=e("util"),o="diagnostic";class a{constructor(){this.eventEmitter=new r.EventEmitter,this.previousDiagnostics=[]}addListener(e){return this.eventEmitter.addListener(o,e),this}on(e){return this.eventEmitter.on(o,e),this}once(e){return this.eventEmitter.once(o,e),this}removeListener(e){return this.eventEmitter.removeListener(o,e),this}off(e){return this.removeListener(e),this}removeAllListeners(){return this.eventEmitter.removeAllListeners(o),this}setMaxListeners(e){return this.eventEmitter.setMaxListeners(e),this}getMaxListeners(){return this.eventEmitter.getMaxListeners()}listeners(){return this.eventEmitter.listeners(o)}rawListeners(){return this.eventEmitter.rawListeners(o)}emit(e){return this.previousDiagnostics.push(e),1e4<this.previousDiagnostics.length&&this.previousDiagnostics.shift(),this.eventEmitter.emit(o,e)}listenerCount(){return this.eventEmitter.listenerCount(o)}prependListener(e){return this.eventEmitter.prependListener(o,e),this}prependOnceListener(e){return this.eventEmitter.prependOnceListener(o,e),this}clearPreviousDiagnosticMessages(){this.previousDiagnostics.length=0}}s.DiagnosticEventEmitter=a,s.Emitter=new a;const l=Object.keys(console).reduce((e,t)=>("function"==typeof console[t]&&(e[t]=console[t]),e),{});function c(e){e.time=e.time||Date.now(),s.Emitter.emit(e);try{var t;i.toFormattedDiagnostic[e.name]&&(t=i.toFormattedDiagnostic[e.name](e))&&!process.env.WALLABY_UNIT_TEST_RUN&&l[t.type](t.message)}catch(e){}}["log","warn","error","info"].forEach(t=>{console[t]=(...e)=>{c({name:"console",type:t,message:(0,n.formatWithOptions)({},...e),time:Date.now()})}}),s.emitDiagnostic=c,global.diagnosticEmitter=s.Emitter,global.emitDiagnostic=c},{"./diagnosticMapping":50,events:void 0,util:void 0}],50:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.toFormattedDiagnostic=void 0,s.toFormattedDiagnostic={diagnosticsCopied:e=>({type:"log",message:"Diagnostics report has been successfully copied to clipboard."}),console:e=>({type:"log",message:`console.${e.type}: `+e.message}),invalidBabelVersion:e=>({type:"error",message:"Babel version for compiler must be >= "+e.minVersion}),genericError:e=>({type:"error",message:e.message}),genericWarning:e=>({type:"warn",message:e.message}),secureLinkToLaunchLegacyUiService:e=>({type:"log",message:"To launch Wallaby App, open this link in your browser: "+e.url}),nodeRunnerStdErr:e=>({type:"error",message:e.message}),possiblyIncompatiblePatch:e=>({type:"warn",message:e.message}),uiServiceReady:e=>({type:"log",message:e.port?"Wallaby Linked Mode is available at http://localhost:"+e.port:"Wallaby App (realtime reports) is available at http://localhost:51245"}),cannotDetermineTestsToRun:e=>{let t="Can't determine tests to run for the change.";return e.onlyRunSelectedTestFiles||(e.runAllTestsWhenNoAffectedTests?t+="\nTo prevent the full test run when can not determine tests to run, use `runAllTestsWhenNoAffectedTests: false` configuration option.":t+="\nTo run all tests when can not determine tests to run, use `runAllTestsWhenNoAffectedTests: true` configuration option."),{type:"log",message:t}},longRunningSetupTeardown:e=>({type:"warn",message:"Some long running code has been detected: "+("setup"===e.type?"Global Setup":"Global Teardown")}),finishedExecuting:e=>{let t=e.duration,s="millisecond(s)";return 1e3<t&&(t/=1e3,s="second(s)",60<t)&&(t/=60,s="minute(s)"),{type:"log",message:`Finished executing ${e.numberTests} affected test(s) in ${Math.round(100*t)/100} `+s}},testProgress:e=>({type:"log",message:`Execution progress: ${e.numberExecuted} tests'`}),waitingForGlobalSetupTeardown:e=>({type:"log",message:`[${e.sessionId}] Global Setup and Teardown is not complete, waiting for ${e.timeoutMs}ms before recycling worker`}),recyclingWorker:e=>({type:"error",message:`[${e.sessionId}] ${e.reason}, recycling worker.`}),postProcessorLog:e=>({type:"log",message:e.message})}},{}],51:[function(e,t,s){function f(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32}f.prototype.diff_main=function(e,t,s,r){var i,n,o,r=r=void 0===r?this.Diff_Timeout<=0?Number.MAX_VALUE:(new Date).getTime()+1e3*this.Diff_Timeout:r;if(null==e||null==t)throw new Error("Null input. (diff_main)");return e==t?e?[[0,e]]:[]:(s=s=void 0===s||s,o=this.diff_commonPrefix(e,t),i=e.substring(0,o),e=e.substring(o),t=t.substring(o),o=this.diff_commonSuffix(e,t),n=e.substring(e.length-o),e=e.substring(0,e.length-o),t=t.substring(0,t.length-o),o=this.diff_compute_(e,t,s,r),i&&o.unshift([0,i]),n&&o.push([0,n]),this.diff_cleanupMerge(o),o)},f.prototype.diff_compute_=function(e,t,s,r){var i,n,o,a,l;return e?t?(a=e.length>t.length?e:t,i=e.length>t.length?t:e,-1!=(o=a.indexOf(i))?(a=[[1,a.substring(0,o)],[0,i],[1,a.substring(o+i.length)]],e.length>t.length&&(a[0][0]=a[2][0]=-1),a):1==i.length?[[-1,e],[1,t]]:(o=this.diff_halfMatch_(e,t))?(a=o[0],i=o[1],l=o[2],n=o[3],o=o[4],a=this.diff_main(a,l,s,r),l=this.diff_main(i,n,s,r),a.concat([[0,o]],l)):s&&100<e.length&&100<t.length?this.diff_lineMode_(e,t,r):this.diff_bisect_(e,t,r)):[[-1,e]]:[[1,t]]},f.prototype.diff_lineMode_=function(e,t,s){e=(u=this.diff_linesToChars_(e,t)).chars1,t=u.chars2;for(var r=u.lineArray,i=this.diff_main(e,t,!1,s),n=(this.diff_charsToLines_(i,r),this.diff_cleanupSemantic(i),i.push([0,""]),0),o=0,a=0,l="",c="";n<i.length;){switch(i[n][0]){case 1:a++,c+=i[n][1];break;case-1:o++,l+=i[n][1];break;case 0:if(1<=o&&1<=a){i.splice(n-o-a,o+a);for(var u,n=n-o-a,p=(u=this.diff_main(l,c,!1,s)).length-1;0<=p;p--)i.splice(n,0,u[p]);n+=u.length}o=a=0,c=l=""}n++}return i.pop(),i},f.prototype.diff_bisect_=function(e,t,s){for(var r=e.length,i=t.length,n=Math.ceil((r+i)/2),o=n,a=2*n,l=new Array(a),c=new Array(a),u=0;u<a;u++)l[u]=-1,c[u]=-1;l[o+1]=0;for(var p=r-i,d=p%2!=(c[o+1]=0),h=0,g=0,f=0,m=0,_=0;_<n&&!((new Date).getTime()>s);_++){for(var v=-_+h;v<=_-g;v+=2){for(var y=o+v,b=(P=v==-_||v!=_&&l[y-1]<l[y+1]?l[y+1]:l[y-1]+1)-v;P<r&&b<i&&e.charAt(P)==t.charAt(b);)P++,b++;if(r<(l[y]=P))g+=2;else if(i<b)h+=2;else if(d){var w=o+p-v;if(0<=w&&w<a&&-1!=c[w])if((x=r-c[w])<=P)return this.diff_bisectSplit_(e,t,P,b,s)}}for(var k=-_+f;k<=_-m;k+=2){for(var x,w=o+k,S=(x=k==-_||k!=_&&c[w-1]<c[w+1]?c[w+1]:c[w-1]+1)-k;x<r&&S<i&&e.charAt(r-x-1)==t.charAt(i-S-1);)x++,S++;if(r<(c[w]=x))m+=2;else if(i<S)f+=2;else if(!d)if(0<=(y=o+p-k)&&y<a&&-1!=l[y]){var P,b=o+(P=l[y])-y;if((x=r-x)<=P)return this.diff_bisectSplit_(e,t,P,b,s)}}}return[[-1,e],[1,t]]},f.prototype.diff_bisectSplit_=function(e,t,s,r,i){var n=e.substring(0,s),o=t.substring(0,r),e=e.substring(s),s=t.substring(r),t=this.diff_main(n,o,!1,i),r=this.diff_main(e,s,!1,i);return t.concat(r)},f.prototype.diff_linesToChars_=function(e,t){var o=[],a=Object.create(null);function s(e){for(var t="",s=0,r=-1,i=o.length;r<e.length-1;){-1==(r=e.indexOf("\n",s))&&(r=e.length-1);var n=e.substring(s,r+1),s=r+1;void 0!==a[n]?t+=String.fromCharCode(a[n]):(t+=String.fromCharCode(i),a[n]=i,o[i++]=n)}return t}return o[0]="",{chars1:s(e),chars2:s(t),lineArray:o}},f.prototype.diff_wordMode=function(e,t){var e=this.diff_linesToWords_(e,t),t=e.chars1,s=e.chars2,e=e.lineArray,t=this.diff_main(t,s,!1);return this.diff_charsToLines_(t,e),t},f.prototype.diff_linesToWords_=function(e,t){var a=[],l=Object.create(null),c=(a[0]="",/^[A-Za-z\xC0-\u02C6\u02C8-\u02D7\u02DE-\u02FF\u1E00-\u1EFF]+$/);function s(e){for(var t="",s=function(e){for(var t=e.split(/(\s+|\b)/),s=0;s<t.length-1;s++)!t[s+1]&&t[s+2]&&c.test(t[s])&&c.test(t[s+2])&&(t[s]+=t[s+2],t.splice(s+1,2),s--);return t}(e),r=a.length,i=0,n=s.length;i<n;i++){var o=s[i];void 0!==l[o]?t+=String.fromCharCode(l[o]):(t+=String.fromCharCode(r),l[o]=r,a[r++]=o)}return t}return{chars1:s(e),chars2:s(t),lineArray:a}},f.prototype.diff_charsToLines_=function(e,t){for(var s=0;s<e.length;s++){for(var r=e[s][1],i=[],n=0;n<r.length;n++)i[n]=t[r.charCodeAt(n)];e[s][1]=i.join("")}},f.prototype.diff_commonPrefix=function(e,t){if(!e||!t||e.charAt(0)!=t.charAt(0))return 0;for(var s=0,r=Math.min(e.length,t.length),i=r,n=0;s<i;)e.substring(n,i)==t.substring(n,i)?n=s=i:r=i,i=Math.floor((r-s)/2+s);return i},f.prototype.diff_commonSuffix=function(e,t){if(!e||!t||e.charAt(e.length-1)!=t.charAt(t.length-1))return 0;for(var s=0,r=Math.min(e.length,t.length),i=r,n=0;s<i;)e.substring(e.length-i,e.length-n)==t.substring(t.length-i,t.length-n)?n=s=i:r=i,i=Math.floor((r-s)/2+s);return i},f.prototype.diff_commonOverlap_=function(e,t){var s=e.length,r=t.length;if(0==s||0==r)return 0;r<s?e=e.substring(s-r):s<r&&(t=t.substring(0,s));var i=Math.min(s,r);if(e==t)return i;for(var n=0,o=1;;){var a=e.substring(i-o),a=t.indexOf(a);if(-1==a)return n;o+=a,0!=a&&e.substring(i-o)!=t.substring(0,o)||(n=o,o++)}},f.prototype.diff_halfMatch_=function(e,t){var d,s,r,i,n,o,a,l;return!(this.Diff_Timeout<=0)&&(i=e.length>t.length?e:t,r=e.length>t.length?t:e,!(i.length<4||2*r.length<i.length))&&(d=this,s=c(i,r,Math.ceil(i.length/4)),r=c(i,r,Math.ceil(i.length/2)),s||r)?(i=!r||s&&s[4].length>r[4].length?s:r,e.length>t.length?(n=i[0],o=i[1],a=i[2],l=i[3]):(a=i[0],l=i[1],n=i[2],o=i[3]),[n,o,a,l,i[4]]):null;function c(e,t,s){for(var r,i,n,o,a=e.substring(s,s+Math.floor(e.length/4)),l=-1,c="";-1!=(l=t.indexOf(a,l+1));){var u=d.diff_commonPrefix(e.substring(s),t.substring(l)),p=d.diff_commonSuffix(e.substring(0,s),t.substring(0,l));c.length<p+u&&(c=t.substring(l-p,l)+t.substring(l,l+u),r=e.substring(0,s-p),i=e.substring(s+u),n=t.substring(0,l-p),o=t.substring(l+u))}return 2*c.length>=e.length?[r,i,n,o,c]:null}},f.prototype.diff_cleanupSemantic=function(e){for(var t,s,r,i,n=!1,o=[],a=0,l=null,c=0,u=0,p=0,d=0,h=0;c<e.length;)0==e[c][0]?(u=d,p=h,h=d=0,l=e[o[a++]=c][1]):(1==e[c][0]?d+=e[c][1].length:h+=e[c][1].length,l&&l.length<=Math.max(u,p)&&l.length<=Math.max(d,h)&&(e.splice(o[a-1],0,[-1,l]),e[o[a-1]+1][0]=1,a--,c=0<--a?o[a-1]:-1,h=d=p=u=0,n=!(l=null))),c++;for(n&&this.diff_cleanupMerge(e),this.diff_cleanupSemanticLossless(e),c=1;c<e.length;)-1==e[c-1][0]&&1==e[c][0]&&(t=e[c-1][1],s=e[c][1],r=this.diff_commonOverlap_(t,s),(i=this.diff_commonOverlap_(s,t))<=r?(r>=t.length/2||r>=s.length/2)&&(e.splice(c,0,[0,s.substring(0,r)]),e[c-1][1]=t.substring(0,t.length-r),e[c+1][1]=s.substring(r),c++):(i>=t.length/2||i>=s.length/2)&&(e.splice(c,0,[0,t.substring(0,i)]),e[c-1][0]=1,e[c-1][1]=s.substring(0,s.length-i),e[c+1][0]=-1,e[c+1][1]=t.substring(i),c++),c++),c++},f.prototype.diff_cleanupSemanticLossless=function(e){function t(e,t){var s,r,i,n,o,a;return e&&t?(o=e.charAt(e.length-1),a=t.charAt(0),s=o.match(f.nonAlphaNumericRegex_),r=a.match(f.nonAlphaNumericRegex_),i=s&&o.match(f.whitespaceRegex_),n=r&&a.match(f.whitespaceRegex_),o=i&&o.match(f.linebreakRegex_),a=n&&a.match(f.linebreakRegex_),e=o&&e.match(f.blanklineEndRegex_),t=a&&t.match(f.blanklineStartRegex_),e||t?5:o||a?4:s&&!i&&n?3:i||n?2:s||r?1:0):6}for(var s=1;s<e.length-1;){if(0==e[s-1][0]&&0==e[s+1][0]){for(var r,i=e[s-1][1],n=e[s][1],o=e[s+1][1],a=this.diff_commonSuffix(i,n),l=(a&&(r=n.substring(n.length-a),i=i.substring(0,i.length-a),n=r+n.substring(0,n.length-a),o=r+o),i),c=n,u=o,p=t(i,n)+t(n,o);n.charAt(0)===o.charAt(0);){i+=n.charAt(0),n=n.substring(1)+o.charAt(0),o=o.substring(1);var d=t(i,n)+t(n,o);p<=d&&(p=d,l=i,c=n,u=o)}e[s-1][1]!=l&&(l?e[s-1][1]=l:(e.splice(s-1,1),s--),e[s][1]=c,u?e[s+1][1]=u:(e.splice(s+1,1),s--))}s++}},f.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/,f.whitespaceRegex_=/\s/,f.linebreakRegex_=/[\r\n]/,f.blanklineEndRegex_=/\n\r?\n$/,f.blanklineStartRegex_=/^\r?\n\r?\n/,f.prototype.diff_cleanupEfficiency=function(e){for(var t=!1,s=[],r=0,i=null,n=0,o=!1,a=!1,l=!1,c=!1;n<e.length;)0==e[n][0]?(i=e[n][1].length<this.Diff_EditCost&&(l||c)?(o=l,a=c,e[s[r++]=n][1]):(r=0,null),l=c=!1):(-1==e[n][0]?c=!0:l=!0,i&&(o&&a&&l&&c||i.length<this.Diff_EditCost/2&&o+a+l+c==3)&&(e.splice(s[r-1],0,[-1,i]),e[s[r-1]+1][0]=1,r--,o&&a?(l=c=!0,r=0):(n=0<--r?s[r-1]:-1,l=c=!1),t=!(i=null))),n++;t&&this.diff_cleanupMerge(e)},f.prototype.diff_cleanupMerge=function(e){e.push([0,""]);for(var t,s=0,r=0,i=0,n="",o="";s<e.length;)switch(e[s][0]){case 1:i++,o+=e[s][1],s++;break;case-1:r++,n+=e[s][1],s++;break;case 0:1<r+i?(0!==r&&0!==i&&(0!==(t=this.diff_commonPrefix(o,n))&&(0<s-r-i&&0==e[s-r-i-1][0]?e[s-r-i-1][1]+=o.substring(0,t):(e.splice(0,0,[0,o.substring(0,t)]),s++),o=o.substring(t),n=n.substring(t)),0!==(t=this.diff_commonSuffix(o,n)))&&(e[s][1]=o.substring(o.length-t)+e[s][1],o=o.substring(0,o.length-t),n=n.substring(0,n.length-t)),0===r?e.splice(s-i,r+i,[1,o]):0===i?e.splice(s-r,r+i,[-1,n]):e.splice(s-r-i,r+i,[-1,n],[1,o]),s=s-r-i+(r?1:0)+(i?1:0)+1):0!==s&&0==e[s-1][0]?(e[s-1][1]+=e[s][1],e.splice(s,1)):s++,r=i=0,o=n=""}""===e[e.length-1][1]&&e.pop();for(var a=!1,s=1;s<e.length-1;)0==e[s-1][0]&&0==e[s+1][0]&&(e[s][1].substring(e[s][1].length-e[s-1][1].length)==e[s-1][1]?(e[s][1]=e[s-1][1]+e[s][1].substring(0,e[s][1].length-e[s-1][1].length),e[s+1][1]=e[s-1][1]+e[s+1][1],e.splice(s-1,1),a=!0):e[s][1].substring(0,e[s+1][1].length)==e[s+1][1]&&(e[s-1][1]+=e[s+1][1],e[s][1]=e[s][1].substring(e[s+1][1].length)+e[s+1][1],e.splice(s+1,1),a=!0)),s++;a&&this.diff_cleanupMerge(e)},f.prototype.diff_xIndex=function(e,t){for(var s=0,r=0,i=0,n=0,o=0;o<e.length&&(1!==e[o][0]&&(s+=e[o][1].length),-1!==e[o][0]&&(r+=e[o][1].length),!(t<s));o++)i=s,n=r;return e.length!=o&&-1===e[o][0]?n:n+(t-i)},f.prototype.diff_prettyHtml=function(e){for(var t=[],s=/&/g,r=/</g,i=/>/g,n=/\n/g,o=0;o<e.length;o++){var a=e[o][0],l=e[o][1].replace(s,"&amp;").replace(r,"&lt;").replace(i,"&gt;").replace(n,"&para;<br>");switch(a){case 1:t[o]='<ins style="background:#e6ffe6;">'+l+"</ins>";break;case-1:t[o]='<del style="background:#ffe6e6;">'+l+"</del>";break;case 0:t[o]="<span>"+l+"</span>"}}return t.join("")},f.prototype.diff_prettyCompactHtml=function(e){for(var t=[],s=0;s<e.length;s++){var r=0===s,i=s===e.length-1,n=e[s][0],o=e[s][1];switch(n){case 1:t[s]='<ins style="background:#e6ffe6;">'+this.prepare_text_(o)+"</ins>";break;case-1:t[s]='<del style="background:#ffe6e6;">'+this.prepare_text_(o)+"</del>";break;case 0:t[s]="<span>"+this.truncate_context_(o,r,i)+"</span>"}}return t.join("")},f.prototype.prepare_text_=function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"&para;<br>")},f.prototype.truncate_context_=function(e,t,s){var r=e.split(/\r\n|\r|\n/),i='<span class="dots">...</span>',n=r.length;return n<=4||!t&&!s&&n<=8?this.prepare_text_(e):t?i+this.prepare_text_("\n"+r.slice(-4).join("\n")):s?this.prepare_text_(r.slice(0,4).join("\n")+"\n")+i:this.prepare_text_(r.slice(0,4).join("\n")+"\n")+i+this.prepare_text_("\n"+r.slice(-4).join("\n"))},f.prototype.diff_text1=function(e){for(var t=[],s=0;s<e.length;s++)1!==e[s][0]&&(t[s]=e[s][1]);return t.join("")},f.prototype.diff_text2=function(e){for(var t=[],s=0;s<e.length;s++)-1!==e[s][0]&&(t[s]=e[s][1]);return t.join("")},f.prototype.diff_levenshtein=function(e){for(var t=0,s=0,r=0,i=0;i<e.length;i++){var n=e[i][0],o=e[i][1];switch(n){case 1:s+=o.length;break;case-1:r+=o.length;break;case 0:t+=Math.max(s,r),r=s=0}}return t+=Math.max(s,r)},f.prototype.diff_toDelta=function(e){for(var t=[],s=0;s<e.length;s++)switch(e[s][0]){case 1:t[s]="+"+encodeURI(e[s][1]);break;case-1:t[s]="-"+e[s][1].length;break;case 0:t[s]="="+e[s][1].length}return t.join("\t").replace(/%20/g," ")},f.prototype.diff_fromDelta=function(e,t){for(var s=[],r=0,i=0,n=t.split(/\t/g),o=0;o<n.length;o++){var a=n[o].substring(1);switch(n[o].charAt(0)){case"+":try{s[r++]=[1,decodeURI(a)]}catch(e){throw new Error("Illegal escape in diff_fromDelta: "+a)}break;case"-":case"=":var l=parseInt(a,10);if(isNaN(l)||l<0)throw new Error("Invalid number in diff_fromDelta: "+a);l=e.substring(i,i+=l);"="==n[o].charAt(0)?s[r++]=[0,l]:s[r++]=[-1,l];break;default:if(n[o])throw new Error("Invalid diff operation in diff_fromDelta: "+n[o])}}if(i!=e.length)throw new Error("Delta length ("+i+") does not equal source text length ("+e.length+").");return s},f.prototype.match_main=function(e,t,s){if(null==e||null==t||null==s)throw new Error("Null input. (match_main)");return s=Math.max(0,Math.min(s,e.length)),e==t?0:e.length?e.substring(s,s+t.length)==t?s:this.match_bitap_(e,t,s):-1},f.prototype.match_bitap_=function(e,s,r){if(s.length>this.Match_MaxBits)throw new Error("Pattern too long for this browser.");var t=this.match_alphabet_(s),i=this;function n(e,t){e/=s.length,t=Math.abs(r-t);return i.Match_Distance?e+t/i.Match_Distance:t?1:e}for(var o,a,l,c=this.Match_Threshold,u=(-1!=(p=e.indexOf(s,r))&&(c=Math.min(n(0,p),c),-1!=(p=e.lastIndexOf(s,r+s.length)))&&(c=Math.min(n(0,p),c)),1<<s.length-1),p=-1,d=s.length+e.length,h=0;h<s.length;h++){for(o=0,a=d;o<a;)n(h,r+a)<=c?o=a:d=a,a=Math.floor((d-o)/2+o);var d=a,g=Math.max(1,r-a+1),f=Math.min(r+a,e.length)+s.length,m=Array(f+2);m[f+1]=(1<<h)-1;for(var _=f;g<=_;_--){var v=t[e.charAt(_-1)];if(m[_]=0===h?(m[_+1]<<1|1)&v:(m[_+1]<<1|1)&v|(l[_+1]|l[_])<<1|1|l[_+1],m[_]&u){v=n(h,_-1);if(v<=c){if(c=v,!(r<(p=_-1)))break;g=Math.max(1,2*r-p)}}}if(n(h+1,r)>c)break;l=m}return p},f.prototype.match_alphabet_=function(e){for(var t={},s=0;s<e.length;s++)t[e.charAt(s)]=0;for(s=0;s<e.length;s++)t[e.charAt(s)]|=1<<e.length-s-1;return t},f.prototype.patch_addContext_=function(e,t){if(0!=t.length){for(var s=t.substring(e.start2,e.start2+e.length1),r=0;t.indexOf(s)!=t.lastIndexOf(s)&&s.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;)r+=this.Patch_Margin,s=t.substring(e.start2-r,e.start2+e.length1+r);r+=this.Patch_Margin;var i=t.substring(e.start2-r,e.start2),n=(i&&e.diffs.unshift([0,i]),t.substring(e.start2+e.length1,e.start2+e.length1+r));n&&e.diffs.push([0,n]),e.start1-=i.length,e.start2-=i.length,e.length1+=i.length+n.length,e.length2+=i.length+n.length}},f.prototype.patch_make=function(e,t,s){var r,i;if("string"==typeof e&&"string"==typeof t&&void 0===s)2<(i=this.diff_main(r=e,t,!0)).length&&(this.diff_cleanupSemantic(i),this.diff_cleanupEfficiency(i));else if(e&&"object"==typeof e&&void 0===t&&void 0===s)r=this.diff_text1(i=e);else if("string"==typeof e&&t&&"object"==typeof t&&void 0===s)r=e,i=t;else{if("string"!=typeof e||"string"!=typeof t||!s||"object"!=typeof s)throw new Error("Unknown call format to patch_make.");r=e,i=s}if(0===i.length)return[];for(var n=[],o=new f.patch_obj,a=0,l=0,c=0,u=r,p=r,d=0;d<i.length;d++){var h=i[d][0],g=i[d][1];switch(a||0===h||(o.start1=l,o.start2=c),h){case 1:o.diffs[a++]=i[d],o.length2+=g.length,p=p.substring(0,c)+g+p.substring(c);break;case-1:o.length1+=g.length,o.diffs[a++]=i[d],p=p.substring(0,c)+p.substring(c+g.length);break;case 0:g.length<=2*this.Patch_Margin&&a&&i.length!=d+1?(o.diffs[a++]=i[d],o.length1+=g.length,o.length2+=g.length):g.length>=2*this.Patch_Margin&&a&&(this.patch_addContext_(o,u),n.push(o),o=new f.patch_obj,a=0,u=p,l=c)}1!==h&&(l+=g.length),-1!==h&&(c+=g.length)}return a&&(this.patch_addContext_(o,u),n.push(o)),n},f.prototype.patch_deepCopy=function(e){for(var t=[],s=0;s<e.length;s++){var r=e[s],i=new f.patch_obj;i.diffs=[];for(var n=0;n<r.diffs.length;n++)i.diffs[n]=r.diffs[n].slice();i.start1=r.start1,i.start2=r.start2,i.length1=r.length1,i.length2=r.length2,t[s]=i}return t},f.prototype.patch_apply=function(e,t){if(0==e.length)return[t,[]];e=this.patch_deepCopy(e);for(var s=this.patch_addPadding(e),r=(t=s+t+s,this.patch_splitMax(e),0),i=[],n=0;n<e.length;n++){var o,a=e[n].start2+r,l=this.diff_text1(e[n].diffs),c=-1;if(l.length>this.Match_MaxBits?-1!=(o=this.match_main(t,l.substring(0,this.Match_MaxBits),a))&&(-1==(c=this.match_main(t,l.substring(l.length-this.Match_MaxBits),a+l.length-this.Match_MaxBits))||c<=o)&&(o=-1):o=this.match_main(t,l,a),-1==o)i[n]=!1,r-=e[n].length2-e[n].length1;else if(i[n]=!0,r=o-a,l==(a=-1==c?t.substring(o,o+l.length):t.substring(o,c+this.Match_MaxBits)))t=t.substring(0,o)+this.diff_text2(e[n].diffs)+t.substring(o+l.length);else{var u=this.diff_main(l,a,!1);if(l.length>this.Match_MaxBits&&this.diff_levenshtein(u)/l.length>this.Patch_DeleteThreshold)i[n]=!1;else{this.diff_cleanupSemanticLossless(u);for(var p,d=0,h=0;h<e[n].diffs.length;h++){var g=e[n].diffs[h];0!==g[0]&&(p=this.diff_xIndex(u,d)),1===g[0]?t=t.substring(0,o+p)+g[1]+t.substring(o+p):-1===g[0]&&(t=t.substring(0,o+p)+t.substring(o+this.diff_xIndex(u,d+g[1].length))),-1!==g[0]&&(d+=g[1].length)}}}}return[t=t.substring(s.length,t.length-s.length),i]},f.prototype.patch_addPadding=function(e){for(var t=this.Patch_Margin,s="",r=1;r<=t;r++)s+=String.fromCharCode(r);for(r=0;r<e.length;r++)e[r].start1+=t,e[r].start2+=t;var i,n=e[0],o=n.diffs;return 0==o.length||0!=o[0][0]?(o.unshift([0,s]),n.start1-=t,n.start2-=t,n.length1+=t,n.length2+=t):t>o[0][1].length&&(i=t-o[0][1].length,o[0][1]=s.substring(o[0][1].length)+o[0][1],n.start1-=i,n.start2-=i,n.length1+=i,n.length2+=i),0==(o=(n=e[e.length-1]).diffs).length||0!=o[o.length-1][0]?(o.push([0,s]),n.length1+=t,n.length2+=t):t>o[o.length-1][1].length&&(i=t-o[o.length-1][1].length,o[o.length-1][1]+=s.substring(0,i),n.length1+=i,n.length2+=i),s},f.prototype.patch_splitMax=function(e){for(var t=this.Match_MaxBits,s=0;s<e.length;s++)if(!(e[s].length1<=t))for(var r=e[s],i=(e.splice(s--,1),r.start1),n=r.start2,o="";0!==r.diffs.length;){var a=new f.patch_obj,l=!0;for(a.start1=i-o.length,a.start2=n-o.length,""!==o&&(a.length1=a.length2=o.length,a.diffs.push([0,o]));0!==r.diffs.length&&a.length1<t-this.Patch_Margin;){var c=r.diffs[0][0],u=r.diffs[0][1];1===c?(a.length2+=u.length,n+=u.length,a.diffs.push(r.diffs.shift()),l=!1):-1===c&&1==a.diffs.length&&0==a.diffs[0][0]&&u.length>2*t?(a.length1+=u.length,i+=u.length,l=!1,a.diffs.push([c,u]),r.diffs.shift()):(u=u.substring(0,t-a.length1-this.Patch_Margin),a.length1+=u.length,i+=u.length,0===c?(a.length2+=u.length,n+=u.length):l=!1,a.diffs.push([c,u]),u==r.diffs[0][1]?r.diffs.shift():r.diffs[0][1]=r.diffs[0][1].substring(u.length))}var o=(o=this.diff_text2(a.diffs)).substring(o.length-this.Patch_Margin),p=this.diff_text1(r.diffs).substring(0,this.Patch_Margin);""!==p&&(a.length1+=p.length,a.length2+=p.length,0!==a.diffs.length&&0===a.diffs[a.diffs.length-1][0]?a.diffs[a.diffs.length-1][1]+=p:a.diffs.push([0,p])),l||e.splice(++s,0,a)}},f.prototype.patch_toText=function(e){for(var t=[],s=0;s<e.length;s++)t[s]=e[s];return t.join("")},f.prototype.patch_fromText=function(e){var t=[];if(e)for(var s=e.split("\n"),r=0,i=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;r<s.length;){var n=s[r].match(i);if(!n)throw new Error("Invalid patch string: "+s[r]);var o=new f.patch_obj;for(t.push(o),o.start1=parseInt(n[1],10),""===n[2]?(o.start1--,o.length1=1):"0"==n[2]?o.length1=0:(o.start1--,o.length1=parseInt(n[2],10)),o.start2=parseInt(n[3],10),""===n[4]?(o.start2--,o.length2=1):"0"==n[4]?o.length2=0:(o.start2--,o.length2=parseInt(n[4],10)),r++;r<s.length;){var a=s[r].charAt(0);try{var l=decodeURI(s[r].substring(1))}catch(e){throw new Error("Illegal escape in patch_fromText: "+l)}if("-"==a)o.diffs.push([-1,l]);else if("+"==a)o.diffs.push([1,l]);else if(" "==a)o.diffs.push([0,l]);else{if("@"==a)break;if(""!==a)throw new Error('Invalid patch mode "'+a+'" in: '+l)}r++}}return t},(f.patch_obj=function(){this.diffs=[],this.start1=null,this.start2=null,this.length1=0,this.length2=0}).prototype.toString=function(){for(var e,t=0===this.length1?this.start1+",0":1==this.length1?this.start1+1:this.start1+1+","+this.length1,s=0===this.length2?this.start2+",0":1==this.length2?this.start2+1:this.start2+1+","+this.length2,r=["@@ -"+t+" +"+s+" @@\n"],i=0;i<this.diffs.length;i++){switch(this.diffs[i][0]){case 1:e="+";break;case-1:e="-";break;case 0:e=" "}r[i+1]=e+encodeURI(this.diffs[i][1])+"\n"}return r.join("").replace(/%20/g," ")},t.exports=f},{}],52:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.Runner=void 0;const o=logger.create("electronRunner")["debug"],i=e("path"),n=e("child_process"),a=e("./runWorkerPool"),l=e("./browserEnvironment"),r=e("./utils");var c=0;s.Runner=class{constructor(e){var r=this;this._project=e,this.screenShotReady=Promise.resolve(),this._params=e.settings().env.params,this._runner=e.settings().env.runner,this._envOptions=e.settings().env.options,this._clearMemoryCache=e.settings().env.clearMemoryCache,this._host=void 0,this._callbacks=Object.create(null),this._hostPromise=new Promise(function(t,s){try{var e=_.extend({},process.env,r._params.env?_.reduce(r._params.env.split(";"),function(e,t){t=t.split("=");return e[t[0]]=t[1],e},{}):{});delete e.ATOM_SHELL_INTERNAL_RUN_AS_NODE,delete e.ELECTRON_RUN_AS_NODE,e.ELECTRON_DISABLE_SECURITY_WARNINGS="true",r._host=n.fork(i.join(__dirname,"runners","browser","electronHost.js"),[],{execPath:r._runner,env:e,execArgv:r._params.runner?r._params.runner.split(" "):[]}),r._host.on("error",function(e){r._handleHostError(e)}),r._host.on("message",function(e){try{e.id?r._responseWithCorrelationId(e):"ready"===e.type?t(r._host):"error"===e.type&&r._handleHostError(e.error)}catch(e){r._handleHostError(e)}})}catch(e){s(e)}}).catch(function(e){r._handleHostError(e)}),this._workerPool=new a.WorkerPool(this._project,{create:_.bind(r._create,this),recycle:_.bind(r._recycle,this),healthy:()=>!0,prepare:_.bind(r._prepare,this)}),this._browserEnvironment=new l.BrowserEnvironment(e,this._workerPool)}run(e){return this._workerPool.run(e)}_handleHostError(e){this._project._cleanStack(e=e||{});var t="Electron runner error: "+(e.message||"unknown"),e=e.stack||t;emitDiagnostic({name:"genericError",message:e}),this._project.emitTestRunError({text:t,header:"Electron Runner"})}_create(e,t){this._hostPromise.then(function(){t({pageId:e})})}_recycle(e){this._host&&this._host.send({type:"closePage",pageId:e.pageId})}_evaluateOnPage(e,t,s){e={type:"evaluateOnPage",pageId:e,action:"("+t.toString()+")()"};this._requestWithCorrelationId(e,s||_.noop)}_openPage(e,t,s,r){this._requestWithCorrelationId({type:"openPage",pageId:e,url:t,options:s},r||_.noop)}_closePage(e){this._host.send({type:"closePage",pageId:e})}_capturePage(e,t){var s=Q.defer();try{this._requestWithCorrelationId({type:"capturePage",file:t,pageId:e},function(){s.resolve()}),this.screenShotReady=s.promise}catch(e){s.reject(new Error("Failed to render test run screen shot")),emitDiagnostic({name:"genericError",message:r.default.formatWithoutColors(["Failed to render test run screen shot",e.message])})}}_prepare(t,s){var r=this,i=_.randomId(),n=r._browserEnvironment.sandboxName(s,i);return o("Starting sandbox [%s]",n),r._workerPool.getWorker(s).then(function(e){return r._workerPool.cancelled()?Promise.reject({runCancelled:!0}):e instanceof Error||e.runCancelled?Promise.reject(e):(o("Preparing sandbox [%s]",n),r._browserEnvironment.prepareSandbox(t,i,s))}).then(function(e){return r._workerPool.cancelled()?Promise.reject({runCancelled:!0}):(o("Prepared sandbox [%s]",n),Promise.resolve({instance:{resume:function(){r._evaluateOnPage(s,function(){$_$tracer.resume()})},ping:function(e){r._evaluateOnPage(s,function(){},e)},close:function(e){r._closePage(s),e(!0)},closing:function(){r.screenShotReady=Promise.resolve()},start:function(t){r._openPage(s,e,r._envOptions,function(e){t(e.status)&&r._evaluateOnPage(s,function(){$_$tracer.start()})})}},name:n,sessionId:i,workerId:s}))})}cancel(e){return this._workerPool.cancel(e)}start(){var e=this;return e._workerPool.start(e._browserEnvironment.webApp()).then(function(){return e._workerPool.setFileRoot(e._browserEnvironment.sandboxRootUrl()),Promise.resolve()})}stop(){var e=this;e._host&&(e._host.send({type:"stop"}),e._host.disconnect(),delete e._callbacks,delete e._host),e._workerPool.stop()}_requestWithCorrelationId(e,t){var s=this,r=++c,t=s._callbacks[r]={done:t};e.id=r,s._host.send(e),t.timeout=setTimeout(function(){delete s._callbacks[r]},12e5)}_responseWithCorrelationId(e){var t=this._callbacks[e.id];delete this._callbacks[e.id],t&&(clearTimeout(t.timeout),t.done(e))}}},{"./browserEnvironment":12,"./runWorkerPool":77,"./utils":88,child_process:void 0,path:void 0}],53:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.ErrorTraceMapper=void 0;class r{constructor(e){this._stack=[],this._stackEntriesByFileByLine=new Map,this._currentStackEntryIndex=0,this._processStack(e),this._firstStackEntry=this._stack[0],this._currentStackEntry=this._firstStackEntry,this._error=e}fileLineRange(e,t,s){null!=(e=null==(e=this._stackEntriesByFileByLine.get(e))?void 0:e.get(t))&&e.forEach(e=>{e.rangeIds.add(s)})}traceFrame(e,t,s){var r=this._currentStackEntry;r.fileId===e&&r.rangeIds.has(t)?this._moveToNextStackEntry(s):0<this._currentStackEntryIndex&&this._firstStackEntry.fileId===e&&this._firstStackEntry.rangeIds.has(t)&&(this._resetStackMappingState(),this._moveToNextStackEntry(s))}_moveToNextStackEntry(e){var t=this._currentStackEntryIndex;t===this._stack.length-1?(this._error.traceFrame=e,this._resetStackMappingState()):(this._currentStackEntryIndex=t+1,this._currentStackEntry=this._stack[this._currentStackEntryIndex])}_resetStackMappingState(){this._currentStackEntryIndex=0,this._currentStackEntry=this._firstStackEntry}fileIds(){return this._stack.length?[...new Set(this._stack.map(e=>e.fileId))]:void 0}_processStack(e){if(e.stack){var s=[];for(const o of e.stack.slice().reverse())if(!o.notMappedFile){var r=o[0],i=o[1],n={fileId:r,line:i,rangeIds:new Set};s.push(n);let e=this._stackEntriesByFileByLine.get(r),t=(e||(e=new Map,this._stackEntriesByFileByLine.set(r,e)),e.get(i));t||(t=[],e.set(i,t)),t.push(n)}s.length&&(this._stack=s)}}}s.ErrorTraceMapper=class{constructor(){this._errorsByFile=new Map}error(e){var t=new r(e),e=t.fileIds();if(e)for(const s of e){let e=this._errorsByFile.get(s);e||(e=[],this._errorsByFile.set(s,e)),e.push(t)}}fileLineRange(e,t,s){var r=this._errorsByFile.get(e);if(r)for(const i of r)i.fileLineRange(e,t,s)}traceFrame(e,t,s){var r=this._errorsByFile.get(e);if(r)for(const i of r)i.traceFrame(e,t,s)}}},{}],54:[function(e,t,d){"use strict";Object.defineProperty(d,"__esModule",{value:!0}),d.looksLikeEmail=void 0;const y=e("path"),b=e("os"),w=e("fs"),k=(d.looksLikeEmail=/^[a-zA-Z0-9_+&*-]+(?:\.[a-zA-Z0-9_+&*-]+)*@(?:[a-zA-Z0-9-]+\.)+[a-zA-Z]{2,63}$/,["January","February","March","April","May","June","July","August","September","October","November","December"]),i="wallabyjs@gmail.com";d.default={wallabyEmail:function(){return i},normalizePath:function(e){return"win32"===process.platform&&e?e.replace(/\\/g,"/"):e},parseKey:function(e){var t={},s=(e&&2===(s=e.split(":")).length&&(e=(s=s[1])&&s.replace(/^\s+|\s+$/gm,"")),Buffer.from(e,"base64").toString().split("\n")),e=(t.licenseeName=s[0],t.licenseTags=s[1],t.licenseTags.split(",")||[]);t.licenseeEmail=e[0],t.licensedProduct=e[1],t.multiUserKey=e[2],t.source=e[3],t.trial="1"===e[5],t.expirationDateString=s[2],t.licenseSignature=s[3],t.freeLicense=t.licenseeEmail===i;try{var r=t.expirationDateString.split("/");t.expirationDateStringFormatted=r[0]+" "+k[parseInt(r[1],10)-1]+" "+r[2]}catch(e){t.expirationDateStringFormatted=t.expirationDateString}return t.expirationTime=e[7]&&parseInt(e[7],10)||new Date(t.expirationDateString+" UTC").getTime(),t},format:function(r,i){return r.replace(/\{([0-9a-zA-Z_]+)\}/g,function(e,t,s){return"{"===r[s-1]&&"}"===r[s+e.length]?t:null==(s=i.hasOwnProperty(t)?i[t]:null)?"":s})},validPackageName:function(e){if(e&&!e.match(/^\./)&&!e.match(/^_/)&&!(214<e.length||e.toLowerCase()!==e||/[~'!()*]/.test(e.split("/").slice(-1)[0]))){if(encodeURIComponent(e)===e)return e;var t=e.match(/^(?:@([^/]+?)[/])?([^/]+?)$/);if(t){var s=t[1],t=t[2];if(encodeURIComponent(s)===s&&encodeURIComponent(t)===t)return e}}},withFreePort:function(t){var s=e("http").createServer();s.listen(0),s.on("listening",function(){var e=s.address().port;s.once("close",function(){t(e)}),s.close()}),process.nextTick(function(){})},checkPort:function(r){const i=e("net");return new Promise(e=>{const t=new i.Socket,s=setTimeout(()=>{e(0);try{t.destroy()}catch(e){}},500);t.once("connect",()=>{clearTimeout(s),e(0),t.end()}).once("error",()=>{clearTimeout(s),e(r)}).connect(r,"0.0.0.0")})},getLicenseDetails:function(){var e=y.join(b.homedir(),".wallaby"),t=y.join(e,"key.lic"),e=y.join(e,".ol"),s={state:"demoLicense",productType:"",registeredTo:"",expiryDate:"",email:"",daysUntilExpiry:"",isBundle:!1,upgradeUrl:"https://wallabyjs.com/purchase/?referrer=wsp#select-wallaby",purchaseUrl:"https://wallabyjs.com/purchase/?referrer=wsp#select-wallaby",renewUrl:"https://wallabyjs.com/purchase/?referrer=wsp#select-wallaby"};try{var r=JSON.parse(Buffer.from(w.readFileSync(e).toString(),"base64").toString());s.email=r.wallabyEmail||"",s.registeredTo=s.email,s.onlineLicense=!!r.wallabyEmail,s.onlineLicense&&s.registeredTo&&(s.state="activating")}catch(e){}try{var i=w.readFileSync(t).toString().split(":").reduce((e,t)=>t.trim());if(i.length<50){if(!s.onlineLicense)try{parseInt(i,10)+1314e6<+new Date&&(s.state="trialDemoOver")}catch(e){s.state="trialDemoOver"}}else{var n,o,a,l=Buffer.from(i,"base64").toString().split("\n"),[c,u,,,p,d]=l[1].split(","),h=(s.registeredTo=l[0],s.email=s.email||c,s.isBundle=!!~u.indexOf("Quokka.js"),!!~u.toLowerCase().indexOf("company")||!!~u.toLowerCase().indexOf("enterprise")),g=!!~u.indexOf("Open Source"),f="wallabyjs@gmail.com"===c||"1"===d,[m,_,v]=(s.productType=s.isBundle?"Wallaby.js + Quokka.js":"Wallaby.js",l[2].split("/"));s.expiryDate=m+" "+k[parseInt(_,10)-1]+", "+v;let e=!1;g?s.state="openSource":(n=new Date(Date.UTC(parseInt(v,10),parseInt(_,10)-1,parseInt(m,10))),o=new Date,a=Math.floor((n.getTime()-o.getTime())/864e5),s.daysUntilExpiry=a+" day"+(1===a?"":"s"),a<0?f?s.state="trialDemoOver":(s.state="expired",s.key=i,e=!0):a<=14?f?s.state="trialLicense":(s.state="expiring",s.key=i,e=!0):f?s.state="trialLicense":(s.state="activated",s.key=i,e=!0)),e&&!h&&(h?(s.purchaseUrl="https://wallabyjs.com/store/company/?referrer=wsp#select-wallaby",p?(s.upgradeUrl=`https://wallabyjs.com/store/personal/?renewalOrder=${p}&upgrade=1&referrer=wsp`,s.renewUrl=`https://wallabyjs.com/store/personal/?renewalOrder=${p}&referrer=wsp`):(s.upgradeUrl="https://wallabyjs.com/store/company/?referrer=wsp#select-wallaby",s.renewUrl="https://wallabyjs.com/store/company/?referrer=wsp#select-wallaby")):(s.upgradeUrl=`https://wallabyjs.com/store/personal/?renewalEmail=${encodeURIComponent(c)}&upgrade=1&referrer=wsp`,s.renewUrl=`https://wallabyjs.com/store/personal/?renewalEmail=${encodeURIComponent(c)}&referrer=wsp`))}}catch(e){}return s},saveLicenseDetails:function(t){var e=y.join(b.homedir(),".wallaby"),s=y.join(e,"key.lic"),e=y.join(e,".ol");let r;try{r=JSON.parse(Buffer.from(w.readFileSync(e).toString(),"base64").toString())}catch(e){r={}}let i="";try{i=w.readFileSync(s).toString()}catch(e){}if(d.looksLikeEmail.test(t)){try{r.wallabyEmail=t.trim(),r.lastUpdate=(new Date).getTime(),w.writeFileSync(e,Buffer.from(JSON.stringify(r)).toString("base64"))}catch(e){}return"emailLooksOk"}try{w.unlinkSync(e)}catch(e){}var e=e=>{try{var t=this.parseKey(e);if(t.licenseeName&&t.expirationDateString&&(~t.licensedProduct.indexOf("(Freedom)")||~t.licensedProduct.indexOf("(VS Code)")))return{licensee:t.licenseeName,freeLicense:t.freeLicense,isBundle:0===t.licensedProduct.indexOf("Wallaby.js + Quokka.js"),expiration:t.expirationDateStringFormatted||t.expirationDateString}}catch(e){}},t=t||"",n=!!e(i),e=e(t),o=!!e;let a=!1;if(!(o||!t&&n))return"keyDoesNotLookOk";try{w.writeFileSync(s,t);try{if(e.isBundle){var l=y.join(b.homedir(),".quokka"),c=y.join(l,".qlc"),u=(w.existsSync(l)||w.mkdirSync(l),w.writeFileSync(c,t),y.join(l,"config.json"));let e={};try{var p=w.readFileSync(u).toString();e=JSON.parse(p)}catch(e){}e.pro=!0,w.writeFileSync(u,JSON.stringify(e))}}catch(e){}a=o}catch(e){a=!1}return a?"keyLooksOk":"keyDoesNotLookOk"}}},{fs:void 0,http:void 0,net:void 0,os:void 0,path:void 0}],55:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.fileCacheMiddleware=void 0;const p=e("path"),r=e("parseurl"),i=e("mime"),n=e("graceful-fs"),o=new Map,d=(e,t,s)=>{e.set({"Cache-Control":"public, max-age=86400",Expires:new Date(Date.now()+864e5).toUTCString()}),e.type(i.lookup(s,"text/plain")),e.status(200).end(t)};s.fileCacheMiddleware={create:(t,c)=>{const u=logger.create("middleware")["trace"],s=t.main.cache||o;return t.main.read=t.main.read||n.readFile,t.alt&&(t.alt.cache||(t.alt.cache={get:()=>{},set:()=>{},del:()=>{}}),t.alt.read=t.alt.read||n.readFile),(e,i)=>{let n=decodeURI(r(e).pathname),o=("/"===n&&(n=""),t.main.root),a=(u("Preparing to serve %s",n||o),p.normalize(p.join(o,n)));e=s.get(a);if(_.isString(e)||e instanceof Buffer)u("Serving %s from cache",n||o),d(i,e,a);else{const l=(e,t,s,r)=>{s?e?(o=e.root,u("Serving %s from disk (alt. location)",n||o),a=p.normalize(p.join(o,n)),e.read(a,l.bind(null,void 0,e.cache))):(u("Error when reading file %s, %s",a,s&&s.message||"unknown"),c&&emitDiagnostic({name:"genericError",message:"Trying to access missing resource or API: "+n}),i.status(404).end()):(t.set(a,r),d(i,r,a))};u("Serving %s from disk",n||o),t.main.read(a,l.bind(null,t.alt,s))}}}}},{"graceful-fs":void 0,mime:void 0,parseurl:void 0,path:void 0}],56:[function(e,t,s){global._=e("lodash"),global.Q=e("q"),global.EventEmitter=e("events").EventEmitter,Q.longStackSupport=!1,global.Promise||(global.Promise=Q.Promise),_.extend(_,e("./utils").default),_.str=e("underscore.string"),_.mixin(_.str.exports()),global.logger=global.logger||e("./logger"),_["_"+["tyii","dwe1","md"].join("")]=["tyi","idw","e1m","d"].join("")},{"./logger":58,"./utils":88,events:void 0,lodash:void 0,q:void 0,"underscore.string":void 0}],57:[function(t,e,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var r=t("acorn");const i=["AssignmentExpression","AssignmentPattern","ArrayExpression","ArrayPattern","ArrowFunctionExpression","AwaitExpression","BlockStatement","BinaryExpression","BreakStatement","CallExpression","CatchClause","ClassBody","ClassDeclaration","ClassExpression","ComprehensionBlock","ComprehensionExpression","ConditionalExpression","ContinueStatement","DoWhileStatement","DebuggerStatement","EmptyStatement","ExportBatchSpecifier","ExportDeclaration","ExportSpecifier","ExportNamedDeclaration","ExportDefaultDeclaration","ExportAllDeclaration","ExpressionStatement","FieldDefinition","ForOfStatement","ForStatement","ForInStatement","FunctionDeclaration","FunctionExpression","GeneratorExpression","Identifier","IfStatement","ImportBatchSpecifier","ImportDeclaration","ImportSpecifier","Literal","LabeledStatement","LogicalExpression","MemberExpression","MethodDefinition","ModuleDeclaration","NewExpression","ObjectExpression","ObjectPattern","Program","Property","ReturnStatement","SequenceExpression","SpreadElement","SwitchStatement","SwitchCase","Super","TaggedTemplateExpression","TemplateElement","TemplateLiteral","ThisExpression","ThrowStatement","TryStatement","UnaryExpression","UpdateExpression","VariableDeclaration","VariableDeclarator","WhileStatement","WithStatement","YieldExpression","JSXIdentifier","JSXNamespacedName","JSXMemberExpression","JSXElement","JSXOpeningElement","JSXClosingElement","JSXEmptyExpression","JSXExpressionContainer","JSXSpreadAttribute","JSXAttribute"],a=r.Parser.extend(t("./acornTolerancePlugin"),t("./acornTopLevelAwaitPlugin"),t("./acornLogicalAssignment"),t("./acornImportMetaPlugin"),t("./acornImportAttributesAssertionsPlugin"),t("./acornNumericSeparatorPlugin.js"),t("acorn-jsx")());var l=t("escodegen-wallaby"),c="Babel.objectSpread";function n(e){var t;return 0===e.indexOf("__REGEXP ")?(t=e.split("__REGEXP ")[1].match(/\/(.*)\/(.*)?/),new RegExp(t[1],t[2]||"")):e}class o{constructor(e){var a=this;if(this._autoLogHints={},this._loggedRanges={},this._liveCommentLines={},this._ignoreCoverageHints=[],this._testNames=[],this._ignoreCoverageHints.lastHintPosition=-1,this._ignoreFileCoverage=!1,this._captureConsoleLog=e.captureConsoleLog,this._logMarkers=e.recordValues?e.logMarkers:void 0,this._extractedComments=e.extractedComments,this._outstandingLogpointCount=0,this._extractedComments&&this._extractedComments.isCoverageIgnored&&(this._ignoreFileCoverage=!0),e.hints&&(this._extractedComments||this._ignoreFileCoverage||(e.hints.ignoreCoverage&&(this._ignoreCoverageRegExp=n(e.hints.ignoreCoverage)),e.hints.ignoreCoverageForFile&&(this._ignoreFileCoverageRegExp=n(e.hints.ignoreCoverageForFile))),e.recordValues&&e.hints.commentAutoLog&&(_.isString(e.hints.commentAutoLog)?this._autoLogHintExpPrefix=e.hints.commentAutoLog:(this._autoLogHintExpPrefix=e.hints.commentAutoLog.value,this._autoLogHintGlobalExp=e.hints.commentAutoLog.exp)),e.hints.logpointsNotAvailableExpression&&(this._logpointsNotAvailableExpression=e.hints.logpointsNotAvailableExpression),e.hints.testFileSelection)&&(e.hints.testFileSelection.include&&(this._includeTestFileRegExp=n(e.hints.testFileSelection.include)),e.hints.testFileSelection.exclude)&&(this._excludeTestFileRegExp=n(e.hints.testFileSelection.exclude)),this._opts=_.defaults(e||{},{}),this._opts.recordValues||(this._wrapExpressionStatementExpressionIntoVisitor=function(e){return e}),this._opts.test){let s=!1,r=this._opts.testFileChangeStart;if(this._logMarkers){let t=!1;for(let e=0;e<this._logMarkers.length;e++){var i=this._logMarkers[e];if(i.new&&i.range){if(this._opts.testFileChangeStart||t){s=!0;break}t=!0,r={line:i.range[0],column:i.range[1]}}}}s?this._containsChangePosition=function(){return!1}:a._containsChangePosition=r&&r.line?function(e){return e&&e.loc.start.line<=r.line&&e.loc.end.line>=r.line&&(r.line>e.loc.start.line||r.column>e.loc.start.column)&&(r.line<e.loc.end.line||r.column<e.loc.end.column)}:function(e){return e&&e.start<a._opts.testFileChangeStart&&e.end>a._opts.testFileChangeStart}}else this._containsChangePosition=function(){return!1};if(a._visitor=this._createVisitor(),a._opts.sequenceExpressionToDiff||(a._replaceSequenceWithDiff=()=>{}),a._opts.automaticTestFileSelection&&a._visitor.CallExpression.add(function(e){e.arguments&&e.arguments[0]&&"Literal"===e.arguments[0].type&&(e.callee&&"Identifier"===e.callee.type&&"fit"===e.callee.name&&2===e.arguments.length&&(a._includedTestFile=!0,a._hasIncludedTest=!0),e.callee&&"Identifier"===e.callee.type&&"fdescribe"===e.callee.name&&2===e.arguments.length||e.callee&&"MemberExpression"===e.callee.type&&e.callee.property&&"Identifier"===e.callee.property.type&&"only"===e.callee.property.name&&(2===e.arguments.length||3===e.arguments.length))&&(a._includedTestFile=!0,a._hasIncludedTest=!0)}),a._opts.recordMatchSnapshotRanges&&(a._matchSnapshotRanges=[],a._visitor.CallExpression.add(function(e){e.callee&&"MemberExpression"===e.callee.type&&e.callee.property&&"Identifier"===e.callee.property.type&&("toMatchSnapshot"===e.callee.property.name||"toThrowErrorMatchingSnapshot"===e.callee.property.name||"snapshot"===e.callee.property.name)&&(e.callee.object=a._sequence([{type:"CallExpression",callee:{type:"MemberExpression",object:{type:"Identifier",name:"$_$tracer"},property:{type:"Identifier",name:"_beforeMatchSnapshot"}},arguments:[a._literal(a._opts.file),a._literal(a._matchSnapshotRanges.length)]},e.callee.object]),a._matchSnapshotRanges.push([e.loc.start.line,e.loc.start.column,e.loc.end.line,e.loc.end.column]))})),null!=(e=a._opts.snaps)&&e.enabled){const o=a._opts.vue,l=a._opts.svelte;a._snaps=[],a._snapScopes=new Map,a._lastSnap=void 0,a._visitor.BlockStatement.add(function(e,r){var i=a._lastSnap;if(!(i&&i.body.end>e.start)&&e.body&&1===e.body.length&&Array.isArray(r.parentNode)){i=e.body[0];if("BlockStatement"===i.type&&i.body){var t=!i.body.length;if(t||1<i.body.length||"BlockStatement"!==i.body[0].type){i=a._lastSnap={empty:t,body:e};if(a._snaps.push(i),o){let e=void 0,t=void 0,s=r.parentContext;for(;s;){var n=s.parentNode;if(!n)break;if(e){if("CallExpression"===n.type&&n.callee&&"Identifier"===n.callee.type&&"_defineComponent"===n.callee.name&&n.arguments&&1<=n.arguments.length&&"ObjectExpression"===n.arguments[0].type){t=n;break}}else"Property"===n.type&&n.method&&"init"===n.kind&&"Identifier"===n.key.type&&"setup"===n.key.name&&"FunctionExpression"===n.value.type&&n.value.params&&"BlockStatement"===n.value.body.type&&1<=n.value.params.length&&"__props"===n.value.params[0].name&&(e=n);s=s.parentContext}t&&e&&(i.scope="vue",a._snapScopes.set(i.scope,{source:e.value.body,call:a._vueSfcSetupFuncCall()}))}if(l){let e=void 0,t=r.parentContext;for(;t;){var s=t.parentNode;if(!s)break;if("FunctionDeclaration"===s.type&&s.id&&"Identifier"===s.id.type&&"instance"===s.id.name&&s.params&&3<=s.params.length&&"Identifier"===s.params[0].type&&"$$self"===s.params[0].name&&"Identifier"===s.params[1].type&&"$$props"===s.params[1].name&&"Identifier"===s.params[2].type&&"$$invalidate"===s.params[2].name){e=s;break}t=t.parentContext}e&&(i.scope="svelte",a._snapScopes.set(i.scope,{source:e.body,call:a._svelteInstanceFuncCall()}))}t=r.parentNode.indexOf(e),r=r.parentNode[t+1];if(r&&"ExpressionStatement"===r.type&&r.expression){e="TemplateLiteral"===r.expression.type,t="Literal"===r.expression.type&&"string"==typeof r.expression.value;if(e||t)if(i.output=r.expression,e&&l){e=r.expression.quasis;if(e&&1===e.length){const e=r.expression.quasis[0];e.loc&&e.loc.start&&e.loc.end?i.outputLines=e.loc.end.line-e.loc.start.line+1:i.outputContent=e.value.raw}}else i.outputContent=t?r.expression.value:void 0}}}}}),a._visitor.ExpressionStatement.add(function(e,t){a._lastSnap&&a._lastSnap.output===e.expression&&(t.hinted=!0)})}if(a._opts.recordFunctions){const r=(e,t,s)=>{var r=null==(r=e.id)?void 0:r.name;if(r)return r;if("constructor"===(null==(r=t.parentNode)?void 0:r.kind))return(r=null==(r=null==(r=null==(r=null==(r=null==(r=t.parentContext)?void 0:r.parentContext)?void 0:r.parentContext)?void 0:r.parentNode)?void 0:r.id)?void 0:r.name)?r+".constructor":"constructor";if("ArrowFunctionExpression"===e.type&&"CallExpression"===(null==(e=null==(r=t.parentContext)?void 0:r.parentNode)?void 0:e.type)&&"Identifier"===(null==(e=null==(r=t.parentContext.parentNode.callee)?void 0:r.property)?void 0:e.type))return(r=t.parentContext.parentNode.callee.property.name)?`.${r} argument`:s;return(null==(r=(null==(e=t.parentNode)?void 0:e.id)||(null==(r=t.parentNode)?void 0:r.key)||(null==(e=t.parentNode)?void 0:e.left))?void 0:r.name)||s};let s=0;a._rangeFunctions=[],a._visitor.FunctionDeclaration.add(function(e,t){t.func={id:s++,name:r(e,t,"anonymous")}}),a._visitor.FunctionExpression.add(function(e,t){t.func={id:s++,name:r(e,t,"anonymous")}}),a._visitor.ArrowFunctionExpression.add(function(e,t){t.func={id:s++,name:r(e,t,"arrow function")}}),a._visitor.Program.add(function(e,t){t.func={id:s++,name:"program"}}),a._onRangeAdded=function(e){a._rangeFunctions.push(e.func)}}a._visitor.SequenceExpression.add(function(e,t){var s,r;e.expressions&&2===e.expressions.length&&([s,r]=e.expressions,s)&&r&&"Literal"===s.type&&0===s.value&&"MemberExpression"===r.type&&"Identifier"===(null==(s=r.object)?void 0:s.type)&&null!=(s=r.object)&&s.name&&r.object.name.startsWith("import_")&&"Identifier"===(null==(s=r.property)?void 0:s.type)&&"default"===(null==(s=r.property)?void 0:s.name)&&(e.expressions[1]={type:"SequenceExpression",expressions:[a._instruction(r,t),r]})}),a._visitor.IfStatement.add(function(e){e.consequent&&"BlockStatement"!==e.consequent.type&&(e.consequent=a._wrapInBlock([e.consequent])),e.alternate&&"BlockStatement"!==e.alternate.type&&"IfStatement"!==e.alternate.type&&(e.alternate=a._wrapInBlock([e.alternate]))}),a._visitor.add([this._visitor.DoWhileStatement,this._visitor.WhileStatement,this._visitor.IfStatement,this._visitor.ForStatement],function(e,t){e.test&&(e.test=a._instructionValueSequence([a._instruction(e.test,t,"TST"),e.test],t,void 0,1)),e.update&&(t=a._wrapIfMarkedForAutoLog(e.update,t))&&(e.update=t)}),a._visitor.add([this._visitor.ForOfStatement,this._visitor.ForInStatement],function(e,t){e.right&&(e.right=a._instructionValueSequence([a._instruction(e.right,t,"FR"),e.right],t))}),a._visitor.SwitchStatement.add(function(e,t){e.discriminant=a._instructionValueSequence([a._instruction(e.discriminant,t,"SWT"),e.discriminant],t)}),a._visitor.SwitchCase.add(function(e){e.consequent&&0<e.consequent.length&&(1!=e.consequent.length||"BlockStatement"!==e.consequent[0].type)&&(e.consequent=[a._wrapInBlock(e.consequent)])}),a._visitor.add([a._visitor.DoWhileStatement,a._visitor.ForInStatement,a._visitor.ForStatement,a._visitor.ForOfStatement,a._visitor.LabeledStatement,a._visitor.WhileStatement,a._visitor.WithStatement],function(e){e.body&&"BlockStatement"!==e.body.type&&("LabeledStatement"!==e.type||"DoWhileStatement"!==e.body.type&&"ForInStatement"!==e.body.type&&"ForStatement"!==e.body.type&&"WhileStatement"!==e.body.type)&&"ForOfStatement"!==e.body.type&&(e.body=a._wrapInBlock([e.body]))}),a._visitor.add([a._visitor.BreakStatement,a._visitor.ContinueStatement,a._visitor.ThrowStatement],function(e,t){t.parentNode&&("ForStatement"===t.parentNode.type||"ForInStatement"===t.parentNode.type||"ForOfStatement"===t.parentNode.type||"ExportDeclaration"===t.parentNode.type)||(e=[a._instructionStatement(e,t,"S"),e],t.replacement=a._wrapInBlock(e))}),a._visitor.VariableDeclaration.add(function(t,s){if((!s.parentNode||"ForStatement"!==s.parentNode.type&&"ForInStatement"!==s.parentNode.type&&"ForOfStatement"!==s.parentNode.type&&"ExportDeclaration"!==s.parentNode.type&&"ExportNamedDeclaration"!==s.parentNode.type)&&t.declarations&&t.declarations.length&&"VariableDeclarator"===t.declarations[0].type){var e,r=t.declarations[0],i=a._instruction(t,s,"S");a._isUndefinedInstruction(i)||(!r.init||"FunctionExpression"!==r.init.type&&"ArrowFunctionExpression"!==r.init.type&&"ClassExpression"!==r.init.type?r.init?(e=a._getNodesToCheckForAutoLogsInVariableDeclaration(t,r),r.init=a._instructionValueSequence([i,r.init],s,e)):"var"===t.kind?r.init={type:"LogicalExpression",operator:"||",left:i,right:{type:"Identifier",name:r.id.name}}:r.init=i:t.declarations.unshift({type:"VariableDeclarator",id:{type:"Identifier",name:"$_$wvd"+a._ranges.length},init:i}));for(let e=1;e<t.declarations.length;e++){var n,o=t.declarations[e];"VariableDeclarator"===o.type&&o.init&&"FunctionExpression"!==o.init.type&&"ArrowFunctionExpression"!==o.init.type&&"ClassExpression"!==o.init.type&&(n=a._getNodesToCheckForAutoLogsInVariableDeclaration(t,o),n=a._wrapIfMarkedForAutoLog(o.init,s,!1,n))&&(o.init=n)}}}),a._visitor.ExpressionStatement.add(function(e,t){a._replaceConsoleLog(e.expression,t);var s=[],r=e.expression;a._replaceSequenceWithDiff(e)&&s.push(r),e._systemJsRegisterCall||(e.expression&&"YieldExpression"===e.expression.type?((r=a._wrapIfMarkedForAutoLog(e.expression.argument,t,void 0,[e.expression,e]))&&(e.expression.argument=r),e.expression=a._sequence([a._instruction(e,t,"S"),e.expression])):((r=t.hinted?e.expression:a._wrapExpressionStatementExpressionIntoVisitor(e.expression,e))===e.expression&&s.push(e),e.expression=a._instructionValueSequence([a._instruction(e,t,"S"),r],t,s)))}),a._visitor.ReturnStatement.add(function(e,t){a._replaceConsoleLog(e.argument,t),e.argument=e.argument?a._instructionValueSequence([a._instruction(e,t,"R"),e.argument],t,[e],-(e.end-e.start-6)):a._instruction(e,t,"R")}),a._visitor.ConditionalExpression.add(function(e,t){a._replaceConsoleLog(e.consequent,t),e.consequent=a._instructionValueSequence([a._instruction(e.consequent,t,"CDC"),e.consequent],t),a._replaceConsoleLog(e.alternate,t),e.alternate=a._instructionValueSequence([a._instruction(e.alternate,t,"CDA"),e.alternate],t)}),a._visitor.LogicalExpression.add(function(e,t){e.left=a._instructionValueSequence([a._instruction(e.left,t,"LGL"),e.left],t),e.right=a._instructionValueSequence([a._instruction(e.right,t,"LGR"),e.right],t)}),a._visitor.Program.add(function(e,t){_.isEmpty(a._autoLogHints)&&(a._visitor.removeVisitorsAddedForAutoLogHintsOnly(),a._getFunctionParameterLogInstructions=()=>[],a._getNodesToCheckForAutoLogsInVariableDeclaration=()=>[]),e.body=e.body||[];var s=e.body[0],r=1===e.body.length&&a._isSystemJsModule(s),i=a._scopeStartVariableDeclaration("P",[a._delayedLiteral(()=>a._totalRanges)]);a._needsToStayFirst(s)?e.body.splice(0,1,a._firstNode(s),i):r&&r.length?(s._systemJsRegisterCall=!0,e.body.splice(1,0,i,a._instructionStatement(e.body[0],t,"S"))):e.body.unshift(i),e.body.push(a._instructionStatement(e,t,"PE"))}),a._visitor.add([a._visitor.FunctionDeclaration,a._visitor.FunctionExpression,a._visitor.ArrowFunctionExpression],function(e,t){e.id&&e.id.name&&("_getJestObj"!==e.id.name&&"_interopRequireDefault"!==e.id.name||(t.hinted=!0)),a._numberOfFunctions++,a._tryFindTestName(e,t),"ArrowFunctionExpression"===e.type&&e.expression&&(e.body=a._wrapInBlock([a._return(a._instructionValueSequence([a._instruction(e.body,t,"R"),e.body],t))]),e.expression=!1);var s=a._scopeStartVariableDeclaration("F"),r=a._getFunctionParameterLogInstructions(e,t),i=e.body.body[0],n=a._needsToStayFirst(i),o=a._isSuperCall(i);n?(e.body.body.splice(0,1,a._firstNode(i),s),e.body.body.splice(2,0,...r)):o?a._handleSuperCall(e.body.body,t,s,r):e.body.body.unshift(s,...r)}),a._visitor.Super.add(function(e,t){t.hinted=!0,t.parentContext.hinted=!0}),a._visitor.ImportBatchSpecifier.add(function(e){e.type="ImportNamespaceSpecifier",e.id=e.name,delete e.name}),a._visitor.ImportSpecifier.add(function(e){e.default&&(e.type="ImportDefaultSpecifier")}),a._visitor.AssignmentPattern.add(function(e,t){"="===e.operator&&(e.type="AssignmentExpression"),e.right&&(e.right=a._instructionValueSequence([a._instruction(e.right,t,"AR"),e.right],t))}),a._visitor.add([a._visitor.ExportNamedDeclaration,a._visitor.ExportDefaultDeclaration,a._visitor.ExportAllDeclaration,a._visitor.ImportDeclaration],function(){a._esm=!0}),a._visitor.CatchClause.addForAutoLogOnly(function(e,t){var s;e.body&&e.body.body&&e.param&&"Identifier"===e.param.type&&(s=a._getAutoLogHint(e)||a._getAutoLogHint(e.param))&&e.param.name&&e.body.body.unshift({type:"ExpressionStatement",expression:a._generateUndefinedAutoLogNode(e.param,t,s)})}),a._visitor.ObjectPattern.addForAutoLogOnly(function(e,t){e.properties.forEach(e=>{e.ignore=!0})}),a._visitor.Property.addForAutoLogOnly(function(e,t){var s;!e.ignore&&e.value&&"ObjectPattern"!==t.parentNode.type&&!e.method&&(s=[],!e.computed&&e.key&&"Identifier"===e.key.type&&s.push(e.key),t=a._wrapIfMarkedForAutoLog(e.value,t,!1,s))&&(e.shorthand=!1,e.value=t)}),a._visitor.WithStatement.addForAutoLogOnly(function(e,t){e.object&&(t=a._wrapIfMarkedForAutoLog(e.object,t,!1))&&(e.object=t)}),a._visitor.SpreadElement.addForAutoLogOnly(function(e,t){e.argument&&(t=a._wrapIfMarkedForAutoLog(e.argument,t,!1,[e]))&&(e.argument=t)}),["ForInStatement","ForOfStatement"].forEach(e=>{a._visitor[e].addForAutoLogOnly(function(e,t){var s,r;e.body&&"BlockStatement"===e.body.type&&e.left&&("Identifier"===e.left.type?(s=a._getAutoLogHint(e)||a._getAutoLogHint(e.left))&&e.body.body.unshift(a._generateUndefinedAutoLogNode(e.left,t,s,!0)):"VariableDeclaration"===e.left.type&&1===e.left.declarations.length&&(s=a._getAutoLogHint(e)||a._getAutoLogHint(e.left)||a._getAutoLogHint(e.left.declarations[0]))&&("ObjectPattern"===(r=e.left.declarations[0].id).type&&r.properties&&r.properties.length&&r.properties[0].value&&"AssignmentPattern"===r.properties[0].value.type?r.properties[0].value.left&&"Identifier"===r.properties[0].value.left.type&&e.body.body.unshift(a._generateUndefinedAutoLogNode(r.properties[0].value.left,t,s,!0)):e.body.body.unshift(a._generateUndefinedAutoLogNode(r,t,s,!0))))})}),a._visitor.ThrowStatement.addForAutoLogOnly(function(e,t){e.argument&&(t=a._wrapIfMarkedForAutoLog(e.argument,t,!1,[e]))&&(e.argument=t)}),a._visitor.MemberExpression.addForAutoLogOnly(function(e,t){var s;e.object&&(s=a._wrapIfMarkedForAutoLog(e.object,t))&&(e.object=s),e.property&&(e.computed?(s=a._wrapIfMarkedForAutoLog(e.property,t))&&(e.property=s):t.parentNode&&(a._isInstrumented(e,t)||"AssignmentExpression"===t.parentNode.type&&t.parentNode.left===e||"CallExpression"===t.parentNode.type&&t.parentNode.callee===e||"NewExpression"===t.parentNode.type&&t.parentNode.callee===e||"UpdateExpression"===t.parentNode.type&&t.parentNode.argument===e||"UnaryExpression"===t.parentNode.type&&t.parentNode.argument===e&&"delete"===t.parentNode.operator)||(s=a._wrapIfMarkedForAutoLog(e,t,!1,[e.property]))&&(t.replacement=s))}),a._visitor.BinaryExpression.addForAutoLogOnly(function(e,t){var s;e.left&&(s=a._wrapIfMarkedForAutoLog(e.left,t))&&(e.left=s),e.right&&(s=a._wrapIfMarkedForAutoLog(e.right,t))&&(e.right=s)}),a._visitor.CallExpression.addForAutoLogOnly(function(e,t){if(e.arguments&&e.arguments.length)for(var s,r=0,i=e.arguments.length;r<i;r++)"SpreadElement"!==e.arguments[r].type&&(s=a._wrapIfMarkedForAutoLog(e.arguments[r],t))&&(e.arguments[r]=s);var n;e.callee&&!a._isInstrumented(e,t)&&(n=[e.callee],"MemberExpression"===e.callee.type&&e.callee.property&&n.push(e.callee.property),n=a._wrapIfMarkedForAutoLog(e,t,!1,n))&&(t.replacement=n)}),a._visitor.NewExpression.addForAutoLogOnly(function(e,t){if(e.arguments&&e.arguments.length)for(var s,r=0,i=e.arguments.length;r<i;r++)"SpreadElement"!==e.arguments[r].type&&(s=a._wrapIfMarkedForAutoLog(e.arguments[r],t))&&(e.arguments[r]=s)}),a._visitor.ArrayExpression.addForAutoLogOnly(function(e,t){if(e.elements&&e.elements.length)for(var s=0,r=e.elements.length;s<r;s++){var i=e.elements[s];i&&"SpreadElement"!==i.type&&(i=a._wrapIfMarkedForAutoLog(i,t))&&(e.elements[s]=i)}}),a._visitor.TemplateLiteral.addForAutoLogOnly(function(e,t){if(e.expressions&&e.expressions.length)for(var s=0,r=e.expressions.length;s<r;s++){var i=a._wrapIfMarkedForAutoLog(e.expressions[s],t);i&&(e.expressions[s]=i)}}),a._visitor.AwaitExpression.addForAutoLogOnly(function(e,t){e.argument&&(t=a._wrapIfMarkedForAutoLog(e.argument,t))&&(e.argument=t)}),a._visitor.SequenceExpression.addForAutoLogOnly(function(e,t){if(e.expressions&&e.expressions.length)for(var s=0,r=e.expressions.length;s<r;s++){var i=e.expressions[s],i=a._wrapIfMarkedForAutoLog(i,t);i&&(e.expressions[s]=i)}}),a._visitor.ConditionalExpression.addForAutoLogOnly(function(e,t){e.test&&(t=a._wrapIfMarkedForAutoLog(e.test,t))&&(e.test=t)}),a._visitor.AssignmentExpression.addForAutoLogOnly(function(e,t){var s;e.right&&("="!==e.operator?!a._getAutoLogHint(e.right)&&((s=[]).push(e.left),"MemberExpression"===e.left.type&&e.left.property&&s.push(e.left.property),s=a._wrapIfMarkedForAutoLog(e,t,!1,s))&&(t.replacement=s):(s=[e.left],"MemberExpression"===e.left.type&&e.left.property?s.push(e.left.property):"ArrayPattern"!==e.left.type&&"ObjectPattern"!==e.left.type||s.push(...a._findAllChildIdentifiersExceptComputedPropertyKeys(e.left)),(t=a._wrapIfMarkedForAutoLog(e.right,t,!1,s))&&(e.right=t)))}),a._visitor.UnaryExpression.addForAutoLogOnly(function(e,t){e.argument&&"delete"!==e.operator&&(t=a._wrapIfMarkedForAutoLog(e.argument,t))&&(e.argument=t)})}instrument(e){var t=this,s=(t._ranges=[],t._code=e,t._numberOfFunctions=0,t._totalRanges=0,t._logMarkerRangeMap={},t._testNames=[],t._parse(e)),e=(t._postInitializeIgnoreCoverageHints(),t._postInitializeAutoLogHints(e,s),t._change(s,t._visitor));let r;this._snaps&&this._snaps.length?r=this._processSnaps(e):this._appendComponentInstantiation(e);s=t._generate(e);return delete t._code,{code:s.code,map:s.map.toString(),ranges:t._ranges,numberOfFunctions:t._numberOfFunctions,testName:t._testName,testNames:t._testNames,esm:t._esm,includedTestFile:t._includedTestFile,excludedTestFile:t._excludedTestFile,hasIncludedTest:t._hasIncludedTest,matchSnapshotRanges:t._matchSnapshotRanges,loggedRanges:t._loggedRanges,notInstrumentedLogMarkers:t._logMarkers&&t._logMarkers.filter(e=>!e.instrumented),liveCommentLines:!_.isEmpty(t._liveCommentLines)&&t._liveCommentLines||void 0,logpointInfo:{overlappingLogpointsPresent:0!==t._outstandingLogpointCount},snaps:r,logMarkerRangeMap:t._logMarkerRangeMap,rangeFunctions:t._rangeFunctions}}_nodeEndsBeforeSelectionStart(e,t,s){return e.loc.end.line<t||e.loc.end.line===t&&e.loc.end.column<s}_findBestMatchingAutoLogNode(e,t,s,r,i,n){if(("File"===e.type||"Program"===e.type)&&t.loc.start.line===s)return t;var o=this._nodeEndsBeforeSelectionStart(e,s,r),s=this._nodeEndsBeforeSelectionStart(t,s,r);if(o&&!s)return t;if(s&&!o)return e;if(e.loc.start.column<=r&&t.loc.start.column>r)return e;if(t.loc.start.column<=r&&e.loc.start.column>r)return t;if(t.loc.start.column<=r&&e.loc.start.column<=r){if(e.loc.start.column>t.loc.start.column)return e;if(t.loc.start.column>e.loc.start.column)return t}else{if(e.loc.start.column<t.loc.start.column)return e;if(t.loc.start.column<e.loc.start.column)return t}s=n-1;return(e.loc.end.line>i||e.loc.end.line===i&&e.loc.end.column>=s)&&(t.loc.end.line<i||t.loc.end.line===i&&t.loc.end.column<s)?e:(t.loc.end.line>i||t.loc.end.line===i&&t.loc.end.column>=s)&&(e.loc.end.line<i||e.loc.end.line===i&&e.loc.end.column<s)?t:(e.loc.end.line>i||e.loc.end.line===i&&e.loc.end.column>=s)&&(t.loc.end.line>i||t.loc.end.line===i&&t.loc.end.column>=s)?e.loc.end.line<t.loc.end.line||e.loc.end.line===t.loc.end.line&&e.loc.end.column<t.loc.end.column?e:t:e.loc.end.line<t.loc.end.line||e.loc.end.line===t.loc.end.line&&e.loc.end.column<t.loc.end.column?t:e}_postInitializeIgnoreCoverageHints(){if(this._extractedComments&&this._extractedComments.ignoreComments)for(const e of this._extractedComments.ignoreComments)this._ignoreCoverageHints.push(e.index);this._ignoreCoverageHints.length||(this._nextHint=()=>{})}_postInitializeAutoLogHints(e,t){var s;const p=this;if(p._opts.recordValues){if(p._extractedComments&&p._extractedComments.liveComments)for(const a of p._extractedComments.liveComments)p._handleLiveComment(a.index,a.exp,e);if(p._logMarkers&&p._logMarkers.length){let u=-1;const d=new Map;for(const c of p._logMarkers){var r=c.range;r&&(r=r[0],u=Math.max(u,r),null!=(s=d.get(r))&&s.push(c)||d.set(r,[c]))}const l=this._getVisitor(),h=(l.ChainExpression=function(e,t,s){s(e.expression,t,"Expression")},new Set(["ClassDeclaration","ClassExpression","FunctionDeclaration","FunctionExpression","ArrowFunctionExpression"])),g=new Map;!function e(c,t,s){var r,s=s||c.type;c.loc.start.line<=u&&((r=d.get(c.loc.start.line))&&!t.has(c)&&(t.add(c),r.forEach(e=>{if(e.range){var[,t,s,r]=e.range;if(c.loc.start.column<=r||c.loc.start.line!==s||c.loc.end.line>c.loc.start.line||c.loc.end.line===c.loc.start.line&&c.loc.end.column>=t)if(e.logpoint&&!e.inlineLogpoint&&!e.synthetic&&h.has(c.type)){var i,n=c.loc.start.line+1,o=c.loc.end.line,a=e.changeId;for(let e=n;e<=o;e++){var l={range:[e,0,e,1/0],changeId:a,id:a,expanded:!1,new:!0,action:"show",logpoint:!0,synthetic:!0};null!=(i=d.get(e))&&i.push(l)||d.set(e,[l])}u=Math.max(u,o)}else"EmptyStatement"!==c.type&&"DebuggerStatement"!==c.type&&"ChainExpression"!==c.type&&((n=g.get(e))?g.set(e,p._findBestMatchingAutoLogNode(n,c,c.loc.start.line,t,s,r)):g.set(e,c))}})),r=l[s])&&r(c,t,e)}(t,new Set);for(const[f,m]of g.entries()){var i="VariableDeclarator"===(i=m).type&&i.init?i.init:"IfStatement"===i.type&&i.test?i.test:"RestElement"===i.type&&i.argument?i.argument:"AssignmentExpression"===i.type&&"="!==i.operator&&i.right?i.left:i,n=(f.logpoint&&this._outstandingLogpointCount++,p._autoLogHints[i.end]),o=null!=n&&n.isLiveComment?n:null==n?void 0:n.liveComment;n&&!o||(p._autoLogHints[i.end]={start:i.start,logMarker:f,liveComment:o},p._logMarkerRangeMap[[i.loc.start.line,i.loc.start.column,i.loc.end.line,i.loc.end.column].join(",")]=f.range.join(","))}}}}_getVisitor(){var e=t("./acornWalkJsxPlugin")(t("acorn-walk").base);return e.MemberExpression=function(e,t,s){s(e.object,t,"Expression"),s(e.property,t,"Expression")},e.MethodDefinition=e.Property=function(e,t,s){e.computed?s(e.key,t,"Expression"):s(e.key,t,"Identifier"),s(e.value,t,"Expression")},e}_findAllChildIdentifiersExceptComputedPropertyKeys(e){var t=[];const i=this._getVisitor();return i.ObjectPattern=function(e,t,s){for(var r=0,i=e.properties;r<i.length;r+=1){var n=i[r];"Property"===n.type?(n.computed||n.method||s(n.key,t,"Identifier"),s(n.value,t,"Pattern")):"RestElement"===n.type&&s(n.argument,t,"Pattern")}},function e(t,s,r){r=r||t.type,"Identifier"===t.type&&s.indexOf(t)<0&&s.push(t),r=i[r];r&&r(t,s,e)}(e,t),t}_getNodesToCheckForAutoLogsInVariableDeclaration(e,t){e=[e];return"VariableDeclarator"===t.type&&t.id&&("Identifier"===t.id.type?e.push(t.id):"ObjectPattern"!==t.id.type&&"ArrayPattern"!==t.id.type||e.push(...this._findAllChildIdentifiersExceptComputedPropertyKeys(t.id))),e}_tryFindTestName(e,t){var s;this._containsChangePosition(e.body)&&t.parentContext&&(this._saveTestNameIfTestFunctionCall(t,e,t.parentNode)||this._tryFindTestNameFromWrappedFunction(e,t)||t.parentContext.parentContext&&(s=t.parentNode,!_.isArray(s)||s[0]!==e&&s[1]!==e||(e=(s=t.parentContext).parentNode)&&"CallExpression"===e.type&&s.parentContext&&this._tryFindTestNameFromWrappedFunction(t.parentContext.parentNode,t.parentContext.parentContext)))}_tryFindTestNameFromWrappedFunction(e,t){var s=t.parentNode;if(_.isArray(s)&&(s[0]===e||s[1]===e)){s=t.parentContext,e=s.parentNode;if(e&&"CallExpression"===e.type&&s.parentContext)return this._saveTestNameIfTestFunctionCall(s.parentContext,e,s.parentContext.parentNode)}}_createVisitor(){var s=[],r={removeVisitorsAddedForAutoLogHintsOnly:function(){_.each(s,function(e){r[e].clearAutoLogHintsActions()})},add:function(e,t){for(var s=0,r=e.length;s<r;s++)e[s].add(t)}};return _.each(i,function(t){var i=[],e=(r[t]=function(e,t){for(var s=0,r=i.length;s<r;s++)i[s](e,t)},r[t]);e.add=function(e){i.push(e)},e.addForAutoLogOnly=function(e){e.removeIfNoAutoLogHints=!0,s.push(t),i.push(e)},e.clearAutoLogHintsActions=function(){i=_.filter(i,function(e){return!e.removeIfNoAutoLogHints})},e.clear=function(){i.length=0}}),r}_change(e,t,s){var r,i,n;if(s=s||{},e.type){if(e.loc)if(t[e.type]){if(s.hinted||(s.hinted=this._nextHint(e)),s.hinted)return e;t[e.type](e,s)}if("Identifier"===e.type||"Literal"===e.type||"ThisExpression"===e.type||"DebuggerStatement"===e.type||"EmptyStatement"===e.type||"BreakStatement"===e.type||"ContinueStatement"===e.type)return}for(n in e)e.hasOwnProperty(n)&&"loc"!==n&&"type"!==n&&"start"!==n&&"end"!==n&&"name"!==n&&(r=e[n])&&_.isObject(r)&&(i={parentContext:s,parentNode:e,hinted:s.hinted,func:s.func},this._change(r,t,i),i.replacement)&&(e[n]=i.replacement);return e}_handleLiveComment(e,t,o){const a=this._autoLogHints[e]={exp:t,isLiveComment:!0};t=(e,t,s,r)=>{for(var i,n=e;0<=n;n--)if(i=o[n],!s.test(i)){n++;break}return n<t&&!this._autoLogHints[n]&&(this._autoLogHints[n]=a,r)&&r(n),n};t(t(e-1,e,/\s/)-1,e,/[\s,)}]/,e=>a.bracelessIndex=e)}_parse(i){var e,n=this,t={locations:!0,ecmaVersion:"latest",allowReturnOutsideFunction:!0,allowImportExportEverywhere:!0,allowAwaitOutsideFunction:!0,allowHashBang:!0,plugins:{jsx:!0,objectSpread:!0,dynamicImport:!0,topLevelAwait:!0,tolerance:!0}},o=[];return n._ignoreCoverageRegExp&&o.push(function(e,t,s,r){t&&t.match(n._ignoreCoverageRegExp)&&n._ignoreCoverageHints.push(r)}),n._ignoreFileCoverageRegExp&&o.push(function(e,t){!n._ignoreFileCoverage&&t&&t.match(n._ignoreFileCoverageRegExp)&&(n._ignoreFileCoverage=!0,n._wrapExpressionStatementExpressionIntoVisitor=function(e){return e},n._autoLogHints={})}),n._includeTestFileRegExp&&o.push(function(e,t){!n._includedTestFile&&t&&t.match(n._includeTestFileRegExp)&&(n._includedTestFile=!0)}),n._excludeTestFileRegExp&&o.push(function(e,t){!n._excludedTestFile&&t&&t.match(n._excludeTestFileRegExp)&&(n._excludedTestFile=!0)}),!n._opts.recordValues||!n._autoLogHintExpPrefix||n._ignoreFileCoverage||n._extractedComments&&n._extractedComments.liveComments||o.push(function(e,t,s){var r;t&&!n._ignoreFileCoverage&&(0===(r=t.indexOf(n._autoLogHintExpPrefix))||-1!==r&&0===t.substring(0,r).trim().length)&&(t=t.substr(n._autoLogHintExpPrefix.length+r).trim(),n._handleLiveComment(s,t,i))}),n._opts.preserveComments?(t.ranges=!0,t.onComment=[],t.onToken=[],e=a.parse(i,t),_.each(t.onComment,function(t){_.each(o,function(e){e("Block"===t.type,t.value,t.start,t.end,null==(e=t.loc)?void 0:e.start)})}),l.attachComments(e,t.onComment,t.onToken)):(o.length&&(t.onComment=function(t,s,r,i,n){_.each(o,function(e){e(t,s,r,i,n)})}),a.parse(i,t))}_nextHint(e,t){for(var s=this,r=e.start,i=e.end,e=(!t&&_.isNumber(s._ignoreCoverageHints.prevLastHintPosition)&&(s._ignoreCoverageHints.lastHintPosition=s._ignoreCoverageHints.prevLastHintPosition,delete s._ignoreCoverageHints.prevLastHintPosition),s._ignoreCoverageHints.lastHintPosition),n=s._ignoreCoverageHints.lastHintPosition+1,o=!1,a=!1,l=!1;n<s._ignoreCoverageHints.length;){var c=s._ignoreCoverageHints[n];if(c<=r||l&&c<i)o=!0,s._ignoreCoverageHints.lastHintPosition=n,n++,l=!0;else{if(!(t&&c<i))break;a=!0,s._ignoreCoverageHints.lastHintPosition=n,n++}}return a&&(s._ignoreCoverageHints.prevLastHintPosition=e),o}_generate(e){var t={sourceMap:this._opts.fileName||"original",sourceMapWithCode:!0};return this._opts.preserveComments&&(t.comment=!0),l.generate(e,t)}_wrapInBlock(e){return{type:"BlockStatement",body:e}}_instructionValueSequence(e,t,s,r){var i=e[1],i=this._wrapIfMarkedForAutoLog(i,t,!0,s,r);return i&&(e[1]=i),_.isEmpty(this._autoLogHints)&&(this._instructionValueSequence=_.bind(this._sequence,this),this._getNodesToCheckForAutoLogsInVariableDeclaration=()=>[]),this._sequence(e)}_wrapIfMarkedForAutoLog(t,s,r,i,n){if(t&&!s.hinted){let e=t;if(!(a=this._getAutoLogHint(t,n))&&i&&i.length)for(var o=0;o<i.length;o++){var a,l=i[o];if(a=this._getAutoLogHint(l)){e=l;break}}if(a&&(!t.tracerLog||"."===a.exp||a.logMarker&&"time"===a.logMarker.action))return r?this._wrapIntoVisitor(t,this._generateNodeContext(e),!1,a):this._generateUndefinedAutoLogNode(t,s,a)}}_isInstrumented(e,t){return t.parentNode&&(t.parentNode[5]===e||t.parentNode[6]===e)}_generateUndefinedAutoLogNode(e,t,s,r){let i=this._ranges.length-1;t=this._instruction(e,Object.assign(Object.assign({},t),{disallowValueLoggingInOrAfterCurrentDebuggerFrame:r}),"U",e=>{i=e}),r=this._wrapIntoVisitor(e,this._generateNodeContext(e),!1,s,()=>i);return this._sequence([t,r])}_getAutoLogHint(e,t){var s=e.end+(t||0),s=this._autoLogHints[s];s&&0<=s.start&&e.start!==s.start&&(s=void 0);try{return s?(s.bracelessIndex&&delete this._autoLogHints[s.bracelessIndex],s):t?s=this._getAutoLogHint(e):void 0}finally{s&&s.isLiveComment&&(this._liveCommentLines[e.loc.start.line]=e.loc.start.column)}}_sequence(e){return 2===e.length&&this._isUndefinedInstruction(e[0])?e[1]:{type:"SequenceExpression",expressions:e}}_literal(e){return{type:"Literal",value:e}}_delayedLiteral(e){return{type:"Literal",get value(){return _.isUndefined(this._value)&&(this._value=e()),this._value}}}_return(e){return{type:"ReturnStatement",argument:e}}_firstNode(e){return{type:"ExpressionStatement",expression:{type:"Literal",value:e&&e.expression&&e.expression.value||""}}}_handleSuperCall(e,t,s,r){var i=e[0],t=this._instructionStatement(i,t,"S");delete i.loc,delete i.expression.loc,e.splice(1,0,...[s,t].concat(r))}_replaceConsoleLog(e,t){var s=this;e&&!t.hinted&&s._captureConsoleLog&&("CallExpression"===e.type&&e.callee&&"MemberExpression"===e.callee.type&&e.callee.object&&"Identifier"===e.callee.object.type&&"console"===e.callee.object.name&&e.callee.property&&"Identifier"===e.callee.property.type&&"log"===e.callee.property.name?(e.tracerLog=!0,e.callee.object.name="$_$tracer",e.arguments||(e.arguments=[]),e.arguments.push(s._literal(s._generateNodeContext(e.arguments[0]))),e.arguments.push(s._literal(s._opts.file)),e.arguments.push(s._literal(s._ranges.length))):e.arguments&&e.arguments.length&&s._replaceConsoleLog(e.arguments[0],t))}_generateNodeContext(e){if(e&&"Literal"!==e.type)try{var t=_.truncate(l.generate(e,{}),40).toString().replace("$_$tracer.log","console.log").replace(/\s*;\s*$/,"").replace(/\r\n\s*/g," ").replace(/\n\s*/g," ");return~t.indexOf("$_$tracer")?"":t}catch(e){}return""}_replaceSequenceWithDiff(e){var t=this,s=e;if((e=s.expression)&&"SequenceExpression"===e.type&&e.expressions&&2===e.expressions.length){var r=e.expressions[0],e=e.expressions[1],i="";if(r&&"Literal"!==r.type)try{i=_.truncate(l.generate(r,{}),40).toString()+" vs "+_.truncate(l.generate(e,{}),40).toString()}catch(e){}return s.expression={type:"CallExpression",callee:{type:"MemberExpression",object:{type:"Identifier",name:"$_$tracer"},property:{type:"Identifier",name:"diff"}},arguments:[r,e,t._literal(i),t._literal(t._opts.file),t._literal(t._ranges.length)]},!0}}_needsToStayFirst(e){return e&&"ExpressionStatement"===e.type&&e.expression&&"Literal"===e.expression.type&&("use strict"===e.expression.value||"use babel"===e.expression.value||"ngInject"===e.expression.value)}_isSystemJsModule(e){return e&&"ExpressionStatement"===e.type&&e.expression&&"CallExpression"===e.expression.type&&e.expression.callee&&"MemberExpression"===e.expression.callee.type&&e.expression.callee.object&&e.expression.callee.property&&"Identifier"===e.expression.callee.object.type&&"Identifier"===e.expression.callee.property.type&&"System"===e.expression.callee.object.name&&"register"===e.expression.callee.property.name&&e.expression.arguments}_isSuperCall(e){return e&&"ExpressionStatement"===e.type&&e.expression&&"CallExpression"===e.expression.type&&e.expression.callee&&"Super"===e.expression.callee.type}_isUndefinedInstruction(e){return e&&"Identifier"===e.type&&"undefined"===e.name}_onRangeAdded(e){}_instruction(r,i,n,t){var o=r.loc,e="",s=[];switch(n){case"PE":s=[this._literal(this._opts.file)];case"FE":e=n.toLowerCase();break;default:if(this._ignoreFileCoverage||i.hinted||this._nextHint(r,!0))return{type:"Identifier",name:"undefined"};e="";const l=()=>{var e,t,s=[o.start.line,o.start.column,o.end.line,o.end.column];"R"===n&&(e=1,r.argument&&"CallExpression"===r.argument.type&&r.argument.callee&&("Identifier"===(t="SequenceExpression"===(t=r.argument.callee).type&&t.expressions&&t.expressions.length?t.expressions[t.expressions.length-1]:t).type?e=this._isObjectSpread(t)?c:t.name:"MemberExpression"===t.type&&(t.property&&"Identifier"===t.property.type&&"createElement"===t.property.name&&t.object&&(this._isReactObject(t.object)||"MemberExpression"===t.object.type&&this._isReactObject(t.object.object))?e="Babel.React.createElement":t.object&&this._isObjectSpread(t.object)&&(e=c))),s.push(e)),this._ranges.push(s),this._onRangeAdded(i)};this._totalRanges++,"U"!==n?(s=[this._literal(this._opts.file),this._literal(this._ranges.length)],l(),"AR"!==n?s.push({type:"Identifier",name:"$_$c"}):e="_"):(e="_",(s=[this._literal(this._opts.file),this._delayedLiteral(()=>{var e=this._ranges.length;return l(),t&&t(e),e})]).push({type:"Identifier",name:"$_$c"}),i.disallowValueLoggingInOrAfterCurrentDebuggerFrame&&s.push(this._literal(!0)))}var a=this._instructionCallExpression(e,s);return r.loc&&(a.loc=r.loc,a.callee.loc=r.loc),a}_isReactObject(e){return e&&"Identifier"===e.type&&e.name&&~e.name.toLowerCase().indexOf("react")}_isObjectSpread(e){return e&&"Identifier"===e.type&&e.name&&~e.name.toLowerCase().indexOf("objectspread")}_wrapExpressionStatementExpressionIntoVisitor(e,t){return e&&"Identifier"===e.type?(t=(t=this._getAutoLogHint(t))||this._getAutoLogHint(e),this._wrapIntoVisitor(e,void 0,{hasAutoLogHint:!!t},t||{exp:""})):e}_autoHintDetails(e,t){e=this._autoLogHintGlobalExp&&!e&&t.isLiveComment||this._autoLogHintGlobalExp&&e&&e.hasAutoLogHint;let s=(t.logMarker||t).exp;var r=(s=e?"":s)&&"?"===s[0],i=s&&("."===s[0]||".+"===s.substr(0,2)||"+."===s.substr(0,2)),n=s&&("+"===s[0]||".+"===s.substr(0,2)||"+."===s.substr(0,2));return r&&(s=s.substr(1).trim()),i&&(s=s.substr(1).trim()),n&&(s=s.substr(1).trim()),t.logMarker&&(n=t.logMarker.expanded),{hasGlobalExp:e,exp:s,isProxyExp:r,isTimeDiffExp:i,isAutoExpandExp:n}}_wrapIntoVisitor(t,s,r,i,n,o){var a=this;let{hasGlobalExp:l,exp:c,isProxyExp:u,isTimeDiffExp:p,isAutoExpandExp:d}=this._autoHintDetails(r,i);var h=i.logMarker&&"time"!==i.logMarker.action&&i.logMarker;let g=i.logMarker&&"time"===i.logMarker.action&&i.logMarker;g&&(i.liveComment?((f=this._autoHintDetails(r,i.liveComment)).isTimeDiffExp&&(g.instrumented=!0,g=void 0),l=f.hasGlobalExp,c=f.exp,u=f.isProxyExp,p=f.isTimeDiffExp,d=f.isAutoExpandExp):p=!0);var f=a._ranges.length-(r?0:1),m=[a._literal(a._opts.file)];if(n?(m.push(a._delayedLiteral(()=>{var e=n();return a._loggedRanges[e]=!0,e})),m.push(a._delayedLiteral(()=>a._opts.file+","+n()))):(a._loggedRanges[f]=!0,m.push(a._literal(f)),m.push(a._literal(a._opts.file+","+f))),m.push({type:"Identifier",name:"$_$c"}),p&&!c)return m.push(a._literal(s||t.name||"")),m.push(a._tracerMethodCall("_time")),m.push(t),m.push(a._tracerMethodCall("_time")),g&&(f={type:"ObjectExpression",properties:[]},g.traceId&&f.properties.push(a._propertyNode("traceId",g.traceId)),g.changeId&&f.properties.push(a._propertyNode("changeId",g.changeId)),(g.traceId||g.changeId)&&m.push(f),g.instrumented=!0),this._tracerMethodCall("_logTime",m);{m.push(a._literal(c?_.truncate(c,40):s||t.name||"")),g?(delete(f=Object.assign({},g)).liveComment,m.push(a._wrapIntoVisitor(t,s,!!r,{exp:".",logMarker:f}))):p?m.push(a._wrapIntoVisitor(t,s,!!r,{exp:"."})):m.push(t),l?m.push(a._evalExpressionNode(a._autoLogHintGlobalExp)):this._logpointsNotAvailableExpression&&i.logMarker&&i.logMarker.logpoint?m.push(a._evalExpressionNode(this._logpointsNotAvailableExpression)):m.push(c?a._evalExpressionNode(c):a._literal("$_$ne")),m.push(a._literal(!r||a._autoLogHintExpPrefix&&r&&r.hasAutoLogHint?0:1));let e=0;if(d&&(e|=1),u&&(e|=2),m.push(a._literal(e)),h){f={type:"ObjectExpression",properties:[]};const o=i.liveComment&&""===i.liveComment.exp||!i.liveComment&&r;return o&&f.properties.push(a._propertyNode("permanent",1)),h.traceId&&f.properties.push(a._propertyNode("traceId",h.traceId)),h.changeId&&(f.properties.push(a._propertyNode("changeId",h.changeId)),this._outstandingLogpointCount--),(h.traceId||h.changeId||o)&&m.push(f),h.instrumented=!0,!o&&i.liveComment?a._wrapIntoVisitor(a._instructionCallExpression("v",m),s,r,i.liveComment,n,!0):a._instructionCallExpression("v",m)}return o&&m.push({type:"ObjectExpression",properties:[a._propertyNode("permanent",1)]}),a._instructionCallExpression("v",m)}}_propertyNode(e,t){return{type:"Property",key:{type:"Identifier",name:e},value:{type:"Literal",value:t}}}_tracerMethodCall(e,t){return{type:"CallExpression",callee:{type:"MemberExpression",computed:!1,object:{type:"Identifier",name:"$_$tracer"},property:{type:"Identifier",name:e}},arguments:t||[]}}_evalExpressionNode(e){return{type:"FunctionExpression",params:[{type:"Identifier",name:"$"}],body:{type:"BlockStatement",body:[{type:"TryStatement",block:{type:"BlockStatement",body:[{type:"ReturnStatement",argument:{type:"CallExpression",callee:{type:"Identifier",name:"eval"},arguments:[{type:"Literal",value:e}]}}]},handler:{type:"CatchClause",param:{type:"Identifier",name:"__e"},body:{type:"BlockStatement",body:[{type:"ReturnStatement",argument:{type:"Literal",value:"✗"}}]}}}]},generator:!1,expression:!1}}_instructionCallExpression(e,t){return{type:"CallExpression",callee:{type:"Identifier",name:"$_$w"+e},arguments:t}}_selfExecutingAsyncFunction(e){return{type:"ExpressionStatement",expression:{type:"CallExpression",callee:{type:"ArrowFunctionExpression",expression:!1,generator:!1,async:!0,params:[],body:{type:"BlockStatement",body:e}},arguments:[],optional:!1}}}_selfExecutingAsyncSnapFunction(e,t,s){return{type:"ExpressionStatement",expression:{type:"CallExpression",callee:{type:"FunctionExpression",id:{type:"Identifier",name:"snapRootStackTraceMarker_"+e},expression:!1,generator:!1,async:!1,params:[],body:{type:"BlockStatement",body:[{type:"ExpressionStatement",expression:{type:"CallExpression",callee:{type:"FunctionExpression",id:{type:"Identifier",name:t},expression:!1,generator:!1,async:!0,params:[],body:s},arguments:[],optional:!1}}]}},arguments:[],optional:!1}}}_svelteInstanceFuncCall(){return{type:"ExpressionStatement",expression:{type:"CallExpression",callee:{type:"Identifier",name:"instance"},arguments:[{type:"ObjectExpression",properties:[{type:"Property",key:{type:"Identifier",name:"$$"},value:{type:"ObjectExpression",properties:[{type:"Property",key:{type:"Identifier",name:"on_destroy"},value:{type:"ArrayExpression",elements:[]}}]}}]},{type:"ObjectExpression",properties:[]},{type:"ArrowFunctionExpression",expression:!1,generator:!1,async:!1,params:[],body:{type:"BlockStatement",body:[]}}]}}}_vueSfcSetupFuncCall(){return{type:"ExpressionStatement",expression:{type:"LogicalExpression",operator:"&&",left:{type:"LogicalExpression",operator:"&&",left:{type:"LogicalExpression",operator:"&&",left:{type:"BinaryExpression",operator:"!==",left:{type:"UnaryExpression",operator:"typeof",argument:{type:"Identifier",name:"_sfc_main"}},right:{type:"Literal",value:"undefined"}},right:{type:"Identifier",name:"_sfc_main"}},right:{type:"MemberExpression",object:{type:"Identifier",name:"_sfc_main"},property:{type:"Identifier",name:"setup"}}},right:{type:"CallExpression",callee:{type:"MemberExpression",object:{type:"Identifier",name:"_sfc_main"},property:{type:"Identifier",name:"setup"}},arguments:[{type:"ObjectExpression",properties:[]},{type:"ObjectExpression",properties:[{type:"Property",key:{type:"Identifier",name:"expose"},value:{type:"ArrowFunctionExpression",expression:!1,generator:!1,async:!1,params:[],body:{type:"BlockStatement",body:[]}},kind:"init",computed:!1,method:!1,shorthand:!1}]}]}}}}_appendComponentInstantiation(e){var t;!this._opts.vue&&!this._opts.svelte||null!=(t=this._opts.snaps)&&t.onlyMode||(e=(t=e.body).pop(),t.push(this._opts.svelte?this._svelteInstanceFuncCall():this._vueSfcSetupFuncCall()),t.push(e))}_processSnaps(s){var e,t=this._snaps,r=this._snapScopes,i={type:"Identifier",name:"e"},n={type:"EmptyStatement"};let o=s.body;if(null!=(h=this._opts.snaps)&&h.onlyMode){var a=[];for(let t=0;t<s.body.length;t++){var l=s.body[t];if("ImportDeclaration"===l.type){var c=[],u=l.source.value,p=l.specifiers||[];if(p.length){var d=p.find(e=>"ImportNamespaceSpecifier"===e.type);let e=void 0;for(const v of p)v!==d&&(e=e||{type:"ObjectPattern",properties:[]}).properties.push({type:"Property",key:"ImportDefaultSpecifier"===v.type?{type:"Identifier",name:"default"}:v.imported,value:v.local,kind:"init"});d&&c.push(this._variableDeclaration(d.local,this._dynamicImport(u))),e&&c.push(this._variableDeclaration(e,d?d.local:this._dynamicImport(u)))}else c.push({type:"ExpressionStatement",expression:this._dynamicImport(u)});let e=this._tracerMethodCall("reportSnapsImportError",[{type:"NewExpression",callee:{type:"Identifier",name:"Error"},arguments:[{type:"MemberExpression",object:i,property:{type:"Identifier",name:"message"}}]}]);e.loc=l.loc,e=this._instructionValueSequence([this._instruction(e,{}),e],{}),s.body[t]=this._wrapIntoTryCatch(c,i,[{loc:l.loc,type:"ExpressionStatement",expression:e}])}else"ExportDefaultDeclaration"===l.type?(l.declaration&&("FunctionDeclaration"===l.declaration.type||"ClassDeclaration"===l.declaration.type&&!l.declaration.superClass)&&a.push(l.declaration),s.body[t]=n):"ExportNamedDeclaration"===l.type?l.declaration?"FunctionDeclaration"===l.declaration.type||"ClassDeclaration"===l.declaration.type&&!l.declaration.superClass?(a.push(l.declaration),s.body[t]=n):(s.body[t]=l.declaration,"VariableDeclaration"===l.declaration.type&&(l.declaration.kind="var")):s.body[t]=n:"ExportAllDeclaration"===l.type?s.body[t]=n:"VariableDeclaration"===l.type?l.kind="var":"FunctionDeclaration"!==l.type&&("ClassDeclaration"!==l.type||l.superClass)||(a.push(l),s.body[t]=n)}var h=this._wrapIntoTryCatch(s.body,i,[{type:"ExpressionStatement",expression:this._tracerMethodCall("reportSnapsProgramScopeError",[i])}]);const g=o.pop();(o=[h,g]).unshift(...a),s.body=null!=(h=this._opts.snaps)&&h.asyncWrap?[this._selfExecutingAsyncFunction(o)]:o}const g=o.pop();try{const y=new Map;for(const w of r.keys()){const k=r.get(w);if(null!=(e=this._opts.snaps)&&e.onlyMode){var f=[];for(let e=0;e<k.source.body.length;e++){var m=k.source.body[e];"VariableDeclaration"===m.type?m.kind="var":"FunctionDeclaration"!==m.type&&("ClassDeclaration"!==m.type||m.superClass)||(f.push(m),k.source.body[e]=n)}var _=[];k.source.body=[this._wrapIntoTryCatch(k.source.body,i,[{type:"ExpressionStatement",expression:this._tracerMethodCall("reportSnapsProgramScopeError",[i])}],_)],k.source.body.unshift(...f),y.set(w,_)}else y.set(w,{push:e=>{k.source.body.splice(k.source.body.length-1,0,e)}});o.push(k.call)}const b=1===t.length;return t.map((e,t)=>{let s,r;var i;return e.empty||(i=e.body.body[0],s=i.body[0].loc.start,r=i.body[i.body.length-1].loc.end),(e.scope&&y.has(e.scope)?y.get(e.scope):o).push(this._selfExecutingAsyncSnapFunction(t,"quokka_snap"+(b?"":"_"+(t+1)),e.body.body[0])),e.body.body=[],{empty:e.empty,body:{range:[e.body.loc.start.line,e.body.loc.start.column,e.body.loc.end.line,e.body.loc.end.column],fallbackRange:e.empty?void 0:[s.line,s.column,r.line,r.column]},output:e.output&&{range:[e.output.loc.start.line,e.output.loc.start.column,e.output.loc.end.line,e.output.loc.end.column],content:e.outputContent,lines:e.outputLines}}})}finally{o.push(g)}}_wrapIntoTryCatch(e,t,s,r){return{type:"TryStatement",block:{type:"BlockStatement",body:e},handler:{type:"CatchClause",param:t,body:{type:"BlockStatement",body:s}},finalizer:r?{type:"BlockStatement",body:r}:void 0}}_variableDeclaration(e,t){return{type:"VariableDeclaration",declarations:[{type:"VariableDeclarator",id:e,init:t}],kind:"var"}}_dynamicImport(e){return{type:"AwaitExpression",argument:{type:"ImportExpression",source:{type:"Literal",value:e}}}}_getFunctionParameterLogInstructions(e,i){const n=[],o=this;return e.params.forEach(e=>{if("Identifier"===e.type){var t=o._getAutoLogHint(e);t&&e.name&&n.push(o._generateUndefinedAutoLogNode(e,i,t))}else if("AssignmentPattern"===e.type&&e.left&&e.right&&e.left.name){t=[o._getAutoLogHint(e.left),o._getAutoLogHint(e.right),o._getAutoLogHint(e)].find(e=>e);t&&n.push(o._generateUndefinedAutoLogNode(e.left,i,t))}else if("ObjectPattern"===e.type&&e.properties){const s=o._getAutoLogHint(e);e.properties.forEach(e=>{var t;e&&e.key&&e.value&&e.value.name&&(t=[o._getAutoLogHint(e.value),o._getAutoLogHint(e.key),o._getAutoLogHint(e),s].find(e=>e))&&n.push(o._generateUndefinedAutoLogNode(e.value,i,t))})}else if("ArrayPattern"===e.type&&e.elements){const r=o._getAutoLogHint(e);e.elements.forEach(e=>{var t;e&&e.name&&(t=[o._getAutoLogHint(e),r].find(e=>e))&&n.push(o._generateUndefinedAutoLogNode(e,i,t))})}else"RestElement"===e.type&&e.argument&&e.argument.name&&(t=o._getAutoLogHint(e))&&n.push(o._generateUndefinedAutoLogNode(e.argument,i,t))}),n.map(e=>({type:"ExpressionStatement",expression:e}))}_instructionStatement(e,t,s){return{type:"ExpressionStatement",expression:this._instruction(e,t,s)}}_scopeStartVariableDeclaration(e,t){return{type:"VariableDeclaration",kind:"var",declarations:[{type:"VariableDeclarator",id:{type:"Identifier",name:"$_$c"},init:{type:"CallExpression",callee:{type:"Identifier",name:"$_$w"+e.toLowerCase()},arguments:t?[this._literal(this._opts.file),...t]:[this._literal(this._opts.file)]}}]}}_saveTestNameIfTestFunctionCall(t,s,r){if(_.isArray(r)&&2<=r.length&&r[1]===s&&r[0]){let e;if("Literal"===r[0].type)e=r[0].value;else{if("TemplateLiteral"!==r[0].type)return;s=r[0];if(s.expressions&&s.expressions.length)return;if(!s.quasis||1!==s.quasis.length)return;r=s.quasis[0];if(!r||!r.value)return;e=r.value.cooked}s=t.parentContext.parentNode;if(s&&"CallExpression"===s.type){r=s.callee;if((r="SequenceExpression"===r.type&&r.expressions&&"SequenceExpression"===(r=r.expressions[r.expressions.length-1]).type&&r.expressions?r.expressions[r.expressions.length-1]:r)&&("it"===r.name||"test"===r.name||"asyncTest"===r.name||r.property&&"Identifier"===r.property.type&&("it"===r.property.name||"test"===r.property.name||"asyncTest"===r.property.name||"default"===r.property.name&&"import_node_test"===(null==(t=r.object)?void 0:t.name))))return this._testName=e,this._testNames.push(e),!0}}}}s.default=function(e,t){return new o(t).instrument(e)}},{"./acornImportAttributesAssertionsPlugin":2,"./acornImportMetaPlugin":3,"./acornLogicalAssignment":4,"./acornNumericSeparatorPlugin.js":5,"./acornTolerancePlugin":6,"./acornTopLevelAwaitPlugin":7,"./acornWalkJsxPlugin":8,acorn:void 0,"acorn-jsx":void 0,"acorn-walk":void 0,"escodegen-wallaby":void 0}],58:[function(e,t,s){const a=e("util"),r=new(e("lru-cache"))({max:5242880,length:e=>e.length});let i=0;const l={add(e){r.set(i++,e)},values(){var e=r.values();return e.reverse(),e}};let c=process.env.WALLABY_DEBUG_ENABLED||!1,n=process.env.WALLABY_TRACE_ENABLED||!1;const o={};o.log=function(e){return process.stdout.write(e)},o.formatArgs=function(e){var t=this["namespace"];e[0]=function(){if(o.inspectOpts.hideDate)return"";return(new Date).toISOString()+" "}()+t+" "+e[0]},o.inspectOpts=Object.keys(process.env).filter(e=>/^debug_/i.test(e)).reduce((e,t)=>{var s=t.substring(6).toLowerCase().replace(/_([a-z])/g,(e,t)=>t.toUpperCase());let r=process.env[t];return r=!!/^(yes|on|true|enabled)$/i.test(r)||!/^(no|off|false|disabled)$/i.test(r)&&("null"===r?null:Number(r)),e[s]=r,e},{depth:25,maxArrayLength:100,breakLength:200});d=o,((p.debug=p).default=p).coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},p.instances=[],Object.keys(d).forEach(e=>{p[e]=d[e]}),p.formatters={};const u=p;function p(e,t){let s;function o(...i){if(o.enabled){const n=o;var e=Number(new Date),t=e-(s||e);n.diff=t,n.prev=s,n.curr=e,s=e,i[0]=p.coerce(i[0]),"string"!=typeof i[0]&&i.unshift("%O");let r=0;i[0]=i[0].replace(/%([a-zA-Z%])/g,(e,t)=>{var s;return"%%"!==e&&(r++,"function"==typeof(t=p.formatters[t]))&&(s=i[r],e=t.call(n,s),i.splice(r,1),r--),e}),p.formatArgs.call(n,i);t=a.format(...i)+"\n";(!n.isDebug||(l.add(t),c))&&p.log.call(n,t)}}return o.isDebug="debug"===t,o.isTrace="trace"===t,o.namespace=e,o.enabled=o.isTrace&&n||o.isDebug,p.instances.push(o),o}var d,e=u["formatters"];e.o=function(e){return a.inspect(e,o.inspectOpts).replace(/\s*\n\s*/g," ")},e.O=function(e){return a.inspect(e,o.inspectOpts)},t.exports={create(e){return{debug:u(e,"debug"),trace:u(e,"trace")}},enableDebug(){c||(process.env.WALLABY_DEBUG_ENABLED="true",c=!0,l.values().forEach(e=>{o.log(e)}))},getDebugLog(){return l.values()},enableTrace(){n||(process.env.WALLABY_TRACE_ENABLED="true",n=!0,u.instances.forEach(e=>{e.isTrace&&(e.enabled=!0)})),this.enableDebug()}}},{"lru-cache":void 0,util:void 0}],59:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.Runner=void 0;const r=e("path"),u=e("child_process"),p=logger.create("nodeRunner")["debug"],i=e("./runWorkerPool"),n=e("./utils"),d="###wms###",h="###wme###";s.Runner=class{constructor(e){this._project=e,this._initializer=e.settings().bootstrap,this._teardown=e.settings().teardown,this._slowTestThreshold=e.settings().slowTestThreshold,this._zeroConfigJest=e.isZeroConfigJest(),this._nodeNative=e.isNodeNative(),this._vitest=e.isVitest(),this._viteNode=this._project.isQuokkaVite(),this._nodeModules=r.join(e._localRoot,"node_modules");try{this._regeneratorRuntime=r.join(r.dirname(n.default.resolveModulePathFrom(this._nodeModules,"regenerator-runtime")),"runtime.js")}catch(e){}this._params=e.settings().env.params,this._recycle=e.settings().workers.recycle,this._testFramework=e.settings().testFramework,this._cwd=process.env.quokka||this._zeroConfigJest||this._vitest||this._nodeNative?process.cwd():e._instrumentedRoot,this._localProjectDir=e._localProjectDir,this._originalCacheRoot=e._originalRoot,this._reportUnhandledPromises=!!e.settings().reportUnhandledPromises,this._maxLogEntrySize=e.settings().maxLogEntrySize,this._maxTraceSteps=e.settings().maxTraceSteps,this._maxTraceStepsForWatchExpressionPrefetch=e.settings().maxTraceStepsForWatchExpressionPrefetch,this._workerPool=new i.WorkerPool(this._project,{create:_.bind(this._createNodeInstance,this),recycle:_.bind(this._recycleNodeInstance,this),healthy:_.bind(this._isNodeInstanceHealthy,this),prepare:_.bind(this._prepare,this)}),this._workerPool.setFileRoot(this._cwd)}run(e){return this._workerPool.run(e)}cancel(e){return this._workerPool.cancel(e)}start(){return this._workerPool.start()}stop(){this._workerPool.stop()}mapStack(e,t){return this._workerPool._mapStackEntries(e,t)}updateSettings(e){this._workerPool.updateSettings(e)}_createNodeInstance(i,n){var c=this;setImmediate(function(){try{process.env.quokka&&(c._params=c._project.settings().env.params,c._recycle=c._project.settings().workers.recycle);var e,t=(c._params.runner?_.map(c._params.runner.replace(/"([^"]+)"/g,e=>e.replace(/\s/g,"_space_token_")).split(" "),e=>_.trim(e.replace(/_space_token_/g," "),'"')).filter(e=>!!e):[]).concat([process.mainModule.filename,"runner",i,c._workerPool.receiverPort(),c._testFramework.version+(c._testFramework.autoDetected?",autoDetected":""),c._testFramework.path||"",c._nodeModules,c._originalCacheRoot,process.env.BABEL_ENV&&c._regeneratorRuntime||"",c._testFramework.configFile||"",JSON.stringify(c._project.settings().logLimits),c._testFramework.toolVersion||""]),s=_.extend({},process.env,c._params.env?_.reduce(c._params.env.split(";"),function(e,t){var s=t.split("=");return e[_.trimLeft(s[0])]=t.substring(s[0].length+1),e},{}):{});if(process.env.WALLABY_PNP){let e="";s.NODE_OPTIONS?e=s.NODE_OPTIONS:process.env.NODE_OPTIONS&&(e=process.env.NODE_OPTIONS),-1===e.indexOf("--require")&&(e=e+(e?" ":"")+process.env.WALLABY_PNP),s.NODE_OPTIONS=e}process.env.WALLABY_PNP_ESM&&(e=s.NODE_OPTIONS||process.env.NODE_OPTIONS||"",e=process.env.WALLABY_PNP_ESM+(e?" ":"")+e,s.NODE_OPTIONS=e),delete s.ATOM_SHELL_INTERNAL_RUN_AS_NODE,s.WALLABY_ELECTRON_RUN_AS_NODE||delete s.ELECTRON_RUN_AS_NODE,process.env.WALLABY_INTEGRATION_TEST_RUN&&delete s.CI,process.env.quokka&&(s.NODE_OPTIONS=(s.NODE_OPTIONS||"")+" --no-deprecation");var r=c._project.settings().env.runner;const l={process:(0,u.spawn)(r,t,{cwd:c._cwd,env:s}),onConnected:function(e){_.isFunction(e)?this._onConnected=e:this._onConnected&&(this._onConnected(e),delete this._onConnected,delete this.onConnected)}};let o="",a=(l.process.stdout.removeAllListeners("data"),l.process.stdout.on("data",s=>{try{var r=s&&s.toString("utf8")||"";o+=r;let e,t;for(;-1!==(e=o.indexOf(d))&&-1!==(t=o.indexOf(h));){if(t>e){var i=o.substring(e+d.length,t);try{var n=JSON.parse(i);l.expectedPong&&l.expectedPong(n),l.expectedClose&&l.expectedClose(n),c._workerPool.onMessage(n,{},e=>{c._sendToWorker(l,e)})}catch(e){p("Error while processing STDOUT message: "+e.message)}}o=o.substring(t+h.length)}}catch(e){p("Error while processing STDOUT message: "+e.message),o=""}}),"");l.process.stderr.on("data",function(s){try{var r,i,n=(s&&s.toString("utf8")||"").split("\n").filter(e=>-1===e.indexOf("ExperimentalWarning:")&&-1===e.indexOf("node --trace-warnings")&&!e.startsWith("--import 'data:text/javascript")).join("\n");a+=n;let e,t;for(;-1!==(e=a.indexOf(d))&&-1!==(t=a.indexOf(h));)a=(t>e?(r=a.substring(e+d.length,t),p("Error in worker: %s",r),console.error(r)):(i=a.substring(0,t),p("Error in worker: %s",i),console.error(i)),a.substring(t+h.length))}catch(e){p("Error in worker: %s",a),console.error(a),a=""}}),n(l)}catch(e){p("Error while creating worker #%s: %s",i,e&&(e.stack||e.message)),n()}})}_recycleNodeInstance(e){try{e.process.stdout.removeAllListeners("data"),e.process.stderr.removeAllListeners("data")}finally{e.process&&!e.process.killed&&e.process.kill()}}_isNodeInstanceHealthy(e){return e.process&&e.process.pid&&!e.process.killed&&!e.process.signal&&null===e.process.exitCode}_prepare(n,r){var u=this,t=_.randomId(),e=u._sandboxName(r,t),i={};return p("Starting sandbox [%s]",e),Promise.resolve().then(function(){return u._workerPool.cancelled()?Promise.reject({runCancelled:!0}):(p("Preparing sandbox [%s]",e),u._workerPool.getWorker(r))}).then(function(c){return c instanceof Error||c.runCancelled?Promise.reject(c):(p("Prepared sandbox [%s]",e),Promise.resolve({instance:{resume:function(){u._sendToWorker(c,JSON.stringify({type:"in:tracer.resume",data:{}}))},ping:function(t){var s=_.uniqueId();c.expectedPong=function(e){"pong"===e.type&&e.data===s&&(delete c.expectedPong,t())},u._sendToWorker(c,JSON.stringify({type:"in:ping",data:s}))},teardown:function(){u._sendToWorker(c,JSON.stringify({type:"in:teardown",data:{}}))},close:function(s){if(u._recycle&&!u._teardown)u._workerPool.recycleWorker(r),u._workerPool.getWorker(r).then(_.noop),s(!0);else{let t;if(u._teardown){if(i._closing)return;i._closing=!0,t=_.uniqueId(),c.expectedClose=function(e){"closed"===e.type&&e.data&&e.data.requestId===t&&(delete c.expectedClose,delete i._closing,u._recycle&&(u._workerPool.recycleWorker(r),u._workerPool.getWorker(r).then(_.noop)),s(!e.data.error))}}u._sendToWorker(c,JSON.stringify({type:"in:stop",data:t})),u._teardown||s(!0)}},closing:_.noop,start:function(e,l){if(e("success")){let o="",a=(c.process.stdout.removeAllListeners("data"),c.process.stdout.on("data",s=>{try{var r=s&&s.toString("utf8")||"";o+=r;let e,t;for(;-1!==(e=o.indexOf(d))&&-1!==(t=o.indexOf(h));){if(t>e){var i=o.substring(e+d.length,t);try{var n=JSON.parse(i);c.expectedPong&&c.expectedPong(n),c.expectedClose&&c.expectedClose(n),u._workerPool.onMessage(n,{},e=>{u._sendToWorker(c,e)})}catch(e){p("Error while processing STDOUT message: "+e.message)}}o=o.substring(t+h.length)}}catch(e){p("Error while processing STDOUT message: "+e.message),o=""}}),"");c.process.stderr.removeAllListeners("data"),c.process.stderr.on("data",e=>{try{var s=e&&e.toString("utf8")||"";if(0!==s.indexOf("Debugger listening on port")){a+=s;let e,t;for(;-1!==(e=a.indexOf(d))&&-1!==(t=a.indexOf(h));){if(t>e){var r,i=a.substring(e+d.length,t);if(i.includes("###wpm###"))try{var n=JSON.parse(i);l(n.message,n.stack,n.actual,n.expected)}catch(e){p("Error while processing STDERR message: "+e.message)}else i&&(r=i.split("\n").filter(e=>!e.trimStart().startsWith("at")).join("\n"),/error/i.test(r)||/fail/i.test(r)?l(r,i):console.warn("STDERR: "+r))}a=a.substring(t+h.length)}}}catch(e){p("Error while processing STDERR message: "+e.message),a=""}});e={sessionId:t,tests:n.tests,files:_.reduce(n.allFiles.concat(n.allTestFiles),(e,t)=>{var s,r,i;return _.isNumber(t.id)&&(s={id:t.id,rangesLength:t.rangesLength},e.push(s),u._zeroConfigJest||u._vitest||u._nodeNative)&&(s.path=t.normalizedRelativePath,s.parentFilePath=t.parentFilePath,s.childFilePath=t.childFilePath,s.numberOfFunctions=t.numberOfFunctions,s.ts=t.ts,s.runnerCacheKey=t.runnerCacheKey,s.inOriginalFilesCache=t.inOriginalFilesCache,s.instrument=t.instrument,s.logMarkers=t.logMarkers,s.extractedComments=t.extractedComments,t.test)&&(s.test=!0,r=!(t.relatedFilesWithTests||u._project.hadGlobalErrorsPreviousRun()||u._project.settings().runAllTestsInAffectedTestFile||n.fullRun),i=t.changeStart&&t.changePosition&&r,s.allowedToRunSingleTestOnly=r||void 0,i)&&(s.changeStart=t.changeStart,s.changePosition=t.changePosition),e},[]),testFiles:_.map(n.testFilesToLoad,function(e){var t;return 0===u._testFramework.version.indexOf("jest")&&(t=(t=u._project._getFileMetadataById(e.originalId||e.id))&&t.getFileLineMap()),{path:e.path,id:e.originalId||e.id,type:e.type,originalType:e.originalType,content:process.env.quokka?e.content:void 0,lineMap:t,logMarkers:u._viteNode?e.logMarkers:void 0,extractedComments:u._viteNode?e.extractedComments:void 0,esm:process.env.quokka?e.esm:void 0}}),root:u._cwd,localProjectDir:u._localProjectDir,flushCache:!1,initializer:u._initializer,teardown:u._teardown,slowTestThreshold:u._slowTestThreshold,manualTestRun:n.manualRun,updateSnapshotsRun:n.updateSnapshotsRun,profileRun:n.profileRun||void 0,reportUnhandledPromises:u._reportUnhandledPromises,maxLogEntrySize:u._maxLogEntrySize,maxTraceSteps:u._maxTraceSteps,maxTraceStepsForWatchExpressionPrefetch:u._maxTraceStepsForWatchExpressionPrefetch,expressionsToEvaluate:n.expressionsToEvaluate,hints:u._project.settings().hints,autoConsoleLog:u._project.settings().autoConsoleLog,captureConsoleLog:u._project.settings().captureConsoleLog,preserveComments:u._project.settings().preserveComments,reportConsoleErrorAsError:u._project.settings().reportConsoleErrorAsError,suppressClearingRequireCache:u._zeroConfigJest||void 0,traceContext:n.traceContext||void 0,suppressCallStackEval:!!process.env.quokka||void 0,updateNoMoreThanOneSnapshotPerTestFileRun:u._project.settings().updateNoMoreThanOneSnapshotPerTestFileRun||void 0,runGlobals:n.runGlobals||!1,processEnvUpdates:n.processEnvUpdates,customJestConfig:u._project.settings().customJestConfig||void 0,symlinkNodeModules:u._project.settings().symlinkNodeModules,resolveGetters:u._project.settings().resolveGetters,autoExpandAllLogs:u._project.settings().autoExpandAllLogs||void 0,snapsAutoRun:process.env.quokka&&(null==(e=u._project.settings().quokka)?void 0:e.snapsAutoRun)||void 0,noLogThrottling:u._project.settings().noLogThrottling||void 0,esmHooks:u._project.settings().esmHooks,preloadModules:u._project.settings().preloadModules,v2:!!process.env.WALLABY2||void 0};u._sendToWorker(c,JSON.stringify({type:"in:run",data:e}))}}},name:e,sessionId:t,workerId:r}))})}_sandboxName(e,t){return"worker #"+e+", session #"+t}_sendToWorker(e,t){e.process.stdin.write(d+t+h)}}},{"./runWorkerPool":77,"./utils":88,child_process:void 0,path:void 0}],60:[function(p,e,t){var u=p("path"),d=p("util"),h=p("./utils").default;const r=p("./runners/node/teardown");var s=p("./utils/remapComments").default,g=(h.remapComments=s,JSON.stringify),o=JSON.parse;const a="###wms###",l="###wme###";function i(e){e&&c(a+e+l)}var n=process.stderr.write.bind(process.stderr),f=function(e){var t="";"string"!=typeof(e=e||"")?(t=e.stack||e.message||e.toString&&e.toString()||"",e.message&&!~t.indexOf(e.message)&&(t=e.message+"\n"+t)):t=e,n(a+t+l)},c=process.stdout.write.bind(process.stdout),m=(global.emitDiagnostic=function(e){e._diagnostic=1,e._p="###wpm###",i(g(e))},{send:function(e){i(e)}});process.exit=function(){};var _=p("module").Module._cache,v=process.cwd(),y=[],b=[],w=p("timers").setTimeout,k=p("timers").setInterval,x=process.nextTick;p("timers").setTimeout=global.setTimeout=function(){var e=w.apply(this,arguments);return y.push(e),e},process.env.quokka&&(p("timers").setInterval=global.setInterval=function(){var e=k.apply(this,arguments);return b.push(e),e});try{d.promisify.custom&&d.promisify.custom&&(global.setTimeout[d.promisify.custom]=w[d.promisify.custom])}catch(e){}var S=function(e){if("string"==typeof e)f(e);else{var t="";e||f("");try{if(global.$_$tracer&&(e.stack||e.message))return t=global.$_$tracer.setAssertionData({actual:e.actual,expected:e.expected,showDiff:!0},{message:e.message,stack:e.stack,_p:"###wpm###"}),void global.$_$tracer.reportHighPriorityGlobalErrorObject(t)}catch(e){}"[object Object]"===(t=t||e&&(e.stack||e.message||e.diagnosticText||e.toString&&e.toString()||g(e))||"")&&e&&(t="Runtime error: "+g(e)),f(t||"")}};function P(e){S(e),process.env.quokka&&process.emit("beforeExit")}function F(){~process.listeners("uncaughtException").indexOf(P)||process.on("uncaughtException",P)}F();function C(e,t,s,r,i,n,o,a,l,c){var u=this;u._port=t,u._id=parseInt(e,10),global.$_$logLimits=JSON.parse(l),u._connect(function(){function e(){global._=p("lodash"),global._.extend(global._,p("./utils")),global._.str=p("underscore.string"),global._.mixin(global._.str.exports()),h.instrument=p("./instrumentor").default,global.$_$tracer.workerId=u._id}global.$_$reuseableTracer=!0,global.$_$receiver={send(e){m.send(g(e))}},p("./tracer"),global.$_$receiver.onopen&&global.$_$receiver.onopen(),global.$_$tracer._onStart=()=>{},global.$_$tracer._utils=h,global.$_$tracer._handleUncaughtException=F,~s.indexOf("quokka")&&(global._quokkaLazyLoadHelperFunctions=e),(~s.indexOf("jest")||~s.indexOf("vitest"))&&(e(),process.exit=function(e){e&&~s.indexOf("jest")&&S(new Error("process.exit called with "+e))}),global.wallaby._frameworks={chai:{},sinon:{},quibble:{}},global.wallaby._originalCacheRoot=n,global.wallaby._localNodeModules=i,global.wallaby._testFrameworkPath=r,global.wallaby._testConfigFile=a,global.wallaby._fileExtensionsAdded=!1,global.wallaby._regeneratorRuntime=o,global.wallaby._toolVersion=c,u.profileRunInTestWorker=!~s.indexOf("vitest"),process.stdout.write=function(){},process.stderr.write=function(e){if("string"==typeof(e=Buffer.isBuffer(e)?e.toString("utf8"):e)&&0===(e=e.trimEnd()).split("\n").filter(e=>-1===e.indexOf("ExperimentalWarning:")&&-1===e.indexOf("node --trace-warnings")).join("\n").length)return;emitDiagnostic({name:"nodeRunnerStdErr",message:e})},u._testFrameworkInitializer=p("./runners/node/"+s.split(",")[0]+"/initializer.js")}),global.$_$tracer._highPriorityReceiver=m,global.$_$tracer._onReceiverClosed=e=>{e?global.$_$tracer._onReceiverClosedCallback=e:global.$_$tracer._onReceiverClosedCallback&&(global.$_$tracer._onReceiverClosedCallback(),delete global.$_$tracer._onReceiverClosedCallback)},global.$_$tracer.unref=()=>{process.versions.bun&&u._referenceToKeepProcessAlive&&clearInterval(u._referenceToKeepProcessAlive),process.stdin.pause()},global.$_$tracer.ref=()=>{process.versions.bun&&(u._referenceToKeepProcessAlive=k(()=>{},864e5),u._referenceToKeepProcessAlive.ref()),process.stdin.resume()},global.$_$tracer._nodeUtil=d,u._patchFrameworks()}var T=function(){process.on("unhandledRejection",function(e){throw e})};C.prototype={send:function(e){m.send(g(e))},_connect:function(e){var i=this;e&&e(),m.send(g({worker:i._id.toString()}));let n="";process.stdin.on("data",function(e){n+=e.toString();let t,s;for(;-1!==(t=n.indexOf(a))&&-1!==(s=n.indexOf(l,t));)try{var r=o(n.substring(t+a.length,s).trim());i[r.type](r.data)}catch(e){}finally{n=n.substring(s+l.length)}}),process.stdin.resume()},"in:connected":function(){this._onConnected&&this._onConnected(),delete this._onConnected},"in:teardown":async function(){global.wallaby.teardown&&await global.wallaby.teardown()},"in:run":function(s){s.reportUnhandledPromises&&T&&(T(),T=void 0),global.$_$coverage=[],s.suppressClearingRequireCache||Object.keys(_).forEach(function(e){var t=_[e];(t.filename&&~t.filename.indexOf(s.root)||s.flushCache)&&delete _[e]}),global.$_$tracer._filePathToFileData={},global.$_$tracer._hints=s.hints,global.$_$tracer._autoConsoleLog=s.autoConsoleLog,global.$_$tracer._captureConsoleLog=s.captureConsoleLog,global.$_$tracer._preserveComments=s.preserveComments,global.$_$tracer._reportConsoleErrorAsError=s.reportConsoleErrorAsError,global.$_$tracer._suppressCallStackEval=s.suppressCallStackEval,global.$_$tracer._updateNoMoreThanOneSnapshotPerTestFileRun=s.updateNoMoreThanOneSnapshotPerTestFileRun,global.$_$tracer._autoExpandAllLogs=s.autoExpandAllLogs,s.noLogThrottling&&(global.$_$tracer._formattingOpts=(e,t)=>t),s.v2&&!global.$_$tracer.v2&&global.$_$tracer.initV2();for(var e=0,t=s.files.length;e<t;e++){for(var r=s.files[e],i=global.$_$coverage[r.id]=[],n=0;n<r.rangesLength;n++)i[n]={};r.path&&(global.$_$tracer._filePathToFileData[r.path]=r)}global.$_$baseDir=s.root+u.sep,global.$_$slow=s.slowTestThreshold,global.$_$tests=s.tests;var o=(s.testFiles||[]).map(function(e){return e.path});global.$_$testFiles=s.testFiles,global.wallaby.tests=o,global.$_$session=s.sessionId,global.$_$initialSpecId=1e5*(this._id+1)||1,global.$_$traceContext=s.traceContext,global.$_$profileRun=s.profileRun,global.$_$resolveGetters=s.resolveGetters,global.$_$snapsAutoRun=s.snapsAutoRun||void 0,global.$_$tracer._shouldReportProgramScope=!0,global.$_$tracer.initLoadingPhase(),global.$_$tracer._maxLogEntrySize=s.maxLogEntrySize||global.$_$tracer._maxLogEntrySize,global.$_$tracer._maxTraceSteps=s.maxTraceSteps||global.$_$tracer._maxTraceSteps,global.$_$tracer._maxTraceStepsForWatchExpressionPrefetch=void 0!==s.maxTraceStepsForWatchExpressionPrefetch?s.maxTraceStepsForWatchExpressionPrefetch:global.$_$tracer._maxTraceStepsForWatchExpressionPrefetch,global.$_$tracer._reportError=S;try{global.wallaby.testFramework=this._testFrameworkInitializer.init(o)}catch(e){S(e)}if(global.$_$tracer.reportGlobalError=f,global.wallaby.localProjectDir=s.localProjectDir,global.wallaby.projectCacheDir=v,global.wallaby.sessionId=s.sessionId,global.wallaby.workerId=this._id,global.wallaby.runGlobals=s.runGlobals,global.wallaby.customJestConfig=s.customJestConfig,global.wallaby.preloadModules=s.preloadModules,global.wallaby.esmHooks=s.esmHooks,global.$_$tracer._manualTestRun=s.manualTestRun,global.$_$tracer._updateSnapshotsRun=s.updateSnapshotsRun,global.$_$tracer._expressionsToEvaluate=s.expressionsToEvaluate||{},s.processEnvUpdates&&(s.processEnvUpdates.updates&&s.processEnvUpdates.updates.forEach(e=>{process.env[e.variable]=e.value}),s.processEnvUpdates.deletions)&&s.processEnvUpdates.deletions.forEach(e=>{delete process.env[e]}),s.symlinkNodeModules)try{const l=p("fs");var a=e=>{e=u.resolve(e);return l.realpathSync(e)};a(process.cwd())===a(s.localProjectDir)||l.existsSync(u.join(process.cwd(),"node_modules"))||l.symlinkSync(u.join(s.localProjectDir,"node_modules"),"node_modules","dir")}catch(e){}try{console._times&&console._times.clear()}catch(e){}try{if(p("./runners/node/bootstrap")(s.initializer),global.$_$profileRun&&this.profileRunInTestWorker){const c=new(p("inspector").Session);c.connect(),c.post("Profiler.enable",()=>{c.post("Profiler.start",()=>{global.$_$tracer.start()})}),global.$_$tracer._profileSession=c}else global.$_$tracer.start();this._teardown=s.teardown}catch(e){S(e)}},"in:stop":function(t){var e;global.$_$profileRun&&(global.$_$tracer._profileSession?(global.$_$tracer._profileSession.post("Profiler.stop",(e,{profile:t})=>{e?S(e):this.send({type:"profile",data:t})}),delete global.$_$tracer._profileSession):global.$_$tracer._profileResult&&(this.send({type:"profile",data:global.$_$tracer._profileResult}),delete global.$_$tracer._profileResult));try{process.nextTick!==x&&(process.nextTick=x),global.$_$tracer.reset(),global.$_$tracer.resetEnvGlobal();try{console._times&&console._times.clear()}catch(e){}e=r(this._teardown),delete this._teardown}catch(e){S(e)}const s=e=>{y.forEach(function(e){clearTimeout(e)}),y.length=0,b.forEach(function(e){clearInterval(e)}),b.length=0,delete global.$_$coverage,delete global.$_$tests,delete global.$_$session,delete global.$_$initialSpecId,delete global.$_$profileRun,this.send({type:"closed",data:{requestId:t,error:e}})};e instanceof Promise?e.then(()=>s(!1)).catch(e=>{S(e),s(!0)}):s(!1)},"in:ping":function(e){var t=()=>this.send({type:"pong",data:e});process.env.quokka&&global.$_$tracer._asyncCodeMayBeExecuting?global.$_$tracer._pong=t:t()},"in:tracer.resume":function(){global.$_$tracer.resume()},_patchFrameworks:function(){h.patchModule("resolve",e=>{var e=e("resolve"),t=e.sync;return e.sync=function(){var e=arguments[1]=arguments[1]||{};return e.paths=e.paths||[],Array.isArray(e.paths)&&(e.paths=e.paths.concat([global.wallaby._localNodeModules]).concat(process.env.NODE_PATH?process.env.NODE_PATH.split(u.delimiter):[])),t.apply(this,arguments)},e}),h.patchModule("./util/core/wrap-method",e=>{var s=e("./util/core/wrap-method");return s&&s.toString&&~s.toString().indexOf("sinon")?function(e){var t=s.apply(this,arguments);return wallaby._frameworks.sinon.stubs.push(t),t}:s}),h.patchModulesCode([{files:["pretty-format/build/index.js"],replacements:[{from:"options && options.highlight",to:"options && options.highlight && false",optional:!0}]},{files:["@testing-library/react-native/build/helpers/format.js"],replacements:[{from:"function shouldHighlight() {",to:"function shouldHighlight() { return false;",optional:!0}]},{files:["@testing-library/react-native/build/helpers/debugDeep.js"],replacements:[{from:"console.log(`${message}\n\n`, (0, _format.default)(instance, formatOptions));",to:"const __output = (0, _format.default)(instance, formatOptions); console.log(`${message}\n\n`, __output); return __output;",optional:!0},{from:"console.log((0, _format.default)(instance, formatOptions));",to:"const __output = (0, _format.default)(instance, formatOptions); console.log(__output); return __output;",optional:!0}]},{files:["@testing-library/react-native/build/helpers/debugShallow.js"],replacements:[{from:"console.log(`${message}\n\n`, (0, _format.default)(output));",to:"const __output = (0, _format.default)(output); console.log(`${message}\n\n`, __output); return __output;",optional:!0},{from:"console.log((0, _format.default)(output));",to:"const __output = (0, _format.default)(output); console.log(__output); return __output;",optional:!0}]},{files:["@testing-library/dom/dist/pretty-dom.js"],replacements:[{from:"highlight: inNode()",to:"highlight: false",optional:!0},{from:"highlight: shouldHighlight(),",to:"highlight: false,",optional:!0},{from:"const logDOM = (...args) =>",to:"const logDOM = (...args) => (console.log(prettyDOM(...args)), prettyDOM(...args));const logDOM_ = (...args) =>",optional:!0}]},{files:["@testing-library/react/dist/pure.js"],replacements:[{from:"el.forEach(e => console.log((0, _dom.prettyDOM)(e, maxLength, options)))",to:"el.map(e => (console.log((0, _dom.prettyDOM)(e, maxLength, options)), _dom.prettyDOM(e, maxLength, options)))",optional:!0},{from:"console.log((0, _dom.prettyDOM)(el, maxLength, options))",to:"(console.log((0, _dom.prettyDOM)(el, maxLength, options)), _dom.prettyDOM(el, maxLength, options))",optional:!0}]},{files:["@testing-library/react-native/build/helpers/format.js"],replacements:[{from:"highlight: true",to:"highlight: false",optional:!0}]},{files:["@testing-library/react-native/build/helpers/debugDeep.js"],replacements:[{from:"console.log((0, _format.default)(instance));",to:"return (console.log((0, _format.default)(instance)), _format.default(instance));",optional:!0}]},{files:["@testing-library/react-native/build/helpers/debug-deep.js"],replacements:[{from:"console.log(`${message}\n\n`, (0, _format.default)(instance, formatOptions));",to:"console.log(`${message}\n\n`, (0, _format.default)(instance, formatOptions)); return _format.default(instance, formatOptions);",optional:!0},{from:"console.log((0, _format.default)(instance, formatOptions));",to:"console.log((0, _format.default)(instance, formatOptions)); return _format.default(instance, formatOptions);",optional:!0}]}])}},e.exports=function(e,t,s,r,i,n,o,a,l,c){new C(e,t,s,r,i,n,o,a,l,c)}},{"./instrumentor":57,"./tracer":80,"./utils":88,"./utils/remapComments":91,fs:void 0,inspector:void 0,lodash:void 0,module:void 0,path:void 0,timers:void 0,"underscore.string":void 0,util:void 0}],61:[function(u,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Runner=void 0;const l=logger.create("phantomRunner")["debug"];var o=u("phantom");const s=u("./runWorkerPool"),r=u("./browserEnvironment"),p=u("./utils");var a=!1;t.Runner=class{constructor(e){this._project=e,this.screenShotReady=Promise.resolve(),this._params=e.settings().env.params,this._viewportSize=e.settings().env.viewportSize,this._clearMemoryCache=e.settings().env.clearMemoryCache,this._phantomjsPath=e.settings().env.runner,this._workerPool=new s.WorkerPool(this._project,{create:_.bind(this._createPhantomInstance,this),recycle:_.bind(this._recyclePhantomInstance,this),healthy:_.bind(this._isPhantomInstanceHealthy,this),prepare:_.bind(this._prepare,this)}),this._browserEnvironment=new r.BrowserEnvironment(e,this._workerPool)}run(e){return this._workerPool.run(e)}_createPhantomInstance(s,t){var r=this;try{var e={dnodeOpts:{weak:!1}},i=(r._phantomjsPath&&(e.binary=r._phantomjsPath),e.onExit=function(e,t){return"SIGSEGV"!==t||a||(emitDiagnostic({name:"genericError",message:"Looks like the PhantomJs version being used is not supported on your OS.\nTry using a different PhantomJs version (https://wallabyjs.com/docs/integration/phantomjs2.html)\nor Chromium/V8 via Electron runner (https://wallabyjs.com/docs/integration/electron.html)"}),a=!0),l("Signal killed phantomjs #%s: %s, exit code: %s",s,t,e)},["--disk-cache=yes","--web-security=false"]),n=(r._params.runner&&(i=i.concat(_.filter(r._params.runner.split(" "),function(e){return!(!e||~e.indexOf("--disk-cache=")||~e.indexOf("--web-security="))}))),!1);i.push(function(e){if(!n){if(!e)return n=!0,l("Additional attempt to create phantom instance #%s",s),r._createPhantomInstance(s,t);e.set("onError",function(e){l("PhantomJs failure: %s, recycling phantom instance #%s",e,s),r._workerPool.recycleWorker(s)}),n=!0,t(e)}}),i.push(e),o.create.apply(o,i)}catch(e){l("Error while creating worker #%s: %s",s,e&&(e.stack||e.message)),t()}}_recyclePhantomInstance(e){e.exit(),e.process.kill()}_isPhantomInstanceHealthy(e){return e.process&&e.process.pid&&!e.process.killed&&!e.process.signal&&null===e.process.exitCode}_prepare(r,t){var i=this,n=_.randomId(),o=i._browserEnvironment.sandboxName(t,n);return l("Starting sandbox [%s]",o),Promise.resolve().then(function(){return i._workerPool.cancelled()?Promise.reject({runCancelled:!0}):(l("Preparing sandbox [%s]",o),Promise.all([i._getPage(t),i._browserEnvironment.prepareSandbox(r,n,t)]))}).then(function(e){l("Prepared sandbox [%s]",o);var c=e[0],s=e[1];return Promise.resolve({instance:{resume:function(){c.evaluate(function(){$_$tracer.resume()})},ping:function(e){c.evaluate(function(){},e)},close:function(e){c.stop&&c.stop(),c.close(),e(!0)},closing:function(){i._captureScreenShot(r.screen,c)},start:function(t,e){i._clearMemoryCache&&c.onResourceRequested(function(e,t,s){try{var r,i,n,o,a=global._urlUtil=global._urlUtil||u("url"),l=e.url;!l||0===l.indexOf("data:")||~l.indexOf("wallabyFileId")||(n=(i="/"===(r=a.parse(e.url)).pathname.charAt(0)?r.pathname.substr(1):r.pathname)&&s[i])&&(o=r.search&&r.search.length,t.changeUrl(l+(o?"&":"?")+n.ts+"&wallabyFileId="+n.id),c.clearMemoryCache())}catch(e){emitDiagnostic({name:"genericWarning",message:p.default.formatWithoutColors(["Error while clearing memory cache",e&&e.message])})}},_.noop,r.allFilesHash),c.set("onError",e),c.open(s,function(e){t(e)&&c.evaluate(function(){$_$tracer.start()})})}},name:o,sessionId:n,workerId:t})})}cancel(e){return this._workerPool.cancel(e)}start(){return this._workerPool.start(this._browserEnvironment.webApp())}stop(){this._workerPool.stop()}_captureScreenShot(e,t){if(e){var s=Q.defer();try{t.render(e,function(){s.resolve()}),this.screenShotReady=s.promise}catch(e){s.reject(new Error("Failed to render test run screen shot")),emitDiagnostic({name:"genericError",message:p.default.formatWithoutColors(["Failed to render test run screen shot",e.message])})}}}_getPage(t){var s=this;return s._workerPool.getWorker(t).then(function(e){return s._workerPool.cancelled()?Promise.reject({runCancelled:!0}):e instanceof Error||e.runCancelled?Promise.reject(e):(l("Creating page for worker #"+t),s._createPage(e,t))})}_createPage(n,o){var a=this;return new Promise(function(t,s){var r=!1,e=setTimeout(function(){r||(i(),a._workerPool.recycleWorker(o),l("Phantom page is not created in time, recycling it"),s({runCancelled:!0,rerun:!0}))},400),i=function(){r=!0,clearTimeout(e)};try{n.createPage(function(e){r||(i(),l("Phantom page created"),e.set("viewportSize",a._viewportSize||{width:800,height:600}),t(e))})}catch(e){i(),s(e)}})}}},{"./browserEnvironment":12,"./runWorkerPool":77,"./utils":88,phantom:void 0,url:void 0}],62:[function(e,t,s){t.exports=class{constructor(e,t){this._read=e,this._fs=t}stat(){return this._fs.stat.apply(this._fs,arguments)}statSync(){return this._fs.statSync.apply(this._fs,arguments)}readdir(){return this._fs.readdir.apply(this._fs,arguments)}readdirSync(){return this._fs.readdirSync.apply(this._fs,arguments)}readlink(){return this._fs.readlink.apply(this._fs,arguments)}readlinkSync(){return this._fs.readlinkSync.apply(this._fs,arguments)}readFile(e,t,s){e=this._read(e);e?("function"==typeof t&&(s=t,t=null),e.getContent().then(function(e){s(null,t?e:Buffer.from(e))}).catch(function(e){s(e)})):this._fs.readFile.apply(this._fs,arguments)}readFileSync(e,t){var e=this._read(e);return e?(e=e.getContentSync(),t?e:Buffer.from(e)):this._fs.readFileSync.apply(this._fs,arguments)}readJson(e,s){this.readFile(e,(e,t)=>{if(e)s(e);else{let e;try{e=JSON.parse(t.toString("utf-8"))}catch(e){return void s(e)}s(null,e)}})}readJsonSync(e){e=this.readFileSync(e);return JSON.parse(e.toString("utf-8"))}purge(){return this._fs.purge.apply(this._fs,arguments)}}},{}],63:[function(e,t,s){const y=e("path"),b=e("os"),w=e("util.promisify"),r=e("./InputFileSystem"),o=e("./loader"),i=e("../../utils").default,a="WallabyPlugin";let k=process.cwd();k.endsWith("/")&&(k=k.substring(0,k.length-1));const x=y.join(process.cwd(),"wallaby-webpack-entry.js");class n{constructor(e){this._setupFileByFullPath=e}apply(e){e.ensureHook("file").tapAsync(a,(e,t,s)=>{return e.path===x?s(null,{path:x}):(e=this._setupFileByFullPath.get(e.path))&&"string"!=typeof e?s(null,{path:e.fullPath}):void s()})}}class l{constructor(){}apply(e){const r="./node_modules/"+o.pre.id,i="./node_modules/"+o.post.id,n="./node_modules/"+o.single.id;e.ensureHook("file").tapAsync(a,(e,t,s)=>e.relativePath===r?s(null,{path:o.pre.id}):e.relativePath===i?s(null,{path:o.post.id}):e.relativePath===n?s(null,{path:o.single.id}):void s())}}t.exports=class{constructor(e,t,s){if(!e)throw new Error("webpack parameter is mandatory.");this._webpack=e,this._configuration=t||{},s=s||{},Array.isArray(s.setupFiles)||(s.setupFiles=[]),this._setupFiles=[],this._setupFileByFullPath=new Map;for(let e=0;e<s.setupFiles.length;e++){const i=s.setupFiles[e];var r;"string"==typeof i?this._setupFileByFullPath.get(i)||(r=y.resolve(i),this._setupFiles.push(r),this._setupFileByFullPath.set(r,r)):i.code&&i.path&&(r={fullPath:y.resolve(i.path),getContent:async()=>i.code,getContentSync:()=>i.code,ts:(new Date).getTime()},this._setupFileByFullPath.get(r.fullPath)||(this._setupFiles.push(r),this._setupFileByFullPath.set(r.fullPath,r)))}s.mapResourceToPath&&(this._mapResourceToPath=s.mapResourceToPath)}async process(t){this._logger=t.logger,this._logger.debug("Processing started."),this._settings=t.settings;let s=new Map;this._deletedFilePaths=new Set;var e=!!this._compilation;let r;if(e){if(t.anyFilesAdded||t.anyFilesDeleted){this._dependecyFileIdsByFileId={},this._moduleIdByFileFullPath=new Map,this._filePathByModuleId={},this._testFilePathByModuleId={},this._testFileModuleIdByPath={},this._initializeEntry(t.allTestFiles),t.allFiles.forEach(e=>s.set(e.fullPath,e)),t.anyFilesDeleted&&this._fileByFullPath.forEach((e,t)=>s.has(t)?{}:this._deletedFilePaths.add(t)),this._fileByFullPath=s,this._affectedFileByFullPath=s;const m=this._compilation.compiler.inputFileSystem;t.affectedFiles.forEach(e=>m.purge(e.fullPath)),this._deletedFilePaths.forEach(e=>m.purge(e))}else t.affectedFiles.forEach(e=>s.set(e.fullPath,e)),this._affectedFileByFullPath=s;r=this._compilation.compiler}else this._logger.debug("Initializing."),t.allFiles.forEach(e=>s.set(e.fullPath,e)),this._fileByFullPath=s,this._affectedFileByFullPath=s,this._dependecyFileIdsByFileId={},this._moduleIdByFileFullPath=new Map,this._filePathByModuleId={},this._testFilePathByModuleId={},this._testFileModuleIdByPath={},this._compilation=null,this._initializeEntry(t.allTestFiles),this._sanitizeConfiguration(),this._adjustConfiguration(t.timestamp),r=this._createCompiler(),this._customizeCompiler(r);this._prepareCompiler(e,t.anyFilesAdded,t.anyFilesDeleted,t.affectedFiles,r);var i=w(r.compile).bind(r),n=(this._logger.debug("Compilation started%s.",e?" (incremental)":""),await i(),this._compilation);if(n.errors.length){let e;try{e=this._formatErrors(n)}catch(e){throw n.errors[0]}throw new Error(e)}this._logger.debug("Compilation finished.");var o=[];function a(e){return e.buildMeta&&e.buildMeta["aurelia-id"]?e.buildMeta["aurelia-id"]:e.id}for(const _ of(!e||t.anyFilesAdded||t.anyFilesDeleted?n:n.wallaby).modules)if("runtime"!==_.type&&_.resource!==x){var l=this._mapResourceToPath?this._mapResourceToPath(_):_.resource;if(!this._deletedFilePaths.has(l)){this._logger.trace("Processing module %s (%s).",_.id,_.resource||_.userRequest),"string"==typeof l&&(l.startsWith(k)?this._filePathByModuleId[_.id]="."+l.substring(k.length):this._filePathByModuleId[_.id]=l);let e=this._affectedFileByFullPath.get(l)||this._fileByFullPath.get(l);var c,u,p,d,h=_.wallaby||{},g=this._renderModule(n,_);g?(c=(c=_.resourceResolveData&&_.resourceResolveData.patch)?c(g.source()):g.source(),u=g.map(),p=a(_),e&&e.test&&(d=[],this._traverseDependencies(n,_,d),this._dependecyFileIdsByFileId[e.id]=d),d=g.moduleArgument||_.moduleArgument||"module",g=_.exportsArgument||"exports, __webpack_exports__",o.push(t.createFile({path:e?`${e.path}${e.test?"":"."+_.id}.wbp.js`:y.join("__modules",_.id+".js"),original:e,content:`window.__moduleBundler.modules[${JSON.stringify(p)}] = function(__wallaby_webpack_module__, __wallaby_webpack_export__, __webpack_require__) { (function(${d}, ${g}, __webpack_require__) { ${_.strict?'"use strict";':""}${c}${b.EOL}})(${d.split(",").map(()=>"__wallaby_webpack_module__").join(",")}, ${g.split(",").map(()=>"__wallaby_webpack_export__").join(",")}, __webpack_require__); }`,sourceMap:u,ranges:h.ranges,extra:{sourceMap:h.map,testName:h.testName,loggedRanges:h.loggedRanges,numberOfFunctions:h.numberOfFunctions,includedTestFile:h.includedTestFile,excludedTestFile:h.excludedTestFile,notInstrumentedLogMarkers:h.notInstrumentedLogMarkers,liveCommentLines:h.liveCommentLines,usedLogpoints:h.usedLogpoints}})),e||(e=this._setupFileByFullPath.get(l))&&"string"==typeof e&&(e={fullPath:e}),e&&(this._moduleIdByFileFullPath.set(e.fullPath,p),e.test)&&(this._testFilePathByModuleId[_.id]=e.path,this._testFileModuleIdByPath[e.path]=_.id)):this._logger.trace("Ignoring module %s (%s).",_.id,_.resource||_.userRequest)}}if(!e||t.anyFilesAdded||t.anyFilesDeleted){o.push(t.createFile({order:-1,path:"____wallaby-webpack.js",content:this._templates.webpack()})),o.push(t.createFile({order:-.99,path:"____wallaby-webpack-bootstrapper.js",content:this._templates.bootstrapper(this._testFileModuleIdByPath,this._testFilePathByModuleId,this._filePathByModuleId)}));var f=[];for(const v of this._setupFiles){let e;if((e="string"==typeof v?(e=this._fileByFullPath.get(v))||{fullPath:v}:v)&&!e.test){const a=this._moduleIdByFileFullPath.get(e.fullPath);a&&f.push(`window.__moduleBundler.require(${JSON.stringify(a)});`)}}f.length&&o.push(t.createFile({path:"____wallaby-webpack-setup.js",order:1/0,content:f.join(b.EOL)}))}return this._logger.debug("Emitting %s files.",o.length),await Promise.all(o),this._logger.debug("Processing finished."),{testDependencies:this._dependecyFileIdsByFileId}}get _templates(){throw new Error("Not implemented abstract member.")}_initializeEntry(e){this._logger.debug("Initializing entry.");var t=[];for(const s of this._setupFiles){let e;(e="string"==typeof s?(e=this._fileByFullPath.get(s))||{fullPath:s}:s)&&!e.test&&t.push(`require('${i.normalizePath(e.fullPath)}');`)}for(const r of e)t.push(`require('./${r.path}');`);this._entry={path:x,ts:(new Date).getTime(),content:t.join(b.EOL)}}async shutdown(){if(this._compilation){const e=this._compilation.compiler;if(e&&e.close)return new Promise((t,s)=>{e.close(e=>{e?s(e):t()})})}return Promise.resolve()}_sanitizeConfiguration(){this._logger.debug("Sanitizing configuration.");var e=this._configuration;e.module||(e.module={}),e.plugins||(e.plugins=[]),e.resolve||(e.resolve={}),e.resolveLoader||(e.resolveLoader={}),e.resolve.plugins||(e.resolve.plugins=[]),e.resolveLoader.plugins||(e.resolveLoader.plugins=[]),e.optimization||(e.optimization={}),e.entry={main:x},e.mode="none",e.devtool="source-map"}_adjustConfiguration(){this._logger.debug("Adjusting configuration.");var e=this._configuration,t=e.plugins;const s=e=>{var t;return e===x?{getContent:async()=>this._entry.content,getContentSync:()=>this._entry.content}:(t=this._setupFileByFullPath.get(e))&&"string"!=typeof t?t:this._affectedFileByFullPath.get(e)||this._fileByFullPath.get(e)};t.unshift(e=>{e.inputFileSystem=new r(s,e.inputFileSystem)}),t.unshift(new this._webpack.DefinePlugin({"process.env.NODE_ENV":JSON.stringify("development")})),e.resolve.plugins.unshift(new n(this._setupFileByFullPath)),e.resolveLoader.plugins.unshift(new l);t=e.optimization;void 0===t.removeAvailableModules&&(t.removeAvailableModules=!1),void 0===t.removeEmptyChunks&&(t.removeEmptyChunks=!1),void 0===t.mergeDuplicateChunks&&(t.mergeDuplicateChunks=!1),void 0===t.providedExports&&(t.providedExports=!1),void 0===t.splitChunks&&(t.splitChunks=!1)}_createCompiler(){return this._logger.debug("Creating compiler."),this._webpack(this._configuration)}_customizeCompiler(e){this._logger.debug("Customizing compiler."),e.hooks.normalModuleFactory.tap(a,e=>{this._customizeNormalModuleFactory(e)}),e.hooks.thisCompilation.tap(a,e=>{this._initializeCompilation(e),this._customizeCompilation(e)})}_customizeNormalModuleFactory(e){e.hooks.createModule.tap(a,e=>{var t,s;"stylable"!==e.type&&(t=e.loaders,0<e.loaders.length?(e=t[0].loader,s=t[t.length-1].loader,e!==o.post.id&&t.unshift({loader:o.post.id,options:null}),s!==o.pre.id&&t.push({loader:o.pre.id,options:null})):t.push({loader:o.single.id,options:null}))})}_initializeCompilation(e){throw new Error("Not implemented abstract member.")}_customizeCompilation(t){t.wallaby={load:e=>{e=this._mapResourceToPath?this._mapResourceToPath(e):e.resource;return this._affectedFileByFullPath.get(e)||this._fileByFullPath.get(e)},settings:this._settings,logger:this._logger,files:new Set,modules:[]},t.hooks.buildModule.tap(a,e=>{this._logger.trace("Compiled %s.",e.resource||e.userRequest),t.wallaby.modules.push(e)}),t.hooks.shouldGenerateChunkAssets.tap(a,()=>!1)}_prepareCompiler(e,t,s,r,i){}_renderModule(e,t){throw new Error("Not implemented abstract member.")}_traverseDependencies(e,t,s,r){throw new Error("Not implemented abstract member.")}_formatErrors(e){throw new Error("Not implemented abstract member.")}}},{"../../utils":88,"./InputFileSystem":62,"./loader":65,os:void 0,path:void 0,"util.promisify":void 0}],64:[function(n,e,t){n("./modulePatch");const o=n("semver"),a=n("../../utils").default,l=n("./loader"),c=n("./locator");e.exports=i=>(e,t,s)=>{s=s||c.load(i),a.patchModule(l.single.id,()=>l.single),a.patchModule(l.pre.id,()=>l.pre),a.patchModule(l.post.id,()=>l.post);var r=s.version;if(!o.valid(r)||o.lt(r,"4.36.1"))throw new Error("Only Webpack v4.36.1 or higher is supported.");r=o.major(r),r=new(n(4===r?"./v4/Postprocessor":"./v5/Postprocessor"))(s,e,t),s=r.process.bind(r);return s.owner=r,s.bundler={native:!0},s}},{"../../utils":88,"./loader":65,"./locator":66,"./modulePatch":67,"./v4/Postprocessor":68,"./v5/Postprocessor":70,semver:void 0}],65:[function(e,t,s){const c=e("lodash"),u=e("../../utils").default,p=e("../../utils/remapComments").default,d=e("../../instrumentor").default;function r(r,i,e,n){if(this._compilation&&this._compilation.wallaby){var{load:o,settings:a,logger:s,files:l}=this._compilation.wallaby,o;if((o=o(this))&&o.instrument)if(n||this.cacheable.verified)if(l.has(o.id))s.trace("Skipping instrumentation of '%s': file is already instrumented.",o.path);else{Buffer.isBuffer(r)&&65279===(r=r.toString("utf-8")).charCodeAt(0)&&(r=r.substr(1)),s.trace("Instrumenting '%s' [content %s, source-map %s].",o.path,!!r,!!i);let e=c.extend({},a.hints);(!o.test||(e.allowIgnoringCoverageInTests||(e=c.omit(e,"ignoreCoverage","ignoreCoverageForFile")),a.extractComments))&&(e=c.omit(e,"testFileSelection"));let t;n=o.logMarkers||[];try{let s;i&&(o.changeStart||o.logMarkers&&o.logMarkers.length||o.extractedComments&&!o.extractedComments.isCoverageIgnored)&&(s=new u.SourceMapConsumer(i)),(t=d(r,{file:o.id,test:o.test,testFileChangeStart:i?u.mapTextPosition(o.changeStart&&o.changePosition,s):o.changeStart,logMarkers:n.map(e=>({originalRange:e.range,range:u.mapOriginalRangeToTransformed(s,e.range),changeId:e.id,traceId:e.traceId,expanded:e.expanded,new:e.new,exp:e.exp,action:e.action,logpoint:e.logpoint,inlineLogpoint:e.inlineLogpoint})),extractedComments:p(o.extractedComments,r,s),hints:e,recordValues:a.autoConsoleLog,captureConsoleLog:a.captureConsoleLog,preserveComments:a.preserveComments||!1,automaticTestFileSelection:o.test&&!a.extractComments&&a.automaticTestFileSelection,sequenceExpressionToDiff:!1})).liveCommentLines&&i?(s=s||new u.SourceMapConsumer(i),t.liveCommentLines=c.chain(t.liveCommentLines).map((e,t)=>({line:parseInt(t,10),column:e+1})).map(({line:e,column:t})=>u.mapTransformedRangeToOriginal(s,[e,t,e,t])).filter(e=>e&&e.length).map(e=>e[0]).value()):t.liveCommentLines&&(t.liveCommentLines=Object.keys(t.liveCommentLines).map(e=>parseInt(e,10)).filter(e=>e).map(e=>e))}catch(e){throw u.formatInstrumentationError(e,r,o.path)}l.add(o.id),this._module.wallaby={ranges:t.ranges,loggedRanges:t.loggedRanges,map:i,testName:t.testName,numberOfFunctions:t.numberOfFunctions,includedTestFile:t.includedTestFile,excludedTestFile:t.excludedTestFile,notInstrumentedLogMarkers:t.notInstrumentedLogMarkers,liveCommentLines:t.liveCommentLines,usedLogpoints:n.filter(e=>e.logpoint).map(e=>e.id)},r=t.code,i=i?u.combineSourceMaps(i,t.map):t.map,s.trace("Instrumented '%s'.",o.path)}else s.trace("Skipping instrumentation of '%s': file is wrapped by some loader.",o.path)}this.callback(null,r,i,e)}t.exports.pre=function(e,t,s){this.callback(null,e,t,s)},t.exports.pre.pitch=function(){this.cacheable.verified=!0},t.exports.pre.id="wallaby-pre-loader",t.exports.pre.raw=!0,t.exports.post=function(e,t,s){r.apply(this,[e,t,s,!1])},t.exports.post.id="wallaby-post-loader",t.exports.post.raw=!0,t.exports.single=function(e,t,s){r.apply(this,[e,t,s,!0])},t.exports.single.id="wallaby-loader",t.exports.single.raw=!0},{"../../instrumentor":57,"../../utils":88,"../../utils/remapComments":91,lodash:void 0}],66:[function(e,t,s){const i=e("path"),n=e("fs"),o=e("../../utils").default;t.exports={load:e=>{var t=[];t.length||(t.push(i.join(e,"node_modules/@angular-devkit/build-angular")),t.push(i.join(e,"node_modules/react-scripts")),t.push(i.join(e)));for(const r of t){var s=o.tryRequireModuleWithPathFrom(r,"webpack");if(s&&(s=s.module))return s}t="Unable to load webpack module."+(n.existsSync(i.join(e,"pnpm-lock.yaml"))?"\nIf your project is using `pnpm` then please ensure `webpack` is hoisted to your node_modules folder.\nYou may either:\n  add `public-hoist-pattern[]=webpack` to `<rootDir>/.npmrc`, or \n  run `pnpm add webpack --save-dev` to add an explicit dependency.":"");throw new Error(t)}}},{"../../utils":88,fs:void 0,path:void 0}],67:[function(e,t,s){e("../../utils").default.patchModulesCode([{files:["thread-loader/dist/index.js"],replacements:[{from:"function pitch() {",to:"function pitch() { this.loaders.slice(this.loaderIndex + 1); return;"}]}],"Possibly incompatible/unsupported thread-loader version")},{"../../utils":88}],68:[function(e,t,s){var r=e("../Postprocessor");const i=e("./templates");class n extends r{constructor(e,t,s){super(e,t,s)}get _templates(){return i}_adjustConfiguration(){super._adjustConfiguration();var e=this._configuration;e.cache=!1,void 0===e.module.unsafeCache&&(e.module.unsafeCache=!0)}_initializeCompilation(t){if(this._compilation)t.cache=this._compilation.cache;else{t.cache={};{const i=t.fileTimestamps.get.bind(t.fileTimestamps);t.fileTimestamps.get=e=>{e=i(e);return e||1}}{const n=t.contextTimestamps.get.bind(t.contextTimestamps);t.contextTimestamps.get=e=>{e=n(e);return e||1}}}const s=new Date(864e13).getTime(),r=(this._deletedFilePaths.forEach(e=>{t.fileTimestamps.set(e,s),t.contextTimestamps.set(e,s)}),(new Date).getTime());this._affectedFileByFullPath.forEach(e=>{t.fileTimestamps.set(e.fullPath,r),t.contextTimestamps.set(e.fullPath,r)}),t.fileTimestamps.set(this._entry.path,this._entry.ts),t.createHash=()=>this.hash="",t.sortItemsWithModuleIds=()=>{},t.sortItemsWithChunkIds=()=>{},this._compilation=t}_renderModule(e,t){t=e.moduleTemplates.javascript.render(t,e.dependencyTemplates,{});let s;return s=3===t.children.length?t.children[1]:t.children[2]}_traverseDependencies(e,t,s,r){if(r=r||new Set,t.dependencies)for(const n of t.dependencies){var i;n&&n.module&&n.module.resource&&(i=n.module.resource,!r.has(i))&&(r.add(i),i=this._fileByFullPath.get(i))&&(s.push(i.id),this._traverseDependencies(e,n.module,s,r))}}_formatErrors(t){let s=t.errors[0];var r,i=t.requestShortener;let n="";if((s="string"==typeof s?{message:s}:s).file&&(n+=s.file+`
`),s.module&&s.module.readableIdentifier&&"function"==typeof s.module.readableIdentifier&&(n+=this._formatFilePath(s.module.readableIdentifier(i)),"object"==typeof s.loc&&(t=this._formatLocation(s.loc))&&(n+=" "+t),n+="\n"),n+=s.message,s.origin){if(n+=`
 @ `+this._formatFilePath(s.origin.readableIdentifier(i)),"object"==typeof s.originLoc&&(t=this._formatLocation(s.originLoc))&&(n+=" "+t),s.dependencies)for(const o of s.dependencies)o.loc&&"string"!=typeof o.loc&&(r=this._formatLocation(o.loc))&&(n+=" "+r);let e=s.origin;for(;e.issuer;)e=e.issuer,n+=`
 @ `+e.readableIdentifier(i)}return n}_formatFilePath(e){return e.includes("!")?e.replace(/^(\s|\S)*!/,"")+` (${e})`:""+e}_formatLocation(e){return null===e?"":"string"==typeof e?e:"number"==typeof e?""+e:"object"==typeof e?"start"in e&&e.start&&"end"in e&&e.end?"object"==typeof e.start&&"number"==typeof e.start.line&&"object"==typeof e.end&&"number"==typeof e.end.line&&"number"==typeof e.end.column&&e.start.line===e.end.line?this._formatPosition(e.start)+"-"+e.end.column:this._formatPosition(e.start)+"-"+this._formatPosition(e.end):"start"in e&&e.start?this._formatPosition(e.start):"name"in e&&"index"in e?`${e.name}[${e.index}]`:"name"in e?e.name:this._formatPosition(e):""}_formatPosition(e){return null===e?"":"string"==typeof e?e:"number"==typeof e?""+e:"object"==typeof e?"line"in e&&"column"in e?e.line+":"+e.column:"line"in e?e.line+":?":"index"in e?"+"+e.index:"":""}}t.exports=n},{"../Postprocessor":63,"./templates":69}],69:[function(e,t,s){t.exports={webpack:()=>`
    window.__moduleBundler = {};
    window.__moduleBundler.modules = {};
    window.__moduleBundler.installedModules = {};
    window.__moduleBundler.assert = function(moduleId, suppressTestVerification) {};
    window.__moduleBundler.require = function(moduleId, suppressTestVerification) {    
      // Check if module is in cache
      if(window.__moduleBundler.installedModules[moduleId]) {
          return window.__moduleBundler.installedModules[moduleId].exports;
      }
      
      window.__moduleBundler.assert(moduleId, suppressTestVerification);
      
      // Create a new module (and put it into the cache)
      var module = window.__moduleBundler.installedModules[moduleId] = {
          i: moduleId,
          l: false,
          exports: {}
      };
 
      const executor = window.__moduleBundler.modules[moduleId];
 
      if(!executor) {
        throw new Error('Cannot find module ' + moduleId + '.');
      }
 
      // Execute the module function
      try {
        executor.call(module.exports, module, module.exports, window.__moduleBundler.require);
      } catch (err) {
        if (err && !err.moduleLoadError) {
          if (window.__moduleBundler.filePathByModuleId[moduleId]) {
            err.moduleLoadError = true;
            err.message = window.__moduleBundler.filePathByModuleId[moduleId] + ' : ' + err.message;
          }
        }
        throw err;
      }      
  
      // Flag the module as loaded
      module.l = true;
  
      // Return the exports of the module
      return module.exports;
    };
    
    // expose the modules object (__webpack_modules__)
    window.__moduleBundler.require.m = window.__moduleBundler.modules;
    
    // expose the module cache
    window.__moduleBundler.require.c = window.__moduleBundler.installedModules;
    
    (function() {  
      var hasOwnProperty = Object.prototype.hasOwnProperty;
        
      // define getter function for harmony exports
      window.__moduleBundler.require.d = function(exports, name, getter) {
        if(!hasOwnProperty.call(exports, name)) {
            Object.defineProperty(exports, name, { enumerable: true, get: getter });
        }
      };
    })();
    
    // define __esModule on exports
    window.__moduleBundler.require.r = function(exports) {
      if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
          Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
      }
      Object.defineProperty(exports, '__esModule', { value: true });
    };

    // create a fake namespace object
    // mode & 1: value is a module id, require it
    // mode & 2: merge all properties of value into the ns
    // mode & 4: return value when already ns object
    // mode & 8|1: behave like require
    window.__moduleBundler.require.t = function(value, mode) {
      if(mode & 1) value = window.__moduleBundler.require(value);
      if(mode & 8) return value;
      if((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;
      var ns = Object.create(null);
      window.__moduleBundler.require.r(ns);
      Object.defineProperty(ns, 'default', { enumerable: true, value: value });
      if(mode & 2 && typeof value != 'string') for(var key in value) window.__moduleBundler.require.d(ns, key, function(key) { return value[key]; }.bind(null, key));
      return ns;
    };
    
    // getDefaultExport function for compatibility with non-harmony modules
    window.__moduleBundler.require.n = function(module) {
        var getter = module && module.__esModule ?
            function getDefault() { return module['default']; } :
            function getModuleExports() { return module; };
        window.__moduleBundler.require.d(getter, 'a', getter);
        return getter;
    };

    window.__moduleBundler.require.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
        
    // __webpack_public_path__
    window.__moduleBundler.require.p = "";
    
    // on error function for async loading
    window.__moduleBundler.require.oe = function(err) { console.error(err); throw err; };
    
    window.__moduleBundler.require.i = function(value) { return value; };
    
    window.__moduleBundler.require.e = function() { return Promise.resolve(); };
  `,bootstrapper:(e,t,s)=>`
    window.__moduleBundler.testFileModuleIdByPath = ${JSON.stringify(e)};
    window.__moduleBundler.testFilePathByModuleId = ${JSON.stringify(t)};
    window.__moduleBundler.filePathByModuleId = ${JSON.stringify(s)};
    window.__moduleBundler.assert = function(moduleId, suppressTestVerification) {
      if(!suppressTestVerification) {
        var path = window.__moduleBundler.testFilePathByModuleId[moduleId];
        if(path) {
          throw new Error("Test file " + path + " is being imported from other test files.\\nThis may cause tests in the file to be executed more than once (when the test file runs and every time it gets imported).\\nIf the test file contains some test helper code, try refactoring the reused code into a file of its own and use it by importing the new helper file where required.");
        }
      }
    };
    window.__moduleBundler.loadTests = function () { 
      window.wallaby._startWhenReceiverIsReady(function() {
        for(var i = 0, len = wallaby.loadedTests.length; i < len; i++)
        {
          var path = wallaby.loadedTests[i];
          if (path && path.length > 7 && path.substr(-7) === ".wbp.js") {
            window.__moduleBundler.require(window.__moduleBundler.testFileModuleIdByPath[path.substr(0, path.length - 7)], true);      
          }
        }
      });
    };    
  `}},{}],70:[function(e,t,s){var r=e("../Postprocessor");const i=e("./templates");class n extends r{constructor(e,t,s){super(e,t,s)}get _templates(){return i}_adjustConfiguration(e){super._adjustConfiguration(e);var t=this._configuration;t.cache&&"filesystem"===t.cache.type?t.cache.version=""+e:t.cache||(t.cache={type:"memory"})}_initializeCompilation(t){var e;if(this._compilation||(e=this._webpack.javascript.JavascriptModulesPlugin,this._javascriptModulesPluginClass=e,this._javascriptModulesPluginInstance=new e),t.fileSystemInfo._fileTimestamps.map){t.compiler.fileTimestamps=new Map;for(var[s,r]of t.fileSystemInfo._fileTimestamps)t.compiler.fileTimestamps.has(s)||t.compiler.fileTimestamps.set(s,r);t.fileSystemInfo._fileTimestamps.stack=[t.compiler.fileTimestamps]}else t.compiler.fileTimestamps=t.fileSystemInfo._fileTimestamps;if(t.fileSystemInfo._contextTimestamps.map){t.compiler.contextTimestamps=new Map;for(var[i,n]of t.fileSystemInfo._contextTimestamps)t.compiler.contextTimestamps.has(i)||t.compiler.contextTimestamps.set(i,n);t.fileSystemInfo._contextTimestamps.stack=[t.compiler.contextTimestamps]}else t.compiler.contextTimestamps=t.fileSystemInfo._contextTimestamps;const o=new Date(864e13).getTime();t.compiler.modifiedFiles=new Set,t.compiler.removedFiles=new Set,this._deletedFilePaths.forEach(e=>{t.compiler.removedFiles.add(e),t.compiler.fileTimestamps.set(e,{safeTime:o,timestamp:o}),t.compiler.contextTimestamps.set(e,{safeTime:o,timestamp:o})}),this._affectedFileByFullPath.forEach(e=>{t.compiler.modifiedFiles.add(e.fullPath),t.compiler.fileTimestamps.set(e.fullPath,{safeTime:e.id+"_"+e.ts,timestamp:e.id+"_"+e.ts})}),t.compiler.fileTimestamps.set(this._entry.path,{safeTime:this._entry.ts,timestamp:this._entry.ts}),this._setupFiles.forEach(e=>{e.ts&&t.compiler.fileTimestamps.set(e.fullPath,{safeTime:e.ts,timestamp:e.ts})}),this._compilation=t}_renderModule(e,t){var s={dependencyTemplates:e.dependencyTemplates,runtimeTemplate:e.runtimeTemplate,moduleGraph:e.moduleGraph,chunkGraph:e.chunkGraph,codeGenerationResults:e.codeGenerationResults,chunk:{}};if(!e.codeGenerationResults.map.has(t))return null;var r=this._javascriptModulesPluginClass.getCompilationHooks(e),s=this._javascriptModulesPluginInstance.renderModule(t,s,r,!0);if(!s)return null;let i;var r=s.original().getChildren();return i=3===r.length?r[1]:r[2],e.chunks&&e.chunks.size&&(s=e.chunks.values().next().value,r=e.chunkGraph._modules.get(t))&&(e=r.runtimeRequirements&&r.runtimeRequirements.get(s.runtime),i.moduleArgument=e&&!e.has("module")?"__unused_webpack_module":void 0),i}_traverseDependencies(e,t,s,r){r=r||new Set;for(const n of e.moduleGraph.getOutgoingConnections(t)){var i;n.module&&n.module.resource&&(i=n.module.resource,!r.has(i))&&(r.add(i),i=this._fileByFullPath.get(i))&&(s.push(i.id),this._traverseDependencies(e,n.module,s,r))}}_formatErrors(t){const s=t.requestShortener;let r=t.errors[0];var i=[];if("string"!=typeof r&&r.module){var n=t.moduleGraph,o=new Set;let e=r.module;for(;e&&!o.has(e);){o.add(e);var a=n.getIssuer(e);if(!a)break;i.push({origin:a,module:e}),e=a}}return"string"==typeof r&&(r={message:r}),i.length&&(r.message=""+r.message+i.map(e=>`
@ `+e.module.readableIdentifier(s)).join()),r.message}}t.exports=n},{"../Postprocessor":63,"./templates":71}],71:[function(e,t,s){t.exports={webpack:()=>`
    window.__moduleBundler = {};
    window.__moduleBundler.modules = {};
    window.__moduleBundler.installedModules = {};
    window.__moduleBundler.assert = function(moduleId, suppressTestVerification) {};
    window.__moduleBundler.require = function(moduleId, suppressTestVerification) {    

      if(window.__moduleBundler.installedModules[moduleId]) {
          return window.__moduleBundler.installedModules[moduleId].exports;
      }
      
      window.__moduleBundler.assert(moduleId, suppressTestVerification);
      
      var module = window.__moduleBundler.installedModules[moduleId] = {
          id: moduleId,
          loaded: false,
          exports: {}
      };
 
      const executor = window.__moduleBundler.modules[moduleId];
 
      if(!executor) {
        throw new Error('Cannot find module ' + moduleId + '.');
      }
      
      // Execute the module function
      try {
        executor.call(module.exports, module, module.exports, window.__moduleBundler.require);
      } catch (err) {
        if (err && !err.moduleLoadError) {
          if (window.__moduleBundler.filePathByModuleId[moduleId]) {
            err.moduleLoadError = true;
            err.message = window.__moduleBundler.filePathByModuleId[moduleId] + ' : ' + err.message;
          }
        }
        throw err;
      }
      
      module.loaded = true;
      
      return module.exports;
    };
        
    (function() {  
      var hasOwnProperty = Object.prototype.hasOwnProperty;
      window.__moduleBundler.require.d = function(exports, definition) {
        for(var key in definition) {
          if(hasOwnProperty.call(definition, key) && !hasOwnProperty.call(exports, key)) {
            Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
          }
        }
      };
    })();
    
    window.__moduleBundler.require.r = function(exports) {
      if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
          Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
      }
      Object.defineProperty(exports, '__esModule', { value: true });
    };
    
    window.__moduleBundler.require.p = "";
    
    window.__moduleBundler.require.e = function() { return Promise.resolve(); };
    
    window.__moduleBundler.require.oe = function(err) { console.error(err); throw err; };
    
    window.__moduleBundler.require.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
    
    window.__moduleBundler.require.i = [];
    
    window.__moduleBundler.require.c = window.__moduleBundler.installedModules;
    
    window.__moduleBundler.require.m = window.__moduleBundler.modules;
    
    window.__moduleBundler.require.n = function(module) {
      var getter = module && module.__esModule ?
        function getDefault() { return module['default']; } :
        function getModuleExports() { return module; };
      window.__moduleBundler.require.d(getter, { a: getter });
      return getter;
    };
    
    window.__moduleBundler.require.t = function(value, mode) {
      if(mode & 1) value = this(value);
      if(mode & 8) return value;
      if((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;
      var ns = Object.create(null);
      window.__moduleBundler.require.r(ns);
      var def = {};
      if(mode & 2 && typeof value == 'object' && value) {
        for(const key in value) def[key] = function() { return value[key]; };
      }
      def['default'] = function() { return value; };
      window.__moduleBundler.require.d(ns, def);
      return ns;
    };
    
    window.__moduleBundler.require.nmd = function(module) {
      module.paths = [];
      if (!module.children) module.children = [];
      return module;
    }

    window.__moduleBundler.require.hmd = function(module) {
      module = Object.create(module);
      if (!module.children) module.children = [];
      Object.defineProperty(module, 'exports', {
        enumerable: true,
        set: function() {
          throw new Error('ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: ' + module.id);
        }
      });
      return module;
    }
    
    window.__moduleBundler.require.g = (function() {
      if (typeof globalThis === 'object') return globalThis;
      try {
        return this || new Function('return this')();
      } catch (e) {
        if (typeof window === 'object') return window;
      }
    })();
    
    window.__moduleBundler.require.v = function() {
      throw new Error('WASM modules are not supported yet.');
    }

    window.__moduleBundler.require.u = function(chunkId) {
      return chunkId + ".js"
    }

    var baseURI = window.location.origin;
    window.__moduleBundler.require.b = baseURI;
  `,bootstrapper:(e,t,s)=>`
    window.__moduleBundler.testFileModuleIdByPath = ${JSON.stringify(e)};
    window.__moduleBundler.testFilePathByModuleId = ${JSON.stringify(t)};
    window.__moduleBundler.filePathByModuleId = ${JSON.stringify(s)};
    window.__moduleBundler.assert = function(moduleId, suppressTestVerification) {
      if(!suppressTestVerification) {
        var path = window.__moduleBundler.testFilePathByModuleId[moduleId];
        if(path) {
          throw new Error("Test file " + path + " is being imported from other test files.\\nThis may cause tests in the file to be executed more than once (when the test file runs and every time it gets imported).\\nIf the test file contains some test helper code, try refactoring the reused code into a file of its own and use it by importing the new helper file where required.");
        }
      }
    };
    window.__moduleBundler.loadTests = function () { 
      window.wallaby._startWhenReceiverIsReady(function() {
        for(var i = 0, len = wallaby.loadedTests.length; i < len; i++)
        {
          var path = wallaby.loadedTests[i];
          if (path && path.length > 7 && path.substr(-7) === ".wbp.js") {
            window.__moduleBundler.require(window.__moduleBundler.testFileModuleIdByPath[path.substr(0, path.length - 7)], true);      
          }
        }
      });
    };    
  `}},{}],72:[function(e,t,s){"use strict";t.exports=class{constructor(e,t,s){this.type=e.type,this.path=e.path,this.content=t,this.maps=[],this.config=s}rename(e){return this.newPath=e,this}changeExt(e){var t=this.newPath||this.path;return this.newPath=t.substr(0,t.lastIndexOf(".")+1)+e,this}}},{}],73:[function(e,t,s){var r=e("child_process"),i=e("events"),n=e("os"),e=e("util");const o={STARTING:"STARTING",READY:"READY",BUSY:"BUSY"};function a(e){this.process=r.fork(e,["worker"]),this.pid=this.process.pid,this.status=o.STARTING,this.process.once("message",this.onReady.bind(this)),i.EventEmitter.call(this)}function l(e,t){this.workers=[],this.queue=[];var i=this;t=t||n.cpus().length;for(var s=0;s<t;s++)!function s(){var r=new a(e);r.on("ready",i._run.bind(i)),r.process.on("exit",function(e){if(0!==e){for(var t=0;t<i.workers.length;t++)i.workers[t].pid===r.pid&&i.workers.splice(t,1);s()}}),i.workers.push(r)}()}e.inherits(a,i.EventEmitter),a.prototype.onReady=function(){this.status===o.STARTING&&(this.status=o.READY,this.emit("ready",this))},a.prototype.onMessage=function(e,t){e(t),this.status=o.READY,this.emit("ready",this)},a.prototype.send=function(e,t){this.status=o.BUSY,this.emit("busy"),this.process.once("message",this.onMessage.bind(this,t)),this.process.send(e)},l.prototype.enqueue=function(e,t){this.queue.push({task:e,callback:t}),process.nextTick(this._run.bind(this))},l.prototype.stop=function(){_.each(this.workers,function(e){e.process.send({type:"exit"})})},l.prototype._run=function(e){if(0!==this.queue.length){if(!e)for(var t=0;t<this.workers.length;t++)if(this.workers[t].status===o.READY){e=this.workers[t];break}var s;e&&(s=this.queue.shift(),e.send(s.task,s.callback))}},t.exports={_queue:void 0,start:function(e){this._queue||(this._queue=new l(e))},started:function(){return!!this._queue},run:function(e){var r=this;return r._queue?Q.promise(function(t,s){try{r._queue.enqueue(e,function(e){t(e)})}catch(e){s(e)}}):Q.reject(new Error("Processor pool is not started"))},stop:function(){this._queue&&(this._queue.stop(),delete this._queue)}}},{child_process:void 0,events:void 0,os:void 0,util:void 0}],74:[function(e,t,s){"use strict";var n=e("path"),o=e("micromatch").isMatch,r=e("./config").default,i=e("./utils").default,l=e("./preprocessedFile");const{debug:a,trace:c}=logger.create("processor");var u,p=!1,d="Processor must pass a string, an object with code property or an error to done function.";class h{constructor(e,t){this._config=e,this._settingsAreReady=_.isObject(this._config),this._root=t,this._localRoot=this._settingsAreReady?process.cwd():n.dirname(e)}run(i,o,n){var a=this;return(this._settingsAreReady?Q.when(this._config):r(this._config,this._root)).then(e=>{let t=a._processors(e,o,n);if(!t.length)return c("No %s found for %s",n?"compilers":"preprocessors",o.path),Q.when({content:i,noProcessors:!0});n&&(t=[t[0]]);var s=new l(o,i,e);s.additionalPreset=this._additionalPreset(e);let r=Q.when(s);return c("Running %s processor(s) for %s",t.length,o.path),t.forEach(function(s){r=r.then(n=>Q.promise((r,i)=>{try{var e=e=>{if(c("Finished running one processor for %s",o.path),e instanceof Error)i(e);else{if(_.isObject(e)){if(!_.isString(e.code))return void i(new Error(d));var t=e.code,s=e.map||e.sourceMap;s&&(!s.version&&s._mappings&&s.toString&&(s=s.toString()),n.maps.push(s)),e.ranges&&(n.ranges=e.ranges),e.scriptRange&&(n.scriptRange=e.scriptRange),e.noScript&&(n.noScript=e.noScript)}else{if(!_.isString(e))return void i(new Error(d));t=e}n.content=t,r(n)}};if(1===s.length){let t;try{t=s(n)}catch(e){t=e}finally{e(t)}}else 2===s.length?s(n,e):i(new Error("Processor must be an async function with two params, where last param is done callback, or sync function with one param and returning the result."))}catch(e){i(e)}}))}),r})}_additionalPreset(e){if(!p){if(e.testFramework&&e.testFramework.version&&0===e.testFramework.version.indexOf("jest"))try{u=i.requireModuleFrom(this._localRoot,"babel-preset-jest")}catch(e){try{u=i.requireModuleFrom(this._localRoot,"react-scripts/node_modules/babel-preset-jest")}catch(e){a("WARNING: could not find and load babel-preset-jest preset, it is required for correct jest.mock(...) calls hoisting")}}p=!0}return u}_processors(s,r,e){let i=[];e=e?s.compilers:s.preprocessors;return _.each(e,(e,t)=>{if(!_.isString(t))throw new Error("Processor patterns object keys must be strings.");if(!_.isArray(e)&&!_.isFunction(e))throw new Error('Processor(s) for "'+t+'" is specified incorrectly, must be an array of functions or a function.');_.isFunction(e)&&(e=[e]),o(0===(r.path||"").indexOf("..")?n.basename(r.path):r.path,t,{dot:s.dot})&&(i=i.concat(_.map(e,e=>{if(_.isFunction(e))return e;throw new Error('Processor for "'+t+'" is specified incorrectly, must be an array of functions or a function.')})))}),i}}t.exports=e=>new h(e.config,e.root).run(e.content,e.file,"compiler"===e.type)},{"./config":17,"./preprocessedFile":72,"./utils":88,micromatch:void 0,path:void 0}],75:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Project=void 0;const path=require("path"),url=require("url"),semver=require("semver"),which=require("which"),utils_1=require("./utils"),config_1=require("./config"),utils_2=require("./extension/shared/utils"),remapComments_1=require("./utils/remapComments"),instrumentor_1=require("./instrumentor");var processor=require("./processor");const testTask_1=require("./testTask");var Tracker=require("./tracking");const{debug,trace}=logger.create("project"),chromeProfileViewer_1=require("./chromeProfileViewer"),errorTraceMapper_1=require("./errorTraceMapper");var cp=require("child_process"),spawn=cp.spawn,spawnedProcesses={},testPathSeparator=(cp.spawn=function(){"cmd"===arguments[0]&&arguments[1]&&3<=arguments[1].length&&"/d"===arguments[1][0]&&"/c"===arguments[1][1]&&(arguments[0]=arguments[1][2],arguments[1].splice(0,3));var e=spawn.apply(this,arguments);try{var t=e.pid;e.on("exit",function(){t&&delete spawnedProcesses[t]}),spawnedProcesses[t]=e}catch(e){}return e},"^#^"),runAlways=1,runOneTime=2,bundleFileId="bundle";class Project extends EventEmitter{constructor(s){super();this._structureFileFormatVersion=25,this._wallabyEmail=utils_2.default.wallabyEmail(),this._cli=s.cli,this.startLegacyGuiService=!s.quokka&&(void 0===s.version||"1"===s.version),this._diffMatchPatch=s.diffMatchPatch,this._processorPool=s.processorPool,this._runnerResolver=s.runnerResolver,this._fileStructureCachePromise=s.fileStructureCachePromise,this._fileStatPromise=s.fileStatPromise,this._readFilePromise=s.readFilePromise,this._writeFilePromise=s.writeFilePromise,this._unlinkFilePromise=s.unlinkFilePromise,this._unlinkFileSync=s.unlinkFileSync,this._readFileSync=s.readFileSync,this._writeFileSync=s.writeFileSync,this._fileExistsSync=s.fileExistsSync,this._dirRemovePromise=s.dirRemovePromise,this._dirRemoveSync=s.dirRemoveSync,this._dirEnsurePromise=s.dirEnsurePromise,this._dirEnsureSync=s.dirEnsureSync,this._lruCache=require("lru-cache")({max:52428800,length:e=>e.length}),this._configFile=s.configPath,this._structureFile="structure.json",this._testExecutionTimesFile="testExecutionTimes.json";var t,r,i,n,o,e,a=s.homeDir||require("os").homedir();if(this._globalSettingsDir=path.join(a,process.env.quokka?".quokka":".wallaby"),s.dirEnsureSync(this._globalSettingsDir),this._notificationSettingsFile=path.join(this._globalSettingsDir,"notifications.json"),this._fileExistsSync(this._notificationSettingsFile)||this._writeFileSync(this._notificationSettingsFile,JSON.stringify({})),process.env.quokka)try{this._globalSettingsDir=path.join(s.homeDir,".quokka"),this._quokkaTempDir=path.join(this._globalSettingsDir,"data",utils_1.default.randomId()),this._quokkaGlobalSettingsFile=path.join(this._globalSettingsDir,"config.json"),this._quokkaGlobalPackageFile=path.join(this._globalSettingsDir,"package.json"),i=!0,this._root="quokka_fake_path",this._quokkaFileName=s.quokka,this._localRoot=process.cwd(),this._useMemoryFs=s.useMemoryFs,this._originalLocalRoot=this._localRoot;let e=!1;if(s.fileExistsSync(path.join(this._localRoot,"package.json"))){this._packageJsonExists=!0;try{var l=JSON.parse(s.readFileSync(path.join(this._localRoot,"package.json")).toString());e=l.workspaces&&l.workspaces.length}catch(e){}}if(!e){let e=path.dirname(path.join(this._localRoot,this._quokkaFileName));for(;e.length>this._localRoot.length;){if(s.fileExistsSync(path.join(e,"package.json"))){this._originalLocalRoot=this._localRoot,this._originalQuokkaFileName=this._quokkaFileName,this._quokkaFileName=path.join(this._localRoot,this._quokkaFileName).substring(e.length+1),s.quokka=this._quokkaFileName,this._localRoot=e,process.chdir(this._localRoot);break}e=path.dirname(e)}}let t=this._localRoot;for(;t.length>=this._originalLocalRoot.length&&(this._quokkaLocalSettingsFile=path.join(t,".quokka"),!s.fileExistsSync(this._quokkaLocalSettingsFile));)t=path.dirname(t);this._originalRoot=path.join("quokka_fake_path","original"),this._instrumentedRoot=path.join("quokka_fake_path","instrumented"),this._editorTypeScript=s.editorTypeScript,n=!0,s.useMemoryFs(this._root),s.useMemoryFs(this._originalRoot),s.useMemoryFs(this._instrumentedRoot),s.useMemoryFs(path.join(this._root,this._structureFile)),s.useMemoryFs(path.join(this._root,this._testExecutionTimesFile));var c=path.join(this._localRoot,this._quokkaFileName),u=path.join(this._originalRoot,path.basename(this._quokkaFileName)),p=(s.useMemoryFs(c),s.useMemoryFs(u,utils_1.default.isLevelUpRelativePath(this._quokkaFileName)),o=!0,"// This is an empty file waiting for changes");this._writeFileSync(c,p),this._writeFileSync(u,p),s.useMemoryFs(path.join(this._instrumentedRoot,this._quokkaFileName)),this._fullInstrumentedPathForTestRunner=function(e){return utils_1.default.isLevelUpRelativePath(this._quokkaFileName)?path.relative(this._localRoot,this._quokkaFileName):e.instrumentedPath.replace(this._instrumentedRoot,this._localRoot)},this._snapsOnlyMode=s.snapsOnlyMode,this._snapsAutoRun=s.snapsAutoRun}catch(e){throw new Error(`Failed to initialize Quokka paths
      homeDir: ${s.homeDir},
      cwd: ${process.cwd()}
      globalSettingsDir: ${this._globalSettingsDir}
      localSettingsFile: ${this._quokkaLocalSettingsFile}
      quokkaFileName: ${s.quokka}
      init status: ${i}, ${n}, `+o+"\n"+e.stack)}else{this._root=s.projectCachePath,this._configFile=s.configPath,this._testsPath=s.testsPath,this._localRoot=path.dirname(this._configFile),this._originalRoot=path.join(this._root,"original"),this._instrumentedRoot=path.join(this._root,"instrumented"),this._machineIdPath=path.join(this._globalSettingsDir,".mid");try{this._fileExistsSync(this._machineIdPath)?this._machineId=this._readFileSync(this._machineIdPath).toString():(e=require("crypto"),this._machineId=e.createHash("sha256").update(e.randomBytes(1024)).digest("hex"),this._writeFileSync(this._machineIdPath,this._machineId))}catch(e){this._machineId=utils_1.default.randomId()}}if(t=path.join(this._localRoot,"node_modules"),this._nodeModules=this._fileExistsSync(t)?t:void 0,this._packageJson=path.join(this._localRoot,"package.json"),this._babelrc=path.join(this._localRoot,".babelrc"),this._babelrcjs=path.join(this._localRoot,".babelrc.js"),this._localProjectDir=this._localRoot+path.sep,r=path.join(this._instrumentedRoot,"node_modules"),this._screenPath=path.join(this._instrumentedRoot,"screen.png"),this._profilePath=path.join(this._globalSettingsDir,"test.cpuprofile"),!process.env.quokka&&this._nodeModules&&s.nodeModulesLookup(function(e){e.push(t)},function(e){return e.replace(r,t)}),process.env.quokka){const d=path.join(this._globalSettingsDir,"node_modules");s.dirEnsureSync(this._quokkaTempDir),this._writeFileSync(path.join(this._quokkaTempDir,"package.json"),"{}"),s.dirEnsureSync(path.join(this._quokkaTempDir,"node_modules")),s.cidFile=path.join(this._globalSettingsDir,".qid"),s.lkp=path.join(this._globalSettingsDir,".qlc"),this._fileExistsSync(this._quokkaGlobalSettingsFile)||this._writeFileSync(this._quokkaGlobalSettingsFile,"{}"),this._fileExistsSync(this._quokkaGlobalPackageFile)||this._writeFileSync(this._quokkaGlobalPackageFile,"{}"),this._loadQuokkaSettings(s.quokkaSettingsOverride),s.edition=this._quokkaSettings.quokka.edition||"",s.nodeModulesLookup(function(e){e.push(d)})}this._live=!1,this._initialRunSignal=s.waitForInitialRunSignal?new Promise(e=>{debug("waiting for initial run signal"),this._signalInitialRun=e}):Promise.resolve(),this._sourceFileCache={},this._writeSourceFileCache={},this._changeQueue={changes:{},deletes:{}},this._testTask=new testTask_1.TestTask(this),this._tracker=new Tracker(s,process.env.quokka?path.dirname(process.mainModule.filename):this._root),this._init=s._init,this._coreVersion=s.coreVersion,this._allowedToSendBusy=!0}async configure(){var e,t,s,r;let i=!1;this._emitInternal({type:"configureStarted"});try{if(this._settings=process.env.quokka?this._quokkaSettings:await(0,config_1.default)(this._configFile,this._instrumentedRoot,{forceUpdate:this._forceConfigUpdate,cli:this._cli},e=>this._emitInternal({type:"config:"+e})),process.env.quokka)this._settings.extensions={};else{var n;process.version;if(process.env.WALLABY_ELECTRON_RUN_AS_NODE&&0,debug("Wallaby Node version: %s",process.version),debug("Wallaby config: %s",this._configFile),this.runOnSave="onsave"===this._settings.runMode,this._settings.screenshot||(this._screenPath=void 0),this._testsPath?(n=void 0!==this._testsPath&&this._testsPath.length?this._validatePaths(this._testsPath):void 0)&&n.length&&(this._settings.smartStart=this._settings.smartStart.filter(e=>"always"!==e.startMode),n.forEach(e=>{this._settings.smartStart.unshift({test:!0,source:!1,path:e,startMode:"always"})})):delete this._settings.smartStart,this._testLocations&&this._updateSettingsTestLocations(),!this.isNativeBundler()){let r=this._settings.postprocessor;_.isArray(this._settings.postprocessor)?(r=this._settings.postprocessor[0],this._settings.postprocessor=this.isZeroConfigJest()||this.isNodeNative()?this._settings.postprocessor[1]:this._combinePostprocessors(this._settings.postprocessor)):(this.isZeroConfigJest()||this.isNodeNative())&&delete this._settings.postprocessor,this.isVitest()&&delete this._settings.postprocessor,r&&r.ts&&r.filePatterns&&0<_.filter(r.filePatterns,e=>e&&!_.endsWith(e,"*.ts?(x)")&&!_.endsWith(e,"*.ts")).length&&(this._overrideFileTypesIncludedInTypeScriptCompiler=!0,this._overrideFileType=function(e,t,s){return"ts"!==e&&"tsx"!==e&&this._overrideFileTypesIncludedInTypeScriptCompiler&&t!==s&&r.filePatterns&&_.find(r.filePatterns,e=>utils_1.default.pathMatchesPattern(0===t.indexOf("..")?path.basename(t):t,e,{dot:this._settings.dot}))?"ts":void 0})}if(this._settings.configCode=this._fileExistsSync(this._configFile)&&this._readFileSync(this._configFile)||"auto.detect","auto.detect"===this._settings.configCode)try{this._settings.configCode+="#"+utils_1.default.quickHash(JSON.stringify({files:this._settings.files,tests:this._settings.tests}))}catch(e){}}if(this._settings.telemetry&&(this._tracker.start(this._settings),this._testLocations?this._tracker.featureUsed("exclusive.run"):process.env.f4b4b415f5452454?this._tracker.featureUsed("quokka.treasure"):process.env.idm45hb6578bw45t&&this._tracker.featureUsed("quokka.demo"),this._tracker.featureUsed("node."+process.version.split(".")[0]),null!=(t=null==(e=this._quokkaSettings)?void 0:e.quokka))&&t.bun&&"prompt"!==(null==(r=null==(s=this._quokkaSettings)?void 0:s.quokka)?void 0:r.bun.usageMode)&&this._tracker.featureUsed("bun"),this._settings.env.phantomDefault)throw new Error("Your wallaby.js configuration is using a deprecated default `env.kind` setting of `phantomjs`.\nTo continue using PhantomJs you must configure this setting explicitly.\nPlease refer to our PhantomJs docs at https://wallabyjs.com/docs/integration/phantomjs2.html for more information.");this._emitInternal({type:"configureComplete"}),i=!0;var o=this._settings.files.length;this._emit({type:"projectConfigured",name:this._settings.name,browser:"browser"===this._settings.env.type,kind:this._settings.env.kind,phantomDefault:this._settings.env.phantomDefault,screenshot:!!this._settings.screenshot,editDelay:this._settings.delays.edit,runOnSave:"onsave"===this._settings.runMode,files:_.map(this._settings.files.concat(this._settings.tests),(e,t)=>(o<=t&&(e.test=!0),e))})}catch(e){this._emitInternal({type:"configureComplete"}),i=!0,this._cleanStack(e,this._fileExistsSync(this._configFile)&&this._configFile);let t=e&&(e.stack||e.message)||"An unknown error occurred.";"string"!=typeof t&&(t=utils_1.default.formatWithoutColors(e)),emitDiagnostic({name:"genericError",message:"Failed to configure Wallaby:\n"+t.split("\n").map(e=>"  "+e).join("\n")+"\n\n  Please refer to our docs: https://wallabyjs.com/docs/config/overview.html "}),debug("Failed to load configuration file: %s",e&&(e.stack||e.message)),this._emitInternal({type:"configurationError"}),this.emitTestRunError({text:e&&(e.stack||e.message),header:"Configuration"})}finally{i||this._emitInternal({type:"configureComplete"})}}profilingSupportedByRunner(){return"node"===this._settings.env.type||"chrome"===this._settings.env.kind||"chrome-new"===this._settings.env.kind||void 0}setLicenseMode(e){this._tracker.mode(e)}reloadQuokkaSettings(){this._settings&&this._settings.quokka&&!1===this._settings.quokka.reloadSettingsOnPackageInstall||(this._loadQuokkaSettings((this._settings||{})._currentInlineQuokkaConfig),this._settings=this._quokkaSettings),this._recycleRunner=!0}allowToRunSnaps(){var e;this._snapsAutoRun=!0,null!=(e=this._quokkaSettings)&&e.quokka&&(this._quokkaSettings.quokka.snapsAutoRun=!0)}_mergeQuokkaSettingsFromQuokkaSettingsFile(e,t){try{var s=this._readFileSync(t);try{var r=JSON.parse(s);try{_.merge(e,r)}catch(e){return`Error merging Quokka settings from: ${t}.`}}catch(e){return`Error parsing Quokka settings "${t}"; make sure that contents are valid JSON.

`+e}}catch(e){}}_loadQuokkaSettings(r){var i,n,o,a,l,c,u,p={globalConfigFile:this._quokkaGlobalSettingsFile,tempDir:this._quokkaTempDir,autoDetect:!0};try{let e=this._mergeQuokkaSettingsFromQuokkaSettingsFile(p,this._quokkaGlobalSettingsFile),t=!1;if(!e){try{u=JSON.parse(this._readFileSync(this._packageJson)),_.merge(p,u.quokka),u.scripts&&(t=Object.keys(u.scripts).some(e=>u.scripts[e].toString().split(" ").some(e=>"bun"===e)))}catch(e){u={}}e=this._mergeQuokkaSettingsFromQuokkaSettingsFile(p,this._quokkaLocalSettingsFile)}if(r&&_.merge(p,r),p.pro&&0===Object.keys(p.pro||{}).length?p.pro={}:p.pro||(p.pro=void 0),p.node&&(p.node=p.node.replace(/^~(?=$|\/|\\)/,process.env.HOME)),"neverUse"===(null==(i=p.bun)?void 0:i.usageMode)||!t&&"alwaysUse"!==(null==(n=p.bun)?void 0:n.usageMode))delete p.bun;else if(p.bun=p.bun||{},p.bun.usageMode=p.bun.usageMode||(null==(l=null==(a=null==(o=this._quokkaSettings)?void 0:o.quokka)?void 0:a.bun)?void 0:l.usageMode)||"prompt",!p.bun.bunPath||this._fileExistsSync(p.bun.bunPath)||delete p.bun.bunPath,!p.bun.bunPath)try{p.bun.bunPath=which.sync("bun"),p.bun.bunPath.toLowerCase().endsWith(".cmd")&&(p.bun.bunPath=path.join(path.dirname(p.bun.bunPath),"node_modules","bun","bin","bun.exe"))}catch(e){delete p.bun}var q=process.versions&&process.versions.pnp,d=(t,e=!0)=>{var s=path.join(this._globalSettingsDir,"node_modules",t),r=path.join(this._localRoot,"node_modules",t);try{if(r=utils_1.default.requireResolve(t,{paths:[this._localRoot]})){let e=r;for(;path.dirname(e)!==e;){if(path.basename(e)===t){r=e;break}e=path.dirname(e)}}}catch(e){}return this._globalSettingsDir!==this._localRoot&&this._fileExistsSync(r)?r:this._fileExistsSync(s)?s:e&&(s=path.join(path.dirname(process.mainModule.filename),"node_modules",t),this._fileExistsSync(s))?path.join(path.dirname(process.mainModule.filename),"node_modules",t):void 0},h=e=>0===e.indexOf(path.join(path.dirname(process.mainModule.filename),"node_modules"));if(this._quokkaFileName.endsWith(".vue")||this._quokkaFileName.endsWith(".svelte"))if(semver.gte(process.versions.node,"18.0.0")){var g=d("vite"),f=d("vite-node");if(g)if(f){if(!h(g))try{var m=require(path.join(f,"package.json"));semver.gte(m.version,"1.2.0")||(e=`Quokka requires vite-node npm package version 1.2.0 or higher for vue/svelte files. Current version is ${m.version}.`)}catch(e){}if(!e)try{var v=require(path.join(g,"package.json"));semver.gte(v.version,"4.5.0")||(e=`Quokka requires vite npm package version 4.5.0 or higher for vue/svelte files. Current version is ${v.version}.`)}catch(e){}e||(p.vite={vitePath:path.join(g,"dist","node","index.js"),viteNodeServerPath:path.join(f,"dist","server.mjs"),viteNodeClientPath:path.join(f,"dist","client.mjs"),fileType:this._quokkaFileName.endsWith(".vue")?"vue":"svelte"},p.stdEsm=!1,p.nativeEsm=!0,delete p.bun)}else e="Quokka requires vite-node npm package to be installed for vue/svelte files.";else e="Quokka requires vite npm package to be installed for vue/svelte files."}else e="Quokka requires Node 18.0.0 or higher for vue/svelte files.";else{var y,b,w,k=semver.gte(process.versions.node,"17.0.0")||semver.gte(process.versions.node,"16.12.0")&&semver.lt(process.versions.node,"17.0.0")||semver.gte(process.versions.node,"14.999.999")&&semver.lt(process.versions.node,"15.0.0")||semver.gte(process.versions.node,"12.999.999")&&semver.lt(process.versions.node,"13.0.0");if(u.dependencies&&u.dependencies["vite-node"]||u.devDependencies&&u.devDependencies["vite-node"])if(!p.ts&&!p.babel)if(k)try{y=utils_1.default.requireResolve("vite",{paths:[this._localRoot]}),b=utils_1.default.requireResolve("vite-node/server",{paths:[this._localRoot]}),w=utils_1.default.requireResolve("vite-node/client",{paths:[this._localRoot]}),y=utils_2.default.normalizePath(y).replace("/index.cjs","/dist/node/index.js"),b=path.join(path.dirname(b),path.basename(b,path.extname(b))+".mjs"),w=path.join(path.dirname(w),path.basename(w,path.extname(w))+".mjs"),p.vite={vitePath:y,viteNodeServerPath:b,viteNodeClientPath:w,fileType:"unknown"},p.stdEsm=!1,p.nativeEsm=!0,delete p.bun}catch(e){p.e=e.toString()}if(p.vite&&!k)throw new Error("Quokka for vite requires Node 16.12.0 or higher.")}if(p.vite||(p.bun&&"prompt"!==p.bun.usageMode||("module"===u.type||_.endsWith(this._quokkaFileName,".mjs"))&&!0!==p.stdEsm||!0!==p.stdEsm&&process.env.WALLABY_PNP)&&(p.stdEsm=!1,p.nativeEsm=!0),this._quokkaSettings={quokka:{globalSettingsDir:this._globalSettingsDir,globalSettingsFile:this._quokkaGlobalSettingsFile,edition:p.pro?"pro":"",installPackage:{command:p.installPackageCommand||(q?"yarn add {packageName}":"npm install {packageName}"),dir:p.tempDir,allowToInstallImportedModules:!0},ignoreExternalFileChanges:p.ignoreExternalFileChanges,autoLog:!!p.autoLog,showSingleInlineValue:p.showSingleInlineValue,showValueOnSelection:p.showValueOnSelection,reloadSettingsOnPackageInstall:p.reloadSettingsOnPackageInstall,allowDebuggerEditAndContinue:!0,vite:!!p.vite,snaps:!0,snapsOnlyMode:this._snapsOnlyMode,snapsAutoRun:this._snapsAutoRun,bun:p.bun},files:[],tests:[{pattern:this._quokkaFileName,ignore:!1,instrument:!0,trigger:!0,load:!0}],env:{type:"node",runner:p.bun&&"prompt"!==p.bun.usageMode?p.bun.bunPath:process.execPath,params:p.env&&p.env.params||{}},compilers:{},preprocessors:{},testFramework:{version:"quokka@1.0.0",configurator:"",reporter:"",starter:""},delays:{run:p.delay||0,edit:0},workers:{recycle:!!p.recycle,regular:1,initial:1},maxConsoleMessagesPerTest:p.maxConsoleMessages||1e3,maxTraceSteps:p.maxTraceSteps||999999,maxTraceStepsForWatchExpressionPrefetch:process.env.WALLABY2?null!=(c=p.maxTraceStepsForWatchExpressionPrefetch)?c:10:0,autoConsoleLog:!0,quokkaVite:!!p.vite,debug:p.debug,reportConsoleErrorAsError:!0,telemetry:!0,hints:{ignoreCoverage:"ignore coverage"},extractComments:!!p.vite,dot:!0,unresponsiveStandardTimeout:p.unresponsiveStandardTimeout||500,logLimits:{inline:{depth:5,elements:5e3},values:{default:{stringLength:8192},autoExpand:{elements:5e3,stringLength:8192,depth:10}}},captureConsoleLog:!0},e)return void(this._quokkaSettings.error=e);"string"==typeof this._quokkaSettings.env.params.env&&_.each(this._quokkaSettings.env.params.env.split(";"),e=>{var t=e.split("=")[0];process.env[t]=e.substring(t.length+1)});let s=!(p.builtInPlugins=[]);if(!1!==p.autoDetect&&!p.vite){let e=path.join(this._localRoot,"node_modules","react-scripts","scripts","utils","createJestConfig.js");try{e=utils_1.default.requireResolve("react-scripts/scripts/utils/createJestConfig",{paths:[this._localRoot]})}catch(e){}this._fileExistsSync(e)&&(s=!0,delete p.ts,p.builtInPlugins.push("auto-detect:create-react-app"),p.babel={ts:!0,presets:["react-app"]},p.plugins=p.plugins||[],u.scripts)&&u.scripts.test&&-1===u.scripts.test.indexOf("--env")&&p.plugins.push("jsdom-quokka-plugin")}var x=t=>{if(!t&&(!1!==p.stdEsm||!1!==p.nativeEsm)||t&&(!0===p.stdEsm||!0===p.nativeEsm)){if(p.stdEsm=!1!==p.stdEsm,p.nativeEsm){p.stdEsm=!1;let e;if(p.node)try{var s=cp.spawnSync(""+p.node,["-v"]);e=(s.stdout||"").toString()}catch(e){debug("An error occurred detecting runner nodejs version: %s",e)}else e=process.version;e&&(e=semver.clean(e),semver.gte(e,"12.0.0"))?(this._quokkaSettings.env.params.runner=this._quokkaSettings.env.params.runner?this._quokkaSettings.env.params.runner+" ":"",semver.gte(e,"14.3.0")&&semver.lt(e,"18.0.0")&&!process.env.WALLABY_ELECTRON_RUN_AS_NODE&&(this._quokkaSettings.env.params.runner+="--experimental-top-level-await "),(semver.gte(e,"19.0.0")&&semver.lt(e,"20.0.0")||semver.lt(e,"20.0.0")&&semver.lt(e,"18.19.0")||semver.gte(e,"20.0.0")&&semver.lt(e,"20.6.0"))&&(t=semver.gte(e,"16.12.0")?"hooks-v2.mjs":"hooks.mjs",this._quokkaSettings.env.params.runner+=`--experimental-loader "${url.pathToFileURL(path.join(path.dirname(process.mainModule.filename),`runners/node/${this._quokkaSettings.testFramework.version}/`+t))}"`)):(p.stdEsm=!0,p.nativeEsm=!1)}p.stdEsm&&(this._quokkaSettings.env.params.runner=this._quokkaSettings.env.params.runner?this._quokkaSettings.env.params.runner+" ":"",this._quokkaSettings.env.params.runner+=`-r "${path.join(path.dirname(process.mainModule.filename),"node_modules/esm-wallaby")}"`,this._quokkaSettings.env.params.env+=";ESM_OPTIONS="+JSON.stringify({await:!0}))}this._quokkaSettings.quokka.nativeEsm=p.nativeEsm},S=p.babel&&!0===p.babel.ts,P=_.endsWith(this._quokkaFileName,".ts")||_.endsWith(this._quokkaFileName,".tsx")||_.endsWith(this._quokkaFileName,".cts")||_.endsWith(this._quokkaFileName,".mts");if(p.vite||!P||S)if(!p.vite&&p.babel){delete p.babel.ts,delete p.ts,process.env.VUE_CLI_BABEL_TRANSPILE_MODULES="true",_.isObject(p.babel)||(p.babel={}),process.env.BABEL_ENV||(process.env.BABEL_ENV=p.babel.env||"test");var F,C=[path.join(this._localRoot,"node_modules","@babel/core"),path.join(this._localRoot,"node_modules","babel-core"),path.join(this._globalSettingsDir,"node_modules","@babel/core"),path.join(this._globalSettingsDir,"node_modules","babel-core")];try{try{const T=utils_1.default.requireResolve("@babel/core",{paths:[this._localRoot]});C.unshift(T)}catch(e){}try{const T=utils_1.default.requireResolve("babel-core",{paths:[this._localRoot]});C.unshift(T)}catch(e){}p.babel.path&&path.resolve(p.babel.path)&&C.unshift(path.resolve(p.babel.path));var T=_.find(C,e=>this._fileExistsSync(e));if(!T)throw new Error("Babel core is not found");~T.indexOf("@babel")&&utils_1.default.patchBabelResolve(T),F=require(T),p.babel.path=T,S&&P&&(p.babel.tsconfigPaths={path:d("tsconfig-paths")}),p.babel.registerPath=d("@babel/register")}catch(e){return void(this._quokkaSettings.error=`Configured to use babel, but can not find babel-core or @babel/core module
${e.message}

Tried to search for babel core in these folders:
`+_.map(C,e=>"  "+e).join("\n"))}s&&utils_1.default.patchModulesCode([{files:["@babel/plugin-proposal-private-property-in-object/lib/index.js"],replacements:[{from:"setTimeout(console.warn, 2500",to:"setTimeout(() => {}, 0",optional:!0}]}]),this._quokkaSettings.compilers[this._quokkaFileName]=require("./babelCompiler")(this._localRoot)(_.extend({babel:F,renameTypeScriptFiles:!1,asyncTransform:p.nativeEsm},_.omit(p.babel,"env","path","polyfill","ignore","tsconfigPaths","registerPath"))),p.babel.version=F.version,x(!0)}else x();else delete p.babel,p.ts=p.ts||{},x(!1);if(!p.vite&&p.ts){var E,j=path.join(this._instrumentedRoot,this._quokkaFileName).replace(/\.[^/.]+$/,""),R=(this._useMemoryFs(j+".js"),this._useMemoryFs(j+".jsx"),delete p.js,_.isObject(p.ts)||(p.ts={}),p.ts.compilerOptions||{}),I=p.ts.path;if(I){I=path.resolve(I);try{E=require(I),p.ts.path=I}catch(e){return void(this._quokkaSettings.error='Configured to use "'+I+'" as TypeScript path, but can not find the `typescript` module')}}if(!E)try{I=path.join(this._localRoot,"node_modules","typescript");try{I=utils_1.default.requireResolve("typescript",{paths:[this._localRoot]})}catch(e){}E=require(I)}catch(e){try{I=path.join(this._globalSettingsDir,"node_modules","typescript"),E=require(I)}catch(e){try{I=path.resolve(this._editorTypeScript),E=require(I)}catch(e){try{E=require("typescript"),I=path.join(path.dirname(process.mainModule.filename),"node_modules/typescript")}catch(e){return void(this._quokkaSettings.error="Can not load `typescript`, please install TypeScript as a dependency of your project.")}}}}let e={},t=path.join(this._localRoot,this._quokkaFileName),s=!0;for(;s&&t!==path.dirname(t);){var B=path.dirname(t);if(B===t){s=!1;break}t=B;var O=path.join(t,"tsconfig.json");if(this._fileExistsSync(O)){try{e=require("./typeScriptUtils").getCompilerOptions(E,O)}catch(e){throw new Error(`Error while loading ${O}:
`+e.message)}s=!1}t.length===this._originalLocalRoot.length&&(s=!1)}if(R.baseUrl||(R.baseUrl=e.baseUrl),(R=Object.assign(Object.assign({},e),R)).baseUrl&&!path.isAbsolute(R.baseUrl)?R.baseUrl=path.join(this._localRoot,R.baseUrl):R.baseUrl||(R.baseUrl=this._localRoot),R.paths){let t=path.relative(this._localRoot,R.baseUrl);if(t)for(var W in"win32"===process.platform&&(t=t.replace(/\\/g,"/")),R.baseUrl=this._localRoot,R.paths)R.paths[W]=R.paths[W].map(e=>t+"/"+e)}R.module=p.nativeEsm?"esnext":"commonjs",R.jsx="react",R.noEmit=!1,R.noEmitOnError=!1,R.emitDeclarationOnly=!1,void 0!==R.target&&(!this._snapsOnlyMode||"ES3"!==R.target&&"ES5"!==R.target)||(R.target="ES6"),delete R.removeComments,process.env.TS_NODE_COMPILER=I;var L=Object.assign(Object.assign({jsx:"react"},p.ts.compilerOptions),{module:p.nativeEsm?"esnext":"commonjs"});try{semver.gte(E.version,"4.1.0")&&(L.jsxImportSource="")}catch(e){}p.nativeEsm||100!==R.moduleResolution&&"bundler"!==R.moduleResolution||(L.moduleResolution="Node16"),process.env.TS_NODE_COMPILER_OPTIONS=JSON.stringify(L);var M,V,z,U=[5110],J=(process.env.TS_NODE_IGNORE_DIAGNOSTICS=process.env.TS_NODE_IGNORE_DIAGNOSTICS?process.env.TS_NODE_IGNORE_DIAGNOSTICS+","+U.join(","):U.join(","),{typescript:E,files:{"**/*.ts?(x)":R,"**/*.cts":R,"**/*.mts":R}});this._quokkaSettings.postprocessor=require("./typeScriptPostprocessor")(this._localRoot)(J),p.ts.path=I,p.ts.version=E.version,p.ts.tsNode={path:d("ts-node")},R&&R.baseUrl&&(p.ts.tsconfigPaths={path:d("tsconfig-paths")}),!p.ts.swc&&void 0!==p.ts.swc||(M=path.join(p.ts.tsNode.path,"dist","transpilers","swc.js"),this._fileExistsSync(M)&&(V=require(path.join(p.ts.tsNode.path,"package.json")).version,!h(z=d("@swc/core",!1)||d("@swc/wasm"))||semver.gte(V,"10.9.2"))?(p.ts.swc=!0,p.ts.swcTranspilerPath=M,p.ts.swcPath=z,p.ts.version+=" + swc"):p.ts.swc=!1),p.ts.compilerOptions=R,p.ts.tsNode.path!==path.join(path.dirname(process.mainModule.filename),"node_modules","ts-node")&&void 0!==process.env.TS_NODE_TRANSPILE_ONLY||(process.env.TS_NODE_TRANSPILE_ONLY="true")}else if(!p.vite){var D=path.join(this._localRoot,this._quokkaFileName),$=!0,N=p.js&&p.js.compilerOptions||null;if(!N)for(;$&&D!==path.dirname(D);){var D=path.dirname(D),A=path.join(D,"jsconfig.json");if(this._fileExistsSync(A)){try{N=require("./typeScriptUtils").getCompilerOptions(require("typescript"),A)}catch(e){throw new Error(`Error while loading ${A}:
`+e.message)}$=!1}D.length===this._originalLocalRoot.length&&($=!1)}N?p.js={compilerOptions:N,tsconfigPaths:{path:d("tsconfig-paths")}}:delete p.js}p.plugins&&p.plugins.length&&(p.plugins=_.uniq(p.plugins)),p.snaps=this._quokkaSettings.quokka.snaps,p.snapsOnlyMode=this._quokkaSettings.quokka.snapsOnlyMode,process.env.quokka=JSON.stringify(p)}catch(e){this._quokkaSettings=this._quokkaSettings||{},this._quokkaSettings.error=e.message}let e=process.version;process.env.WALLABY_ELECTRON_RUN_AS_NODE&&(e+=" - Electron"),this._emitInternal(_.extend({type:"configChanged",settings:this._quokkaSettings},p,{nodeVersion:e}))}_combinePostprocessors(e){const a=this;if(2!==e.length)throw new Error("Only TypeScript postprocessor chaining is supported.");var t=e[0],l=e[1];return function(o){return _.each(o.affectedFiles,e=>{e=a._structure.filesById[e.id];e&&!a._isOriginallyVue(e)&&a._deleteDependantFilesMetadata(e)}),t(o).then(e=>{var t,s,r,i,n;return e.removePostprocessor?(a._settings.postprocessor=l,debug("TypeScript postprocessor is removed as requested by itself"),a._overrideFileTypesIncludedInTypeScriptCompiler=!1):(e=function(e){var t=a._createPostProcessorInputFile(!1,e);return e.originalId&&(t.id=e.originalId,t.originalType=e.originalType),t},t=e=>e&&(_.isEmpty(e.dependant)&&(!e.tmp||e.originalId&&!a._isOriginallyVue(a._structure.filesById[e.originalId]))||a._isOriginallyVue(e)),n=function(e){e=a._structure.filesById[e.id];return!e||_.isEmpty(e.dependant)||a._isOriginallyVue(e)?e:_.values(e.dependant)[0]},a._updateFileOrder(),s=_.chain(a._structure.testFilesInOrder).filter(t).map(e).value(),r=_.chain(a._structure.sourceFilesInOrder).filter(t).map(e).value().concat(s),i=_.chain(o.affectedFiles).map(n).filter(t).map(e).value(),n=_.chain(o.affectedTestFiles).map(n).filter(t).map(e).value(),o=_.extend(o,{allTestFiles:s,allFiles:r,affectedFiles:i,affectedTestFiles:n})),l(o)})}}configFilePath(){return this._configFile}coreVersion(){return this._coreVersion}projectName(){var e;return(null==(e=this._settings)?void 0:e.name)||path.basename(this._localRoot)}async preloadStructure(t=!1){if(!this._preloadedStructure)try{this._preloadedStructure=await this._fileStructureCachePromise(path.join(this._root,this._structureFile));let s={};try{s=await this._fileStructureCachePromise(path.join(this._root,this._testExecutionTimesFile))}catch(e){s={}}Object.keys(this._preloadedStructure.filesByPath).forEach(e=>{var t=s[e];t&&(this._preloadedStructure.filesByPath[e].testExecutionTimes=t)})}catch(e){if(this._preloadedStructure={},t)throw e}return this._preloadedStructure}signalInitialRun(){this._signalInitialRun&&this._signalInitialRun()}async start(s){var e=this._init(s,this);this._emitInternal({type:"starting",files:s.files});try{await e,this._live&&this.stop(),debug("File cache: %s",this._root),this._live=!1,await Promise.all([this._dirEnsurePromise(this._originalRoot),this._dirEnsurePromise(this._instrumentedRoot)])}catch(e){throw this._cleanStack(e),this.emitTestRunError({text:e.stack||e.message,header:"Pre-initialization"}),this._signalIfBecameLive(),e}this._emitInternal({type:"loadingProjectStarted"});let r=!1;try{try{let t={};try{t=await this.preloadStructure(!0)}catch(e){if(t={},e&&e.error)throw this._signalIfBecameLive(),this._cleanStack(e),e}var i=async()=>{await this._dirRemovePromise(this._instrumentedRoot),await this._dirEnsurePromise(this._instrumentedRoot)},n=async e=>{try{return(await this._fileStatPromise(e)).mtime.getTime()}catch(e){return 0}},[o,a,c]=await Promise.all([n(this._packageJson),n(this._babelrc),n(this._babelrcjs)]);let e=!1;t.invalidateCache?(debug("Invalidating local cache as requested"),e=!0):o!==t.packageJsonTimestamp?(debug("package.json file change detected, invalidating local cache"),e=!0):a!==t.babelrcTimestamp?(debug(".babelrc file change detected, invalidating local cache"),e=!0):c!==t.babelrcJsTimestamp?(debug(".babelrc.js file change detected, invalidating local cache"),e=!0):t.configCode===this._settings.configCode&&this._structureFileFormatVersion===t.version||(debug("Config file change detected, invalidating local cache"),e=!0),e?(delete t.timestamp,await i(),t={packageJsonTimestamp:o,babelrcTimestamp:a,babelrcJsTimestamp:c}):(t.packageJsonTimestamp=o,t.babelrcTimestamp=a,t.babelrcJsTimestamp=c),this._emit({type:"awaitingInitialRunSignal"}),await this._initialRunSignal,t.timestamp||(t.timestamp=Date.now()),this._structure=Object.assign({filesByPath:{},filesRenamed:{},filesById:{},testFilesById:{},testFileSelectionById:{included:{},excluded:{}},awaitingFiles:[],configCode:this._settings.configCode},t),this._structure.awaitingFiles=[],this._structure.sourceFilesInOrder=[],this._structure.testFilesInOrder=[],!this._structure.notifiedAboutWallabyApp&&this.startLegacyGuiService&&(emitDiagnostic({name:"uiServiceReady"}),this._structure.notifiedAboutWallabyApp=!0);const p=s.files.reduce((e,t)=>(e[t.path]=!0,e),{}),d=(Object.values(this._structure.filesByPath).forEach(e=>{p[e.path]||(e=this._deleteFileMetadata(e))&&((this.isZeroConfigJest()||this.isVitest()||this.isNativeBundler()||this.isNodeNative())&&!e.inOriginalFilesCache||this._unlinkFilePromise(e.originalPath),this.isZeroConfigJest()||this.isVitest()||this.isNativeBundler()||this.isNodeNative()||this._unlinkFilePromise(e.instrumentedPath))}),[]),h=[];let l=!!process.env.quokka;s.files.forEach(s=>{var e,t=s.path;const r=0===t.indexOf("..")?path.basename(s.path):s.path;s.test||this._settings.tests.some(e=>e.ignore&&utils_1.default.pathMatchesPattern(r,e.regexp,e.options))?l=!0:(e=this._settings.tests.find(e=>!e.ignore&&utils_1.default.pathMatchesPattern(r,e.regexp,e.options)))&&emitDiagnostic({name:"genericError",message:"File/pattern "+s.path+" is specified in the files list but also found in the tests list: "+e.pattern+".\r\n\tIf it's a test, make sure to exclude it from the files list, for example by adding { pattern: '"+e.pattern+"', ignore: true } to the files list.\r\n\tIf it's not a test, remove it from the tests list."});let i=this._structure.filesByPath[t];const n=i&&i.id===s.id;let o=!1;if(i?(i.includedExplicitlyTestFile=s.includedExplicitlyTestFile,i.smartModeStart=s.smartModeStart,i=this._createFileMetadata(i,s.id),s.order&&(i.order=s.order),i.ts!==s.ts&&(this._settings.extractComments&&s.coverable||!this.isZeroConfigJest()&&!this.isVitest()&&!this.isNativeBundler()&&!this.isNodeNative())&&(this._structure.awaitingFiles.push(s.id),o=!0)):(i=this._createFileMetadata(s,s.id),(this._settings.extractComments&&s.coverable||!this.isNativeBundler()&&(!(this.isZeroConfigJest()||this.isVitest()||this.isNodeNative())||i.test))&&(this._structure.awaitingFiles.push(s.id),o=!0)),i.includedExplicitlyTestFile&&h.push(i.path),(this.isZeroConfigJest()||this.isVitest()||this.isNodeNative())&&(i.validSyntax=!0,n?s.ts!==i.ts&&(!o&&i.test&&(this._structure.awaitingFiles.push(s.id),o=!0),i.changeTs=+new Date):i.changeTs=+new Date),this.isNativeBundler()&&(i.validSyntax=!0,s.ts!==i.ts)&&(i.changeTs=+new Date),!o&&!this.isNativeBundler()&&(!(this.isZeroConfigJest()||this.isVitest()||this.isNodeNative())||i.test)){const a=(e,t)=>e?t?e.toString("base64"):e.toString():"";d.push((async()=>{try{await this._fileStatPromise(i.originalPath)}catch(e){trace("No cached file %s, requesting it",s.path),this._structure.awaitingFiles.push(s.id)}if(i.inOriginalFilesCache=!0,!(this.isZeroConfigJest()||this.isVitest()||this.isNodeNative()))if(n)try{await this._readFilePromise(i.instrumentedPath)}catch(e){trace("No instrumented file %s, re-instrumenting original file",s.path);var t=await this._readFilePromise(i.originalPath);await this._processFile(i,a(t,i.binary),void 0,!0,!1)}else{t=await this._readFilePromise(i.originalPath);trace("Re-instrumenting original file %s because its ID has changed",s.path),await this._processFile(i,a(t,i.binary),void 0,!0,!1)}})())}}),this._settings.smartStart&&(this._smartStartTestRun=!0,h.length?this.setTestLocations(h):(this._tracker.featureUsed("smartStart"),this._testLocations=new Set,this._updateSettingsTestLocations())),l||emitDiagnostic({name:"genericError",message:"No files with tests found, check your tests list patterns."}),this._fileOrderUpdatePending=!0;var u=this._runnerResolver(this._settings.env.type,this._settings.env.kind);this._testRunner=new u(this),this._emitInternal({type:"loadingProjectComplete"}),r=!0,await Promise.all(d.concat([this._testRunner.start()]))}catch(e){throw this._signalIfBecameLive(),this._cleanStack(e),e}}finally{r||(this._emitInternal({type:"loadingProjectComplete"}),r=!0)}return this._signalIfBecameLive()?(debug("File cache is up-to-date, starting full test run"),this._queueTestRunFromFileChanges(null,!0),this._scheduleTestRun()):(debug("File cache requires some updates, waiting required files from IDE"),this._emit({type:"filesRequired",files:this._structure.awaitingFiles})),this._structure}smartStartTestRun(){return this._smartStartTestRun}file(s){var t,r=this,i=e=>{e.isTransientChange?!1!==r._hasPendingTransientFileChangesOnly&&(r._hasPendingTransientFileChangesOnly=!0):r._hasPendingTransientFileChangesOnly=!1};if(s.tsOnlyChange){let e;s.inEditor&&(s.file&&s.file.path&&(e=r._changeQueue.changes[s.file.path])&&e.length&&(this._hasAnyPendingInEditorFileChanges=!0),i(s)),r._fileChangesInProcess?e&&e.length&&(e[e.length-1].file.ts=s.file.ts):(t=r._structure.filesByPath[s.file.path])&&(t.ts=s.file.ts),void(process.env.WALLABY_INTEGRATION_TEST_RUN||r._testRunInProgress||r._emit({type:"testRunReQueued",tsOnlyChange:!0}))}else{if(r._emitInternal({type:"file",file:s.file,delete:s.delete,inEditor:s.inEditor,logMarkers:s.logMarkers,extractedComments:s.extractedComments,isTransientChange:s.isTransientChange,snapOutputOnlyChange:s.snapOutputOnlyChange}),!process.env.quokka||s.inEditor)return(s.inEditor||process.env.WALLABY_INTEGRATION_TEST_RUN)&&(this._hasAnyPendingInEditorFileChanges=!0),i(s),new Promise(function(e,t){try{r._isTestTriggeringFileChange(s)&&r._tryCancelActiveTestRun(testTask_1.runPriority.fileChangePriority),r._queueFileChange(s),r.paused?(r._hasAnyPendingPausedFileChanges=!0,debug("File changed, but the project is paused")):r.runOnSave&&s.inEditor&&!s.isTransientChange?(debug("File changed in editor and set to only run on save, will not schedule test run"),r._emitInternal({type:"fileMarkersInvalid"})):r._scheduleChangedQueueProcessing(),e(void 0)}catch(e){t(e)}});r._structure&&r._filesAreUpToDate([s.file.id])}}scheduleChangedQueueProcessing(){this._scheduleChangedQueueProcessing()}scheduleChangeQueueProcessingIfInEditorPendingChanges(){this.hasAnyPendingInEditorFileChanges()&&this._scheduleChangedQueueProcessing()}hasAnyPendingPausedFileChanges(){return this._hasAnyPendingPausedFileChanges}hasAnyPendingInEditorFileChanges(){return this._hasAnyPendingInEditorFileChanges}runTests(e){this.runOnSave&&this.scheduleChangeQueueProcessingIfInEditorPendingChanges();var t=this,s=t.settings().quokka;if(s&&e.externalFileChange&&!t._expressionsToEvaluateReceived){if(s.ignoreExternalFileChanges)return;if(t._testRunInProgress)return;if(t._lastRunFinishTime&&+new Date-t._lastRunFinishTime<(s.externalFileChangeTimeout||1e3))return}if(!(s&&e.externalFileChangePath&&e.externalFileChangePath.endsWith(".mjs")&&-1!==e.externalFileChangePath.indexOf(".-timestamp"))){if(delete t._expressionsToEvaluateReceived,t._tryCancelActiveTestRun(testTask_1.runPriority.testRunPriority),e.tests)t._queueRequestedTestRun(e.tests),debug("Requested to run some tests");else if(e.catchup){if(!this._catchupTestTask)throw new Error("Invalid run tests request");if(debug("Debugger stopped"),!this.runOnSave){if(!this._catchupTestTask.hasAnyFiles()&&!this._catchupTestTask.isFullRun())return void delete this._catchupTestTask;t._testTask=this._catchupTestTask}}else t._queueFullTestRun(!0),debug("Requested to run all tests");e.evaluateExpression&&(debug("Evaluated expression test run"),t._testTask.setEvaluatedExpressionRun()),e.initialTraceRun&&(debug("Debugger start test run"),t._tracker.featureUsed("debug.start"),t._testTask.setInitialTraceRun(e.initialTraceRun)),e.codeClipSharingRun&&(debug("Code Clip sharing test run"),t._testTask.setCodeClipSharingRun(e.codeClipSharingRun)),e.profileRun&&(debug("Profiler start test run"),t._tracker.featureUsed("profile.start"),t._testTask.setProfileRun(e.profileRun)),e.updateSnapshots&&(debug("Snapshots update test run"),t._tracker.featureUsed("updateSnapshots"),t._testTask.setUpdateSnapshotsRun()),t._scheduleTestRun()}}screen(t){var s=this;return s._settings&&"browser"===s._settings.env.type?s._testRunner.screenShotReady.then(function(){return s._readFilePromise(s._screenPath)}).catch(function(){return trace("Unable to load test run screen shot"),Q.when(!1)}).then(function(e){e&&s._emit({type:"screen",screen:Buffer.from(e).toString("base64")},t)}):Q.when(!1)}expressionsToEvaluate(e){this._emitInternal({type:"expressionsToEvaluateReceived",expressionsToEvaluate:e.expressionsToEvaluate}),this._expressionsToEvaluate=this._expressionsToEvaluate||{all:{},byRequestor:{}};var t=e.requestorId||"unknown",s=this._expressionsToEvaluate.byRequestor[t]||{};this._expressionsToEvaluate.byRequestor[t]=e.append?utils_1.default.mergeDeep(s,e.expressionsToEvaluate):e.expressionsToEvaluate||{},0===Object.keys(this._expressionsToEvaluate.byRequestor[t]).length&&delete this._expressionsToEvaluate.byRequestor[t],this._expressionsToEvaluate.all=utils_1.default.mergeDeep({},...Object.values(this._expressionsToEvaluate.byRequestor)),this._expressionsToEvaluateReceived=!0}hasExpressionToEvaluate(e){var t;return!(null==(t=this._expressionsToEvaluate)||!t.all[e])}traceContext(e){(this._traceContext=e)||delete this._catchupTestTask}traceContextStepsToRecordWatchExpressionsAt(e){this._traceContext&&(this._traceContext.stepsToRecordWatchExpressionsAt=e)}stop(e,t,s){var r,i=this;if(i._live=!1,i._tracker.dispose(),clearTimeout(i._emitBusyTimeout),s=s||{},Object.values(i._changeQueue.changes).forEach(e=>{e=null==(e=null==(e=null==e?void 0:e[0])?void 0:e.file)?void 0:e.id;e&&(s[e]=!0)}),i._quokkaTempDir)try{i._dirRemoveSync(i._quokkaTempDir)}catch(e){}debug("Stopping wallaby.js");try{i._unlinkFileSync(path.join(i._root,i._structureFile))}catch(e){}try{i._unlinkFileSync(path.join(i._root,i._testExecutionTimesFile))}catch(e){}debug("Killing %s spawned process(es)",_.keys(spawnedProcesses).length),_.each(spawnedProcesses,function(e){try{e.kill()}catch(e){}}),i._multicaster&&i._multicaster.stop(),e||i._flushSourceFileCacheSync(),i._legacyGuiService&&i._legacyGuiService.stop(),debug("Stopping test runner"),i._testRunner&&i._testRunner.stop(),i._profileViewer&&i._profileViewer.stop(),!e&&i._structure&&(r={version:i._structureFileFormatVersion,timestamp:i._structure.timestamp,filesByPath:i._structure.filesByPath,configCode:i._structure.configCode,packageJsonTimestamp:i._structure.packageJsonTimestamp,babelrcTimestamp:i._structure.babelrcTimestamp,babelrcJsTimestamp:i._structure.babelrcJsTimestamp,invalidateCache:i._invalidateCache,notifiedAboutWallabyApp:i._structure.notifiedAboutWallabyApp,postProcessorStartupTime:i._postProcessorStartupTime},_.each(r.filesByPath,function(e,t){delete e.changeTs,delete e.changeStart,delete e.changePosition,delete e.logMarkers,delete e.numberOfFunctionsChanged,delete e.lastChangeIsComplex,delete e.relatedFilesWithTests,delete e.lastSingleChangeTest,delete e.dependant,delete e.parentFilePath,delete e.inOriginalFilesCache,delete e.tmpLineMap,delete e.compiledTmpLineMap,delete e.noCompilers,delete e.noPreprocessors,delete e.sourceMap,delete e.testFilesLoadedFrom,delete e.tests,delete e.notInstrumentedLogMarkers,delete e.liveCommentLines,delete e.logpointInfo,delete e.testExecutionTimes,i._settings.extractComments||delete e.extractedComments,s&&s[e.id]&&(e.ts=-1),e.tmp&&(delete r.filesByPath[t],e.notStored||i._unlinkFileSync(e.instrumentedPath))}),e=JSON.stringify(r),debug("Saving file structure"),i._writeFileSync(path.join(i._root,i._structureFile),e),i._writeFileSync(path.join(i._root,i._testExecutionTimesFile),JSON.stringify(t)))}idByPath(e){e=this._structure.filesByPath[e];if(e)return e.id}invalidateCache(){this._invalidateCache=!0}settings(){return this._settings}setTestLocations(e){if((e=this._validatePaths(e)).length)this._testLocations=new Set(e);else{if(!this._testLocations)return;delete this._testLocations}this._updateSettingsTestLocations(),this._updateIncludedExplicitlyTestFiles()}addTestLocations(e){if((e=this._validatePaths(e)).length){if(this._testLocations&&0!==this._testLocations.size)for(const t of e)this._testLocations.add(t);else this._testLocations=new Set(e);this._updateSettingsTestLocations(),this._updateIncludedExplicitlyTestFiles()}}removeTestLocations(e){if((e=this._validatePaths(e)).length&&this._testLocations){for(const t of e)if(this._testLocations.delete(t),0===this._testLocations.size){delete this._testLocations;break}this._updateSettingsTestLocations(),this._updateIncludedExplicitlyTestFiles()}}hasTestLocation(e){return this._testLocations&&this._testLocations.has(e)}_validatePaths(e){return e?e.filter(e=>-1===e.indexOf("../")):[]}_updateSettingsTestLocations(){if(this._settings.runSelectedTestsOnly=!!this._testLocations,this._testLocations){this._settings.testLocations=[];for(const e of this._testLocations)this._settings.testLocations.push(e)}else delete this._settings.testLocations;this._emit({type:"testRunModeAvailable",testLocations:this._settings.testLocations,selectedTests:{included:_.map(this.getIncludedTestFiles(),e=>e.path),excluded:_.map(this._getExcludedTestFiles(),e=>e.path)}})}_updateIncludedExplicitlyTestFiles(){var e=this._structure.testFilesById;for(const s in e)if(e.hasOwnProperty(s)){var t=e[s];if(this._testLocations){let e=!1;for(const r of this._testLocations)if(""===r||t.path.startsWith(r)){e=!0;break}e?t.includedExplicitlyTestFile=!0:delete t.includedExplicitlyTestFile}else delete t.includedExplicitlyTestFile;this._updateFileStructure(t)}}_cleanStack(t,s){if(t){var r,i,n=process.mainModule&&path.dirname(process.mainModule.filename)||"";if(t.stack&&_.isString(t.stack)?(i=t.stack.toString(),0===(i=t.message&&!~i.indexOf(t.message)?t.message+"\n"+i:i).indexOf("Error: ")&&(i=i.substr(7)),r=!1,i=this._cleanMessage(_.filter(i.split("\n"),(e,t)=>{if(!(r=r||_.contains(e,"quokkaStackTraceMarker")||_.contains(e,"snapRootStackTraceMarker"))&&!_.contains(e,"From previous event:"))return!t||!/(\s+at|^at)\s+/.test(e)||!s&&!_.contains(e,n)||s&&_.contains(e,s)}).join("\n")),n&&(i=i.split(n).join("[wallaby core]"))):i="",!_.isUndefined(i))try{t.stack=i}catch(e){try{Object.defineProperty(t,"stack",{value:i})}catch(e){try{return Object.assign({},t,i)}catch(e){}}}return t}}_cleanMessage(e,t){return(!this._settings||!this._settings.preservePaths)&&e&&_.isString(e)?(t?e.split(t):e.split(this._instrumentedRoot).join("<rootDir>").split(this._localRoot)).join("<rootDir>"):e}_startProcessorPool(){trace("Starting processor pool (if not yet started)"),this._processorPool.start(process.mainModule.filename)}_tryCancelActiveTestRun(e){process.env.quokka&&(e=testTask_1.runPriority.fileChangePriority),this._runCancelRequester=e;e=this._testRunner&&this._testRunner.cancel(e);e?debug("Test run was cancelled"):!1===e&&debug("Test run is not cancelled because cancel requester does not have enough priority to cancel the run")}_originalLineByFileId(e,t,s){e=this._structure.filesById[e];return e&&e.getFileLineMap()?utils_1.default.getOriginalLineByGeneratedLine(e.getFileLineMap(),t,s):t}_originalLineByFilePath(e,t,s){e=this._structure.filesByPath[e];return e&&e.getFileLineMap()?utils_1.default.getOriginalLineByGeneratedLine(e.getFileLineMap(),t,s):t}stackEntryByFileId(e,t,s){if(e===bundleFileId){var r=this._structure.filesById[bundleFileId];if(!r)return;r=r.fileAndLineByLine(t);if(!r||!_.isNumber(r[0])||!this._structure.filesById[r[0]])return;e=r[0],t=r[1]}r={file:e};return r.line=this._originalLineByFileId(r.file,t,s),r}stackEntryByFilePath(e,t,s){var r=this._structure.filesByPath[e]||this._structure.filesByPath[this._structure.filesRenamed[e]||""];if(r&&((!r.tmp||(r=this._structure.filesById[r.originalId]))&&(!r.childFilePath||(r=this.getFileMetadataByPath(r.childFilePath)))&&(!r||!r.hideFromErrorStackTrace)))return e=r.path,(r={file:r.id}).line=this._originalLineByFilePath(e,t,s),r}stackEntryByFileIdWithoutLineMapping(e,t){e=this._structure.filesById[e];if(e)return{file:e.path,loc:""+t,line:t}}_specialStringValue(e){return"raw"!==e.type&&"html"!==e.type||"string"!=typeof e.value?"unknown"===e.type&&"string"==typeof e.error?e.error:void 0:e.value}copyToClipboard(t){if("string"==typeof t.data)utils_1.default.copyToClipboard(t.data),this._emit({type:"copyToClipboard",data:t.data});else if(Array.isArray(t.data)){var s=require("util");let e="";for(const n of t.data){var r=this._specialStringValue(n.value);e+=(void 0!==r?r:s.formatWithOptions?s.formatWithOptions({depth:null},this._buildObject(n.value)):s.format(this._buildObject(n.value)))+"\n"+(n.loc?`at ${n.loc.file}${n.loc.line?":"+n.loc.line+(n.loc.column?":"+n.loc.column:""):""}
`:"")}utils_1.default.copyToClipboard(e),this._emit({type:"copyToClipboard",data:e})}else{let e="";var i=this._specialStringValue(t.data);e=void 0!==i?i:(i=this._buildObject(t.data),(t=require("util")).formatWithOptions?t.formatWithOptions({depth:null},i):t.format(i)),utils_1.default.copyToClipboard(e),this._emit({type:"copyToClipboard",data:e})}}formatObject(e){var t=this._buildObject(e),s=require("util"),s=s.formatWithOptions?s.formatWithOptions({depth:null},t):s.format(t);return"string"===e.type.toLowerCase()?`'${(s||"").replace(/'/g,"\\'").replace(/\\"/g,'"')}'`:s}_buildObject(e){let t;switch(e.type.toLowerCase()){case"date":return new Date(e.value).toJSON();case"regexp":return new RegExp((e.value||"").replace(/^\//,"").replace(/\/$/,""));case"symbol":case"boolean":case"string":case"number":return e.capped?e.capped+"...":e.nan?NaN:e.positiveInfinity?1/0:e.negativeInfinity?-1/0:e.value;case"null":return null;case"undefined":return;case"array":t=[];break;default:t={}}return _.each(e.props,e=>this._handleProperty(e,t)),t}_handleProperty(e,t){var s;e.rangeNode||e.functionsNode?_.each(e.props,e=>this._handleProperty(e,t)):e.getter||(e.loadActionNode?t["..."]="...":e.type&&"function"!==e.type&&"symbol"!==e.type&&!e.symbol&&(s=e.name.startsWith("'")&&e.name.endsWith("'")?e.name.substr(1,e.name.length-2).replace(/\\'/g,"'"):e.name,t[s]=this._buildObject(e)))}isNotificationMuted(e){try{return!!JSON.parse(this._readFileSync(this._notificationSettingsFile))[e]}catch(e){emitDiagnostic({name:"genericWarning",message:"Unable to read notification settings file: "+(e&&e.message)})}}muteNotification(e){try{var t=JSON.parse(this._readFileSync(this._notificationSettingsFile));t[e]={},this._writeFileSync(this._notificationSettingsFile,JSON.stringify(t))}catch(e){emitDiagnostic({name:"genericWarning",message:"Unable to read/write notification settings file: "+(e&&e.message)})}}_emit(e,t){t&&t.id&&(e.id=t.id),this.emit("message",e)}_emitInternal(e,t){e._internal=!0,this._emit(e,t)}_isJavaScript(e){var t=this;return!!(this._isOriginallyJavaScript(e)||utils_1.default.isJavaScript(e.instrumentedType,this._settings&&this._settings.extensions&&this._settings.extensions.javascript)||_.find(e.dependant,e=>t._isJavaScript(e))||e.instrumentedByTestingFramework)}_isOriginallyJavaScript(e){return utils_1.default.isJavaScript(e.type,this._settings&&this._settings.extensions&&this._settings.extensions.javascript)}_isOriginallyVue(e){return e&&utils_1.default.isVue(e.type)}_isOriginallyCoffeeScript(e){return utils_1.default.isCoffeeScript(e.type,e.originalPath)}_isOriginallyTypeScript(e){return utils_1.default.isTypeScript(e.type)}_isOriginallySvelte(e){return e&&utils_1.default.isSvelte(e.type)}async _runTests(e){var t=this,s=(this._traceContext&&this._traceContext.test?(e.setRegularTraceRunTest(this._traceContext.test),this._catchupTestTask.mergeTask(e)):e.isInitialTraceRun()?this._catchupTestTask=new testTask_1.TestTask(this):delete this._catchupTestTask,t._updateFileOrder(),e.isFullRun()),r=e.isUserRequestedRun(),i=e.isUpdateSnapshotsRun(),n=e.isFileChangedRun(),o=e.files(),a=e.testData(),l=null==(l=this._expressionsToEvaluate)?void 0:l.all,c=a&&a.files,a=a&&a.names,u=e.getPriority(),p=this._hasPendingTransientFileChangesOnly;if(delete this._hasAnyPendingPausedFileChanges,n&&(delete this._hasAnyPendingInEditorFileChanges,delete this._hasPendingTransientFileChangesOnly),s&&debug("Running all tests"),n&&c&&_.isEmpty(c)&&!_.find(o,function(e){return t._isJavaScript(e)}))return Q.when({queueAgain:!0});var d=t._structure.sourceFilesInOrder,c=c?t._orderFilesByConfig(t._expandDependantFiles(c)):t._structure.testFilesInOrder,h=_.find(d.concat(c),function(e){return t._isJavaScript(e)&&!e.validSyntax&&e.coverable});if(h)return t._emitInternal({type:"queuedTestRunInvalidSyntax"}),Q.when({queueAgain:!0,file:h.path});var g,f=t._selectRunnerFiles(c),h=t._selectRunnerFiles(d);if(!f.length&&o){c=_.map(o,e=>e.id);if(_.isEqual(c,t._lastChangedFileIds)||(t._lastChangedFileIds=c),!t._structure.testFilesInOrder.length)return debug("No test files to run, waiting for test files to be discovered."),t._emitInternal({type:"queuedTestRunCannotDetermineTestsToRun"}),Q.when({queueAgain:!0});if(emitDiagnostic({name:"cannotDetermineTestsToRun",runAllTestsWhenNoAffectedTests:!!t._settings.runAllTestsWhenNoAffectedTests,onlyRunSelectedTestFiles:t.hasSomeSelectedTestFiles()}),!t._settings.runAllTestsWhenNoAffectedTests||t.hasSomeSelectedTestFiles())return t._emitInternal({type:"queuedTestRunCannotDetermineTestsToRun"}),Q.when({queueAgain:!0});f=t._selectRunnerFiles(t._structure.testFilesInOrder),s=!(a=void 0),u=e.getFullRunPriority(),debug("Test task priority upgraded to full run")}else delete t._lastChangedFileIds;process.env.quokka&&t._recycleRunner&&(delete t._recycleRunner,g=!0);d=e.isInitialTraceRun()&&e.initialTraceRunData(),c=this.selectedTestFiles();if(this._settings.smartStart&&!c.hasSomeIncludedTestFiles&&!d)return t._emitInternal({type:"queuedTestRunSmartStart"}),Q.when({queueAgain:!0});this.settings().runSelectedTestsOnly&&!c.hasSomeIncludedTestFiles&&(h.length=0,f.length=0);c=e.isInitialTraceRun()||e.isRegularTraceRun();const m=e.profileRunData();var v=_.filter(f,function(e){return!!e.include});return t._emitInternal({type:"runningTests",hasPendingTransientFileChangesOnly:p,changeRun:n,fullRun:s,recordTrace:c,userRequestedInitialTraceRun:d,tests:e.tests(),specFiles:v.map(e=>{var t={id:e.originalId||e.id,testExecutionTimes:e.testExecutionTimes};return delete e.testExecutionTimes,t}),codeClipSharingRun:e.isCodeClipSharingRun()&&e.codeClipSharingRunData()}),t._testRunner.run({framework:t._settings.testFramework,fullRun:s,screen:t._screenPath,filesToLoad:_.filter(h,function(e){return!!e.include}),allFiles:h,testFilesToLoad:v,allTestFiles:f,tests:a,priority:u,manualRun:r,updateSnapshotsRun:i,profileRun:!!m||void 0,recycleBeforeRun:g,expressionsToEvaluate:l,traceContext:c&&(this._traceContext||{})||void 0}).then(e=>(e.globalErrors&&e.globalErrors.length||_.each(o,e=>{delete e.testFilesLoadedFrom}),e.testFiles=_.filter(f,e=>!e.tmp),e.profileRunData=m,Q.when(e)))}_expandDependantFiles(t){return _.each(t,function(e){_.extend(t,e.dependant||{})}),t}_fullInstrumentedPathForTestRunner(e){return e.instrumentedPath}_fullLocalPathForTestRunner(e){return path.join(this._localRoot,e.path)}_selectRunnerFiles(e){var s=this;return _.map(e,function(e){var t=path.relative(s._instrumentedRoot,e.instrumentedPath);return{path:s.isZeroConfigJest()||s.isVitest()||s.isNodeNative()?s._fullLocalPathForTestRunner(e):s._fullInstrumentedPathForTestRunner(e),relativePath:t,normalizedRelativePath:s.normalizePath(t),ts:e.changeTs,runnerCacheKey:e.runnerCacheKey,id:e.id,tmp:e.tmp,test:e.test,instrument:e.coverable,changeStart:e.changeStart,changePosition:e.changePosition,logMarkers:e.logMarkers,extractedComments:e.extractedComments,relatedFilesWithTests:e.relatedFilesWithTests,parentFilePath:e.parentFilePath,numberOfFunctions:e.numberOfFunctions,childFilePath:e.childFilePath,inOriginalFilesCache:e.inOriginalFilesCache,originalId:e.originalId,originalType:e.originalType||e.type,include:e.include,esm:e.esm,type:e.instrumentedType||e.type,rangesLength:e.ranges&&e.ranges.length||0,shadowed:!_.isEmpty(e.dependant),content:process.env.quokka?s._getQuokkaContent(e):void 0,testExecutionTimes:e.testExecutionTimes}})}_queueFileChange(e){if(!e.file)throw new Error("File is missing");var t,s=e.file.path;if(!s)throw new Error("File path is missing");(e.delete?(delete this._changeQueue.changes[s],this._changeQueue.deletes[s]=this._changeQueue.deletes[s]||[]):(s=this._changeQueue.changes[s]=this._changeQueue.changes[s]||[],this.paused&&0<s.length&&((t=s[s.length-1]).file={content:t.file.content},delete t.logMarkers,delete t.extractedComments,delete t.delete,delete t.isTransientChange,delete t.suppressesSingleTestFileChangeStart,e.suppressesSingleTestFileChangeStart=!0),s)).push(e),this._changeQueue.containsTestTriggeringFileChanges=this._changeQueue.containsTestTriggeringFileChanges||this._isTestTriggeringFileChange(e)}_emitBusy(e){e&&(this._allowedToSendBusy=!0),this._allowedToSendBusy&&(this._emit({type:"busy"}),this._tracker.busy(),this._allowedToSendBusy=!1,this._emitBusyTimeout=setTimeout(()=>{this._allowedToSendBusy=!0,clearTimeout(this._emitBusyTimeout)},100))}_scheduleChangedQueueProcessing(e){var r=this;e=e||r._settings.delays.update,r._emitBusy(!0),r._changedQueueTimeout&&clearTimeout(r._changedQueueTimeout),r._changedQueueTimeout=setTimeout(function(){var s;r._fileChangesInProcess||r._testRunInProgress||!r._structure?r._scheduleChangedQueueProcessing(Math.max(e,50)):(r._emitBusy(),delete r._changedQueueTimeout,r._fileChangesInProcess=!0,s=!r._live,r._processChangedQueue().then(function(e){r._fileChangesInProcess=!1;var t=s&&r._live;e.length&&(t||_.find(e,function(e){return r._isTestTriggeringFileChange(e)}))?(r._queueTestRunFromFileChanges(e,t),!r._testTriggeringPendingChanges()&&r._live&&r._scheduleTestRun()):(debug("Changes did not trigger any tests"),r._emit({type:"testRunReQueued",snapOutputOnlyChange:process.env.quokka&&e.length&&!e.find(e=>!e.snapOutputOnlyChange)}))}).catch(function(e){debug("Test queueing failure: "+e&&(e.stack||e.message)),r._cleanStack(e),r.emitTestRunError({text:e&&e.message,header:"Test queueing"})}))},e)}_isTestTriggeringFileChange(e){var t="snap"===e.file.type&&!e.inEditor;return e.file.triggersTests&&!t&&!e.snapOutputOnlyChange}_testTriggeringPendingChanges(){return this._changeQueue.containsTestTriggeringFileChanges}_queueTestRunFromFileChanges(e,t){var s,r,i=this;t?i._queueFullTestRun():i._testTask.isFullRun()||(i._testTask.setFileChangeRunPriority(),i._traceContext&&i._traceContext.test&&i._testTask.setRegularTraceRunTest(i._traceContext.test),r=s=!1,_.each(e,function(e){s=s||e.added,r=r||e.deleted;var t=e.file;e.deleted?i._testTask.addTests(e.tests):i._testTask.addChangedFile(t,e.tests)}),s&&i._testTask.filesAdded(),r&&i._testTask.filesDeleted())}_queueRequestedTestRun(e){this._testTask.addTests(e),this._testTask.setTestRunPriority()}_queueFullTestRun(e){this._testTask=new testTask_1.TestTask(this),this._testTask.setFullRunPriority(),e&&this._testTask.setUserRequestedRun()}async _performPostProcessing(t){var e={};const s=[];if(!this._settings.postprocessor)return{postprocessorTestDependencies:e,postprocessorTestRunErrors:s};this._emitInternal({type:"postProcessorStarted",startupTime:this._structure.postProcessorStartupTime});var r=Date.now();try{if((t.isUserRequestedRun()||t.isEditorRequestedRun())&&!t.isFullRun())return{postprocessorTestDependencies:e,postprocessorTestRunErrors:s};debug("Running postprocessor");var i=t.testData(),n=this._settings.env.bundle&&(t.anyFilesAdded()||t.anyFilesDeleted()),o=this._createPostProcessorArgument({timestamp:this._structure.timestamp,native:this.isNativeBundler(),bundleAllowed:n,affectedFiles:Object.values(t.files()),affectedTestFiles:i&&i.files,anyFilesAdded:t.anyFilesAdded(),anyFilesDeleted:t.anyFilesDeleted(),logger:{error:e=>{e={stack:e};this._cleanStack(e),s.push({message:e.stack})}},dot:this.settings().dot});!o.anyFilesAdded&&!o.anyFilesDeleted||this._settings.postprocessor.ts||this._deleteTmpFiles();try{var a=await this._settings.postprocessor(o);if(this._runCancelRequester>=t.getPriority())throw{runCancelled:!0};if(t.filesNotAdded(),t.filesNotDeleted(),n&&o.bundle.length&&await this._buildBundle(o.bundle),this._runCancelRequester>=t.getPriority())throw{runCancelled:!0};return a&&(debug("Postprocessor execution finished"),a.removePostprocessor&&(debug("Postprocessor is removed as requested by itself"),this._removedPostprocessor=this._settings.postprocessor,this._removedPostprocessor&&this._removedPostprocessor.ts&&(this._overrideFileTypesIncludedInTypeScriptCompiler=!1),delete this._settings.postprocessor),!_.isEmpty(a.testDependencies))?{postprocessorTestDependencies:a.testDependencies,postprocessorTestRunErrors:s}:{postprocessorTestDependencies:e,postprocessorTestRunErrors:s}}catch(e){if(this._runCancelRequester>=t.getPriority())throw{runCancelled:!0};throw debug("Postprocessor run failure: "+e&&(e.stack||e.message)),e.postprocessor=!0,e}}finally{void 0===this._postProcessorStartupTime&&(this._postProcessorStartupTime=Date.now()-r),this._emitInternal({type:"postProcessorComplete"})}}_scheduleTestRun(e){this._emitBusy(!0),void 0===e&&(e=!this._firstScheduleTestRunComplete&&process.env.quokka?(this._firstScheduleTestRunComplete=!0,0):this._settings.delays.run),this._testTask&&process.env.quokka&&this._testTask.setFileChangeRunPriority(),this._testRunTimeout&&clearTimeout(this._testRunTimeout),this._testRunTimeout=setTimeout(async()=>{if(this._fileChangesInProcess||this._testRunInProgress||!this._live)this._scheduleTestRun(Math.max(e,this._firstScheduleTestRunComplete?e:50));else{this._emitBusy(),this._emitTestRunStarted(),delete this._testRunTimeout,delete this._runCancelRequester,this._testRunInProgress=!0;var t=this._testTask;this._testTask=new testTask_1.TestTask(this),t&&t.anyFilesAdded()&&this._removedPostprocessor&&!this._settings.postprocessor&&_.find(t.files(),e=>this._isOriginallyTypeScript(e))&&(debug("TypeScript file has been added, re-activating TypeScript postprocessor"),this._settings.postprocessor=this._removedPostprocessor,this._overrideFileTypesIncludedInTypeScriptCompiler=!0,delete this._removedPostprocessor);let s=!1,r={},e=[];try{var i=await this._performPostProcessing(t);r=i.postprocessorTestDependencies,e=i.postprocessorTestRunErrors,this._testSelectionChanged&&(delete this._testSelectionChanged,t.isFileChangedRun()&&delete this._hasAnyPendingInEditorFileChanges,debug("Promoting test run to full run because of test selection changes"),t.setFullRunPriority()),debug("Test run started; run priority: %s",t.getPriority()),s=await this._runTests(t)}catch(e){e.runCancelled?(debug("Test run cancelled, re-queueing run data"),s={queueAgain:!0,rerun:e.rerun}):e.postprocessor?(this.isNativeBundler()?this.emitTestRunError({text:this._cleanStack({stack:utils_1.default.removeAnsi(e.message)}).stack,header:"Postprocessor"}):this.emitTestRunError({text:"Postprocessor run failure: "+e.message,header:"Postprocessor"}),s={queueAgain:!0,testErrorReported:!0}):this.emitTestRunError({text:(process.env.quokka?"":"Test run failure: ")+(e&&e.stack),header:"Test run"})}try{if(debug("Test run finished"),!_.isEmpty(r)&&s&&_.each(s.loadingSequence,(e,t)=>{s.loadingSequence[t]=_.keys(_.reduce((e||[]).concat(r[t]||[]),(e,t)=>(e[t]=!0,e),{}))}),delete this._runCancelRequester,s){if(e.length&&(s.globalErrors=(s.globalErrors||[]).concat(e)),s.profile){this._emit({type:"testRunReQueued",profileRun:!0});var n=this._processProfile(s.profile);if(s.profileRunData&&"editor"===s.profileRunData.target)this._writeFileSync(this._profilePath,JSON.stringify(n)),this._emit({type:"profileAvailable",path:this._profilePath});else{this._profileViewer||(this._profileViewer=new chromeProfileViewer_1.ProfileViewer(this));let e;s.tests&&s.tests[0]&&(e=s.tests[0].name);let t;s.profileRunData&&(t=s.profileRunData.file);try{await this._profileViewer.show(n,t||"Profile",e||"Test profile")}catch(e){if(e)throw this._cleanStack(e),e}}return this._testRunInProgress=!1,void this._emit({type:"profileTestRunComplete"})}if(s.queueAgain){if(s.file&&(debug("File has invalid syntax: "+s.file),this.emitTestRunError({text:"Test run failure: file "+s.file+" has invalid syntax",header:"File parsing"}),s.testErrorReported=!0),this._testTask.mergeTask(t),debug("Test run data re-queued"),this._emit({type:"testRunReQueued",rerunScheduled:s.rerun,testErrorReported:s.testErrorReported}),s.rerun)return this._testRunInProgress=!1,this._lastRunFinishTime=+new Date,void this._scheduleTestRun(100)}else{var o=s.globalErrors&&s.globalErrors.length,a=o||this._hadGlobalErrorsPreviousRun;(this._hadGlobalErrorsPreviousRun=o)&&s.testFiles&&(this._lastAffectedTestFileIds=_.map(s.testFiles,e=>e.id)),s.changed=!!t.isFullRun()||_.reduce(t.files(),function(e,t){var s=!!t.lastSingleChangeTest;return delete t.lastSingleChangeTest,e[t.id]={singleTestChange:!a&&s},e},{}),this._emit(this._processCoverageResult({time:s.time,type:"testResults",fullRun:t.isFullRun(),fileChangedRun:t.isFileChangedRun()},s)),debug("Test run result processed and sent to IDE")}}}catch(e){return this._testRunInProgress=!1,this._lastRunFinishTime=+new Date,this._testRunTimeout&&(clearTimeout(this._testRunTimeout),this._scheduleTestRun(100)),debug("Failed to process test run results",e.stack),void emitDiagnostic({name:"genericError",message:utils_1.default.formatWithoutColors(["Failed to process test run results",e.stack])})}this._testRunInProgress=!1,this._lastRunFinishTime=+new Date,this._testRunTimeout&&(clearTimeout(this._testRunTimeout),this._scheduleTestRun(100))}},e)}navigationRequested(s,r){if("string"==typeof s){var i=utils_1.default.normalizePath(s).split(":");let e=i.slice(0,i.length-1).join(":"),t=(e=path.relative(this._localRoot,e),parseInt(i[i.length-1],10));t?t--:t=0,process.env.quokka&&this._originalQuokkaFileName&&e===this._quokkaFileName&&(e=this._originalQuokkaFileName),this.emit("message",{type:"navigationRequested",path:e,line:t||1,options:r})}else this.emit("message",{type:"navigationRequested",path:s.file,line:s.line||1,column:s.column||0,options:r})}uiThemeChanged(e){this.emit("message",{type:"uiThemeChanged",name:e})}updateAppSettings(e){this._writeFileSync(path.join(this._globalSettingsDir,"ui.json"),JSON.stringify(e))}valuePeekMaybeChanged(e){this.emit("message",{type:"valuePeekMaybeChanged",value:e})}getAppSettings(){return JSON.parse(this._readFileSync(path.join(this._globalSettingsDir,"ui.json")))}_processProfile(e){var n=process.mainModule&&utils_1.default.normalizePath(path.dirname(process.mainModule.filename))||"";return _.each(e.nodes,i=>{var e,t,s,r;i&&i.callFrame&&i.callFrame.url&&0!==i.callFrame.url.indexOf("node:")&&(~i.callFrame.url.indexOf(n)||0===i.callFrame.url.indexOf("http")&&~i.callFrame.url.indexOf("__wallaby__")&&!_.endsWith(i.callFrame.url,"framework.js")?(i.callFrame.functionName="(worker)",i.callFrame.scriptId="0",i.callFrame.url="",i.callFrame.lineNumber=-1,i.callFrame.columnNumber=-1):((e=i.callFrame.lineNumber+1)&&(r={stack:i.callFrame.url+`:${e}:`+i.callFrame.columnNumber,suppressErrorReporting:!0},null!=(t=(s=this._testRunner).mapStack)&&t.call(s,r),r.stack.length?([t,s]=r.stack[0],(r=this._getFileMetadataById(t))&&(i.callFrame.lineNumber=s,i.callFrame.columnNumber=0,i.callFrame.url=utils_1.default.fileUrl(this._fullLocalPathForTestRunner(r)))):i.callFrame.lineNumber=e),i.positionTicks&&_.each(i.positionTicks,e=>{var t,s,r;1<=e.line&&(r={stack:i.callFrame.url+":"+e.line,suppressErrorReporting:!0},null!=(s=(t=this._testRunner).mapStack)&&s.call(t,r),r.stack.length)&&(e.line=r.stack[0][1])})))}),e}_buildBundle(e){var i=1/0,n="",o=[],a=1,e=(_.each(e,e=>{e.file.include=!1,e.file.notStored=!0;var t=e.content+"\n",s=(i=Math.min(i,e.file.order),utils_1.default.textLines(t).length),s=a-1+s-1,r=[a,s];r.file=e.file.originalId,o.push(r),a=1+s,n+=t}),{id:bundleFileId,path:"____wallaby-bundle.js",ts:+new Date,tmp:!0,type:"js",instrumentedType:"js",include:!0,order:i-.1,test:!1}),t=this._createFileMetadata(e,e.id);return t.originalId=e.id,t.fileAndLineByLine=function(e){for(var t=0,s=o.length-1;t<=s;){var r=Math.floor((s+t)/2),i=o[r];if(e>=i[0]&&e<=i[1])return[i.file,e-i[0]+1];e>i[1]?t=r+1:s=r-1}},this._fileOrderUpdatePending=!0,this._doWriteFileWithLruCache(t.instrumentedPath,n)}hadGlobalErrorsPreviousRun(e){return void 0!==e&&(this._hadGlobalErrorsPreviousRun=e),this._hadGlobalErrorsPreviousRun}emitTestRunError(e){this._emit({type:"testRunError",message:this._cleanMessage(e.text||""),header:e.header})}_emitTestRunStarted(){this._emit({type:"testRunStarted"})}_deleteDependantFiles(e,t){var s=this;return t=t||[],_.each(e.dependant,e=>{t.push(s._unlinkFilePromise(e.instrumentedPath).catch(()=>{})),s._deleteDependantFiles(e,t)}),t}async _processChangedQueue(){var t=[],i=[],n=[],o=this._structure,s=this.isZeroConfigJest()||this.isVitest()||this.isNativeBundler()||this.isNodeNative(),a=e=>{var t=[];if(e&&e.tests)for(const s in e.tests)e.tests[s]===runOneTime&&delete e.tests[s],t.push(s.split(testPathSeparator));return t};for(const f in this._changeQueue.deletes)for(const m of this._changeQueue.deletes[f]){var r,l=o.filesById[m.file.id];if(l){let e=[];if(this._deleteDependantFiles(l,t),this._deleteFileMetadata(m.file),l.test){this._lastAffectedTestFileIds&&(-1<(r=this._lastAffectedTestFileIds.indexOf(m.file.id))&&this._lastAffectedTestFileIds.splice(r,1),this._lastAffectedTestFileIds.length||(this._lastAffectedTestFileIds=void 0));for(const v in o.filesById){var c=o.filesById[v];for(const y in c.tests)y!==f&&!_.startsWith(y,f+testPathSeparator)||delete c.tests[y]}}else e=a(l);s&&!l.inOriginalFilesCache||t.push(this._deleteSourceFile(l.originalPath)),s||t.push(this._unlinkFilePromise(l.instrumentedPath)),n.push({file:l,deleted:!0,tests:e})}}var u=[];for(const b in this._changeQueue.changes){var p=this._changeQueue.changes[b],d=p[p.length-1],h=o.filesByPath[b];let e=[],t=!1,s=!1,r=!!d;for(const w of p)e=e.concat(w.file.affectedTests||[]),t=t||w.inEditor,s=s||w.suppressesSingleTestFileChangeStart,r=r&&w.snapOutputOnlyChange;var g=h&&h.test||d.file.test,g=(e.length||(e=g?[[d.file.id]]:a(h)),g&&u.push(d.file.id),this._getOrCreateFileMetadata(d.file));g.logMarkers=d.logMarkers,g.extractedComments=d.extractedComments,i.push(this._writeFileChanges(g,d.file.fullContent,p.map(e=>e.file.content),d.file.ts,s,r)),n.push({file:g,added:!h,tests:e,inEditor:t,snapOutputOnlyChange:r})}u.length&&(this._lastAffectedTestFileIds=u),this._changeQueue={changes:{},deletes:{}};try{return await Promise.all(t),await Promise.all(i),this._filesAreUpToDate(n.map(e=>e.file.id)),n}catch(e){return debug("File system update failure: "+e&&(e.stack||e.message)),this._filesAreUpToDate(n.map(e=>e.file.id)),this._cleanStack(e),this.emitTestRunError({text:e&&e.message,header:"File system update"}),[]}}normalizePath(e){return utils_1.default.normalizePath(e)}_createPostProcessorArgument(e){var c=this,t=c._createPostProcessorInputFile.bind(c,(e=e||{}).native),s=c._settings.testLocations?e=>!(e.tmp||e.test&&!e.includedExplicitlyTestFile):e=>!e.tmp,r=(c._updateFileOrder(),_.chain(c._structure.testFilesInOrder).filter(s).map(t).value()),i=_.chain(c._structure.sourceFilesInOrder).filter(s).map(t).value().concat(r),n=e.affectedFiles&&e.affectedFiles.length&&_.chain(e.affectedFiles).filter(s).map(t).value()||i,s=e.affectedTestFiles&&e.affectedTestFiles.length&&_.chain(e.affectedTestFiles).filter(s).map(t).value()||r,u=(delete e.affectedFiles,delete e.affectedTestFiles,e.bundleAllowed);return _.extend({},{bundle:[],anyFilesAdded:!0,anyFilesDeleted:!1,allFiles:i,allTestFiles:r,affectedFiles:n,affectedTestFiles:s,nodeModulesDir:c._nodeModules,baseDir:e.native?c._localProjectDir:c._instrumentedRoot,tsPostprocessorOnly:c._settings.postprocessor.ts,settings:c._settings,setFileOrder:function(e){var t;return e.file&&e.file.id&&(c._fileOrderUpdatePending=!0,t=c._getFileMetadataById(e.file.id))&&(t.order=e.order),Q.when(e.order)},createFile:async function(e){var t=_.ltrim(path.extname(e.path),"."),s=c.normalizePath(e.path),s=_.extend(e,{id:s,path:s,ts:e.ts||+new Date,tmp:!0,type:t,instrumentedType:t,include:!1!==e.load,order:e.order||0,test:e.test||!1!==e.test&&e.original&&e.original.test}),{includedTestFile:r,excludedTestFile:i}=c._getFileMetadataById(s.id)||{},r=(s.includedTestFile=!!r,s.excludedTestFile=!!i,c.isNativeBundler()),i=c._createFileMetadata(s,s.id);let n=!(c._fileOrderUpdatePending=!0);n=r?u&&!i.test&&"original"in e:u&&!i.test&&"original"in e&&e.content&&0===e.content.indexOf("window.__moduleBundler.cache");let o,a;if(r){if(e.original&&e.original.id&&(o=c._structure.filesById[e.original.id],i.originalId=o.id,i.testExecutionTimes=o.testExecutionTimes,i.originalType=o.originalType||o.type,o.dependant||(o.dependant={}),(o.dependant[i.id]=i).ranges)){if(e.sourceMap&&(o.lineMap=utils_1.default.updateFileMap({},[e.sourceMap])),o.ranges=[],e.extra.sourceMap)try{const l=new utils_1.default.SourceMapConsumer(e.extra.sourceMap);_.each(i.ranges||[],e=>{e=utils_1.default.mapTransformedRangeToOriginal(l,e);e&&e[3]===1/0&&(e[3]=e[1]+1),o.ranges.push(e||[])})}catch(e){debug("Failed to map ranges for [%s], error: %s",o.path,e.message)}else o.ranges=i.ranges;e.extra.usedLogpoints&&c._emit({type:"usedLogpoints",file:i.path,logpoints:e.extra.usedLogpoints}),o.instrumentedType=t,o.numberOfFunctionsChanged=o.numberOfFunctions!==e.extra.numberOfFunctions,o.numberOfFunctions=e.extra.numberOfFunctions,o.loggedRanges=e.extra.loggedRanges,o.notInstrumentedLogMarkers=e.extra.notInstrumentedLogMarkers,o.liveCommentLines=e.extra.liveCommentLines,o.lastSingleChangeTest=o.test&&!o.numberOfFunctionsChanged&&e.extra.testName||void 0,o.lastSingleChangeTest&&debug("Detected single test [%s] change",e.extra.testName),o.include=!1,i.test&&(c._settings.extractComments?(s=o.extractedComments,c._updateTestFileSelection(o,{includedTestFile:s&&s.testFileSelection&&s.testFileSelection.included,excludedTestFile:s&&s.testFileSelection&&s.testFileSelection.excluded}),s&&delete s.testFileSelection):c._updateTestFileSelection(o,{includedTestFile:e.extra.includedTestFile,excludedTestFile:e.extra.excludedTestFile}))}a=n?e.content:await c._doWriteFileWithLruCache(i.instrumentedPath,e.content)}else{r=e.original&&e.original.id&&e.ranges&&e.sourceMap;e.original&&e.original.id&&((o=c._structure.filesById[e.original.id]).instrumentedType=t,i.originalId=o.id,i.testExecutionTimes=o.testExecutionTimes,i.originalType=o.originalType||o.type,i.ranges=o.ranges,i.loggedRanges=o.loggedRanges,i.rangeFunctions=o.rangeFunctions,i.notInstrumentedLogMarkers=o.notInstrumentedLogMarkers,i.liveCommentLines=o.liveCommentLines,o.dependant||(o.dependant={}),delete o.dependant[i.id],(s=_.values(o.dependant)[0])&&(!1===s.noCompilers?c._deleteFileMetadata(s):s=void 0),o.dependant[i.id]=i,e.sourceMap&&!r&&(o.tmpLineMap=utils_1.default.updateFileMap(s&&(o.compiledTmpLineMap||o.tmpLineMap)||o.lineMap,[e.sourceMap])),r)&&(i.noCompilers=!1,i.sourceMap=e.sourceMap,i.ranges=e.ranges,i.type="js",i.lineMap=utils_1.default.updateFileMap(i.lineMap,[e.sourceMap]),i.coverable=o.coverable,i.hideFromErrorStackTrace=o.hideFromErrorStackTrace,i.numberOfFunctions=o.numberOfFunctions,i.changePosition=_.textIndexPosition(c._getInstrumentedFileContent(o),o.changeStart),i.logMarkers=o.logMarkers,i.extractedComments=o.extractedComments),r?(a=await c._processFile(i,e.content,void 0,!1,!0,!!n),o.tmpLineMap=i.lineMap,o.compiledTmpLineMap=i.lineMap,o.ranges=i.ranges,o.loggedRanges=i.loggedRanges,o.rangeFunctions=i.rangeFunctions,o.logpointInfo=i.logpointInfo,o.notInstrumentedLogMarkers=i.notInstrumentedLogMarkers,o.liveCommentLines=i.liveCommentLines,o.validSyntax=i.validSyntax,o.include=!1,o.numberOfFunctionsChanged=i.numberOfFunctionsChanged,o.numberOfFunctions=i.numberOfFunctions,o.lastSingleChangeTest=i.lastSingleChangeTest,delete i.lineMap):a=n?e.content:await c._doWriteFileWithLruCache(i.instrumentedPath,e.content)}n&&this.bundle.push({file:i,content:a})}},e,{logger:c._createPostprocessorLogger(e.logger)})}_createPostprocessorLogger(e){e=e||{};var t=logger.create("postprocessor");return{debug:t.debug,trace:t.trace,error:e.error||(e=>{emitDiagnostic({name:"genericError",message:e})}),log:e.log||(e=>{emitDiagnostic({name:"postProcessorLog",message:e})})}}_createPostProcessorInputFile(t,s){var r=this;return{path:t?s.path:r.normalizePath(path.relative(r._instrumentedRoot,s.instrumentedPath)),fullPath:t?path.resolve(path.join(r._localProjectDir,s.path)):s.instrumentedPath,binary:s.binary,ts:s.changeTs,id:s.id,type:!t&&s.instrumentedType||s.type,load:s.include,initialLoad:s.initialInclude,instrument:s.coverable,test:s.test,order:s.order,changeStart:s.changeStart,changePosition:s.changePosition,logMarkers:s.logMarkers,extractedComments:s.extractedComments,getContent:function(){var e;return t?r.getLatestOriginalFileContentByPathAsync(s.path):(e=r._lruCache.get(s.instrumentedPath))?Q.when(e):r._readFilePromise(s.instrumentedPath)},getContentSync:function(){return t?r.getLatestOriginalFileContentByPath(s.path):r._getInstrumentedFileContent(s)},setOrder:function(t,e){r._fileOrderUpdatePending=!0,e&&_.each(s.dependant,e=>{e.order=t}),s.order=t}}}_getQuokkaContent(e){return this._settings.quokka.vite?this._sourceFileCache[e.originalPath].content:this._getInstrumentedFileContent(e)}_getInstrumentedFileContent(e){return this._lruCache.get(e.instrumentedPath)||this._readFileSync(e.instrumentedPath)}getInstrumentedJavaScriptFileContentByPath(e){var t,e=this._structure.filesByPath[e];if(e)return(t={})[e.path]=e,(e=_.find(this._expandDependantFiles(t),e=>_.isEmpty(e.dependant)&&"js"===e.type)||e)&&this._getInstrumentedFileContent(e)}getLatestOriginalFileContentByPath(e,t){var s,r=this._structure.filesByPath[e];if(r)return(s=this._writeSourceFileCache[r.originalPath]||this._sourceFileCache[r.originalPath])?s.content:(this.isZeroConfigJest()||this.isVitest()||this.isNodeNative()||this.isNativeBundler())&&!r.inOriginalFilesCache?this._readFileSync(path.join(this._localRoot,r.path)):this._readFileSync(r.originalPath);if(null!=t&&t.useFsForUnknownFiles)try{return this._readFileSync(path.join(this._localRoot,e))}catch(e){}}async getLatestOriginalFileContentByPathAsync(e){var t,e=this._structure.filesByPath[e];if(e)return(t=this._writeSourceFileCache[e.originalPath]||this._sourceFileCache[e.originalPath])?t.content:(this.isZeroConfigJest()||this.isVitest()||this.isNativeBundler()||this.isNodeNative())&&!e.inOriginalFilesCache?await this._readFilePromise(path.join(this._localRoot,e.path)):await this._readFilePromise(e.originalPath)}findTestFile(e){for(var t=this,s=e.files||[],r=0,i=s.length;r<i;r++){var n,o=s[r];if(n=t._structure.testFilesById[o])return n}if(e.testFile&&(n=t._structure.testFilesById[e.testFile]))return n;if(o=t._structure.filesById[s[0]]){var a=_.keys(o.testFilesLoadedFrom||{})[0];if(a)return(n=t._structure.testFilesById[a])&&debug('Test "%s" without test file id mapped to %s (%s)',e.name,n.path,JSON.stringify({log:e.log,filesInvolved:_.map(e.files,function(e){e=t._structure.filesById[e];return e?e.path:"unknown or deleted file"})})),n}}resolveLogEntryRange(e){var t,s;return!("log"!==e.type&&"autoLog"!==e.type&&"diff"!==e.type&&"system"!==e.type||!_.isNumber(e.file)||!_.isNumber(e.range)||(t=this._getFileMetadataById(e.file),s=e.range,t&&(e.range=t.ranges[s],e.range&&!e.range.length&&(e.range=this._findPreviousValidRange(t.ranges,s)),e.range&&e.range.length||delete e.range),0))}addTestFileWithGlobalErrorToTestTask(e){this._testTask&&this._testTask.addTestFileWithGlobalError(e)}_findPreviousValidRange(e,t){for(;0<t;){var s=e[--t];if(s&&s.length)return s}}_processValueExplorerValues(r){_.each(r,({entry:e},t)=>{var s;e.valueBag.data.proxyData&&(t=r[t.split("#")[0]])&&(s=(e,t)=>{t.label=Object.assign({name:t.proxyData.path.join(".")+" "+t.proxyData.trap.toUpperCase()},t.label),t.expressionPath=(t.expressionPath||[]).slice().concat(t.proxyData.path.map(e=>"."+e)),e.props.push(t)},(t=t.entry).valueBag.data.proxyContainerNode?s(t.valueBag.data.props[0],e.valueBag.data):(s(s={disallowToCopyPath:!0,disallowToCopyData:!0,expandable:!0,label:{name:"Accessed Members"},props:[],id:t.valueBag.data.id+",proxyNode",proxyNode:!0},e.valueBag.data),t.valueBag.data={disallowToCopyPath:!0,disallowToCopyData:!0,proxyContainerNode:!0,id:t.valueBag.data.id+",valueContainer",autoExpand:t.valueBag.data.autoExpand,changeId:t.valueBag.data.changeId,expandable:!0,label:t.valueBag.data.label,props:[s,Object.assign(Object.assign({},t.valueBag.data),{label:Object.assign({name:"Value"},t.valueBag.data.label)})]}))})}_processCoverageResult(b,w){var k=this,d=(b.ts=Date.now(),b.files=[],b.tests=[],b.testMatchSnapshotCalls={},b.log=w.log,b.globalErrors=w.globalErrors,b.fileChanges=w.fileChanges,b.additionalHeaderMessage=this._additionalHeaderMessage(),k._settings.reportConsoleErrorAsError&&{});const r={};var e=b.log.slice();const h=new Map,i=(e,t)=>{h.has(e)?h.get(e).push(t):h.set(e,[t])},o={},x=(b.log=[],_.each(e,function(e){if(!k.resolveLogEntryRange(e)&&"error"===e.type&&d)t={message:"\n"!==e.text&&e.text||"[console.error without any message]",stack:[]},(e.spec?d[e.spec]=d[e.spec]||[]:(b.globalErrors||(b.globalErrors=[]),b.globalErrors)).push(t);else{if(e&&e.valueBag&&e.valueBag.data&&e.valueBag.data.id){if(_.isNumber(e.valueBag.traceStep)){const s=e.valueBag;i(e.valueBag.traceStep,e=>{s.traceStep=e,s.preciseTraceStep||(o[e]=o[s.traceStep],delete o[s.traceStep])}),e.valueBag.preciseTraceStep||(o[e.valueBag.traceStep]=e)}if(e.valueBag.data.proxyData)return void(r[e.valueBag.data.id]={entry:e});var t=r[e.valueBag.data.id];if(t)return b.log[t.index]=e,void(t.entry=e);r[e.valueBag.data.id]={index:b.log.length,entry:e}}b.log.push(e)}}),this._processValueExplorerValues(r),debug("Processed console.log entries"),_.each(w.loadingSequence,function(e,s){_.each(e,e=>{var t=k._structure.filesById[e],t=(t&&!k.settings().ignoreFileLoadingDependencyTracking&&(t.testFilesLoadedFrom=t.testFilesLoadedFrom||{},t.testFilesLoadedFrom[s]=runAlways),k._structure.testFilesById[e]);s!==e&&t&&(e=k._structure.testFilesById[s])&&b.globalErrors.push({message:`Test file '${e.path}' is importing or is causing import of another test file '${t.path}'.
This may cause tests in the '${t.path}' file to be executed more than once (when the test file runs and every time it gets imported).
If the '${t.path}' test file contains some test helper code, try refactoring the reused code into a file of its own and use it by importing the new file into '${e.path}' and '${t.path}' test files.`})})}),debug("Processed loading sequences"),new errorTraceMapper_1.ErrorTraceMapper);w.trace&&null!=(e=b.globalErrors)&&e.forEach(e=>x.error(e));var s,t,n,S={},g={},f=!1,a=(_.each(w.tests,function(e){if("disabled"!==e.status&&!S[e.id]){e.matchSnapshotCalls&&_.each(e.matchSnapshotCalls,e=>{var t,s=k._structure.filesById[e.fileId];s&&s.matchSnapshotRanges&&(s=s.matchSnapshotRanges[e.snapshotCallRangeId])&&(t=b.testMatchSnapshotCalls[e.fileId]=b.testMatchSnapshotCalls[e.fileId]||{},delete e.snapshotCallRangeId,delete e.fileId,t[s[0]]=e)}),d&&(u=d[e.id])&&(e.log=(e.log||[]).concat(u));for(var t=b.tests,s=b,r=0,i=e.suite.length;r<i;r++){var n=e.suite[r];(s=_.find(t,function(e){return e.name===n&&e.tests}))||t.push(s={name:n,tests:[]}),t=s.tests}var o,a,l,c,u=!(!e.log||!e.log.length),p=k.findTestFile(e);p?(o=p.id,(l=e.suite.slice()).unshift(p.path),l.push(e.name),a=l.join(testPathSeparator),u&&k._testTask.failingTest(o,l),(p=g[a])?(debug("Test name duplicate: "+e.name),e.name+=" #"+p,g[a]=p+1):g[a]=1,l={name:e.name,id:e.id,fileId:o,log:e.log,time:e.time,slow:e.slow,status:e.status,duplicateNumber:p,parentTests:e.parentTests},s.tests.push(l),S[e.id]={out:l,timeRange:e.timeRange},_.each(e.files,function(e){e=k._structure.filesById[e];e&&(e.tests[a]=runAlways)}),c=[],_.each(l.log,function(t){t.external&&t.stack&&(_.each(t.stack,function(e){e=k._structure.filesById[e[0]];e&&(e.tests[a]=e.tests[a]||runOneTime,e.test)&&e.id!==o&&(t._global=!0)}),t._global&&c.push(t),delete t.external),t.snapshot=t.snapshot||!(!t.message||!(~t.message.indexOf(".toMatchSnapshot(")||~t.message.indexOf(".toThrowErrorMatchingSnapshot(")||~t.message.indexOf("Snapshot name:")&&~t.message.indexOf("Received")||t.message.startsWith("Snapshot `")&&~t.message.indexOf("mismatched"))),w.trace&&x.error(t)}),c.length&&(b.globalErrors=(b.globalErrors||[]).concat(c),l.log=_.filter(l.log,function(e){return!e._global}))):(emitDiagnostic({name:"genericWarning",message:utils_1.default.formatWithoutColors(["Test without test file id, most likely the test did not run, OR the test/test body is in the file that is not in the `tests` list in the configuration file",{testFileIdCanNotBeDetermined:e.name,id:e.id,log:e.log,filesInvolved:_.map(e.files,function(e){e=k._structure.filesById[e];return e?e.path:"unknown or deleted file"})}])}),u&&(f=!0))}}),f&&(b.globalErrors||(b.globalErrors=[]),b.globalErrors.unshift({message:"Some of the failing tests can not be reported, check the wallaby console for more details"})),debug("Processed executed tests"),k._updateFileOrder(),_.each(!0===w.changed?k._structure.sourceFilesInOrder.concat(k._structure.testFilesInOrder):_.map(w.changed,function(e,t){return k._getFileMetadataById(t)}),function(e){var t;e&&(t=e.id,_.isNumber(t))&&!w.coverage[t]&&k._isJavaScript(e)&&(w.coverage[t]=[])}),{});if(_.each(w.coverage,function(c,u){u=parseInt(u,10);var p,d,e=w.changed[u],h={id:u,ranges:[],changed:!0===w.changed||!!e,singleTestChanged:!(!e||!e.singleTestChange)||void 0},g=(a[u]=h,k._getFileMetadataById(u)),s=(g.instrumentedByTestingFramework&&(h.instrumentedByTestingFramework=!0),g.notInstrumentedLogMarkers&&(h.notInstrumentedLogMarkers=g.notInstrumentedLogMarkers),g.liveCommentLines&&(h.liveCommentLines=g.liveCommentLines),g.ranges),f=(_.each(g.loggedRanges,(e,t)=>{t=s[t];t&&(t.logged=!0)}),g.rangeFunctions&&_.each(g.rangeFunctions,(e,t)=>{e&&(t=s[t])&&(t.functionId=e.id)}),{}),m={},v={},y={};_.each(s,function(i,e){const n=!i.length;var t,s,r,o,a,l=c[e],l=_.map(l,function(e,t){var s,r;return(t=parseInt(t,10))&&(s=S[t])?((r=s.timeRange)&&((r[0]===e||d&&!n)&&(d=n||(g.test&&k._looksLikeTestDeclarationRange(p,i)&&(b.log.push({type:"system",text:_.isNumber(s.out.time)?s.out.time+"ms":"",file:u,range:p,context:""}),s.out.declaration=p),s.out.start=i,u!==s.out.fileId&&(m[s.out.fileId]=!0),!1)),n),t):null});n||(t=(p=i).join("."),s=i[0],(r=v[s])?r.hasMultipleRanges||r.rangeKey===t||(r.hasMultipleRanges=!0):v[s]={rangeKey:t},((r=h.changed||l.length||g.relatedFilesWithTests)||i.hasDuplicates)&&(o={items:i,hits:l},(a=f[t])?(l&&l.length||(y[t]=a),i.logged&&(a.items.logged=i.logged),i.hasDuplicates=!0,a.items.hasDuplicates=!0):(f[t]=o,r&&h.ranges.push(o))),w.trace&&x.fileLineRange(u,s,e))}),_.each(y,e=>{var t=e.items[0],t=v[t];t&&t.hasMultipleRanges&&(e.hits=[])}),_.isEmpty(m)||(g.relatedFilesWithTests=m,_.each(m,function(e,t){t=k._getFileMetadataById(t);t&&(t.relatedFilesWithTests=t.relatedFilesWithTests||{},t.relatedFilesWithTests[g.id]=!0)})),b.files.push(h)}),_.isObject(w.changed)&&(s=function(e){e=a[e];e&&(e.changed=!0,e.singleTestChanged=void 0)},t={},n=function(e){t[e]||(t[e]=!0,(e=k._getFileMetadataById(e))&&e.relatedFilesWithTests&&(s(e.id),_.each(e.relatedFilesWithTests,function(e,t){s(t),n(t)})))},_.each(w.changed,function(e,t){n(t)})),debug("Processed code coverage"),w.trace){b.trace={sequence:[],callStack:w.trace.callStack,tests:w.trace.tests,files:{},maxLengthExceeded:(null==(e=w.trace.sequence)?void 0:e.length)>this._settings.maxTraceSteps,fileRangeSteps:new Map};const m=_.values(w.trace.tests);b.trace.callStack&&Object.keys(b.trace.callStack).forEach(e=>{const t=parseInt(e,10);i(t,e=>{b.trace.callStack[e]=b.trace.callStack[t],delete b.trace.callStack[t]})}),m.forEach(t=>{t.start&&i(t.start,e=>{t.start=e}),t.end&&i(t.end,e=>{t.end=e})});let l=void 0,c=m.shift();const v=[];let u=_.isEmpty(o)?void 0:(e,t)=>{var s=o[t];if(s){delete o[t];var r,[i,n]=s.valueBag.data.id.split(","),i=parseInt(i,10),n=parseInt(n,10);if(e[0]!==i||e[1]!==n)for(r of v.slice().reverse())if(r&&r.data[0]===i&&r.data[1]===n){s.valueBag.traceStep=r.index;break}_.isEmpty(o)&&(u=void 0,v.length=0)}},p=0;_.each(w.trace.sequence,(t,s)=>{if(t[3]=s,p!==s){var e=p,r=h.get(s);if(r){for(const a of r)a(e);h.delete(s)}}var r=t[0],s=k._getFileMetadataById(r),i=(l&&l.end===b.trace.sequence.length&&(l=void 0),c&&c.start===b.trace.sequence.length&&(l=c,c=m.shift()),!!l);if(s){var n=t[1];if(null==(o=null==(o=null==s?void 0:s.ranges)?void 0:o[n])||!o.length)return;var o=b.trace.files[s.path],i=(o?!o.hitFromTest&&i&&(o.hitFromTest=!0,o.start=b.trace.sequence.length):b.trace.files[s.path]={start:b.trace.sequence.length,hitFromTest:i,name:s.path,testFile:s.test||void 0,functions:null==(o=s.rangeFunctions)?void 0:o.reduce((e,t)=>(t&&(e[t.id]={name:t.name}),e),{})},x.traceFrame(s.id,n,p),r+"_"+n);let e=b.trace.fileRangeSteps.get(i);e||(e=[],b.trace.fileRangeSteps.set(i,e)),e.push(p)}u&&(u(t,p),o=t[2],v[o]={data:t,index:p}),p++,b.trace.sequence.push(t)}),debug("Processed code trace")}return b}_looksLikeTestDeclarationRange(e,t){return e&&t&&e[0]<=t[0]&&(e[2]>=t[2]||this.isZeroConfigJest()||this.isVitest()||this.isNativeBundler()||this.isNodeNative())}_filesAreUpToDate(e){return this._structure.awaitingFiles=_.without.bind(null,this._structure.awaitingFiles).apply(null,e),this._signalIfBecameLive()}_filesAreRequired(e){this._structure.awaitingFiles=_.union(this._structure.awaitingFiles,e),this._structure.awaitingFiles.length&&(this._live=!0,this._emit({type:"filesRequired",files:this._structure.awaitingFiles}))}_signalIfBecameLive(){var e;if(this._structure&&!this._structure.awaitingFiles.length&&!this._live)return this._live=!0,e={type:"live"},process.env.quokka||(e.wallabyAppPort=this._legacyGuiService&&this._legacyGuiService.port,e.projectCachePath=this._root),this._emit(e),this.emitQuokkaConfigChanged(),debug("Stopping process pool"),this._processorPool.stop(),!0}emitQuokkaConfigChanged(){if(process.env.quokka){let e=process.version;process.env.WALLABY_ELECTRON_RUN_AS_NODE&&(e+=" - Electron"),this._emitInternal(_.extend({type:"configChanged",settings:this._quokkaSettings},JSON.parse(process.env.quokka),{nodeVersion:e}))}}_writeFileChanges(r,i,e,t,n,o){var a,l=this,c=(r.inOriginalFilesCache=!0,r.changeTs=+new Date,[]);_.each(e,function(e){_.isPatch(e)?c.push(e):(a=e,c.length=0)}),void 0!==i&&(a=i);const u=c.length===e.length&&void 0===i;return trace("File %s changes are patches only: %s",r.path,u),Promise.all([u||process.env.quokka?l._readOriginalSourceFile(r.id,r.originalPath):Q.when(!1),l._dirEnsurePromise(path.dirname(r.originalPath)),l._dirEnsurePromise(path.dirname(r.instrumentedPath))]).then(function(e){u&&(a=e[0]);var s=void 0;return delete r.lastChangeIsComplex,_.each(c,function(e){var t=l._diffMatchPatch.patch_fromText(e);1===c.length&&3===e.split("@@").length?r.test&&!n&&_.each(t,function(e){e.diffs&&e.diffs.length&&2===e.diffs[0].length&&!e.diffs[0][0]&&(s=e.start2+e.diffs[0][1].length)}):r.lastChangeIsComplex=!0,void 0===i&&(a=l._diffMatchPatch.patch_apply(t,a)[0]),r.test&&!n&&utils_1.default.hasWallabyRandomIdComment(a)&&(s=void 0)}),process.env.quokka&&l._quokkaFileChanged(a),Promise.all([r.binary?l._doWriteFile(r.originalPath,Buffer.from(a,"base64")):l._writeSourceFile(r.originalPath,a),l._processFile(r,a,s,!l._live,!1,!1,o)])}).then(function(){return r.ts=t,trace("File %s changes saved, store ts: %s, change ts: %s",r.path,r.ts,r.changeTs),Q.when(!0)})}_quokkaFileChanged(content){var inlineConfig,inlineConfigString,file;if(content){var match=/^[\s;]*(\s*\/\/.*?\r?\n)*\s*\(\s*?{/.exec(content);if(match&&match[0]){for(var braceStack=[],start=match[0].length-1,i=start,len=content.length;i<len;i++){var character=content[i];if("{"===character?braceStack.push(character):"}"===character&&braceStack.pop(),!braceStack.length)break}try{inlineConfig=eval(_e1c‍.c("("+content.substring(start,i+1)+")")),inlineConfigString=JSON.stringify(inlineConfig)}catch(e){}}}this._settings._currentInlineQuokkaConfigString!==inlineConfigString&&(this._loadQuokkaSettings(inlineConfig),this._settings=this._quokkaSettings,this._settings._currentInlineQuokkaConfigString=inlineConfigString,this._settings._currentInlineQuokkaConfig=inlineConfig,this._testRunner&&this._testRunner.updateSettings&&this._testRunner.updateSettings(this._settings),file=this._structure.filesByPath[this._quokkaFileName],delete file.noCompilers,delete file.noPreprocessors,this._recycleRunner=!0)}isNodeNative(){return!(!this._settings.testFramework.version||0!==this._settings.testFramework.version.indexOf("node"))}isZeroConfigJest(){return!(!this._settings.testFramework.version||0!==this._settings.testFramework.version.indexOf("jest")||!this._settings.testFramework.autoDetected)}isVitest(){return!(!this._settings.testFramework.version||0!==this._settings.testFramework.version.indexOf("vitest")||!this._settings.testFramework.autoDetected)}isNodeJasmine(){return!("node"!==this._settings.env.type||!this._settings.testFramework.version||0!==this._settings.testFramework.version.indexOf("jasmine"))}isQuokkaVite(){return!(!this._settings.quokka||!this._settings.quokka.vite)}hasGlobalSetupOrTeardown(){return!!this._settings.globalSetup}isNativeBundler(){return this._settings.postprocessor&&this._settings.postprocessor.bundler&&this._settings.postprocessor.bundler.native}_notInstrumented(t,s,e){if(trace("File "+t.path+" is not instrumented by core"),t.validSyntax=!0,this.isZeroConfigJest()||this.isVitest()||this.isQuokkaVite()||this.isNodeNative()){if(!this.isQuokkaVite()&&(t.changeStart=e,t.changeStart?t.changePosition=_.textIndexPosition(s,t.changeStart):delete t.changePosition,!t.binary)&&t.test&&!process.env.quokka){let e;var r,i;this._settings.extractComments?(e={includedTestFile:!1,excludedTestFile:!1},(r=t.extractedComments)&&r.testFileSelection&&(e.includedTestFile=r.testFileSelection.included,e.excludedTestFile=r.testFileSelection.excluded,delete r.testFileSelection)):(r=utils_1.default.deserializeRegExp(this._settings.hints.testFileSelection.include),i=utils_1.default.deserializeRegExp(this._settings.hints.testFileSelection.exclude),e=utils_1.default.testFileSelection(s,r,i,this._settings.automaticTestFileSelection)),this._updateTestFileSelection(t,e)}}else t.ranges=[],this.isNativeBundler()&&(t.changeStart=e,t.changeStart?t.changePosition=_.textIndexPosition(s,t.changeStart):delete t.changePosition);return Q.when({code:s})}_processFile(p,e,d,h,t,s,r){var i,g,f=this;const m=e=e&&e.toString()||"";if("snap"===p.type&&(i=f._structure.filesByPath[path.join(path.dirname(p.path),"..",path.basename(p.path,".snap"))])&&(p.testFilesLoadedFrom=p.testFilesLoadedFrom||{},p.testFilesLoadedFrom[i.id]=runAlways),r)return p.validSyntax=!0,Q.when({code:m});if(f.isZeroConfigJest()||f.isVitest()||f.isNativeBundler()||f.isQuokkaVite()||this.isNodeNative())return this._notInstrumented(p,m,d);if(process.env.quokka&&(h=!1,f._settings.error))throw new Error(f._settings.error);return p.changeStart=d,trace("Preparing to process %s",p.path),"node"===f.settings().env.type&&(f._isJavaScript(p)||f._isOriginallyTypeScript(p))&&((p.coverable||p.test)&&(e=e.replace(/^\#\!.*/,"")),f._isJavaScript(p))&&f._settings.testFramework.jsPreprocessor&&(e=f._settings.testFramework.jsPreprocessor(e)),f._settings.testFramework.version&&0===f._settings.testFramework.version.indexOf("jest")&&(f._isOriginallyTypeScript(p)||f._isJavaScript(p))&&(p.originalId?p.docBlockComment=(f._structure.filesById[p.originalId]||{}).docBlockComment:p.docBlockComment=utils_1.default.docBlockComment(e).replace(/\r?\n|\r/g," ")||void 0),p.originalId&&(g=f._structure.filesById[p.originalId])&&(p.includedTestFile=g.includedTestFile,p.excludedTestFile=g.excludedTestFile),h&&f._startProcessorPool(),!p.changeStart||p.noCompilers||p.binary||(p.changePosition=_.textIndexPosition(e,p.changeStart)),(p.binary||!p.coverable&&!p.test?new Promise(e=>e(f._notInstrumented(p,m,d))):(t?Q.when(e):f._runThroughProcessors(p,e,h,!0).catch(e=>(f._cleanStack(e),Promise.reject(new Error("Failed to run compilers on "+p.path+", "+(e&&(e.stack||e.message))))))).then(function(s){if(p.noScript)return new Promise(e=>e(f._notInstrumented(p,m,d)));if(!p.noCompilers){trace("Processing compiled "+p.path),p.instrumentedType="js";var e=p.sourceMap,o=new utils_1.default.SourceMapConsumer(e),a=(delete p.sourceMap,_.reduce(p.ranges,function(e,t){return(e[t[0]]=e[t[0]]||[]).push(t),e},{}));p.changePosition&&(p.changePosition.source=e.sources&&e.sources[0]||".",(e=f._findClosestRange(a,p.changePosition,!0))&&(p.changePosition.column=e[1]),p.changePosition.bias=2,p.changeStart=o.generatedPositionFor(p.changePosition));const c={};if(p.logMarkers)for(const u of p.logMarkers)u.originalRange=u.originalRange||u.range,u.range=utils_1.default.mapOriginalRangeToTransformed(o,u.originalRange),u.range&&(c[u.range.join(",")]=u.originalRange);var l=f._isOriginallyCoffeeScript(p),r=function(e,n){_.each(e,e=>{if(p.logMarkers){var t=e.join(","),t=n[t]||t;if(c[t])return t=c[t],e[0]=t[0],e[1]=t[1],e[2]=t[2],void(e[3]=t[3])}var s,r,t={line:e[0],column:e[1]},i=o.originalPositionFor(t);5===e.length&&(s="_extends"===e[4]||"Babel.React.createElement"===e[4]||"Babel.objectSpread"===e[4],e.length=4,(i=i.source&&!s&&(s={line:e[0],column:e[1],bias:2},(s=o.originalPositionFor(s)).source)&&i.line<s.line?s:i).source||(t.column+=7,(i=o.originalPositionFor(t)).source)||(i=(t.column+=l?7:26,o.originalPositionFor(t)))),(r=i.source?f._findClosestRange(a,i):r)?(e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3]):e.length=0})}}if(!f._isOriginallyJavaScript(p)&&p.noCompilers)return new Promise(e=>e(f._notInstrumented(p,m,d)));trace("Instrumenting "+p.path+", via process pool: "+h);let t=_.extend({},f._settings.hints);p.test&&(process.env.quokka||t.allowIgnoringCoverageInTests||(t=_.omit(t,"ignoreCoverage","ignoreCoverageForFile")),!f._settings.extractComments)||(t=_.omit(t,"testFileSelection"));const i=p.scriptRange?s.substring(p.scriptRange.start,p.scriptRange.end):s;e=p.logMarkers||[];const n=process.env.quokka&&f._settings.quokka.snaps;return f._instrument(i,{file:p.tmp?p.originalId:p.id,test:p.test,testFileChangeStart:p.changeStart,logMarkers:e.map(e=>({id:e.id,originalRange:e.originalRange,range:e.range,changeId:e.id,traceId:e.traceId,expanded:e.expanded,new:e.new,exp:e.exp,action:e.action,logpoint:e.logpoint,inlineLogpoint:e.inlineLogpoint})),extractedComments:(0,remapComments_1.default)(p.extractedComments,i,o),hints:t,recordValues:f._settings.autoConsoleLog,captureConsoleLog:f._settings.captureConsoleLog,preserveComments:f._settings.preserveComments||!1,automaticTestFileSelection:!process.env.quokka&&p.test&&!f._settings.extractComments&&f._settings.automaticTestFileSelection,sequenceExpressionToDiff:!!process.env.quokka,snaps:{enabled:n,onlyMode:f._snapsOnlyMode,asyncWrap:!0},recordFunctions:!!process.env.quokka||void 0},h,e).then(function(e){var t;if(e.error)throw e.error;if(r&&r(e.ranges,e.logMarkerRangeMap),p.test&&(f._settings.extractComments?(t=p.extractedComments,f._updateTestFileSelection(g,{includedTestFile:t&&t.testFileSelection&&t.testFileSelection.included,excludedTestFile:t&&t.testFileSelection&&t.testFileSelection.excluded}),t&&delete t.testFileSelection):f._updateTestFileSelection(p,e)),p.esm=e.esm,p.validSyntax=!0,p.ranges=e.ranges,p.loggedRanges=e.loggedRanges,p.rangeFunctions=e.rangeFunctions,p.logpointInfo=e.logpointInfo,p.notInstrumentedLogMarkers=e.notInstrumentedLogMarkers,e.liveCommentLines&&o?p.liveCommentLines=_.chain(e.liveCommentLines).map((e,t)=>({line:parseInt(t,10),column:e+1})).map(({line:e,column:t})=>utils_1.default.mapTransformedRangeToOriginal(o,[e,t,e,t])).filter(e=>e&&e.length).map(e=>e[0]).value():e.liveCommentLines&&(p.liveCommentLines=Object.keys(e.liveCommentLines).map(e=>parseInt(e,10)).filter(e=>e).map(e=>e)),e.usedLogpoints&&f._emit({type:"usedLogpoints",file:p.path,logpoints:e.usedLogpoints}),p.lineMap=utils_1.default.updateFileMap(p.noCompilers?{}:p.lineMap,[JSON.parse(e.map)]),delete p.tmpLineMap,p.numberOfFunctionsChanged=p.numberOfFunctions!==e.numberOfFunctions,p.numberOfFunctions=e.numberOfFunctions,p.lastSingleChangeTest=p.test&&!p.numberOfFunctionsChanged&&e.testName||void 0,p.lastSingleChangeTest&&debug("Detected single test [%s] change",e.testName),p.docBlockComment&&e.code&&(debug("Re-attaching document block comment"),e.code=p.docBlockComment+e.code),p.scriptRange&&(e.code=s.substring(0,p.scriptRange.start)+e.code+s.substring(p.scriptRange.end)),n){if(f._snapsOnlyMode&&(!e.snaps||!e.snaps.length))return Q.when(new Error(utils_1.default.snapsNotFoundError));if(f._settings.autoExpandAllLogs=!!(e.snaps||[]).find(e=>e.output),f._mapSnaps(p,e.snaps,o),f._snapsOnlyMode){if(!f._snapsAutoRun&&e.snaps&&e.snaps.length)return Q.when(new Error(utils_1.default.snapsFoundButNoAutoRunError));if(null==(t=e.snaps)||!t.find(e=>!e.empty))return Q.when(new Error(utils_1.default.snapsAreEmptyError))}}return Q.when(e)}).catch(function(e){p.validSyntax=!1;var t=_.map(p.tests,(e,t)=>t.split(testPathSeparator))||[];return f._testTask.addChangedFile(p,t),f._cleanStack(e),Q.when(utils_1.default.formatInstrumentationError(e,i,p.path))})})).then(function(e){return e instanceof Error?Q.when(e):f._runThroughProcessors(p,e.code,h,!1).then(e=>s?Q.when(e):(trace("Writing to disk and caching processed file %s",p.path),p.binary?f._doWriteFile(p.instrumentedPath,Buffer.from(e,"base64")):f._doWriteFileWithLruCache(p.instrumentedPath,e))).catch(e=>(f._cleanStack(e),Q.when(new Error("Failed to run preprocessors on "+p.path+", "+(e&&(e.stack||e.message))))))}).then(e=>e instanceof Error?Promise.reject(e):Q.when(e))}testRunnerTransformedFile(e){const t=this._getFileMetadataById(e.id);if(t){trace("Test Runner transformed file: %s %s",t.path,e.transformedTime),t.ranges=[],t.matchSnapshotRanges=e.matchSnapshotRanges;var s=process.env.quokka&&this._settings.quokka.snaps;if(process.env.quokka&&this._lruCache.set(t.instrumentedPath,e.instrumented.code),e.transformed.map)try{const r=new utils_1.default.SourceMapConsumer(e.transformed.map);_.each(e.instrumented.ranges||[],e=>{e=utils_1.default.mapTransformedRangeToOriginal(r,e);e&&(e[3]===1/0&&(e[3]=e[1]+1),e[2]>=e[0]||(e[2]=e[0]),e[3]>=e[1]||(e[3]=e[1]+1)),t.ranges.push(e||[])}),t.runnerCacheKey=e.runnerCacheKey,s&&this._mapSnaps(t,e.instrumented.snaps,r)}catch(e){t.ranges=[],debug("Failed to map ranges for [%s], error: %s",t.path,e.message)}else t.ranges=e.instrumented.ranges,t.runnerCacheKey=e.runnerCacheKey,s&&this._mapSnaps(t,e.instrumented.snaps,void 0);t.lineMap=e.lineMap,t.lastSingleChangeTest=e.instrumented.testName,t.numberOfFunctions=e.instrumented.numberOfFunctions,t.loggedRanges=e.instrumented.loggedRanges,t.rangeFunctions=e.instrumented.rangeFunctions,t.logpointInfo=e.instrumented.logpointInfo,t.notInstrumentedLogMarkers=e.instrumented.notInstrumentedLogMarkers,t.liveCommentLines=e.instrumented.liveCommentLines,e.parentFilePath&&(s=this.getFileMetadataByPath(e.parentFilePath))&&(t.parentFilePath=e.parentFilePath,s.childFilePath=t.path,s.runnerCacheKey=t.runnerCacheKey),t.instrumentedByTestingFramework=!0,e.usedLogpoints&&this._emit({type:"usedLogpoints",file:t.path,logpoints:e.usedLogpoints})}}_mapSnaps(e,t,s){let r;try{if(t&&t.length)if(s){e.originalId&&(e=this._structure.filesById[e.originalId]);try{var i=this.getLatestOriginalFileContentByPath(e.path);if(!i)throw new Error("Unable to locate original file content");0===(r=utils_1.default.mapSnapRanges(s,t,i)).length&&(r=void 0)}catch(e){emitDiagnostic({name:"genericWarning",message:"Failed to process snaps: "+e.message})}}else r=t}finally{this._emit({type:"snapsFound",file:e.path,snaps:r})}}_updateTestFileSelection(e,t){var s,r;e&&(s=e.includedTestFile,r=e.excludedTestFile,e.includedTestFile=t.includedTestFile,e.excludedTestFile=t.excludedTestFile,e.originalId||this._updateFileStructure(e),!!e.includedTestFile==!!s&&!!e.excludedTestFile==!!r||(this._testSelectionChanged=!0),e.originalId)&&this._updateTestFileSelection(this._structure.filesById[e.originalId],t)}_findClosestRange(e,t,s){var r=e[t.line];if(r)for(var i,n=1/0,o=0;o<r.length;o++){var a=r[o],l=Math.abs(a[1]-t.column);l<n&&(!s||a[1]<=t.column)&&(n=l,i=a)}return i}_runThroughProcessors(t,e,s,r){var i=this;return!Object.keys(r?i._settings.compilers:i._settings.preprocessors).length||(r?t.noCompilers:t.noPreprocessors)?(trace("No %s configured for %s",r?"compilers":"preprocessors",t.path),r?t.noCompilers=!0:t.noPreprocessors=!0,Q.when(e)):(e={content:e,config:process.env.quokka?i._settings:i._configFile,file:t,root:i._instrumentedRoot,type:r?"compiler":"preprocessor"},(s&&i._processorPool.started()?i._processorPool.run(e):processor(e)).then(e=>{if(e.error)throw e.error;return r?t.noCompilers=e.noProcessors:t.noPreprocessors=e.noProcessors,i._updateInstrumentedFile(e,t,r&&!t.noCompilers),e.content}))}_updateInstrumentedFile(e,t,s){s&&delete t.lineMap,e.maps&&e.maps.length&&(t.lineMap=utils_1.default.updateFileMap(t.lineMap,e.maps)),e.newPath&&(t.instrumentedPath=path.resolve(this._instrumentedRoot,e.newPath),t.instrumentedType=_.trim(path.extname(t.instrumentedPath),"."),this._structure.filesRenamed[e.newPath]=t.path),s&&(t.ranges=e.ranges,t.scriptRange=e.scriptRange,t.noScript=e.noScript,t.sourceMap=e.maps&&e.maps[0],t.ranges&&t.ranges.length||t.noScript||debug("Compiler did not set ranges for file [%s]",t.path),t.sourceMap||t.noScript||debug("Compiler did not set source map for file [%s]",t.path))}async _instrument(t,s,e,r){e=await(e&&this._processorPool.started()?this._processorPool.run({content:t,opts:s,type:"instrumentor"}):new Promise(e=>e((0,instrumentor_1.default)(t,s))));return e.usedLogpoints=r.filter(e=>e.logpoint).map(e=>e.id),e}_writeSourceFile(e,t){var s=this._sourceFileCache[e];return s&&(s.content=t),this.isZeroConfigJest()||this.isVitest()||this.isNodeNative()||!s?(this._writeSourceFileCache[e]={content:t},this._doWriteFile(e,t).finally(()=>{delete this._writeSourceFileCache[e]})):Q.when(!0)}_doWriteFile(e,t){var s=this;return s._dirEnsurePromise(path.dirname(e)).then(function(){return s._writeFilePromise(e,t)})}_doWriteFileWithLruCache(e,t){var s=this;return s._dirEnsurePromise(path.dirname(e)).then(function(){return s._writeFilePromise(e,t)}).then(()=>(s._lruCache.set(e,t),Q.when(!0)))}_deleteSourceFile(e){return delete this._sourceFileCache[e],this._unlinkFilePromise(e)}_readOriginalSourceFile(i,n){var o=this,e=o._sourceFileCache[n];return e?(trace("Returning previously cached file [%s] from memory",i),Promise.resolve(e.content)):o._readFilePromise(n).then(function(e){var t=Promise.resolve();const s=e.toString();var r,e=_.keys(o._sourceFileCache);return 2<=e.length&&(e=e[0],r=o._sourceFileCache[e],delete o._sourceFileCache[e],o._structure.filesById[r.id]?(t=o._doWriteFile(e,r.content),trace("Writing previously cached file [%s] to disk",e)):trace("Previously cached file [%s] was deleted and does not need saving to disk",e)),trace("Caching file [%s] in memory",i),o._sourceFileCache[n]={content:s,id:i},t.then(function(){return Q.when(s)})})}_flushSourceFileCacheSync(){var s=this;try{_.each(s._sourceFileCache,function(e,t){s._dirEnsureSync(path.dirname(t)),s._writeFileSync(t,e.content)})}catch(e){_.each(s._sourceFileCache,function(e){e=s._structure.filesById[e.id];e&&(e.ts=0)})}}_getOrCreateFileMetadata(e){var t=this._structure.filesByPath[e.path];return t||(t=this._createFileMetadata(e,e.id),this._fileOrderUpdatePending=!0,t)}_getFileMetadataById(e){return this._structure.filesById[e]}getFileMetadataByPath(e){return this._structure.filesByPath[e]}_overrideFileType(e,t,s){}_createFileMetadata(e,t){var s,r,i,n;if(process.env.quokka||path.resolve(e.path)!==path.normalize(e.path).replace(new RegExp(path.sep+"$"),""))return s=path.join(this._originalRoot,process.env.quokka?path.basename(e.path):e.path),r=path.join(this._instrumentedRoot,e.path),e.instrumentedPath&&r!==e.instrumentedPath&&(r=e.instrumentedPath,e.instrumentedType=_.trim(path.extname(r),"."),(i=path.relative(this._instrumentedRoot,r))!==e.path)&&(this._structure.filesRenamed[i]=e.path),i=e.type,n=this._overrideFileType(e.type,e.path,e.id)||e.type,t={id:t,path:e.path,type:n||"js",originalType:e.originalType||i||n,binary:e.binary||void 0,tmp:e.tmp||void 0,instrumentedType:e.instrumentedType||n||"js",order:e.order,originalPath:s,instrumentedPath:r,ts:e.ts,changeTs:e.ts,runnerCacheKey:e.runnerCacheKey,triggersTests:e.triggersTests,include:e.include,initialInclude:_.isBoolean(e.initialInclude)?e.initialInclude:e.include,esm:e.esm,includedTestFile:e.includedTestFile,includedExplicitlyTestFile:e.includedExplicitlyTestFile,smartModeStart:e.smartModeStart,excludedTestFile:e.excludedTestFile,coverable:e.coverable,hideFromErrorStackTrace:e.hideFromErrorStackTrace||void 0,test:e.test,tests:e.tests||{},ranges:e.ranges||void 0,loggedRanges:e.loggedRanges||void 0,rangeFunctions:e.rangeFunctions||void 0,logpointInfo:e.logpointInfo||void 0,extractedComments:e.extractedComments||void 0,notInstrumentedLogMarkers:e.notInstrumentedLogMarkers||void 0,liveCommentLines:e.liveCommentLines||void 0,matchSnapshotRanges:e.matchSnapshotRanges||void 0,lineMap:e.lineMap||void 0,tmpLineMap:e.tmpLineMap||void 0,validSyntax:e.validSyntax||void 0,numberOfFunctions:e.numberOfFunctions||void 0,docBlockComment:e.docBlockComment||void 0,instrumentedByTestingFramework:e.instrumentedByTestingFramework||void 0,childFilePath:e.childFilePath,getFileLineMap:function(){return this.tmpLineMap||this.lineMap},testExecutionTimes:e.testExecutionTimes},this._updateFileStructure(t),t;throw new Error("Configured file paths must be relative: "+e.path)}_deleteTmpFiles(){var t=this;this._deleteDependantFilesMetadata(),_.each(t._structure.filesByPath,e=>e.tmp&&t._deleteFileMetadata(e)),t._fileOrderUpdatePending=!0}_deleteDependantFilesMetadata(e){var t=this;e?(_.each(e.dependant,e=>t._deleteFileMetadata(e)),e.dependant={}):_.each(t._structure.filesByPath,e=>t._deleteDependantFilesMetadata(e))}_deleteFileMetadata(e){e=this._structure.filesByPath[e.path];if(e)return this._updateFileStructure(e,!0),this._fileOrderUpdatePending=!0,e}_updateFileStructure(e,t){t?(this._deleteDependantFilesMetadata(e),delete this._structure.filesById[e.id],delete this._structure.testFilesById[e.id],delete this._structure.filesByPath[e.path],delete this._structure.testFileSelectionById.excluded[e.id],delete this._structure.testFileSelectionById.included[e.id]):(this._structure.filesById[e.id]=e,(this._structure.filesByPath[e.path]=e).test&&(this._structure.testFilesById[e.id]=e,delete this._structure.testFileSelectionById.included[e.id],delete this._structure.testFileSelectionById.excluded[e.id],e.excludedTestFile?this._structure.testFileSelectionById.excluded[e.id]=e:(this._settings.testLocations?e.includedExplicitlyTestFile:e.includedTestFile)&&(this._structure.testFileSelectionById.included[e.id]=e)))}selectedTestFiles(){return{hasSomeIncludedTestFiles:!_.isEmpty(this._structure.testFileSelectionById.included),hasSomeExcludedTestFiles:!_.isEmpty(this._structure.testFileSelectionById.excluded)}}hasSomeSelectedTestFiles(){var e=this.selectedTestFiles();return e.hasSomeIncludedTestFiles||e.hasSomeExcludedTestFiles}isExcludedTestFile(e){return!!this._structure.testFileSelectionById.excluded[e]}isIncludedTestFile(e){return!!this._structure.testFileSelectionById.included[e]}getIncludedTestFiles(){return _.values(this._structure.testFileSelectionById.included)}getNotExcludedTestFiles(){return _.filter(this._structure.testFilesInOrder,e=>!e.originalId&&!this.isExcludedTestFile(e.id))}_getExcludedTestFiles(){return _.values(this._structure.testFileSelectionById.excluded)}_additionalHeaderMessage(){var e,t,s,r={};try{return this._settings.testLocations?(r.testLocations=this._settings.testLocations,0===this._settings.testLocations.length?this._settings.smartStart&&this._settings.smartStart.find(e=>"**/*"===e.pattern&&e.test&&"edit"===e.startMode)?"(waiting for test to be modified)":"(waiting for test to be opened)":(e=`(only executed ${this._settings.testLocations.map((e,s)=>{var t=e.split("/");for(let e=1;e<t.length;e++){const r=t.slice(t.length-e).join("/");if(!this._settings.testLocations.find((e,t)=>t!==s&&e.endsWith(r)))return r}return e}).map(e=>""===e?"./":e).join(", ")})`,2<=this._settings.testLocations.length&&120<e.length?`(only executing ${this._settings.testLocations.length} test files)`:e)):(t=this.selectedTestFiles(),this._settings.runSelectedTestsOnly||t.hasSomeIncludedTestFiles||t.hasSomeExcludedTestFiles?(r.selectedTests={included:_.map(this.getIncludedTestFiles(),e=>e.path),excluded:_.map(this._getExcludedTestFiles(),e=>e.path)},s="",this._settings.runSelectedTestsOnly&&!t.hasSomeIncludedTestFiles?s="no test files selected":t.hasSomeIncludedTestFiles&&(s="only executed "+_.map(this.getIncludedTestFiles(),e=>e.path).join(", ")),`(${s=!s&&t.hasSomeExcludedTestFiles?"skipped "+_.map(this._getExcludedTestFiles(),e=>e.path).join(", "):s})`):void 0)}finally{this._emit(Object.assign({type:"testRunModeAvailable"},r))}}_updateFileOrder(){var t=this;t._fileOrderUpdatePending&&(t._structure.testFilesInOrder=[],t._structure.sourceFilesInOrder=[],_.each(t._orderFilesByConfig(t._structure.filesByPath),function(e){(e.test?t._structure.testFilesInOrder:t._structure.sourceFilesInOrder).push(e)}),delete t._fileOrderUpdatePending)}_orderFilesByConfig(e){return _.chain(e).sortBy(function(e){return e.path}).sortBy(function(e){return e.order}).value()}saveLatestQuokkaFileChange(e){const t=path.join(this._globalSettingsDir,"recentFiles");var s=e=>path.join(t,e),r=e=>e&&("win32"===process.platform?e.toLowerCase():e);if(e.scratchFile){if(utils_1.default.textLines(e.content).length<=1&&e.content.length<50&&(e.content=""),!e.content)return;if(3e3<e.content.length){try{this._dirEnsureSync(t),this._writeFileSync(s(e.fileId),e.content)}catch(e){}delete e.content}}else delete e.content;var i=path.join(this._globalSettingsDir,"recentFiles.json");let n={};try{this._fileExistsSync(i)&&(n=JSON.parse(this._readFileSync(i)))}catch(e){}n.projects||(n.projects={});var o=r(this._localRoot),a=(e.projectRoot=this._localRoot,n.projects[o]||{}),o=(delete n.projects[o],n.projects[o]=a,e.fileId||r(e.path)),r=!a[o];for(delete a[o],a[o]=e,r&&(n.total=(n.total||0)+1);100<n.total;)for(var l in n.projects){var c=n.projects[l];if(!_.isEmpty(c)){for(var u in c){var p=c[u];if(delete c[u],n.total--,p.scratchFile&&!p.content)try{this._unlinkFileSync(s(p.fileId))}catch(e){}break}break}delete n.projects[l]}try{this._writeFileSync(i,JSON.stringify(n))}catch(e){}}packageJsonExists(){return this._packageJsonExists}}exports.Project=Project},{"./babelCompiler":10,"./chromeProfileViewer":13,"./config":17,"./errorTraceMapper":53,"./extension/shared/utils":54,"./instrumentor":57,"./processor":74,"./testTask":79,"./tracking":81,"./typeScriptPostprocessor":83,"./typeScriptUtils":84,"./utils":88,"./utils/remapComments":91,child_process:void 0,crypto:void 0,"lru-cache":void 0,os:void 0,path:void 0,semver:void 0,typescript:void 0,url:void 0,util:void 0,which:void 0}],76:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.RotatingLogStream=void 0;const a=e("fs"),l=e("path");class r extends e("stream").Writable{constructor(e,t){super(),this.filename=e,this.options=t,this.fd=null,this.openStream()}openStream(){if(this.fd)try{a.closeSync(this.fd)}catch(e){}var e=l.dirname(this.filename);a.existsSync(e)||a.mkdirSync(e,{recursive:!0});try{this.fd=a.openSync(this.filename,"a")}catch(e){}}checkSizeAndRotate(){if(null!==this.fd)try{a.fstatSync(this.fd).size>=this.options.size&&this.rotateLog()}catch(e){}}rotateLog(){if(null!==this.fd){try{var t=l.dirname(this.filename),s=l.basename(this.filename,l.extname(this.filename)),r=l.extname(this.filename),e=l.join(t,s+"."+this.options.maxRotations+r);a.existsSync(e)&&a.unlinkSync(e);for(let e=this.options.maxRotations-1;0<e;e--){var i=l.join(t,s+"."+e+r),n=l.join(t,s+"."+(e+1)+r);a.existsSync(i)&&a.renameSync(i,n)}var o=l.join(t,s+".1"+r);a.copyFileSync(this.filename,o)}catch(e){}a.truncateSync(this.filename)}}_write(t,e,s){null===this.fd&&this.openStream();try{this.checkSizeAndRotate(),a.writeSync(this.fd,t)}catch(e){this.openStream();try{this.checkSizeAndRotate(),a.writeSync(this.fd,t)}catch(e){}}s()}}s.RotatingLogStream=r},{fs:void 0,path:void 0,stream:void 0}],77:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.WorkerPool=void 0;const r=e("os"),d=e("path"),i=e("http"),f=e("./utils"),m=logger.create("workers")["debug"],n=e("ws"),h=e("./utils/formatter");var o=/^win/.test(process.platform),g="&wallabyFileId=",v="Wallaby.js cache is corrupted, please restart wallaby.js",y=/.*jasmine\.js:(\d|\s)*throw error;[^\^]*\^\s*/s;const a=/^\s+at(?:(?:.jasmine\-)|\s+jasmine\.buildExpectationResult)/,l=/^\s+at.*?jest(-.*?)?(\/|\\)(build|node_modules|packages)(\/|\\)/,c=/\/@vitest\/\w+\/dist\/|\/vitest\/dist\/|\/vitest\/src\/|\/vite-node\/dist\/|\/vite-node\/src\/|\/node_modules\/chai\/|\/node_modules\/tinypool\/|\/node_modules\/tinyspy\/|\/deps\/chai\.js|__vitest_browser__/;s.WorkerPool=class{constructor(t,e){this._connectingWorkers={},this._project=t,this._opts=t.settings(),this._extension=e,this._mapConsoleMessagesStackTrace=this._project.settings().mapConsoleMessagesStackTrace,process.env.quokka&&(this.reportConsoleOutput=function(e){e=_.extend({},e);t.resolveLogEntryRange(e),t._emitInternal({type:"consoleOutput",data:e})},this.reportIntermediateResult=function(){}),this._sessions={},this._executedTestNumber=0,this._testRunId=0,this._workers={},this._testFilesByWorker={},this._workerPingTimeoutOverride={},this._connectingWorkers={},this._workerPendingCleanup={},this._calculateNumberOfParallelWorkers(),this._hasGlobalSetupOrTeardown=this._project.hasGlobalSetupOrTeardown();for(var s=Math.max(this._maxWorkers,this._minWorkers)+(this._hasGlobalSetupOrTeardown?1:0),r=0;r<s;r++)this.getWorker(r);this._globalWorkerId=s,this._normalizedWallabyServerPath=this._project.normalizePath(d.dirname(process.mainModule.filename)),_.endsWith(this._normalizedWallabyServerPath,"/")||(this._normalizedWallabyServerPath+="/"),this._normalizedLocalRoot=this._project.normalizePath(this._project._localRoot),this._zeroConfigJest=this._project.isZeroConfigJest(),this._vitest=this._project.isVitest(),this._viteNode=this._project.isQuokkaVite(),this._nodeJasmine=this._project.isNodeJasmine(),this._unresponsiveStandardTimeout=Math.max(500,this._opts.unresponsiveStandardTimeout||(this._zeroConfigJest||this._vitest?2e3:200)),this._unresponsiveInitialTimeout=Math.max(this._unresponsiveStandardTimeout,this._opts.unresponsiveInitialTimeout||(this._zeroConfigJest||this._vitest?7e3:200)),this._longExecutingWarningTimeout=Math.max(500,this._opts.longExecutingWarningTimeout||5e3),this._longExecutingPingTimeout=Math.max(200,this._opts.longExecutingPingTimeout||200),this._globalSetupTeardownTimeout=Math.max(10,this._opts.globalSetupTeardownTimeout||5e3)}"worker:transformedFile"(e){this._project.testRunnerTransformedFile(e)}"worker:profile"(e){this._resolveProfileRunPromise&&(this._resolveProfileRunPromise(e),delete this._resolveProfileRunPromise)}onMessage(t,n,o){const a=this;let s;try{s=t&&"string"!=typeof t?Buffer.isBuffer(t)?JSON.parse(t.toString()):t:JSON.parse(t)}catch(e){return void emitDiagnostic({name:"genericError",message:"Failed to deserialize message from worker: "+t+", "+(e&&e.message||"")})}const l=e=>{e._queuedMessagesTimeout&&(clearTimeout(e._queuedMessagesTimeout),e._queuedMessagesTimeout=void 0);var t=Date.now();for(e._queuedMessages.sort((e,t)=>e.message.seq-t.message.seq);e._queuedMessages.length;){var{message:s,processBy:r}=e._queuedMessages[0];if(s.seq>e._nextSeq&&t<r)break;e._queuedMessages.shift(),e._nextSeq<=s.seq&&(e._nextSeq=s.seq+1);try{i(s,e)}catch(e){emitDiagnostic({name:"genericError",message:"Failed to process message "+s.type+" from worker, "+(e&&e.message||"")})}}e._queuedMessages.length&&(m("Requeuing out of order messages from Test Runner for sequential processing"),e._queuedMessagesTimeout=setTimeout(()=>l(e),e._queuedMessages[0].processBy-t))},i=(t,s)=>{var e;if(t._diagnostic)emitDiagnostic(t);else if(a["worker:"+t.type])a["worker:"+t.type](t.data),null!=s&&s._queuedMessagesTimeout&&l(s);else if(t.worker){var r=a._workers[t.worker];if(r){if(r.onConnected)r.onConnected(n);else if(process.env.quokka&&r.instance){if(r.instance.channel)try{r.instance.channel.close(),r.instance.channel.removeAllListeners()}catch(e){}r.instance.channel=n}try{o(JSON.stringify({type:"in:connected"}))}catch(e){emitDiagnostic({name:"genericError",message:'Failed to send the "connected" message to worker. '+e.message})}}}else if(s){r=!s||(s._disposing||a.cancelled(s._testRunId))&&!s._globalSetup;if("console"===t.type&&t.data){var i=t.data;if("debugLog"===i.type)return void m(i.text);(i.spec||process.env.quokka)&&!r||"autoLog"===i.type||emitDiagnostic({name:"console",type:i.type,time:i.time||Date.now(),message:void 0!==i.text?i.text:void 0!==(null==(e=i.valueBag)?void 0:e.data)?"string"===i.valueBag.data.type?i.valueBag.data.value:(0,h.formatAsString)(i.valueBag.data,{maxLineLength:1/0}):""})}if(!r)try{s[t.type](t.data),s._queuedMessagesTimeout&&l(s)}catch(e){emitDiagnostic({name:"genericError",message:"Failed to process message "+t.type+" from worker, "+(e&&e.message||"")}),s.reject(e)}}};if(s.seq){let e=s.session&&a._sessions[s.session];(e=e&&s.childSession?e.childSession(s.session+"."+s.childSession):e)?s.seq===e._nextSeq?(e._nextSeq++,i(s,e)):s.seq<e._nextSeq?(m(`Message from Test Runner processed out of order: ${e._id}:${e._nextSeq}, `+JSON.stringify(s)),i(s,e)):(t=Date.now(),e._queuedMessages.push({message:s,processBy:t+100}),e._queuedMessagesTimeout||(e._queuedMessagesTimeout=setTimeout(()=>l(e),100))):i(s,void 0)}else i(s,void 0)}start(e){var s=this,r=this._httpServer=e?i.createServer(e):i.createServer();return r.listen(0),new Promise(function(e,t){r.on("listening",function(){try{s._receiverPort=r.address().port,m("Web server is listening at "+s._receiverPort),s._wss=new n.Server({server:r,host:"127.0.0.1",verifyClient:function(e){return _.verifyLocalOrigin(e.origin)}}),s._wss.on("connection",function(t){t.on("message",function(e){s.onMessage(e,t,t.send.bind(t))})}),e()}catch(e){t(e)}})})}wallabyFileIdPrefix(){return g}traceContext(){return this._traceContext}receiverPort(){return this._receiverPort}setFileRoot(e){this._fileRoot=this._project.normalizePath(e)}updateSettings(e){this._opts=e}async run(e){var s=this;this._cancelled=!1,this._testRunId++,this._executedTestNumber=0,this._runPriority=e.priority,this._traceContext=e.traceContext,this._profileRun=e.profileRun;let t=0;this._profileRun?(this._profileRunPromise=new Promise(function(e){s._resolveProfileRunPromise=e}),e.testFilesToLoad&&1===e.testFilesToLoad.length&&(t=s._findWorkerThatExecutedTestFile(e.testFilesToLoad[0])||0)):(delete this._resolveProfileRunPromise,delete this._profileRunPromise),e.recycleBeforeRun&&_.each(this._workers,function(e,t){s.recycleWorker(t)}),m("Starting test run, priority: "+this._runPriority),this._startTime=(new Date).getTime();var r=e.fullRun&&1<this._maxWorkers&&1<e.testFilesToLoad.length?this._maxWorkers:1<this._minWorkers&&1<e.testFilesToLoad.length&&!(e.fullRun&&this._maxWorkers<this._minWorkers)?this._minWorkers:1;let i=void 0;if(this._hasGlobalSetupOrTeardown&&e.testFilesToLoad.length){var n=setTimeout(()=>{emitDiagnostic({name:"longRunningSetupTeardown",type:"setup",timeout:this._longExecutingWarningTimeout})},this._longExecutingWarningTimeout);try{i=await s._runGlobalSetup(e),clearTimeout(n)}catch(e){if(clearTimeout(n),e.error)throw e.error;return e.result}}1===r&&_.each(e.testFilesToLoad,e=>s._testFileIsAssignedToWorker(e,t));n=Object.assign(Object.assign({},e),{processEnvUpdates:i&&i.processEnvUpdates});let o,a=void 0;try{o=1<r?await this._runInParallel(n,r):[await this._prepareSandbox(n,t).then(e=>s._runTests(e))]}catch(e){throw e}finally{if(i){e=setTimeout(()=>{emitDiagnostic({name:"longRunningSetupTeardown",type:"teardown",timeout:this._longExecutingWarningTimeout})},this._longExecutingWarningTimeout);i.sandbox.instance.teardown();const{error:c,result:l}=await i.result;if(clearTimeout(e),c)throw c;a=l}}this._workerPingTimeoutOverride={};const l=1===o.length?o[0]:await s._mergeRunTestsResults(o);return a&&(l.log=(l.log||[]).concat(a.log||[]),l.globalErrors=(l.globalErrors||[]).concat(a.globalErrors||[])),this._executedTestNumber&&(this._endTime=(new Date).getTime(),r=s._endTime-s._startTime,emitDiagnostic({name:"finishedExecuting",numberTests:this._executedTestNumber,duration:r}),this._project._emitInternal({type:"testRunStatsAvailable",duration:r,numberOfTests:this._executedTestNumber})),this._profileRunPromise&&(l.profile=await s._profileRunPromise,delete s._profileRunPromise),l}_handleError(t,e,s,r,i,n,o,a,l,c,u){var p=this,d=(n===o&&(n=o=void 0),p._reportableError(s,r)),e=(m("Sandbox (%s) [%s] error: %s",t.active()?"active":"inactive",e,d),"SyntaxError: Parse error"===s&&_.isEmpty(r));if(p._corruptedCache(d))p._project.invalidateCache(),t.reject(new Error(v)),t.recycleWorker();else if(p._corruptedJestCache(s,r))m("Jest cache corrupted: %s",r),p._project.invalidateCache(),t.reject(new Error("Jest cache is corrupted, please clear jest cache (`npx jest --clearCache`) and then restart wallaby.js"));else if(process.env.quokka?m("Runtime error: "+d):emitDiagnostic({name:"genericError",message:"Runtime error: "+d}),t.active())if(u||t.scheduleCompleteIfNotActiveFor(process.env.WALLABY_INTEGRATION_TEST_RUN?1e3:100),!(r=!r&&s?s:r)||p._viteNode&&(f.default.isSnapsAreEmptyError({message:s})||f.default.isSnapsFoundButNoAutoRunError({message:s})||f.default.isSnapsNotFoundError({message:s})))t.reject(new Error(s));else if(!e)try{var h={message:s,stack:_.isString(r)?r:_.reduce(r,function(e,t){return e+t.file+":"+t.line+"\n"},""),external:!0,actual:n,expected:o,snapshot:a},g=(p._nodeJasmine&&(h.message=h.message&&h.message.replace(y,""),h.message.endsWith("\r")&&(h.message=h.message.slice(0,-1)),h.stack=h.stack&&h.stack.replace(y,"")),(p._zeroConfigJest||p._vitest||p._viteNode)&&(h.delayStackMapping=!0,h.allowNotMappedStackLines=!0,h.testFilePath=c,t._notMappedStackEntries.push(h)),p._viteNode&&["at ViteNodeRunner.","at async ViteNodeRunner."].forEach(e=>{var e=h.stack.indexOf(e);-1!==e&&(e=h.stack.lastIndexOf("\n",e),h.stack=h.stack.substring(0,e))}),[h]);p._processTestLog(g,l),h.delayStackMapping||h.stack&&h.stack.length||!c||(h.stack=`Error: ${h.message}.
    at ${c}:1:0`,p._mapStackEntries(h,!0),delete h.testFilePath),this._stackIsEmptyOrHasNoMappedEntries(h)&&(~h.message.indexOf("Cannot find module")||(h.message=d),this._ensureStackFormat(h)),!i&&t._executingTest?t.addToTestLog(h):t._globalErrors.push(h)}catch(e){t.reject(new Error(s+", "+(e&&e.message)))}}_createAndStartSession(n,t,s,e){var o=this;try{const i=()=>{var i=o._createSession(n.sessionId,n.workerId,n.testRunId,n.instance,n.opts,t,s,e);n.instance.start(function(e){return o.cancelled(n.testRunId)?(i.reject({runCancelled:!0}),!1):"success"===e||(i.reject(new Error("Sandbox load failed, status: "+e)),!1)},function(e,t,s,r){o._handleError(i,n.sessionId,e,t,!1,s,r)})};var r=o._workerPendingCleanup[n.workerId];r?(m("[%s] Sandbox is waiting for worker cleanup",n.sessionId),r.onDone.push(e=>{if(o.cancelled(n.testRunId))return m("[%s] Sandbox run was cancelled while it was waiting for worker cleanup",n.sessionId),s({runCancelled:!0});if(e){m("[%s] Sandbox worker requires recycling, creating new session",n.sessionId);try{return t(o._prepareSandbox(n.opts,n.workerId).then(function(e){return o._runTests(e)}))}catch(e){return s(e)}}i()})):i()}catch(e){s(e)}}_getRunTestResult(e){var t,s;return e.session?(s=(t=e.session).runResult,_.each(_.keys(t),function(e){e&&"_"===e[0]&&!_.isFunction(t[e])&&"_disposing"!==e&&delete t[e]}),delete e.session,Promise.resolve(s)):Promise.resolve(e)}_runTests(s){var r=this;return r.cancelled(s.testRunId)?Promise.reject({runCancelled:!0}):(m("[%s] Running tests in sandbox",s.name),new Promise(function(e,t){if(r.cancelled(s.testRunId))return t({runCancelled:!0});r._createAndStartSession(s,e,t,void 0)}).then(function(e){return r._getRunTestResult(e)}))}_stackIsEmptyOrHasNoMappedEntries(e){return!e.stack||"string"==typeof e.stack&&!e.stack.length||"string"!=typeof e.stack&&!e.stack.some(e=>!e.notMappedFile)}_ensureStackFormat(e){e.stack&&"string"!=typeof e.stack||(e.stack=[])}_createRunResult(e,t){var s=e._coverage,r=e._trace,i=e._loadingSequence,n=e._tests,o=e._log,a=e._fileChanges,l=e._globalErrors.concat(e._executingTestLog);return _.each(l,e=>this._removeAnsi(e)),l.length||(l=void 0),e._notMappedStackEntries.length&&(_.each(e._notMappedStackEntries,e=>{var t;delete e.delayStackMapping,this._mapStackEntries(e,e.allowNotMappedStackLines),this._stackIsEmptyOrHasNoMappedEntries(e)&&e.testFilePath&&(t={stack:`Error: ${e.message}.
    at ${e.testFilePath}:1:0`},this._mapStackEntries(t,!0),delete e.testFilePath,this._ensureStackFormat(e),t.stack)&&t.stack.length&&e.stack.unshift(...t.stack),delete e.allowNotMappedStackLines,e.onStackMapped&&(e.onStackMapped(),delete e.onStackMapped)}),e._notMappedStackEntries.length=0),{coverage:s,trace:r,tests:n,log:o,globalErrors:l,loadingSequence:i,time:t,fileChanges:a}}_removeAnsi(e){return!f.default.hasAnsi(e.message)||f.default.hasAnsi(e.actual)||f.default.hasAnsi(e.expected)||(e.message=f.default.removeAnsi(e.message)),e}_reportableError(e,t){return _.isString(t)?(this._project._cleanStack(t={stack:t}),t.stack):e}cancel(e){if(!_.isEmpty(this._sessions))return e>=this._runPriority&&(_.each(this._sessions,function(e){e.reject({runCancelled:!0})}),this._cancelled=!0,m("Cancelling test run, cancel requester priority: %s, current run priority: %s",e,this._runPriority),!0)}cancelled(e){return this._cancelled||e&&e!==this._testRunId}_areLogEntryMessagesEqual(e="",t=""){return e===t||(this._opts.testFramework&&this._opts.testFramework.version&&0===this._opts.testFramework.version.indexOf("mocha")?0<e.indexOf(":")&&_.contains(e,t)||0<t.indexOf(":")&&_.contains(t,e):void 0)}_createSession(l,c,n,u,e,o,a,t,s){var p=this;return p._sessions[l]={_opts:e,_id:l,_coverage:{},_tests:[],_loadingSequence:{},_log:[],_fileChanges:[],_executingTestLog:[],_globalErrors:[],_total:0,_skipped:0,_disposing:!1,_exceededMaxTestAllowedLogLimit:!1,_onFinished:u.closing,_messagesPerTest:{},_closeByErrorTimeout:void 0,_longRunningWarningTimeout:void 0,_longRunningPingTimeout:void 0,_globalSetupCompleteTimeout:void 0,_executingFiles:{},_executingTest:void 0,_notMappedStackEntries:[],_globalSetup:!!t,_globalSetupDoneCalled:!1,_completed:!1,_testRunId:n,_parentSession:s,_children:[],_nextSeq:1,_queuedMessages:[],_queuedMessagesTimeout:void 0,childSession:function(e){return p._sessions[e]||(e=p._createSession(e,c,n,u,this._opts,()=>{},()=>{},void 0,this),this._children.push(e),e)},started:function(e){var t=this;m("[%s] Loaded %s test(s)",l,e.total),t._total=e.total,_.each(e.loadingSequence,e=>{t._loadingSequence[e[0]]=e.slice(1)})},specFileTests:function(e){p._project._emitInternal({type:"specFileTests",sessionId:l,files:e})},active:function(){return!this._disposing&&!p.cancelled(n)},scheduleCompleteIfNotActiveFor:function(e){var t=this;clearTimeout(t._closeByErrorTimeout),t._closeByErrorTimeout=setTimeout(function(){t.complete()},e)},addToTestLog:function(e){var t=this._executingTestLog[this._executingTestLog.length-1];t&&p._areLogEntryMessagesEqual(t.message||void 0,e.message||void 0)&&t.stack&&e.stack&&0<t.stack.length&&0<e.stack.length&&_.isEqual(e.stack[0],t.stack[0])?e.stack.length>t.stack.length&&(t.stack=e.stack):this._executingTestLog.push(e)},intermediateComplete:function(){this._parentSession||p.reportIntermediateResult&&p.reportIntermediateResult(p._createRunResult(this))},trace:function(e){var t=this;t._trace=e.trace,t._trace&&_.each(t._trace.callStack,e=>{e.delayStackMapping=!0,t._notMappedStackEntries.push(e)})},complete:function(t){var e=this;if(clearTimeout(e._closeByErrorTimeout),clearTimeout(e._longRunningWarningTimeout),clearTimeout(e._longRunningPingTimeout),clearTimeout(e._globalSetupCompleteTimeout),void 0!==e._lastTestFile&&(p._project._emitInternal({type:"testFileCompleted",specFileId:e._lastTestFile}),e._lastTestFile=void 0),e._completed=!0,!e._parentSession){e._children.length&&e._children.forEach(e=>{e.runResult=p._createRunResult(e,t&&t.time),e.complete()}),e._onFinished();const i=e._children.map(e=>e.runResult).filter(e=>!!e);var s=e._children.length?e._children.reduce((e,t)=>e+(t._tests||[]).length,0):(e._tests||[]).length,r=e._children.length?e._children.reduce((e,t)=>e+t._skipped,0):e._skipped;e._dispose(function(){p.cancelled(n)?a({runCancelled:!0}):(e._children.length?e.runResult=p._reduceTestResults([p._createRunResult(e,t&&t.time),...i]):e.runResult=p._createRunResult(e,t&&t.time),o({session:e,time:t&&t.time}))}),m("[%s] Run %s test(s), skipped %s test(s)",l,s-r,r)}},globalSetupComplete:function(e){t&&(this._globalSetupDoneCalled=!0,t(e))},globalError:function(e){this._parentSession?this._parentSession.globalError(e):p._handleError(this,l,e.message,e.stack,e.declaration,e.actual,e.expected,e.snapshot,e.allowNotMappedStackLines,e.testFilePath,e.keepSessionActive)},programScopeStart:function(e){this._executingFiles[e]=1,this._setTimeoutForLongRunningOperation()},programScopeEnd:function(e){delete this._executingFiles[e],_.isEmpty(this._executingFiles)&&!this._executingTest&&(clearTimeout(this._longRunningWarningTimeout),clearTimeout(this._longRunningPingTimeout))},preTest:function(e){this._executingSpecFileId=e.specFileId,this._executingTestPath=e.path,this._executingTest=e.specName,this._setTimeoutForLongRunningOperation(),void 0!==this._lastTestFile&&this._lastTestFile!==e.specFileId&&p._project._emitInternal({type:"testFileCompleted",specFileId:this._lastTestFile}),this._lastTestFile=e.specFileId,p._project._emitInternal({type:"preTest",sessionId:l,specFileId:e.specFileId,path:e.path})},postTest:function(){delete this._executingTest,delete this._executingSpecFileId,delete this._executingTestPath},_setTimeoutForLongRunningOperation:function(){var e;if(!process.env.quokka){const i=this,n=e=>{emitDiagnostic({name:"genericWarning",message:e}),p._project._emitInternal({type:"longRunningOperation"}),m(e)};if(clearTimeout(i._longRunningWarningTimeout),clearTimeout(i._longRunningPingTimeout),i.active()){let r=p._longExecutingWarningTimeout;i._executingSpecFileId&&i._executingTestPath&&(e=null==(e=p._project._model)?void 0:e.getTestExecutionTime(i._executingSpecFileId,i._executingTestPath))&&(r=1e3*Math.ceil(Math.max(1.2*e,e+p._longExecutingWarningTimeout)/1e3)),i._longRunningWarningTimeout=setTimeout(()=>{let s=`[${l}] Some long running code has been detected: `;var e=i._executingTest,t=!_.isEmpty(i._executingFiles);if(s+=(e?'test "'+e+'"':"one of your "+(t?"files":"tests"))+" is taking more than "+r+"ms to execute.",t&&(s+="\nExecution of the following files has started but has not finished:",_.each(i._executingFiles,function(e,t){t=p._project._getFileMetadataById(t);s+="\n- "+(t?t.path:"unknown")})),i._log.length&&(s+="\nThe last recorded console.log: "+_.last(i._log).text),e||t){s+="\nTry commenting out the test or excluding the test file from the `tests` list in your wallaby config,\nand restarting wallaby to make sure that it is this test/file causing the issue and not something else.",e&&(s+="\nAlso review your recent changes to the code that the test covers, as well as its `before` and `after` hooks."),s+="\nPinging test runner sandbox...";try{u.ping(function(){clearTimeout(i._longRunningPingTimeout),i.active()&&n("Sandbox is responsive. The issue may be asynchronous in nature (for example, a missing callback).")}),i._longRunningPingTimeout=setTimeout(function(){n("The sandbox is not responsive. Check for possibly recently introduced infinite loops.")},p._longExecutingPingTimeout)}catch(e){s+="\nThe sandbox ping failed: "+e.message}}n(s)},r)}}},module:function(e){p._project._emitInternal({type:"moduleLoaded",path:e.path,session:this})},test:function(t){var s=this;delete s._executingTest,clearTimeout(s._closeByErrorTimeout),s._setTimeoutForLongRunningOperation(),p._project._emitInternal({type:"postTest",sessionId:s._id,specFileId:t.testFile,path:[...t.suite,t.name],status:t.status,duration:t.time,isFailing:t.log&&0<t.log.length}),t.hook&&t.log?(p._processTestLog(t.log),_.isString(t.hook)&&_.each(t.log,e=>{e.message=t.hook+(e.message?": ":"")+e.message}),s._globalErrors=s._globalErrors.concat(t.log)):("disabled"!==t.status?(m("[%s] Test executed: "+t.name,l),p._processTestLog(t.log),t.log&&_.each(t.log,e=>s.addToTestLog(e)),s._executingTestLog.length&&(t.log=s._executingTestLog.slice()),_.isUndefined(t.slow)&&(t.slow=t.time>p._opts.slowTestThreshold),t.slow=t.slow||void 0,s._executingTestLog.length=0,++p._executedTestNumber%50||emitDiagnostic({name:"testProgress",numberExecuted:p._executedTestNumber}),process.env.WALLABY_INTEGRATION_TEST_RUN&&(t.time=1)):(s._skipped++,p._processTestLog(t.log)),s._tests.push(t))},coverage:function(e){this._coverage[e.id]=e.ranges},fileChange:function(e){this._fileChanges.push(e)},console:function(s){if("error"!==s.type||!s.text||-1===s.text.indexOf("ExperimentalWarning:")&&-1===s.text.indexOf("node --trace-warnings")){var e=p._opts.maxConsoleMessagesPerTest,t=this._messagesPerTest[s.spec]=(this._messagesPerTest[s.spec]||0)+1;if(t===e+1){var r=process.env.quokka?"maxConsoleMessages":"maxConsoleMessagesPerTest",r="Number of console messages exceeded maximum allowed value ("+e+"), so messages recording has been stopped"+(process.env.quokka?"":" for the current test")+".\nYou may increase the limit by adding `"+r+"` setting to your config file.";emitDiagnostic({name:"genericWarning",message:r}),process.env.quokka&&(i=this._log[this._log.length-1])&&this._log.unshift({spec:i.spec,range:i.range,file:i.file,text:r,type:"log",format:"raw"})}else if(t<=e){this._log.push(s);var i=!(!s.valueBag||!s.valueBag.data);if(i&&void 0===s.text?(r=s.valueBag.data.customInspect||(0,h.formatAsString)(s.valueBag.data),s.text=s.prefix?s.prefix+r:r,f.default.maybeHtml(s.text)&&(s.format="html")):s.text&&f.default.maybeHtml(s.text)&&(s.format="html"),i)if(process.env.WALLABY2&&null!=(e=null==(t=s.valueBag)?void 0:t.data)&&e.id&&((r=s.valueBag.data.id.split(",")).splice(2,0,(s.spec||"global").toString()),s.valueBag.data.id=r.join(",")),s.valueBag.data.props){const n=s.valueBag.data.props[0];n.callStack&&(this._notMappedStackEntries.push(n.callStack),n.callStack.onStackMapped=()=>{let i;var e;n.callStack.replaceFirstEntryLine&&(e=Object.assign({},s),p._project.resolveLogEntryRange(e),i=e.range&&e.range[0]),n.props=n.callStack.stack.map((e,t)=>{var s,r=e[0],e=0<t||!i?e[1]:i,r=p._project.stackEntryByFileIdWithoutLineMapping(r,e);if(r)return s=(null==(s=n.callStack.context)?void 0:s[t])||"...",{id:n.id+",se"+t,target:r,callStackEntryNode:!0,label:{name:s,description:d.basename(r.file)+":"+e},disallowToCopyPath:!0,disallowToCopyData:!0}}).filter(e=>!!e)})}if(p._mapConsoleMessagesStackTrace&&s.text&&s.text.length)if(/^\s*at .*$/gm.test(s.text)){const o={stack:s.text,suppressErrorReporting:!0};if(p._mapStackEntries(o),o.stack.length){let t=!1;s.text=s.text.split("\n").reduce((r,e)=>{if(e.trimStart().startsWith("at ")){if(!t){const i=e.substr(0,e.indexOf("at "));o.stack.map((e,t)=>{var s=e[0],e=e[1],s=p._project.stackEntryByFileIdWithoutLineMapping(s,e);s&&(t=o.context[t]||"...",r.push(`${i}at ${t} (${d.basename(s.file)}:${e})`))}),t=!0}}else r.push(e);return r},[]).join("\n")}}s.stack&&(i={stack:s.stack},delete s.stack,p._mapStackEntries(i,!0),i.stack.length)&&(e=null==(t=i.stack)?void 0:t[0])&&2===e.length&&(s.file=e[0],r=e[1],s.range=[r,0,r,0],s.context=null==(t=i.context)?void 0:t[0])}p.reportConsoleOutput(s)}},resume:function(){m("Sandbox requested early screen shot capture"),this._onFinished(),this._onFinished=_.noop,u.resume()},reject:function(e){this._parentSession||this._disposing||this._dispose(function(){p.cancelled(n)?a({runCancelled:!0}):a(e)})},recycleWorker:function(){this._parentSession||p.recycleWorker(c)},_dispose:function(e){var s=this;if(s._disposing=!0,clearTimeout(s._closeByErrorTimeout),clearTimeout(s._longRunningWarningTimeout),clearTimeout(s._longRunningPingTimeout),!s._parentSession){s._children.forEach(e=>{e._dispose(_.noop)});const a=p._workerPendingCleanup[c]={onDone:[]};var r=!1,i=function(t){r=!0,o&&clearTimeout(o),delete p._sessions[l],s._children.length&&s._children.forEach(e=>{delete p._sessions[e._id]}),a.onDone&&(a.onDone.forEach(e=>e(t)),a.onDone.length=0),delete p._workerPendingCleanup[c],e()},n=function(){r||(m("[%s] Sandbox is not responsive, recycling worker instance",l),p._tryClosingSandbox(u.close,l),p.recycleWorker(c),i(!0))};if(!s._globalSetup||s._completed||void 0!==p._opts.globalSetupTeardownTimeoutRecycle&&!p._opts.globalSetupTeardownTimeoutRecycle)if(s._globalSetup&&s._completed&&!s._globalSetupDoneCalled)emitDiagnostic({name:"recyclingWorker",sessionId:l,reason:"Error running Global Setup"}),n();else if(s._globalSetup&&s._completed&&0<s._globalErrors.length)emitDiagnostic({name:"recyclingWorker",sessionId:l,reason:"Error running Global Teardown"}),n();else try{var t=p._workerPingTimeoutOverride[c]||p._unresponsiveStandardTimeout,o=setTimeout(function(){n()},t);u.ping(function(){if(!r){clearTimeout(o),m("[%s] Sandbox is responsive, closing it",l);const t=setTimeout(()=>{emitDiagnostic({name:"recyclingWorker",sessionId:l,reason:`Wallaby Teardown did not complete in ${p._globalSetupTeardownTimeout}ms`}),n()},p._globalSetupTeardownTimeout);p._tryClosingSandbox(u.close,l,function(e){r||(clearTimeout(t),(e?i:n)())})}})}catch(e){m("[%s] Sandbox can not be pinged: %s",l,e&&e.message),n()}else emitDiagnostic({name:"waitingForGlobalSetupTeardown",sessionId:l,timeoutMs:p._globalSetupTeardownTimeout}),s._globalSetupCompleteTimeout=setTimeout(()=>{emitDiagnostic({name:"recyclingWorker",sessionId:l,reason:"Global Setup and Teardown did not complete"}),n()},p._globalSetupTeardownTimeout)}}}}_tryClosingSandbox(e,t,s){s=s||function(){};try{e(s)}catch(e){m("[%s] Sandbox closing error, %s",t,e.message)}}_corruptedCache(e){return e&&e.match(/evaluating '[a-z]\.\$_\$coverage\[/)}_corruptedJestCache(e,t){if(this._zeroConfigJest&&e&&"string"==typeof e&&t&&"string"==typeof t&&~e.indexOf("Cannot read property '0' of undefined")){e=t.split("\n").map(e=>e.trim());if(1<e.length&&~e[1].toLowerCase().indexOf("server.js"))return!0}return!1}_processTestLog(e,s){var r=this;_.each(e,function(e){var t=e.message&&e.message.indexOf(" in file:///")||-1;~t&&(e.message=e.message.substring(0,t)),r._corruptedCache(e.message)&&(r._project.invalidateCache(),e.message=v),r._removeAnsi(e),r._mapStackEntries(e,s),process.env.quokka&&e.message&&(e.message=e.message.replace(r._normalizedLocalRoot,".").replace(r._project._localRoot,"."))})}_mapStackEntries(t,l){var c=this,e=g.length;if(t.stack&&_.isString(t.stack)&&!t.delayStackMapping){var u,s,p=[],d={},r=t.stack.split("\n");if(r&&c._corruptedCache(r[0])&&(c._project.invalidateCache(),t.message=v),_.each(r,function(t){var s=t.lastIndexOf(g);if(~s){var s=t.substr(s+e).split(":");2<=s.length&&(r=parseInt(s[1],10),(u=c._project.stackEntryByFileId(parseInt(s[0],10)||s[0],r,parseInt((s[2]||"").replace(/\(/,""),10)))&&u.line?(c._extractBrowserStackLineContext(d,p.length,t),p.push([u.file,u.line])):u&&l?(c._extractBrowserStackLineContext(d,p.length,t),p.push([u.file,r])):u||c._skipStackLine(t,s[0])||((s=[c._project.normalizePath(f.default.isLevelUpRelativePath(s[0])?s[0]:_.ltrim(s[0],"./")),r]).notMappedFile=!0,c._extractBrowserStackLineContext(d,p.length,t),p.push(s)))}else if(process.env.quokka){if(process.env.quokka){if(_.contains(t,"snapRootStackTraceMarker"))return!1;var r=-1!==t.indexOf("file:");if(t=c._project.normalizePath(t),_.contains(t,"quokkaBunModuleTraceMarker")&&(t=t.replace("quokkaBunModuleTraceMarker","./"+c._project._quokkaFileName)),r&&1<(s=t.split("?session=")).length&&(3===(r=s[1].split(":")).length&&(r[0]=""),t=s[0]+r.join(":")),_.contains(t,c._normalizedWallabyServerPath)){if(_.contains(t,"quokkaStackTraceMarker"))return!1}else{s=t;if(3===(n=s!==(t=t.replace(c._normalizedLocalRoot,"."))?(o=s.lastIndexOf(c._normalizedLocalRoot),t.substr(o).split(":")):0!==(o=t.lastIndexOf("(")+1)?t.substring(o,t.lastIndexOf(")")-1).split(":"):2!==(o=t.lastIndexOf("at ")+3)?t.substr(o).split(":"):[]).length){r=parseInt(n[1],10);let e=!1;(u=c._project.stackEntryByFilePath(c._project.normalizePath(f.default.isLevelUpRelativePath(n[0])?n[0]:_.ltrim(n[0],"./")),r,parseInt(n[2],10)))&&u.line?(i=u.file,a=u.line):u&&u.file?u&&l&&(i=u.file||n[0],a=r):(i=n[0],a=r,e=!0),i&&(c._extractNodeStackLineContext(d,p.length,t,o),s=[i,a],e&&(s.notMappedFile=!0),p.push(s))}}}}else{-1!==t.indexOf("file://")&&([r,o]=t.split("?update="),r)&&o&&([,i]=o.split("&wallaby=true"),i)&&(t=decodeURI(r).replace("file://","")+i),t=c._project.normalizePath(t);var i,n,o,a=c._fileRoot?t.lastIndexOf(c._fileRoot):-1;!~a||3!==(n=_.rtrim(t.substr(a+c._fileRoot.length),")").split(":")).length&&2!==n.length||(s=parseInt(n[1],10),(u=c._project.stackEntryByFilePath(c._project.normalizePath(_.ltrim(n[0],"/")),s,parseInt(n[2],10)))&&u.line?(c._extractNodeStackLineContext(d,p.length,t,a),p.push([u.file,u.line])):u&&l&&0<s?(c._extractNodeStackLineContext(d,p.length,t,a),p.push([u.file,s])):u||c._skipStackLine(t,n[0])||((o=[c._project.normalizePath(f.default.isLevelUpRelativePath(n[0])?n[0]:_.ltrim(n[0],"./")),s]).notMappedFile=!0,c._extractNodeStackLineContext(d,p.length,t,a),p.push(o)))}}),p.some(e=>!e.notMappedFile)||t&&t.suppressErrorReporting||m("Failed to map the stack to user code, entry message: %s, stack: %s",t.message&&t.message.substring(0,1024),t.stack.substring(0,1024)),t.message=c._project._cleanMessage(t.message),"node"===c._project.settings().env.type&&t.message&&~t.message.indexOf("Cannot find module")&&(t.message=c._project._cleanMessage(t.message,c._project._root)),t.message)if(t.message.startsWith("TestingLibraryElementError")&&([r,...s]=t.message.split("\n\nIgnored nodes: comments, <script />, <style />\n"),r&&s.length?t.formattedMessage={header:{content:r,format:"error"},body:{content:s.join("\n\n"),format:"html"}}:([r,...s]=t.message.split("\n\n"),r&&s&&(t.formattedMessage={header:{content:r,format:"error"},body:{content:s.join("\n\n"),format:"html"}}))),!t.formattedMessage){let e=t.message.indexOf("- Expected");-1!==(e=-1===e?t.message.indexOf("- Snapshot"):e)&&(t.formattedMessage={header:{content:t.message.substring(0,e),format:"raw"},body:{content:t.message.substring(e),format:"diff"}})}t.stack=p,_.isEmpty(d)||(t.context=d),t.stackMapped=!0}}_skipStackLine(e,t){return 0===t.indexOf("http")||(0===(null==(t=this._opts.testFramework.version)?void 0:t.indexOf("jest"))?l.test(e)||a.test(e):0===(null==(t=this._opts.testFramework.version)?void 0:t.indexOf("vitest"))?c.test(this._project.normalizePath(e)):void 0)}_extractNodeStackLineContext(e,t,s,r){4<r&&"("===s[r-1]&&(s=(s.substr(0,r-2)||"").split("at ")[1])&&(e[t]=s)}_extractBrowserStackLineContext(e,t,s){let r;var i=s.split(" (http");2<=i.length?r=(i[0]||"").split("at ")[1]:2<=(i=s.split("@http")).length&&(r=i[0]),r&&(e[t]=r)}async _runGlobalSetup(e){const i=this;let n,o,a=!1;return n=await i._prepareSandbox(Object.assign(Object.assign({},e),{runGlobals:!0}),i._globalWorkerId),new Promise((s,r)=>{o=new Promise(t=>{i._createAndStartSession(n,async e=>{e=await i._getRunTestResult(e);(a?t:r)({result:e})},e=>{(a?t:r)({error:e})},e=>{a=!0,s({result:o,sandbox:n,processEnvUpdates:e})})})})}_reduceTestResults(e){return _.reduce(e,function(e,t){e.runCancelled=t.runCancelled||e.runCancelled,e.tests=e.tests.concat(t.tests||[]),e.log=e.log.concat(t.log||[]),e.fileChanges=e.fileChanges.concat(t.fileChanges||[]),e.globalErrors=e.globalErrors.concat(t.globalErrors||[]),e.error=t instanceof Error||e.error,e.loadingSequence=_.extend(e.loadingSequence,t.loadingSequence||{}),e.trace=e.trace||t.trace;var s=e.coverage;return _.isEmpty(s)?e.coverage=t.coverage:_.each(t.coverage,function(e,t){var r=s[t];r?_.each(e,function(e,t){var s=r[t];s?_.extend(s,e):r[t]=e}):s[t]=e}),e},{coverage:{},tests:[],log:[],globalErrors:[],loadingSequence:{},trace:void 0,fileChanges:[]})}_mergeRunTestsResults(e){m("Merging parallel test run results");e=this._reduceTestResults(e);return e.runCancelled?Promise.reject(e):e.error?Promise.reject(e.error):Promise.resolve(e)}_findWorkerThatExecutedTestFile(s){let r;return _.each(this._testFilesByWorker,(e,t)=>{if(e[s.normalizedRelativePath])return r=t,!1}),r}_testFileIsAssignedToWorker(e,t){var s=this._testFilesByWorker[t]=this._testFilesByWorker[t]||{};s[e.normalizedRelativePath]||(this._workerPingTimeoutOverride[t]=this._unresponsiveInitialTimeout,s[e.normalizedRelativePath]=!0)}_unassignAllTestFilesFromWorker(e){this._testFilesByWorker[e]={}}_runInParallel(e,t){var s=this,r=e.testFilesToLoad,i={};m("Distributing tests between %s workers",t);for(var n=0;n<t;n++){var o=_.omit(e,"testFiles");o.testFilesToLoad=[],i[n]={opts:o,workerId:n,ranges:0}}return _.each(r,function(e){var t=_.chain(i).sortBy(function(e){return e.ranges}).sortBy(function(e){return e.opts.testFilesToLoad.length}).value()[0];t.opts.testFilesToLoad.push(e),t.ranges+=e.rangesLength,s._testFileIsAssignedToWorker(e,t.workerId)}),m("Running tests in parallel"),Promise.all(_.chain(i).filter(function(e){return!(!e.ranges&&!e.opts.testFilesToLoad.length)}).map(function(e){return s._prepareSandbox(e.opts,e.workerId).then(function(e){return s._runTests(e)})}).value())}_prepareSandbox(t,e){const s=this._testRunId;return this._extension.prepare(t,e).then(e=>(e.testRunId=s,e.opts=t,e))}async getWorker(l){var c=this,e=c._workers[l];return await(e=e||(c._workers[l]={id:l,promise:new Promise(function(a){var e=c._workers[l];if(e)if(e.instance){if(c._extension.healthy(e.instance))return void a(e);m("Found inactive run worker instance #%s, recycling",l),c.recycleWorker(l)}else if(e.promise)return e.promise;m("Starting run worker instance #"+l);try{c._extension.create(l,function(t){var s,r,i,e,n,o;t?(s=c._workers[l]=c._workers[l]||{id:l},t.onConnected?(s.onConnected=_.bind(t.onConnected,s),delete t.onConnected,s.promise=new Promise(function(e){r=e}),i=!1,e=setTimeout(function(){var e;i||(n(),(e=c._workers[l])&&e._connected?c._extension.recycle(t):c.recycleWorker(l),m("Worker is not created in time, recycling it"),r&&r({runCancelled:!0,rerun:!0}),a({runCancelled:!0,rerun:!0}))},1e4),n=function(){i=!0,clearTimeout(e)},(o=c._connectingWorkers[l])&&c._extension.recycle(o),c._connectingWorkers[l]=t,s.onConnected(function(e){delete c._connectingWorkers[l],i||(n(),m("Started run worker instance (delayed) #"+l),s.instance=t,s._connected=!0,t.channel=e,s.promise=Promise.resolve(t),r&&r(t),a(t))})):(m("Started run worker instance (immediate) #"+l),s.instance=t,s.promise=Promise.resolve(t),a(t))):a(new Error("Failed to create worker instance"))})}catch(e){a(e)}})})).promise,c._extension.healthy(e.instance)?e.promise:(c.recycleWorker(l),c.getWorker(l))}reportConsoleOutput(e){}recycleWorker(t){this._unassignAllTestFilesFromWorker(t);try{var e=this._workers[t];e&&e.instance&&(m("Recyling run worker instance #%s",t),this._extension.recycle(e.instance))}catch(e){m("Error while recycling run worker instance #%s: %s",t,e&&(e.stack||e.message))}finally{delete this._workers[t],delete this._workerPendingCleanup[t]}}stop(){var s=this;_.each(s._workers,function(e,t){s.recycleWorker(t)});try{s._wss&&s._wss.close()}catch(e){}try{s._httpServer&&s._httpServer.close()}catch(e){}}_calculateNumberOfParallelWorkers(){this._maxWorkers=Math.max(1,this._opts.workers.initial||Math.max(r.cpus().length-2,2)),o&&!this._opts.workers.initial&&"phantomjs"===this._opts.env.kind&&(this._maxWorkers=Math.min(16,this._maxWorkers)),this._minWorkers=Math.max(1,this._opts.workers.regular||Math.max(Math.floor(this._maxWorkers/2),2)),m("Parallelism for initial run: %s, for regular run: %s",this._maxWorkers,this._minWorkers)}}},{"./utils":88,"./utils/formatter":89,http:void 0,os:void 0,path:void 0,ws:void 0}],78:[function(i,e,t){e.exports={initServerOptions:function(e){const s=i("graceful-fs"),r=i("fs-extra");e.runnerResolver=function(e,t){return i("browser"===e?"electron"===t?"./electronRunner":"chrome-legacy"===t?"./chromeRunnerLegacy":"chrome"===t?"./chromeRunner":"./phantomRunner":"./nodeRunner").Runner},e.processorPool=i("./processPool"),e.fileStructureCachePromise=function(e){return Q.nfcall(s.readFile,e).then(function(e){return Q.when(JSON.parse(e))})},e.fileStatPromise=function(e){return Q.nfcall(s.stat,e)},e.readFilePromise=function(e){return Q.nfcall(s.readFile,e)},e.writeFilePromise=function(e,t){return Q.nfcall(s.writeFile,e,t)},e.unlinkFilePromise=function(e){return Q.nfcall(s.unlink,e)},e.unlinkFileSync=function(e){return s.unlinkSync(e)},e.writeFileSync=function(e,t){return s.writeFileSync(e,t)},e.readFileSync=function(e){return s.readFileSync(e).toString("utf8")},e.fileExistsSync=function(e){return s.existsSync(e)},e.realpathSync=function(e){return s.realpathSync(e)},e.dirRemovePromise=function(e){return Q.nfcall(r.remove,e)},e.dirRemoveSync=function(e){return r.removeSync(e)},e.dirEnsurePromise=function(e){return Q.nfcall(r.ensureDir,e)},e.dirEnsureSync=function(e){return r.ensureDirSync(e)},e.copySync=function(e,t){return r.copySync(e,t)},e.nodeModulesLookup=i("./utils").default.nodeModulesLookup}}},{"./chromeRunner":14,"./chromeRunnerLegacy":15,"./electronRunner":52,"./nodeRunner":59,"./phantomRunner":61,"./processPool":73,"./utils":88,"fs-extra":void 0,"graceful-fs":void 0}],79:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.runPriority=s.TestTask=void 0;const o=e("./types/all"),r={testRunPriority:1,fileChangePriority:2,fullRunPriority:3},g=(s.runPriority=r,logger.create("testTask"))["debug"];s.TestTask=class{constructor(e){this._filesAndAffectedTests={},this._failingTests={},this._tests=[],this._priority=0,this._project=e,this._singleChangeTests=[]}files(){return _.reduce(this._filesAndAffectedTests,(e,t)=>(e[t.file.id]=t.file,e),{})}tests(){return this._tests}hasAnyFiles(){return 0<_.keys(this._filesAndAffectedTests).length}addTests(e){this._tests=this._tests.concat(e)}addTestFileWithGlobalError(e){this._testFilesWithGlobalErrors=this._testFilesWithGlobalErrors||{},this._testFilesWithGlobalErrors[e]=!0}addChangedFile(e,t){this._mergeAffectedTests(e.id,{file:e,tests:t,testFilesLoadedFrom:e.testFilesLoadedFrom})}setTestRunPriority(){this._priority=r.testRunPriority}setFileChangeRunPriority(){this._priority=r.fileChangePriority}setFullRunPriority(){this._priority=r.fullRunPriority}setEvaluatedExpressionRun(){this._editorRequestedRun=!0}setInitialTraceRun(e){this._initialTraceRun=e,this._editorRequestedRun=!0}setProfileRun(e){this._profileRun=e,this._editorRequestedRun=!0}setCodeClipSharingRun(e){this._codeClipSharingRun=e,this._editorRequestedRun=!0}setRegularTraceRunTest(e){this._traceTest=e}setUserRequestedRun(){this._userRequestedRun=!0}setUpdateSnapshotsRun(){this._updateSnapshotsRun=!0}getFullRunPriority(){return r.fullRunPriority}getPriority(){return this._priority}isFullRun(){return this._priority===r.fullRunPriority}isFileChangedRun(){return this._priority===r.fileChangePriority}isUserRequestedRun(){return(this._priority===r.testRunPriority||this._userRequestedRun)&&!this._editorRequestedRun}isEditorRequestedRun(){return this._priority===r.testRunPriority&&this._editorRequestedRun}initialTraceRunData(){return this._initialTraceRun}isInitialTraceRun(){return!!this._initialTraceRun}isProfileRun(){return!!this._profileRun}profileRunData(){return this._profileRun}isCodeClipSharingRun(){return!!this._codeClipSharingRun}codeClipSharingRunData(){return this._codeClipSharingRun}isUpdateSnapshotsRun(){return!!this._updateSnapshotsRun}isRegularTraceRun(){return!!this._traceTest}filesAdded(){this._anyFilesAdded=!0}filesNotAdded(){delete this._anyFilesAdded}filesDeleted(){this._anyFilesDeleted=!0}filesNotDeleted(){delete this._anyFilesDeleted}anyFilesAdded(){return this.isFullRun()||this._anyFilesAdded}anyFilesDeleted(){return this._anyFilesDeleted}mergeTask(e){var s=this;s._priority=Math.max(s._priority,e._priority),_.each(e._filesAndAffectedTests,(e,t)=>{s._mergeAffectedTests(t,e)}),s._failingTests=_.extend({},e._failingTests,s._failingTests),s._tests=s._tests.concat(e._tests),s._testFilesWithGlobalErrors=_.extend({},e._testFilesWithGlobalErrors||{},s._testFilesWithGlobalErrors||{}),s._singleChangeTests=s._singleChangeTests.concat(e._singleChangeTests),s._anyFilesAdded=s._anyFilesAdded||e._anyFilesAdded,s._anyFilesDeleted=s._anyFilesDeleted||e._anyFilesDeleted,e._lastEditedTestFiles&&(s._lastEditedTestFiles=new Set([...e._lastEditedTestFiles||[],...s._lastEditedTestFiles||[]]))}_mergeAffectedTests(e,t){var s=this._filesAndAffectedTests[e];s?(s.tests=s.tests?this._mergeTestLists(s.tests,t.tests||[]):t.tests||[],s.testFilesLoadedFrom=_.extend(s.testFilesLoadedFrom||{},t.testFilesLoadedFrom||{})):this._filesAndAffectedTests[e]=t}_mergeTestLists(e,t){if(0===e.length)return t;if(0===t.length)return e;var s=e.slice(),r=new Set(e.map(o.createTestKey));for(let e=0;e<t.length;e++){var i=t[e],n=(0,o.createTestKey)(i);r.has(n)||(s.push(i),r.add(n))}return s}failingTest(e,t){(this._failingTests[e]=this._failingTests[e]||[]).push(t)}_getAllTests(){var i=this,n=[];if(this._traceTest)n=[this._traceTest];else{var s,r,t=!1,o={},a={},l=0,c=0,u=0,p=0,d=0;_.each(i._filesAndAffectedTests,s=>{var r=s.file,e=(s.tests=_.map(s.tests,function(e){var t=i._getTestFileId(e);return o[t]||(o[t]=1,l++),s.testFilesLoadedFrom&&s.testFilesLoadedFrom[t]||r.numberOfFunctionsChanged||r.lastChangeIsComplex||r.relatedFilesWithTests?[e[0]]:e}),r.test&&(t=!0),r.test&&r.lastSingleChangeTest&&!r.relatedFilesWithTests&&!i._project.hadGlobalErrorsPreviousRun());e&&this._singleChangeTests.push([r.id,"?",r.lastSingleChangeTest]),n=n.concat(e?this._singleChangeTests:s.tests),_.extend(a,s.testFilesLoadedFrom||{})}),_.each(i._tests,e=>{e=i._getTestFileId(e);o[e]||(o[e]=1,c++)}),n=n.concat(i._tests),this.isFileChangedRun()&&_.each(this._testFilesWithGlobalErrors,(e,t)=>{t=parseInt(t,10),o[t]||(o[t]=1,n.push([t]))}),_.each(a,(e,t)=>{t=parseInt(t,10),o[t]||(o[t]=1,n.push([t]),p++)});let e=i._project.hasAnyPendingInEditorFileChanges()&&i._project._lastAffectedTestFileIds&&new Set(i._project._lastAffectedTestFileIds)||void 0;i._lastEditedTestFiles&&(e=new Set([...e||[],...i._lastEditedTestFiles])),!n.length&&e&&(n=n.concat(_.map(Array.from(e),e=>(o[e]||(o[e]=1,u++),[e])))),i._lastEditedTestFiles=e,t&&1===_.size(i._filesAndAffectedTests)||i.isUserRequestedRun()||i.isInitialTraceRun()||i.isRegularTraceRun()||i.isProfileRun()||(s=[],r={},_.each(n,e=>{var t,e=i._getTestFileId(e);r[e]||(t=i._failingTests[e])&&(s=s.concat(t),r[e]=o[e]=1,d++)}),n=n.concat(s)),g("Test files from affected: %s, from deleted or manually requested: %s, from recently changed: %s, from loaded by: %s, from failing: %s",l,c,u,p,d)}this._project.settings().runAllTestsInAffectedTestFile&&_.each(n,e=>{e&&(e.length=1)});var h=this._project.selectedTestFiles();return this._project.settings().runSelectedTestsOnly&&!h.hasSomeIncludedTestFiles?n=[]:(h.hasSomeIncludedTestFiles||h.hasSomeExcludedTestFiles)&&(n=_.filter(n,e=>{e=i._getTestFileId(e);return(!h.hasSomeExcludedTestFiles||!i._project.isExcludedTestFile(e))&&(!h.hasSomeIncludedTestFiles||i._project.isIncludedTestFile(e))}),g("Running only selected or not excluded tests")),n}testData(){return this._getTestRunData()}_getTestRunData(){var e,l,c,u=this;if(this.isFullRun())return e=this._project.selectedTestFiles(),this._project.settings().runSelectedTestsOnly&&!e.hasSomeIncludedTestFiles?void 0:e.hasSomeIncludedTestFiles?{files:_.reduce(u._project.getIncludedTestFiles(),(e,t)=>(e[t.id]=t,e),{}),names:"*"}:e.hasSomeExcludedTestFiles?{files:_.reduce(u._project.getNotExcludedTestFiles(),(e,t)=>(e[t.id]=t,e),{}),names:"*"}:void 0;let t=u._getAllTests();return t?(t=t.reduce((e,t)=>{var s;return e.push(t),1<t.length&&(s=t[t.length-1].split(" #"),e.push([...t.slice(0,-1),s.slice(0,s.length-1).join(" #")])),e},[]),l={},c={},_.each(t,function(e){var t=l,s=u._getTestFileId(e);if(s){s=u._project._structure.testFilesById[s];if(s&&(c[s.id]=s,"*"!==(l=1===e.length?"*":l)))for(var r=1,i=e.length;r<i;r++){var n=e[r],o=t[":"+n],a=r===i-1;if("*"===(o=o&&!a?o:t[":"+n]=a?"*":{}))break;t=o}}}),{files:c,names:l}):void 0}_getTestFileId(e){e=e&&e[0];if(e)return _.isNumber(e)?e:(this._project._structure.filesByPath[e]||{}).id}}},{"./types/all":86}],80:[function(e,t,s){for(var r,w=function(){return this}()||global,i=["alert","confirm","prompt"],n=0;n<i.length;n++){var o=i[n];w[o]&&~w[o].toString().indexOf("[native code]")&&(w[o]=function(){})}w.addEventListener&&(w.addEventListener("beforeunload",function(){if(!(w.$_$tracer&&w.$_$tracer._finished||w.navigator&&w.navigator.userAgent&&!/PhantomJS/.test(w.navigator.userAgent)&&!/Electron/.test(w.navigator.userAgent)&&!w.$_$tracer._startRequested)&&w.$_$throwOnBeforeunload)throw new Error("One of your tests is trying to unload window object.")}),w.$_$reportUnhandledPromises)&&w.addEventListener("unhandledrejection",function(e){var t;if(e&&e.reason)throw t=new Error,e.reason.stack&&(t.stack=e.reason.stack),t.message="Unhandled promise rejection: "+(e.reason.message||e.reason),t});try{w.Error.stackTraceLimit=80}catch(e){}function a(){var s=this;s._noOp=function(){},s._maxLogEntrySize=w.$_$maxLogEntrySize||16384,s._maxTraceSteps=w.$_$maxTraceSteps||999999,s._maxTraceStepsForWatchExpressionPrefetch=void 0!==w.$_$maxTraceStepsForWatchExpressionPrefetch?w.$_$maxTraceStepsForWatchExpressionPrefetch:10,s._evaluatedExpressionPerRangeLimit=1e4,s._evaluatedProxyExpressionPerRangeLimit=1e4,s._undefined=w.undefined,s._setTimeout=w.setTimeout,s._Date=w.Date,s._Error=w.Error,s._Symbol=w.Symbol,s._JSONStringify=JSON.stringify,s._XMLHttpRequest=w.XMLHttpRequest,s._regExpToString=RegExp.prototype.toString,s._dateToString=Date.prototype.toString,s._HTMLAllCollection=w.HTMLAllCollection,s._getOwnPropertyNames=Object.getOwnPropertyNames,s._getOwnPropertyDescriptor=Object.getOwnPropertyDescriptor,s._pauseAfterSingleTestExecution=w.navigator&&w.navigator.userAgent&&/PhantomJS/.test(w.navigator.userAgent),s._seq=0,s.interceptConsoleLog(w),s._receiver=w.$_$receiver||new w.WebSocket("ws://"+(w.$_$receiverHost||"127.0.0.1")+":"+w.$_$receiverPort),s._onReceiverReady=[function(){s._receiverReady=!0}],s._receiver.onopen=function(){for(var t=0,e=s._onReceiverReady.length;t<e;t++)try{s._onReceiverReady[t]()}catch(e){if(w.$_$reuseableTracer||void 0===s._onStartIndex||!(t<s._onStartIndex))throw e;s._globalBrowserError(e.message,void 0,void 0,void 0,e)}},s._receiver.onerror=function(e){throw new Error("Sandbox receiver error: "+e.message)},s.reset()}var k,d,l,c,u=/%[sdjc%]/g,p=/^(?!(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$)[_$a-zA-Z\xA0-\uFFFF][_$a-zA-Z0-9\xA0-\uFFFF]*$/,h=/^(0|[1-9][0-9]*)$/,g=/'([^\\']|\\')*'/;"function"!=typeof Function.prototype.bind&&(Function.prototype.bind=function(e){function t(){return r.apply(this instanceof i?this:e||{},s.concat(Array.prototype.slice.call(arguments)))}var s=Array.prototype.slice.call(arguments,1),r=this,i=function(){};return i.prototype=this.prototype||{},t.prototype=new i,t}),a.prototype={interceptConsoleLog:function(e){var t=this;t._replacedConsoleLog=e.console.log=function(){t._suppressConsoleLog||t._doWhenReceiverIsReady(function(e){t._log.apply(t,e)},arguments)},e.console.warn=function(){t._doWhenReceiverIsReady(function(e){t._warn.apply(t,e)},arguments)},e.console.error=function(){t._doWhenReceiverIsReady(function(e){t._error.apply(t,e)},arguments)},e.console.dir=function(){t._doWhenReceiverIsReady(function(e){t._dir.apply(t,e)},arguments)},e.console.debug=function(){t._doWhenReceiverIsReady(function(e){t._debug.apply(t,e)},arguments)},e.console.info=function(){t._doWhenReceiverIsReady(function(e){t._info.apply(t,e)},arguments)}},setGlobalErrorHandler:function(){var e=this;w.$_$reuseableTracer||(w.onerror=function(){e._globalBrowserError.apply(e,arguments)})},_globalBrowserError:function(){var t=this;t._doWhenReceiverIsReady(function(e){t._sendBrowserGlobalError.apply(t,e)},arguments)},reportDeclarationError:function(){var t=this;t._doWhenReceiverIsReady(function(e){t._sendDeclarationError.apply(t,e)},arguments)},reportHighPriorityGlobalErrorObject:function(e){var t=this;t._doWhenReceiverIsReady(function(){t._sendWithHighPriority("globalError",e)})},reportGlobalErrorObject:function(){var t=this;t._doWhenReceiverIsReady(function(e){t._sendGlobalErrorObject.apply(t,e)},arguments)},reportSnapsImportError:function(e){var t=this;t._doWhenReceiverIsReady(function(e){t._sendGlobalErrorObject.apply(t,e)},[{message:e.message,stack:e.stack,keepSessionActive:!0}])},reportSnapsProgramScopeError:function(e){var t=this;t._doWhenReceiverIsReady(function(e){t._sendGlobalErrorObject.apply(t,e)},[{message:e.message,stack:e.stack,keepSessionActive:!0}])},sendTransformedFile:function(){var t=this;t._doWhenReceiverIsReady(function(e){t._sendTransformedFile.apply(t,e)},arguments)},_sendTransformedFile:function(e){this._send("transformedFile",e)},sendFileChange:function(){var t=this;t._doWhenReceiverIsReady(function(e){t._sendFileChange.apply(t,e)},arguments)},_sendFileChange:function(e){this._send("fileChange",e)},initialSpecId:function(){return w.$_$initialSpecId},setInitializeResult:function(e){this._initializeResult=e},start:function(e){var t,s=this;!e&&(s._delayStart||s._startRequested&&!w.$_$reuseableTracer)||(s.reset(),e?(s._onStart=e,s._patchFrameworks()):(t=function(){if(e)s._onStart=e,s._patchFrameworks();else{if(!s._onStart)throw new Error("Missing tracer start subscription");s._startRequested=!0,s._receiverReady?s._onStart():(s._onReceiverReady.push(s._onStart),s._onStartIndex=s._onReceiverReady.length-1)}},s._initializeResult&&s._initializeResult instanceof Promise?(s._initializeResult.then(t).catch(function(e){e.message="Uncaught Error in Wallaby `setup` function: "+e.message,s._globalBrowserError(e.message,void 0,void 0,void 0,e)}),delete s._initializeResult):t()))},isInitialized:function(){return!!w.$_$coverage},statement:function(e,t){w.$_$coverage[e][t][this._spec]=r++},scopeStart:function(e){this._fileEncounter[e]||(this._fileEncounterSequence.push(e),this._fileEncounter[e]=1)},programScopeStartLoading:function(e){this._testFileIds[e]&&(this._resetFileData(),w.$_$traceContext)&&w.$_$traceContext.test&&(e===w.$_$traceContext.test[0]?this._setTraceRecordMode():this._resetTracerMode()),this.scopeStart(e)},programScopeEndLoading:function(e){this._testFileIds[e]&&(this._saveCurrentTestLoadingSequence(),this._resetFileData())},_saveCurrentTestLoadingSequence:function(){this._fileEncounterSequence.length&&this._testLoadingSequence.push(this._fileEncounterSequence.slice())},entryFile:function(){return this._fileEncounterSequence[0]},started:function(e){(e=e||{}).loadingSequence=this._testLoadingSequence.slice(),this._resetLoadingData(),this._resetFileData(),e.loadingSequence.length&&(w.$_$wp=this.$_$wp,w.$_$wpe=this.$_$wpe),this._send("started",e)},specFileTests:function(e){this._send("specFileTests",e)},specStart:function(e,t,s,r,i){var n=this,o="string"==typeof t?t:n._inspect(t,2,10);this._doWhenReceiverIsReady(function(){n._sendWithHighPriority("preTest",{specName:o,specFileId:s,path:r})}),this._spec=e,this._specName=o,i||this._resetFileData(),w.$_$trace&&(w.$_$trace.tests[e]={start:w.$_$trace.sequence.length})},specSyncStart:function(){var e;this._specRangeStart=r,w.$_$trace&&this._spec&&(e=w.$_$trace.tests[this._spec])&&(e.start=w.$_$trace.sequence.length)},specSyncEnd:function(){this._specRangeEnd=r-1},specEnd:function(){w.$_$trace&&(e=w.$_$trace.tests[this._spec])&&(e.end=Math.max(w.$_$trace.sequence.length-1,e.start),e.start>w.$_$trace.sequence.length-1)&&delete w.$_$trace.tests[this._spec],this._spec=0,delete this._specName;var e=this._specRangeStart,t=this._specRangeEnd;return this._specRangeStart=0,this._specRangeEnd=0,[e,t||r]},needToNotifySingleTestRun:function(){if(this._paused||this._onResumed||!this.hasSpecFilter()||w.$_$reuseableTracer||!this._pauseAfterSingleTestExecution)return!1;for(var e=w.$_$tests;"*"!==e;){var t=Object.keys(e);if(1!=t.length)return!1;e=e[t[0]]}return!0},notifySingleTestAfterEach:function(e){this._paused||this._onResumed||w.$_$reuseableTracer?e():(this._paused=!0,this._onResumed=e,this._send("resume"))},resume:function(){this._paused&&(this._paused=!1,this._onResumed)&&(this._onResumed(),delete this._onResumed)},paused:function(){return this._paused},hasSpecFilter:function(){return!!w.$_$tests&&"*"!==w.$_$tests},specFilter:function(e){var t=w.$_$tests[":?"];if(t&&t[":"+e[e.length-1]])return!0;for(var s=w.$_$tests,r=0,i=e.length;r<i;r++){if(!(s=s[":"+e[r]]))return!1;if("*"===s)return!0}return!1},globalSetupComplete:function(e){this._send("globalSetupComplete",e)},complete:function(e){w.$_$coverage&&(this._sendCoverageAndTimeMeasures(),w.$_$trace&&(w.$_$trace.values={},this._send("trace",{trace:w.$_$trace}),delete w.$_$trace,this._resetTracerMode()),this._send("complete",e),w.$_$reuseableTracer||(this._receiver.close(),this._finished=!0))},intermediateComplete:function(){this._sendCoverageAndTimeMeasures()},_sendCoverageAndTimeMeasures:function(){if(w.$_$coverage){for(var e=0,t=w.$_$coverage.length;e<t;e++){var s=w.$_$coverage[e];s&&s.length&&this._send("coverage",{id:e,ranges:s})}var r=Object.keys(k._autoTimeHits);for(e=0,t=r.length;e<t;e++){var i,n,o,a,l,c,u,p=k._autoTimeHits[r[e]];p.fileId&&(p.logMarkerContext&&(i=p.logMarkerContext.changeId,n=p.logMarkerContext.traceId,o=p.logMarkerContext.traceStep,a=p.logMarkerContext.permanent,l=p.logMarkerContext.preciseTraceStep,c=p.logMarkerContext.initialTraceId),(n||i||a)&&(u=u||{},a)&&(u.permanent=a),(n||i)&&(n&&(u.traceId=n),i&&(u.changeId=i),u.traceStep=o,u.preciseTraceStep=l,u.initialTraceId=c),this._sendLog("autoLog",{content:p.value?this._formatTime(p.value)+"ms":"Σ "+this._formatTime(p.total)+"ms, μ "+this._formatTime(p.total/p.n)+"ms, ⋀ "+this._formatTime(p.min)+"ms, ⋁ "+this._formatTime(p.max)+"ms",format:"raw"},p.context,p.fileId,p.rangeId,u))}}},_formatTime:function(e){return e.toFixed(3)},result:function(e){e.files=this._fileEncounterSequence,e.matchSnapshotCalls=this._matchSnapshotCalls,delete this._matchSnapshotCalls,w.$_$reuseableTracer&&this._sendWithHighPriority("postTest"),this._send("test",e)},_patchFrameworks:function(){var e,t,r,s,i,n,o,a=this;a._patchedFrameworks||w.$_$reuseableTracer||(a._patchedFrameworks=!0,e=w.requirejs&&"function"==typeof w.requirejs.load,t=w.System&&(w.System.fetch||w.System.import),a._shouldReportProgramScope=a._shouldReportProgramScope||e||t,e&&(r=w.requirejs.load,w.requirejs.load=function(e,t,s){return r.call(this,e,t,a._urlWithFileData(s))}),t&&(s=w.System.fetch,w.System.fetch=function(){var e=arguments[0]&&arguments[0].address;return e&&(arguments[0].address=a._urlWithFileData(e)),s.apply(this,arguments)},(i=w.fetch)&&(w.fetch=function(){var e=arguments[0];return e&&(arguments[0]=a._urlWithFileData(e)),i.apply(this,arguments)}),n=w.System.import,w.System.import=function(){var e=arguments[0];return e&&(arguments[0]=a._urlWithFileData(e)),n.apply(this,arguments)}),a._XMLHttpRequest&&(o=a._XMLHttpRequest.prototype.open,a._XMLHttpRequest.prototype.open=function(e,t){arguments[1]=a._urlWithFileData(t),o.apply(this,arguments)}),a._Error&&!a._Error.captureStackTrace&&w.navigator&&w.navigator.userAgent&&/PhantomJS\/2/.test(w.navigator.userAgent)&&(a._Error.captureStackTrace=function(){}))},_urlWithFileData:function(e){if(!e||!~e.indexOf("wallabyFileId")){for(var t=[],s=e.replace(/\\/g,"/").split("/"),r=0;r<s.length;r++)"."!==s[r]&&(".."===s[r]&&t.length&&".."!==t[t.length-1]?t.pop():t.push(s[r]));e=t.join("/"),e=this._appendFileData(e)}return e},_appendFileData:function(e){var t="/"===e.charAt(0)?e.substr(1):e,s=w.location&&w.location.host&&e.indexOf(w.location.host),s=(0<=s&&(t=t.substr(s+w.location.host.length+1)),e.lastIndexOf("?")),t=(t=0<=s?t.substring(0,s):t)&&this._getFileMetadata(t);return t?e+(~s?"&":"?")+t.ts+"&wallabyFileId="+t.id:e},_getFileMetadata:function(e){return w.$_$files[e]||w.$_$files[e.split("\\").join("/")]},_doWhenReceiverIsReady:function(e,t){var s=this,r=Date.now();s._receiverReady?(s.receiverReadyScheduleTime=r,e(t),delete s.receiverReadyScheduleTime):s._onReceiverReady.push(function(){s.receiverReadyScheduleTime=r,e(t),delete s.receiverReadyScheduleTime})},_log:function(){this._sendLog("log",this._format.apply(this,arguments),void 0,void 0,void 0,void 0,void 0,void 0,this.receiverReadyScheduleTime,this._currentStack())},_warn:function(){this._sendLog("warn",this._format.apply(this,arguments),void 0,void 0,void 0,void 0,void 0,void 0,this.receiverReadyScheduleTime)},_error:function(){this._sendLog("error",this._format.apply(this,arguments),void 0,void 0,void 0,void 0,void 0,void 0,this.receiverReadyScheduleTime)},_dir:function(e){this._sendLog("dir",{content:this._inspect(e),format:"raw"},void 0,void 0,void 0,void 0,void 0,void 0,this.receiverReadyScheduleTime)},_debug:function(e){this._sendLog("debug",{content:this._inspect(e),format:"raw"},void 0,void 0,void 0,void 0,void 0,void 0,this.receiverReadyScheduleTime)},_info:function(e){this._sendLog("info",this._format.apply(this,arguments),void 0,void 0,void 0,void 0,void 0,void 0,this.receiverReadyScheduleTime)},_debugLog:function(){this._sendLog("debugLog",this._format.apply(this,arguments),void 0,void 0,void 0,void 0,void 0,void 0,this.receiverReadyScheduleTime)},_sendBrowserGlobalError:function(e,t,s,r,i){e=e&&e.toString()||"",t=t&&t.toString()||"",(s=s&&s.toString()||"")&&(r=0<=r&&r.toString()||"")&&(s+=":"+r),this._send("globalError",{message:e,stack:i&&i.stack?i.stack:e+"\nat "+t+":"+s})},_sendDeclarationError:function(e){this._send("globalError",{message:e.message,stack:e.stack,declaration:!0})},_sendRunnerError:function(e){this._send("globalError",{message:e.message,stack:e.stack,runner:!0})},_sendGlobalErrorObject:function(e){this._send("globalError",e)},setEnvGlobal:function(e){this._envGlobal=e},resetEnvGlobal:function(){delete this._envGlobal},debugLog:function(){var t=this;t._doWhenReceiverIsReady(function(e){t._debugLog.apply(t,e)},arguments)},log:function(){var f,m,_=this,e=(w.$_$trace&&w.$_$traceContext&&(f="*",m=w.$_$trace.sequence.length>_._maxTraceSteps?void 0:w.$_$trace.sequence.length-1),_._replacedConsoleLog!==w.console.log);if(e||_._envGlobal){for(var t=[],s=arguments.length-3,r=0;r<s;r++)t.push(arguments[r]);_._suppressConsoleLog=!0,_._envGlobal&&_._envGlobal.console.log.apply(_._envGlobal.console,t),e&&w.console.log.apply(console,t),_._suppressConsoleLog=!1}_._doWhenReceiverIsReady(function(e){_._loggingValue=!0;for(var t=[],s=e.length-3,r=0;r<s;r++)t.push(e[r]);var i,n,o=e[s],a=e[1+s],l=e[2+s],c=a+","+l,u=_._rangeHits(c),p=u.rangeConsoleHits,u=u.rangeConsoleHitsOfSpec,d=p.count,h=u.count,g=1<t.length?t:t[0];d<_._evaluatedExpressionPerRangeLimit?(n=_._formattingOpts(c,{depth:w.$_$logLimits.inline.depth,elements:w.$_$logLimits.inline.elements,resolveGetters:w.$_$resolveGetters}),i=_._evaluateExpressions(_._expressionId(a,c,h,d),g,o,void 0,void 0,void 0,void 0,n)):d===_._evaluatedExpressionPerRangeLimit&&(n=_._formattingOpts(c,{depth:w.$_$logLimits.inline.depth,elements:w.$_$logLimits.inline.elements,resolveGetters:w.$_$resolveGetters}),i=_._evaluateExpressions(_._expressionId(a,c,h,d),g,o,new Error("Only the first "+d+" values are evaluated"),void 0,void 0,void 0,n)),p.count++,u.count++,i&&f&&(i.traceId=f,i.traceStep=m),i&&_._sendLog("log",{},o,a,l,i),_._loggingValue=!1},arguments)},_rangeHits:function(e){var t=this._consoleHits[e],e=(t||(this._consoleHits[e]=t={count:0,specHits:{}}),t.specHits[this._spec]);return e||(t.specHits[this._spec]=e={count:0}),{rangeConsoleHits:t,rangeConsoleHitsOfSpec:e}},canUpdateSnapshots:function(){return this._updateSnapshotsRun},_expressionId:function(e,t,s,r,i){var n=(this.entryFile()||"").toString(),t=t+","+r+(n===(e=e.toString())?"":","+n);return i&&(t+="#"+i.overallHitCount),t},_expressionIdV2:function(e,t,s,r,i){var n=(this.entryFile()||"").toString(),t=t+","+s+(n===(e=e.toString())?"":","+n);return i&&(t+="#"+i.specHitCount),t},inspectAssertionValue:function(e){return this._inspect(e,8,1e3,!0,!0,!0)},setAssertionData:function(e,t){try{e.actual||e.expected||!e.matcherResult||((e=e.matcherResult).showDiff="toEqual"===e.name);var s=Object.prototype.toString.call(e.actual);!0===e.showDiff&&s==Object.prototype.toString.call(e.expected)&&void 0!==e.expected&&"[object Boolean]"!==s&&"[object Number]"!==s&&"[object Function]"!==s&&("string"!=typeof e.actual&&(e.actual=this.inspectAssertionValue(e.actual),e.expected=this.inspectAssertionValue(e.expected)),t.actual=e.actual,t.expected=e.expected),"UnexpectedError"===e.name&&e.getErrorMessage&&(t.formattedDiff=e.getErrorMessage("ansi").toString()),e.actual&&e.actual.stack&&"string"==typeof e.actual.stack&&(t.stack=t.stack||"",t.stack+="\nFrom actual error object:\n"+e.actual.stack)}catch(e){}return t},diff:function(t,s,r,i,n){var o=this;return o._doWhenReceiverIsReady(function(){var e=o.setAssertionData({showDiff:!0,expected:t,actual:s},{});o._sendLog("diff",{content:""},r,i,n,void 0,e.expected,e.actual)},arguments),s},_sendLog:function(e,t,s,r,i,n,o,a,l,c){var u=t.content?t.content.length:0;t.content&&u>this._maxLogEntrySize&&(t.content=t.content.slice(0,this._maxLogEntrySize)+"...\n(truncated, total length: "+u+")",t.format="raw"),this._send("console",{type:e,text:t.content,format:t.format,prefix:t.prefix,valueBag:n,spec:this._spec,file:r,range:i,context:s,expected:o,actual:a,time:l||Date.now(),stack:c})},_send:function(e,t){this._receiver.send(this._JSONStringify(this._createMessage(e,t)))},_createMessage:function(e,t){return this._seq++,{type:e,data:t,session:w.$_$session,childSession:w.$_$childSession,seq:this._seq}},_sendWithHighPriority:function(e,t){var s;this._highPriorityReceiver?((s=this._createMessage(e,t))._p="###wpm###",this._highPriorityReceiver.send(this._JSONStringify(s)+"\n")):this._send(e,t)},_resetLoadingData:function(){this._testLoadingSequence=this._safeObject([])},_resetFileData:function(){this._fileEncounterSequence=this._safeObject([]),this._fileEncounter=this._safeObject([])},reset:function(){var e=this;r=1,e._consoleHits={},e._consoleProxyHits={},delete e._proxyCache,e._autoTimeHits={},e._logStats={},e._spec=0,delete e._specName,e._specRangeStart=0,e._specRangeEnd=0,e._stackDepth=0,e._functionCallId=0,e._resetFileData()},_safeObject:function(e){return e.toJSON=this._undefined,e},_format:function(e){var t=w.$_$logLimits.inline.depth,s=w.$_$logLimits.inline.elements,r=w.$_$resolveGetters;if("string"!=typeof e){for(var i=[],n=0;n<arguments.length;n++)i.push(this._inspect(arguments[n],t,s,!1,!1,r));return{content:i.join(" ")}}n=1;for(var o=arguments,a=o.length,l=1===a?e:String(e).replace(u,function(e){if("%%"===e)return"%";if(a<=n)return e;switch(e){case"%s":return String(o[n++]);case"%d":return Number(o[n++]);case"%j":return JSON.stringify(o[n++]);case"%c":return n++&&"";default:return e}}),c=o[n];n<a;c=o[++n])l+=null===c||"object"!=typeof c?" "+c:" "+this._inspect(c,t,s);return l&&"┌"===l[0]&&"┘"===l[l.length-1]?{content:l,format:"raw"}:{content:"'"+(l||"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'",format:"raw"}},_inspect:function(e,t,s,r,i,n){r={seen:[],showHidden:!1,hideTypes:r,depth:t||w.$_$logLimits.inline.depth,stylize:function(e){return e},maxElementsPerLevel:s||w.$_$logLimits.inline.elements,customInspect:w.$_$reuseableTracer&&this._nodeUtil,sortProperties:!!i,resolveGetters:!!n};return this._formatValue(r,e,r.depth)},_maybeCustomInspect:function(e){var t;return!w.$_$reuseableTracer||!this._nodeUtil||w.Bun&&e===w.Bun||"function"!=typeof(t=(t=this._nodeUtil.inspect&&this._nodeUtil.inspect.custom&&e[this._nodeUtil.inspect.custom])||e.inspect===this._nodeUtil.inspect||"function"!=typeof e.inspect?t:e.inspect)||t===this._nodeUtil.inspect||e.constructor&&e.constructor.prototype===e?void 0:t},_customInspect:function(e,t,s){var r=this._maybeCustomInspect(t);if(r){r=r.call(t,s,e);if(r!==t)return"string"!=typeof r?this._formatValue(e,r,s):r}},_formatValue:function(t,s,r){var i=this,e=this._formatPrimitive(t,s);if(e)return e;e=this._customInspect(t,s,r);if(e)return e;var e=Object.keys(s),n=this._arrayToHash(e),o=(t.showHidden&&(e=Object.getOwnPropertyNames(s)),t.sortProperties&&e.sort(),this._getOwnPropertySymbols(s));if(o.length&&(t.showHidden||"function"!=typeof s.propertyIsEnumerable||(o=o.filter(function(e){return s.propertyIsEnumerable(e)})),e=e.concat(o)),0===e.length){if("function"==typeof s)return o=s.name?": "+s.name:"",t.stylize("[λ"+o+"]","special");if(this._isRegExp(s))return t.stylize(RegExp.prototype.toString.call(s),"regexp");if(this._isDate(s))return t.stylize(Date.prototype.toString.call(s),"date");if(this._isBigInt(s))return s.toString()+"n";if(this._isError(s))return this._formatError(s)}var a,o="",l=!1,c=!1,u=!1,p=["{","}"],d=s&&s.constructor&&"string"==typeof s.constructor.name&&s.constructor.name||void 0;if("Object"!==d&&!t.hideTypes||(d=void 0),this._isArray(s)?(l=!(d=void 0),p=["[","]"]):this._isSet(s)?c=!0:this._isMap(s)&&(u=!0),"function"==typeof s&&(o=" [λ"+(s.name?": "+s.name:"")+"]"),this._isRegExp(s)&&(o=" "+RegExp.prototype.toString.call(s)),this._isDate(s)&&(o=" "+Date.prototype.toUTCString.call(s)),""===(o=this._isError(s)?" "+this._formatError(s):o)&&d&&(p[0]=d+("String"!==d&&"Number"!==d&&"Boolean"!==d||"function"!=typeof s.valueOf?"":" "+this._formatPrimitive(t,s.valueOf()))+" "+p[0]),l||u||c||(this._isGenerator(s)?o=" [Generator] ":this._isIterator(s)&&(o=" [Iterator] ")),this._nodeUtil&&this._nodeUtil.inspect&&this._looksLikePromise(s))return this._nodeUtil.inspect(s);if(!(0!==e.length||l&&0!==s.length||c||u))return p[0]+o+p[1];if(r<0)return this._isRegExp(s)?t.stylize(RegExp.prototype.toString.call(s),"regexp"):t.stylize("[Object]","special");t.seen.push(s);d=!1;e.length>t.maxElementsPerLevel&&(e.length=t.maxElementsPerLevel,l&&(s=s&&s.slice(0,t.maxElementsPerLevel)),d=!0);try{a=l?this._formatArray(t,s,r,n,e):c?this._formatSet(t,s,r,n,e,d):u?this._formatMap(t,s,r,n,e,d):e.map(function(e){return i._formatProperty(t,s,r,n,e,l)})}catch(e){a=[]}return d&&a.push("..."),t.seen.pop(),this._reduceToSingleString(a,o,p)},_isArray:function(e){return Array.isArray(e)||"object"==typeof e&&"[object Array]"===this._objectToString(e)},_isSet:function(e){return!!(e&&w.Set&&"[object Set]"===this._objectToString(e)&&e.forEach)},_isMap:function(e){return!!(e&&w.Map&&"[object Map]"===this._objectToString(e)&&e.forEach)},_isIterator:function(e){return!!(e&&w.Symbol&&w.Symbol.iterator&&"function"==typeof e[w.Symbol.iterator])},_isGenerator:function(e){return!!(e&&w.Symbol&&w.Symbol.toStringTag&&"Generator"===e[w.Symbol.toStringTag])},_isRegExp:function(e){return"object"==typeof e&&"[object RegExp]"===this._objectToString(e)},_isDate:function(e){return"object"==typeof e&&"[object Date]"===this._objectToString(e)},_isBigInt:function(e){return"bigint"==typeof e},_isError:function(e){return"object"==typeof e&&("[object Error]"===this._objectToString(e)||e instanceof Error)},_objectToString:function(e){return Object.prototype.toString.call(e)},_isNegativeZero:function(e){return 1/e===Number.NEGATIVE_INFINITY},_reduceToSingleString:function(e,t,s){return 60<e.reduce(function(e,t){return e+t.length+1},0)?s[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+s[1]:s[0]+t+" "+e.join(", ")+" "+s[1]},_formatPrimitive:function(e,t){switch(typeof t){case"undefined":return e.stylize("undefined","undefined");case"string":var s="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(s,"string");case"number":return!t&&this._isNegativeZero(t)?e.stylize("-0","number"):e.stylize(""+t,"number");case"boolean":return e.stylize(""+t,"boolean");case"symbol":return this._Symbol&&this._Symbol.prototype.toString.call(t)}if(null===t)return e.stylize("null","null")},_formatError:function(e){return"["+Error.prototype.toString.call(e)+"]"},_formatSet:function(t,e,s,r,i,n){var o=this,a=[];e.forEach(function(e){a.length>t.maxElementsPerLevel||(e=o._formatValue(t,e,null===s?null:s-1),a.push(e))}),!n&&a.length>t.maxElementsPerLevel&&a.push("...");for(var l=0;l<i.length;l++)a.push(o._formatProperty(t,e,s,r,i[l],!1));return a},_formatMap:function(r,e,i,t,s,n){var o=this,a=[];e.forEach(function(e,t){var s;a.length>r.maxElementsPerLevel||(s=o._formatValue(r,t,t=null===i?null:i-1),s=(s+=" => ")+o._formatValue(r,e,t),a.push(s))}),!n&&a.length>r.maxElementsPerLevel&&a.push("...");for(var l=0;l<s.length;l++)a.push(o._formatProperty(r,e,i,t,s[l],!1));return a},_formatArray:function(t,s,r,i,e){for(var n=this,o=[],a=0,l=s.length;a<l;++a)this._hasOwnProperty(s,String(a))?o.push(this._formatProperty(t,s,r,i,String(a),!0)):o.push("");return e.forEach(function(e){e.toString().match(/^\d+$/)||o.push(n._formatProperty(t,s,r,i,e,!0))}),o},_formatProperty:function(e,t,s,r,i,n){var o,a,t=!e.resolveGetters&&Object.getOwnPropertyDescriptor(t,i)||{value:t[i]};if(t.get?a=t.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):t.set&&(a=e.stylize("[Setter]","special")),this._hasOwnProperty(r,i)||(o="["+i.toString()+"]"),a||(e.seen.indexOf(t.value)<0?-1<(a=null===s?this._formatValue(e,t.value,null):this._formatValue(e,t.value,s-1)).indexOf("\n")&&(a=n?a.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+a.split("\n").map(function(e){return"   "+e}).join("\n")):a=e.stylize("[Circular]","special")),void 0===o){if(n&&i.match(/^\d+$/))return a;o=this._propertyName(i),o=e.stylize(o,"string")}return o+": "+a},_arrayToHash:function(e){var t={};return e.forEach(function(e){t[e]=!0}),t},_hasOwnProperty:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},_getOwnPropertySymbols:function(e){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(e):[]},_propertyName:function(e){return e.match(/^\d+$/)?e:(e=JSON.stringify(""+e)).match(/^"([a-zA-Z_$][a-zA-Z_$0-9]*)"$/)?e.substr(1,e.length-2):e.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'")},_evaluate:function(e,t,s,r,i,n){var o={};try{var a,l,c=s||{};c.props=c.props!==this._undefined?c.props:100,c.sortProps=c.sortProps!==this._undefined&&c.sortProps,c.elements=(c.elements!==this._undefined?c:w.$_$logLimits.inline).elements,c.depth=(c.depth!==this._undefined?c:w.$_$logLimits.inline).depth,c.strLength=c.strLength!==this._undefined?c.strLength:w.$_$logLimits.values.default.stringLength,c.expId=c.expId||r,c.rootExpression=t,c.autoExpand=c.autoExpand!==this._undefined&&c.autoExpand,c.seen=[],c.autoExpandPropertyCount=0,c.autoExpandLimit=c.autoExpandLimit!==this._undefined?c.autoExpandLimit:w.$_$logLimits.values.autoExpand.elements,c.autoExpandMaxDepth=c.autoExpandMaxDepth!==this._undefined?c.autoExpandMaxDepth:w.$_$logLimits.values.autoExpand.depth,c.resolveGetters=c.autoExpand||w.$_$resolveGetters,c.node={current:this._undefined,parent:this._undefined,index:0},c.level=0,c.maxLogEntryStringSize=this._maxLogEntrySize,c.estimatedLogEntryStringSize=0,i?(a={error:i.message},this._processTreeNodeResult(a,c),o.data=a):(o.data=this._traverseObject({},e,c,c.expressionsToEvaluate||{}),this._isPrimitiveType(this._type(e))||this._isUndefined(e)||null===e||!this._maybeCustomInspect(e)||(o.data.customInspect=this._inspect(e)),this._suppressCallStackEval||!(o.data.expandable&&o.data.props&&o.data.props.length)&&o.data.expandable||(l={id:o.data.id+",cs",expandable:!0,callStackNode:!0,label:{name:"Call Stack"},disallowToCopyPath:!0,disallowToCopyData:!0,queryPath:o.data.queryPath.slice().concat(["_s_."])},o.data.expandable||(o.data.expandable=!0,o.data.props=[]),o.data.props.unshift(l),c.expressionsToEvaluate&&c.expressionsToEvaluate["_s_."]&&(l.callStack={stack:this._currentStack(),replaceFirstEntryLine:!c.proxyValue})),this._specName&&!c.proxyValue&&o.data&&o.data.label&&o.data.label.value&&(o.data.label.value+=" ("+this._specName+")"))}catch(e){c.node=c.node||{};s={error:'Error while evaluating "'+t+'": '+(e&&e.message||"")};this._processTreeNodeResult(s,c),o.data=s}return o},_addProperty:function(i,n,o,a,l,c,u,p){var d=this;return function(e){var t=l.node.current,s=l.node.index,r=l.node.parent;l.node.parent=t,l.node.index="number"==typeof a?a:e,i.push(d._property(n,o,a,l,c,u,p)),l.node.parent=r,l.node.index=s}},_addObjectProperty:function(i,e,n,o,a,l,c,u,p){var d=this;return e["_p_"+a.toString()]=!0,function(e){var t=l.node.current,s=l.node.index,r=l.node.parent;l.node.parent=t,l.node.index=e,i.push(d._property(n,o,a,l,c,u,p)),l.node.parent=r,l.node.index=s}},_traverseObject:function(t,i,n,e){var o=this,s=n.autoExpand;try{n.level++,n.seen.push(i);var r,a,l,c,u=[],p=[],d=this._type(i),h="array"===d,g=this._isMap(i),f=!("array"===d||"Error"===d),m=!1,_="function"===d,v=this._isPrimitiveType(d),y=this._isPrimitiveWrapperType(d),b=v||y,w={},k=0,x=!1,S=/^(([1-9]{1}[0-9]*)|0)$/;if(n.depth){if(h){var P=i.length,F=e.ranges||n.ranges;if(F&&F.length===P)m=!0,u=F.props,this._traverseRanges(u,function(e,t,s){for(j=t;j<=s;j++)p.push(o._addProperty(e.props,i,d,j,n,void 0,g,f))});else if(P>n.elements){m=!0,r=0,a=P-1,t.cappedElements=!0;var C=o._createRanges(r,a,n);C.length&&(u=u.concat(C),C[0].props=!0,o._traverseRanges([C[0]],function(e,t,s){var r=Math.min(n.elements-1,s);for(r!==s&&(C[0].cappedRange=!0),j=t;j<=r;j++)p.push(o._addProperty(e.props,i,d,j,n,void 0,g,f))}))}else for(a=P,j=r=0;j<a;j++)p.push(o._addProperty(u,i,d,j,n,void 0,g,f));n.autoExpandPropertyCount+=p.length}if("null"!==d&&"undefined"!==d&&!v&&"String"!==d&&"Buffer"!==d&&"bigint"!==d){var T=e.props||n.props;if(this._isSet(i)?(j=0,i.forEach(function(e){var t;k++,n.autoExpandPropertyCount++,T<k||!n.isExpressionToEvaluate&&n.autoExpand&&n.autoExpandPropertyCount>n.autoExpandLimit?x=!0:p.push(o._addProperty(u,i,"Set",j++,n,(t=e,function(){return t}),g,f))})):g&&i.forEach(function(e,t){var s;k++,n.autoExpandPropertyCount++,T<k||!n.isExpressionToEvaluate&&n.autoExpand&&n.autoExpandPropertyCount>n.autoExpandLimit?x=!0:(100<(t=o._inspect(t,2,10).replace(/\r?\n|\r/g," ").replace(/\s\s+/g," ")).length&&(t=t.slice(0,100)+"..."),p.push(o._addProperty(u,i,"Map",t,n,(s=e,function(){return s}),g,f)))}),!m){try{for(l in i)if(!(h&&S.test(l)||this._blacklistedProperty(i,l))){if(k++,n.autoExpandPropertyCount++,T<k){x=!0;break}if(!n.isExpressionToEvaluate&&n.autoExpand&&n.autoExpandPropertyCount>n.autoExpandLimit){x=!0;break}p.push(o._addObjectProperty(u,w,i,d,l,n,void 0,g,f))}}catch(e){}if(w._p_length=!0,_&&(w._p_name=!0),!x){var E=this._getOwnPropertyNames(i).concat(this._getOwnPropertySymbols(i)),j=0;for(P=E.length;j<P;j++)if(l=E[j],!(h&&S.test(l.toString())||this._blacklistedProperty(i,l)||w["_p_"+l.toString()])){if(k++,n.autoExpandPropertyCount++,T<k){x=!0;break}if(!n.isExpressionToEvaluate&&n.autoExpand&&n.autoExpandPropertyCount>n.autoExpandLimit){x=!0;break}p.push(o._addObjectProperty(u,w,i,d,l,n,void 0,g,f))}}}}}if(t.type=d,b?(t.value=i.valueOf(),this._capIfString(d,t,n,e)):"date"===d?t.value=this._dateToString.call(i):"bigint"===d?t.value=i.toString():"RegExp"===d?t.value=this._regExpToString.call(i):"symbol"===d&&this._Symbol?t.value=this._Symbol.prototype.toString.call(i):n.depth||"null"===d||"undefined"===d||(delete t.value,t.capped=!0),x&&(t.cappedProps=!0),c=n.node.current,n.node.current=t,this._treeNodePropertiesBeforeFullValue(t,n),p.length)for(j=0,P=p.length;j<P;j++)p[j](j);u.length&&(t.props=u)}catch(e){t.type="unknown",t.error=e.message,c=n.node.current,n.node.current=t,this._treeNodePropertiesBeforeFullValue(t,n)}return this._additionalMetadata(i,t),this._treeNodePropertiesAfterFullValue(t,n),n.node.current=c,n.level--,n.autoExpand=s,n.seen.pop(),t},_blacklistedProperty:function(e,t){if((e===w||e===this._envGlobal)&&"wallaby"===t||t.indexOf&&0===t.indexOf("$_$"))return!0},_createRanges:function(e,t,s,r){r=r||{index:0};for(var i=s.elements,n=[],o=Math.max(Math.ceil((t-e+1)/i),i),a=e;a<t;a+=o){var l=a,c=Math.min(a+o-1,t),l={rangeNode:!0,name:l+" - "+(c=t<=c+i/2?t:c),props:2*i<c-l+1&&1<i?this._createRanges(l,c,s,r):[]};if(this._setNodeId(l,s),this._setNodeLabel(l,s),this._setNodeExpandableState(l,s),this._setNodePermissions(l,s),l.id+=" r "+r.index++,n.push(l),c===t)break}return n},_traverseRanges:function(e,t){for(var s=0,r=e.length;s<r;s++){var i,n=e[s];n.rangeNode=!0,n.props&&(n.props.length?this._traverseRanges(n.props,t):!0===n.props&&(i=n.name.split("-"),n.props=[],t(n,parseInt(i[0],10),parseInt(i[1],10))))}},_capIfString:function(e,t,s,r){r=r.strLength||s.strLength;("string"===e||"String"===e)&&t.value&&t.value.length>r&&(t.capped=t.value.substr(0,r),delete t.value)},_property:function(e,t,s,r,i,n,o){var a=this,l=(i=i||function(e,t){return e[t]},s.toString()),c=r.expressionsToEvaluate||{},u=r.depth,p=r.isExpressionToEvaluate;try{var d,h=l,g=(n&&"'"===h[0]&&(h=h.substr(1,h.length-2)),r.expressionsToEvaluate=c["_p_"+h]),f=(g&&(r.depth=r.depth+1),r.isExpressionToEvaluate=!!g,"symbol"==typeof s),m={name:f||n?l:this._propertyName(l)};if(f&&(m.symbol=!0),o){var _=this._getOwnPropertyDescriptor(e,s);if(_&&(_.set&&(m.setter=!0),_.get)&&!g&&!r.resolveGetters)return m.getter=!0,this._processTreeNodeResult(m,r),m}try{d=i(e,s)}catch(e){return m={name:l,type:"unknown",error:e.message},this._processTreeNodeResult(m,r),m}var v,y,b,w,k=this._type(d),x=this._isPrimitiveType(k);return m.type=k,x?this._processTreeNodeResult(m,r,d,function(){m.value=d.valueOf(),g||a._capIfString(k,m,r,{})}):(v="function"===k,y=0<=r.seen.indexOf(d)||void 0,b=r.autoExpand&&r.level<r.autoExpandMaxDepth&&!y&&!v&&r.autoExpandPropertyCount<r.autoExpandLimit,w=r.estimatedLogEntryStringSize>r.maxLogEntryStringSize,b||r.level<u&&!w&&!v&&!y||g?(this._traverseObject(m,d,r,g||{}),this._additionalMetadata(d,m)):this._processTreeNodeResult(m,r,d,function(){"date"===k?m.value=a._dateToString.call(d):"bigint"===k?m.value=d.toString():"RegExp"===k?m.value=a._regExpToString.call(d):"symbol"===k&&a._Symbol?m.value=a._Symbol.prototype.toString.call(d):"null"!==k&&"undefined"!==k&&(delete m.value,m.capped=!0,m.circular=y)})),m}finally{r.expressionsToEvaluate=c,r.depth=u,r.isExpressionToEvaluate=p}},_processTreeNodeResult:function(e,t,s,r){this._treeNodePropertiesBeforeFullValue(e,t),r&&r(),this._additionalMetadata(s,e),this._treeNodePropertiesAfterFullValue(e,t)},_treeNodePropertiesBeforeFullValue:function(e,t){this._setNodeId(e,t),this._setNodeQueryPath(e,t),this._setNodeExpressionPath(e,t),this._setNodePermissions(e,t)},_treeNodePropertiesAfterFullValue:function(e,t){this._setNodeLabel(e,t),this._setNodeExpandableState(e,t),t.sortProps&&this._sortProps(e,t),this._addFunctionsNode(e,t),this._addLoadNode(e,t),this._cleanNode(e,t)},_additionalMetadata:function(e,t){try{e&&"number"==typeof e.length&&(t.length=e.length)}catch(e){}if("number"===t.type||"Number"===t.type)if(isNaN(t.value))t.nan=!0,delete t.value;else switch(t.value){case Number.POSITIVE_INFINITY:t.positiveInfinity=!0,delete t.value;break;case Number.NEGATIVE_INFINITY:t.negativeInfinity=!0,delete t.value;break;case 0:this._isNegativeZero(t.value)&&(t.negativeZero=!0)}else"function"===t.type&&"string"==typeof e.name&&e.name&&t.name&&e.name!==t.name&&(t.funcName=e.name)},_setNodeId:function(e,t){e.id=t.node.parent?t.node.parent.id+" "+t.node.index:t.expId},_sortProps:function(e){e.props&&e.props.length&&"array"!==e.type&&"Map"!==e.type&&"Set"!==e.type&&e.props.sort(function(e,t){e=e.name.toLowerCase(),t=t.name.toLowerCase();return e<t?-1:t<e?1:0})},_addFunctionsNode:function(e,t){if(e.props&&e.props.length){for(var s,r=[],i=[],n=0,o=e.props.length;n<o;n++){var a=e.props[n];("function"===a.type?r:i).push(a)}!i.length&&t.autoExpand&&(e.capped=!0),!i.length||r.length<=1||(e.props=i,s={functionsNode:!0,props:r},t.autoExpand&&(s.capped=!0),this._setNodeId(s,t),this._setNodeLabel(s,t),this._setNodeExpandableState(s,t),this._setNodePermissions(s,t),s.id+=" f",e.props.unshift(s))}},_addLoadNode:function(e,t){var s;e.props&&e.props.length&&e.cappedProps&&"string"!==e.type&&!t.nonExpandable&&(this._setNodeId(s={loadActionNode:!0},t),this._setNodeQueryPath(s,t),this._setNodeLabel(s,t),this._setNodeExpandableState(s,t),this._setNodePermissions(s,t),s.id+=" l",e.props.push(s))},_setNodeExpandableState:function(e,t){((e.capped||e.cappedProps||e.functionsNode||e.loadActionNode||e.rangeNode||e.getter)&&!t.nonExpandable||this._isArray(e.props))&&(e.expandable=!0)},_setNodePermissions:function(e,t){var t=t.node.parent,s=((e.symbol||t&&t._hasSymbolPropertyOnItsPath)&&(e._hasSymbolPropertyOnItsPath=!0),t&&t._hasSetOnItsPath),t=t&&t._hasMapOnItsPath,r=("Set"!==e.type&&!s||(e._hasSetOnItsPath=!0),"Map"!==e.type&&!t||(e._hasMapOnItsPath=!0),!(e.functionsNode||e.loadActionNode||e.rangeNode||e.error));(!r||e._hasSymbolPropertyOnItsPath||s||t)&&(e.disallowToCopyPath=!0),r&&!e.getter&&"function"!==e.type&&"symbol"!==e.type&&"Set"!==e.type&&"Map"!==e.type||(e.disallowToCopyData=!0)},_cleanNode:function(e){e._hasSymbolPropertyOnItsPath=void 0,e._hasSetOnItsPath=void 0,e._hasMapOnItsPath=void 0},_setNodeExpressionPath:function(e,t){t.node.parent?e.expressionPath=t.node.parent.expressionPath.concat([this._propertyAccessor(e.name)]):e.expressionPath=[t.rootExpression]},_propertyAccessor:function(e){return e?e.match(h)?"["+e+"]":e.match(p)?"."+e:e.match(g)?"["+e+"]":"['"+e+"']":""},_setNodeQueryPath:function(e,t){var s;t.node.parent?e.loadActionNode?e.queryPath=t.node.current.queryPath.slice():((s=e.name)&&"'"===s[0]&&(s=s.substr(1,s.length-2)),e.queryPath=t.node.parent.queryPath.concat(["_p_"+s])):e.queryPath=[e.id]},_setNodeLabel:function(e,t){e.rangeNode?e.label={name:e.name}:e.loadActionNode?e.label={name:"..."}:e.functionsNode?e.label={name:"Functions"}:this._setNodeLabelValue(e,t)},_setNodeLabelValue:function(e,t){e.label={},e.label.name=e.name,e.label.type=this._formatNodeType(e,t),e.label.value=this._formatNodeValue(e,t),t.estimatedLogEntryStringSize+=(e.label.name&&e.label.name.length||0)+(e.label.type&&e.label.type.length||0)+(e.label.value&&e.label.value.length||0)+18},_setNodeLabelValueV2:function(e,t){t.estimatedLogEntryStringSize+=(e.name?e.name.length:0)+10+(null==(t=e.type)?void 0:t.toLowerCase())==="string"?e.length:27},_formatNodeValue:function(e,t,s){if(e.rangeNode)return e.name;if(e.error)return e.error;if(e.getter)return"(...)";if("number"===e.type.toLowerCase()){if(e.nan)return"NaN";if(e.positiveInfinity)return"Infinity";if(e.negativeInfinity)return"-Infinity";if(e.negativeZero)return"-0"}return"null"===e.type||"undefined"===e.type?e.type:"string"===e.type.toLowerCase()?"'"+(e.capped?e.capped+"...":e.value).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'"+(e.capped?" (total length: "+e.length+")":""):(this._isUndefined(e.value)?this._formatCompactObjectView(e,t,s):e.value)+(e.funcName?":"+e.funcName:"")},_formatCompactObjectView:function(e,t,s){if("function"===e.type)return"λ";var r="array"===e.type&&0===e.length,i=["array"===e.type?"[":"{","","array"===e.type?"]":"}"];if(s||e.capped||e.ranges)i[1]=r?"":"...";else if(e.props){for(var n=[],o=[],a=0;a<e.props.length&&o.length<=5;a++){var l=e.props[a];("function"===l.type||l.getter?n:o).push("array"===e.type?this._formatNodeValue(l,t,!0):l.name+": "+this._formatNodeValue(l,t,!0))}o.length<5&&(o=o.concat(n)),i[1]=o.join(", "),5<e.props.length&&(i[1]+=", ...")}return i.join("")},_formatNodeType:function(e){if(this._isDisplayableType(e.type))return e.error?"":"date"===e.type?"Date":"array"===e.type?e.length?"Array("+e.length+")":"":e.type},_isUndefined:function(e){return e===this._undefined},_isDisplayableType:function(e){return!("boolean"===e||"Boolean"===e||"symbol"===e||"string"===e||"String"===e||"number"===e||"Number"===e||"object"===e||"Object"===e||"function"===e||"null"===e||"undefined"===e)},_type:function(e){var t=typeof e;return"object"===t?"[object Array]"===this._objectToString(e)?t="array":"[object Date]"===this._objectToString(e)?t="date":"[object BigInt]"===this._objectToString(e)?t="bigint":null===e?t="null":e.constructor&&(t=e.constructor.name||t):"undefined"===t&&this._HTMLAllCollection&&e instanceof this._HTMLAllCollection&&(t="HTMLAllCollection"),t},_isPrimitiveType:function(e){return"boolean"===e||"string"===e||"number"===e},_isPrimitiveWrapperType:function(e){return"Boolean"===e||"String"===e||"Number"===e},initLoadingPhase:function(){var s=this;this._resetLoadingData(),this._testFileIds=this._safeObject({}),this._seq=0,(w.$_$testFiles||[]).forEach(function(e){s._testFileIds[e.id]=1}),w.$_$wp=function(e,t){return s._initializeCoverage(e,t),s._reportProgramScope("programScopeStart",e),s.programScopeStartLoading(e),s._executionContext()},w.$_$wpe=function(e){s._reportProgramScope("programScopeEnd",e),s.programScopeEndLoading(e)},!w.$_$traceContext||w.$_$traceContext.test?s._resetTracerMode():w.$_$traceContext.test||s._setTraceRecordMode(),w.$_$profileRun?s._setProfileMode():s._resetTracerMode()},_resetTracerMode:function(){w.$_$w=k.$_$w,w.$_$w_=k.$_$w_,w.$_$wv=k.$_$wv,w.$_$wf=k.$_$wf,this._envGlobal&&(this._envGlobal.$_$w=w.$_$w,this._envGlobal.$_$w_=w.$_$w_,this._envGlobal.$_$wv=w.$_$wv,this._envGlobal.$_$wf=w.$_$wf)},_setProfileMode:function(){w.$_$wf=w.$_$w_=w.$_$w=function(){},w.$_$wv=function(e,t,s,r,i,n){return n},this._envGlobal&&(this._envGlobal.$_$w=w.$_$w,this._envGlobal.$_$w_=w.$_$w_,this._envGlobal.$_$wf=w.$_$wf,this._envGlobal.$_$wv=w.$_$wv)},setNoOpMode:function(){w.$_$wp=w.$_$wpe=w.$_$wf=w.$_$w_=w.$_$w=function(){},w.$_$wv=function(e,t,s,r,i,n){return n}},_setTraceRecordMode:function(){w.$_$trace||(w.$_$trace={sequence:[],tests:{},values:{}}),w.$_$traceContext.allowRecordingValuesAttributtedToCurrentFrame=!0,w.$_$traceContext.allowRecordingValues=!0,w.$_$traceContext.currentFrame=w.$_$traceContext.currentFrame||0,w.$_$traceContext.stepsToRecordWatchExpressionsAt=w.$_$traceContext.stepsToRecordWatchExpressionsAt||{},w.$_$traceContext.allowedNumberOfStepsToRecordWatchExpressionsAfterCurrentStep=k._maxTraceStepsForWatchExpressionPrefetch,w.$_$w=function(e,t,s){k.$_$w(e,t),k._recordTrace(e,t,s[0]),k._recordTraceValues(e,t,s[1]),k._recordCallStack()},w.$_$wv=function(e,t,s,r,i,n,o,a,l,c){if(w.$_$trace){var u=k._expressionId(e,s,0,0);if(!c||!c.traceId||c.permanent){var p,d={};for(p in c||{})d[p]=c[p];d.traceId="*",d.traceStep=w.$_$trace.sequence.length>k._maxTraceSteps?void 0:w.$_$trace.sequence.length-1;var h=k.$_$wv(e,t,s,r,i,n,o,a,l,d);if(!d.permanent)return h}c.permanent&&delete c.permanent,w.$_$trace.values[u]={fileId:e,rangeId:t,fileRangeId:s,context:i,val:n,exp:o,singleHit:a,evalOpts:l,logMarkerContext:c},k._recordTraceValues(e,t,r[1],!0)}return n},w.$_$w_=function(e,t,s,r){k.$_$w_(e,t),w.$_$traceContext.allowRecordingValuesAttributtedToCurrentFrame&&r&&w.$_$traceContext.currentFrame<=w.$_$trace.sequence.length-1&&(w.$_$traceContext.allowRecordingValuesAttributtedToCurrentFrame=!1)},w.$_$wf=function(e){return k.scopeStart(e),k._executionContext()},this._envGlobal&&(this._envGlobal.$_$w=w.$_$w,this._envGlobal.$_$wv=w.$_$wv,this._envGlobal.$_$wf=w.$_$wf)},_executionContext:function(){return[++this._stackDepth,++this._functionCallId]},_recordCallStack:function(){w.$_$trace&&w.$_$traceContext.captureCallStackFrame===w.$_$trace.sequence.length-1&&(w.$_$trace.callStack={},w.$_$trace.callStack[w.$_$traceContext.captureCallStackFrame]={stack:k._currentStack()})},_recordTraceValues:function(e,t,s,r){var i,n,o,a,l,c;w.$_$traceContext.allowRecordingValues&&w.$_$trace&&(i=w.$_$trace.sequence.length-1,n=(o=w.$_$traceContext.currentFrame<i&&!w.$_$traceContext.currentFrameFunctionCallId)||s<w.$_$traceContext.currentFrameFunctionCallId,o=o||s<=w.$_$traceContext.currentFrameFunctionCallId,a=w.$_$traceContext.currentFrameFunctionCallId&&s===w.$_$traceContext.currentFrameFunctionCallId,l=i<w.$_$traceContext.currentFrame&&w.$_$traceContext.stepsToRecordWatchExpressionsAt[i],(c=w.$_$traceContext.currentFrame===i)&&!r&&(w.$_$traceContext.currentFrameFunctionCallId=s),w.$_$traceContext.allowRecordingValuesAttributtedToCurrentFrame&&(c||r&&a)?k._recordCapturedTraceValues(w.$_$traceContext.currentFrame):l?k._recordCapturedTraceValues(i):a&&(--w.$_$traceContext.allowedNumberOfStepsToRecordWatchExpressionsAfterCurrentStep<0?this._stopTraceValueRecording():k._recordCapturedTraceValues(i)),o&&(w.$_$traceContext.allowRecordingValuesAttributtedToCurrentFrame=!1),n)&&this._stopTraceValueRecording()},_recordTrace:function(e,t,s){w.$_$trace.sequence.length>this._maxTraceSteps||(w.$_$trace._stackDepth!==s&&(w.$_$trace._stackDepth=s),w.$_$trace.sequence.push([e,t,s]))},_recordCapturedTraceValues:function(n){var o;Object.keys(w.$_$trace.values).length&&(o=w.$_$trace.values,k._doWhenReceiverIsReady(function(){for(var e=Object.keys(o),t=0,s=e.length;t<s;t++){var r=e[t],r=o[r],i={changeId:r.logMarkerContext.changeId,traceId:"*",traceStep:n,preciseTraceStep:!0,initialTraceId:r.logMarkerContext.traceId};k._autoLogImmediateValue(r.fileId,r.rangeId,-1*n,-1*n,r.context,r.val,r.exp,r.singleHit,r.evalOpts,i)}}))},_clearCapturedTraceValues:function(){w.$_$trace.values={}},_stopTraceValueRecording:function(){k._clearCapturedTraceValues(),w.$_$traceContext.allowRecordingValues=!1},_currentStack:function(){try{throw new Error("stack trace")}catch(e){return e.stack}},_initializeCoverage:function(e,t){if(t){void 0===w.$_$coverage[e]&&(w.$_$coverage[e]=[]);var s=w.$_$coverage[e];if(s.length!==t){this.debugLog("Range mismatch (fileId: "+e+", calculated: "+s.length+", actual: "+t+")");for(var r=s.length;r<t;r++)s[r]={}}}},_reportProgramScope:function(e,t){var s=this;this._shouldReportProgramScope&&this._doWhenReceiverIsReady(function(){s._sendWithHighPriority(e,t)})},_looksLikePromise:function(e){return e&&e.constructor&&"Promise"===e.constructor.name&&"function"==typeof e.then&&"function"==typeof e.catch&&(w.Promise||{}).prototype!==e},_looksLikeObservable:function(e){return e&&e.constructor&&e.constructor.name&&"string"==typeof e.constructor.name&&~e.constructor.name.indexOf("Observable")&&"function"==typeof e.forEach},_looksLikeBuffer:function(e){return e&&e.constructor&&"Buffer"===e.constructor.name&&"function"==typeof e.toString&&(w.Buffer||{}).prototype!==e},_autoLogValue:function(t,s,r,i,n,e,o,a,l,c,u){var p=this,d=w.$_$session;this._loggingValue=!0,p._looksLikePromise(e)?(this._loggingValue=!1,e.then(function(e){w.$_$session===d&&p._autoLogResolvedValue(t,s,r,i,n,"then ",p._valueToFormat(e,o),a,l,c,u)}).catch(function(e){w.$_$session===d&&p._autoLogResolvedValue(t,s,r,i,n,"catch ",(e||"<No Reason Provided>").toString(),a,l,c,u)})):p._looksLikeObservable(e)?(this._loggingValue=!1,e.forEach(function(e){w.$_$session===d&&p._autoLogResolvedValue(t,s,r,i,n,"",p._valueToFormat(e,o),a,l,c,u)})):p._autoLogImmediateValue(t,s,r,i,n,e,o,a,l,c,u),this._loggingValue=!1},_createProxy:function(o,a){a=a||{path:[]};var i,e=o.val,l=this;if(!l._loggingValue)return l._proxyCache||(l._proxyCache=new w.WeakMap),i=function(e,t,s){var r,i,n;if(!l._loggingValue)return t=(t||"").toString(),!(n="function"==typeof e)&&"object"!=typeof e||"get"!==s||(r=l._proxyCache.get(e))||((i={}).path=a.path.slice(),t&&i.path.push(t),r=l._createProxy({fileId:o.fileId,rangeId:o.rangeId,specHitCount:o.specHitCount,overallHitCount:o.overallHitCount,context:o.context,val:e,exp:o.exp,singleHit:o.singleHit,evalOpts:o.evalOpts,logMarkerContext:o.logMarkerContext},i),l._proxyCache.set(e,r)),n||((i={}).path=a.path.slice().concat(t?[t]:[]),i.trap=s,n=l._expressionId(o.fileId,o.rangeId,o.specHitCount,o.overallHitCount),(t=l._consoleProxyHits[n])||(l._consoleProxyHits[n]=t={count:0,specHits:{}}),(s=t.specHits[l._spec])||(t.specHits[l._spec]=s={count:0}),i.specHitCount=s.count,i.overallHitCount=t.count,l._autoLogValue(o.fileId,o.rangeId,o.specHitCount,o.overallHitCount,o.context,e,o.exp,o.singleHit,o.evalOpts,o.logMarkerContext,i),t.count=i.overallHitCount+1,s.count=i.specHitCount+1),r},new w.Proxy(e,{get:function(e,t,s){e=Reflect.get(e,t,s);return i(e,t,"get")||e},set:function(e,t,s,r){return i(s,t,"set"),Reflect.set(e,t,s,r)},apply:function(e,t,s){e=Reflect.apply(e,t,s);return i(e,void 0,"call"),e},deleteProperty:function(e,t){return i(Reflect.get(e,t,e),t,"delete"),Reflect.deleteProperty(e,t)}})},_valueToFormat:function(e,t){return"$_$ne"===t?e:t(e)},_autoLogImmediateValue:function(e,t,s,r,i,n,o,a,l,c,u){this._isBigInt(n)&&(n=n.toString()+"n"),this._autoLogResolvedValue(e,t,s,r,i,"",this._valueToFormat(this._looksLikeBuffer(n)?n.toString():n,o),a,l,c,u)},_autoLogResolvedValue:function(e,t,s,r,i,n,o,a,l,c,u){c&&(p=c.changeId,d=c.traceId,h=c.traceStep,g=c.permanent,f=c.preciseTraceStep,m=c.initialTraceId),this._loggingValue=!0;var p,d,h,g,f,m,_,v,c=e+","+t;!n&&2&l&&(n="⚑ "),r<this._evaluatedExpressionPerRangeLimit?(_=this._formattingOpts(c,{elements:a?50:this._undefined,resolveGetters:w.$_$resolveGetters||1&l||this._autoExpandAllLogs,depth:a?2:this._undefined}),u&&u.overallHitCount===this._evaluatedProxyExpressionPerRangeLimit?v=this._evaluateExpressions(this._expressionId(e,c,s,r,u),o,i,new Error("Only the first "+u.overallHitCount+" values are evaluated"),l,d,!!u,_):(!u||u.overallHitCount<this._evaluatedProxyExpressionPerRangeLimit)&&(v=this._evaluateExpressions(this._expressionId(e,c,s,r,u),o,i,void 0,l,d,!!u,_))):r===this._evaluatedExpressionPerRangeLimit&&(_=this._formattingOpts(c,{elements:a?50:this._undefined,resolveGetters:w.$_$resolveGetters||1&l||this._autoExpandAllLogs,depth:a?2:this._undefined}),v=this._evaluateExpressions(this._expressionId(e,c,s,r,u),o,i,new Error("Only the first "+r+" values are evaluated"),l,d,!!u,_)),(d||p||g)&&(v=v||{},g)&&(v.permanent=g),(d||p)&&(d&&(v.traceId=d),p&&(v.changeId=p),v.traceStep=h,v.preciseTraceStep=f,v.initialTraceId=m),u&&v&&v.data&&(v.data.proxyData=u),this._sendLog("autoLog",{prefix:n,format:n?"raw":void 0},i,e,t,v),this._loggingValue=!1},_formattingOpts:function(e,t){var s=this._time(),r=this._logStats,i=r[e];return!i||100<d(s,i.ts)&&i.count&&i.time/i.count<50?(r[e]=i={count:0,time:0,ts:s},r.hits={}):50<d(s,r.hits.ts)&&r.hits.count&&r.hits.time/r.hits.count<50&&(r.hits={}),i.reduceLimits||r.hits.reduceLimits?{depth:2,props:5,elements:5,strLength:256,autoExpandLimit:30,autoExpandMaxDepth:2,logPointHits:i,startTime:s}:(t.logPointHits=i,t.startTime=s,t)},_evaluateExpressions:function(e,t,s,r,i,n,o,a){var l=this._expressionsToEvaluate&&this._expressionsToEvaluate[e],a=a||{},l=(a.expressionsToEvaluate=l,o&&(a.proxyValue=!0),1&i||this._autoExpandAllLogs),o=(l&&(a.autoExpand=!0,a.depth=1,a.strLength=w.$_$logLimits.values.autoExpand.stringLength),this._evaluate(t,s,a,e,r,n)),i=(o.data&&(o.data.id=e,o.data.autoExpand=!!l),a.logPointHits),t=a.startTime;return i&&t&&(s=this._logStats,r=this._time(),i.count++,i.time+=d(t,r),i.ts=r,s.hits.count++,s.hits.time+=d(t,r),s.hits.ts=r,(50<i.count||20<i.time)&&(i.reduceLimits=!0),500<s.hits.count||200<s.hits.time)&&(s.hits.reduceLimits=!0),o},initV2:function(){this._expressionId=this._expressionIdV2.bind(this),this._setNodeLabelValue=this._setNodeLabelValueV2.bind(this),this._setNodeExpressionPath=function(){},this._setNodePermissions=function(){},this._setNodeId=function(e,t){e.id=t.node.parent?t.node.index+"":t.expId},this.v2=!0}},w.$_$doNotInit?w.$_$Tracer=a:((k=new a).setGlobalErrorHandler(),d=function(e,t){return t-e},w.performance?k._time=function(){return w.performance.now()}:w.process&&w.process.hrtime?(k._time=function(){return w.process.hrtime()},d=function(e,t){return 1e3*(t[0]-e[0])+(t[1]-e[1])/1e6}):k._time=function(){return+new Date},k._logTime=function(t,s,r,i,n,o,e,a,l){var c,u,p=this;return p._looksLikePromise(e)?(c=w.$_$session,e.then(function(e){w.$_$session===c&&p._logTime(t,s,r,i,n,o,e,p._time(),l)}).catch(function(e){w.$_$session===c&&p._logTime(t,s,r,i,n,o,e,p._time(),l)})):(a=d(o,a),(u=k._autoTimeHits[r])?(u.value&&(u.n=1,u.min=u.value,u.max=u.value,u.total=u.value,delete u.value),u.min=Math.min(u.min,a),u.max=Math.max(u.max,a),u.total+=a,u.n+=1):k._autoTimeHits[r]={value:a,context:n,fileId:t,rangeId:s,logMarkerContext:l}),e},k.$_$w=k.$_$w_=w.$_$w=w.$_$w_=function(e,t){k.statement(e,t)},k.$_$wp=w.$_$wp=function(e,t){return k._initializeCoverage(e,t),k._reportProgramScope("programScopeStart",e),k.scopeStart(e),k._executionContext()},k.$_$wpe=w.$_$wpe=function(e){k._reportProgramScope("programScopeEnd",e)},k.$_$wf=w.$_$wf=function(e){k.scopeStart(e)},k.$_$wv=w.$_$wv=function(e,t,s,r,i,n,o,a,l,c){var u,p,d,h,g,f,m,_=k._rangeHits(s),v=_.rangeConsoleHits,_=_.rangeConsoleHitsOfSpec,y=v.count,b=_.count;return a?k._identifierExpressionAutoLogHitLimit?y<k._identifierExpressionAutoLogHitLimit?k._doWhenReceiverIsReady(function(){k._autoLogValue(e,t,b,y,i,n,o,a,l,c)},arguments):y===k._identifierExpressionAutoLogHitLimit&&k._doWhenReceiverIsReady(function(){k._sendLog("log",{content:"Only the first "+k._identifierExpressionAutoLogHitLimit+" values are automatically logged, use console.log("+(i||"...")+") for the full output",format:"raw"},i,e,t)},arguments):y||k._doWhenReceiverIsReady(function(){k._autoLogValue(e,t,b,y,i,n,o,a,l,c)},arguments):!k._logLimit||y<k._logLimit?k._doWhenReceiverIsReady(function(){k._autoLogValue(e,t,b,y,i,n,o,a,l,c)},arguments):y===k._logLimit&&(u=c&&c.changeId,p=c&&c.traceId,d=c&&c.traceStep,h=c&&c.permanent,g=c&&c.preciseTraceStep,f=c&&c.initialTraceId,(p||u||h)&&(m={},h&&(m.permanent=h),p&&(m.traceId=p),u&&(m.changeId=u),p||u)&&(m.traceStep=d,m.preciseTraceStep=g,m.initialTraceId=f),k._doWhenReceiverIsReady(function(){k._sendLog("log",{content:"Only the first "+k._logLimit+" values are automatically logged. Increase this limit with the `logLimit` setting.",format:"raw"},i,e,t,m)},arguments)),v.count++,_.count++,!(2&l&&"object"==typeof n&&w.Proxy&&w.WeakMap)||c&&c.traceId?n:k._createProxy({fileId:e,rangeId:t,specHitCount:b,overallHitCount:y,context:i,val:n,exp:o,singleHit:a,evalOpts:l,logMarkerContext:c})},w.$_$tracer=k,w.$_$coverage=w.$_$coverage||[],w.$_$reuseableTracer||(w.$_$tracer._expressionsToEvaluate=w.$_$expressionsToEvaluate||{}),w.$_$noLogThrottling&&(w.$_$tracer._formattingOpts=function(e,t){return t}),w.$_$v2&&w.$_$tracer.initV2(),c=function(e){return e.path},l=w.$_$testFiles&&(w.$_$testFiles||[]).map(c).map(function(e){return e&&e.replace(/\\/g,"/")}),c=w.$_$testFiles&&w.$_$testFiles.filter(function(e){return e.loaded}).map(c),k.initLoadingPhase(),w.wallaby={delayStart:function(){k._patchFrameworks(),k._delayStart=!0},start:function(){k._delayStart=!1,k.start()},_startWhenReceiverIsReady:function(e){k._shouldReportProgramScope=!0,k._doWhenReceiverIsReady(function(){e()})},tests:l,loadedTests:c,baseDir:w.$_$baseDir,slowTestThreshold:w.$_$slow||75})},{}],81:[function(e,t,s){"use strict";const n=e("path"),o=e("uuid"),i=e("https"),a={Atom:"AT",VSCode:"VSC",Sublime:"ST",IntelliJ:"IJ",VS:"VS"};t.exports=class{constructor(r,e){if(r&&_.isString(e)){this._edition=r.edition,this._version=r.coreVersion||"unknown";var i=r.client&&a[r.client];this._client=i||(~e.indexOf("wallaby-vscode")?"VSC":~e.indexOf(".wallaby")?"VS":~e.indexOf("atom-wallaby")?"AT":~e.indexOf("Sublime")?"ST":"IJ");let t=r.cidFile;t=t||("VS"===this._client?n.join(e,"..","..","t.id"):"VSC"===this._client?n.join(e,"..","..","..",".wtid"):n.join(e,"..","t.id"));let s;try{s=r.readFileSync(t)}catch(e){s=o.v4();try{r.writeFileSync(t,s)}catch(e){}}this._cid=s||o.v4(),this._sid=o.v4(),this._sendHeartbeat=!0,this._featureUseTelemetry=void 0}}start(e){try{this._env=`${"browser"===e.env.type?e.env.kind:e.env.type} `+e.testFramework.version.substr(0,e.testFramework.version.indexOf("@"))+(e.testFramework.autoDetected?".auto":"")}catch(e){this._env="unknown"}this._kind=e.env.kind,this._type=e.env.type,this._auto=e.testFramework.autoDetected,this._framework=e.testFramework.version;let t=this;this._heartbeatInterval=setInterval(()=>t._heartbeat(),3e5),this._started=!0,t._heartbeat()}dispose(){clearInterval(this._heartbeatInterval),clearTimeout(this._sendPendingFeatureUseTelemetryTimeout)}busy(){this._sendHeartbeat=!0}featureUsed(e,t){switch(e){case"vscode.liveShare.available":case"vscode.liveShare.started":return}e.startsWith("vscode.")&&(e=e.slice("vscode.".length));var s=void 0===this._featureUseTelemetry;this._featureUseTelemetry||(this._featureUseTelemetry={}),this._featureUseTelemetry[e]=t||{},s&&(this._sendPendingFeatureUseTelemetryTimeout=setTimeout(()=>this._sendPendingFeatureUseTelemetry(),1e4))}mode(e){this._mode=e}_sendPendingFeatureUseTelemetry(){if(this._started&&this._featureUseTelemetry){const t=this._featureUseTelemetry;this._featureUseTelemetry=null,Object.keys(t).forEach(e=>{this._send(this._build(e,t[e]))})}}_heartbeat(){this._sendHeartbeat&&(this._send(this._build("heartbeat")),this._sendPendingFeatureUseTelemetry()),delete this._sendHeartbeat}_build(e,t){try{var s={name:e.replace(/[^a-z0-9_]/gi,"_").replace(/__+/g,"_").replace(/_$/g,"").slice(0,40),params:{}};return s.params=Object.assign(s.params,t),s.params.session_id=this._sid,s.params.name=e,s.params.editor=this._client,s.params.version=this._version,s.params.env=this._env,this._mode&&(s.params.mode=this._mode),this._edition&&(s.params.edition=this._edition),process.env.quokka||(this._kind&&(s.params.kind=this._kind),s.params.type=this._type,s.params.framework=this._framework,s.params.auto=this._auto),s}catch(e){}}_send(e){if(e)try{var t=JSON.stringify({client_id:this._cid,events:[e]}),s={hostname:"www.google-analytics.com",path:`/mp/collect?measurement_id=${process.env.quokka?"G-08B1NWS1SF":"G-0HETDVEV9W"}&api_secret=`+(process.env.quokka?"H4qI9zDATbyt9zwEvgYNjg":"5o2jcERDQQel559K7G-3kw"),method:"POST",headers:{"Content-Type":"application/json","Content-Length":t.length}},r=i.request(s,function(e){e.on("data",_.noop),e.on("end",_.noop)});r.on("error",_.noop),r.write(t),r.end()}catch(e){}}}},{https:void 0,path:void 0,uuid:void 0}],82:[function(r,e,t){"use strict";const i=logger.create("typeScriptCompiler")["debug"];var n,s=r("./typeScriptVisitor"),o=r("./utils").default,a=r("./typeScriptUtils"),l=r("semver");class c{constructor(e,t){this._useTsconfigFile=!0,this._opts=a.createOptions(n,e||{},this),this._useTsconfigFile&&(this._opts=a.mergeTsConfigOptions(n,this._opts,t)),this._opts.isolatedModules=!0,this._opts.suppressOutputPathCheck=!0,this._opts.allowNonTsExtensions=!0,this._opts.noLib=!0,this._opts.lib=void 0,this._opts.types=void 0,this._opts.noEmit=void 0,this._opts.noEmitOnError=void 0,this._opts.paths=void 0,this._opts.rootDirs=void 0,this._opts.declaration=void 0,this._opts.declarationDir=void 0,this._opts.out=void 0,this._opts.outFile=void 0,this._opts.noResolve=!0,this._visitor=new s(n)}run(e){this._code="",this._ranges=[];var t=this._opts,s=e.path,r=n.createSourceFile(s,e.content,t.target),r=(this._ranges=this._visitor.visit(r),n.transpileModule(e.content,{fileName:s,compilerOptions:t,reportDiagnostics:!0})),t=(this._code=r.outputText,r&&r.diagnostics);if(t&&t.length)throw new Error(_.reduce(t,(e,t)=>{t=a.formatErrorText(n,t);return e[t]||(e[t]=t,e.message+="\n  - "+t),e},{message:"TypeScript compiler errors:"}).message);if(r.emitSkipped)return e.content;t=r.sourceMapText&&JSON.parse(r.sourceMapText);if(t)return this._noRename||e.changeExt("js"),{map:t,code:this._code,ranges:this._ranges};throw new Error("Cannot find source map for "+s)}}e.exports=s=>e=>{if(e.typescript)n=e.typescript;else try{n=o.requireModuleFrom(s,"typescript")}catch(e){try{n=r("typescript")}catch(e){return i("Error loading TypeScript: "+e.message),e=>{throw new Error("Please install a version of TypeScript for your project that is compatible with your version of node.")}}}if(l.valid(n.version)&&l.lt(n.version,"2.1.5"))throw new Error("TypeScript version for compiler must be >= 2.1.5");delete e.typescript;var t=new c(e,s);return e=>t.run(e)}},{"./typeScriptUtils":84,"./typeScriptVisitor":85,"./utils":88,semver:void 0,typescript:void 0}],83:[function(s,e,t){"use strict";var c,u=s("path"),l=s("graceful-fs"),o=s("micromatch").isMatch,r=s("semver"),i=s("./utils").default,p=s("./typeScriptUtils"),d=s("./typeScriptVisitor");const n=logger.create("typeScriptPostprocessor")["debug"];class a{constructor(e,t){var s=this;e=e||{},this._filePatterns=[],this._localProjectDir=t,this._useTsconfigFile=!0,e.files?(this._opts=!1,_.each(e.files,(e,t)=>{s._filePatterns.push(t);t=p.createOptions(c,e=e||{},this);s._opts||(s._opts=t)})):(this._filePatterns.push("**/*.ts?(x)"),this._filePatterns.push("**/*.cts"),this._filePatterns.push("**/*.mts"),this._opts=p.createOptions(c,e,this)),this._allTrackedFiles={},this._allFiles={},this._ts=1}createPostprocessor(){var l=this,e=n=>{var o=n.logger,e=(l._ts++,l._filesToBeCompiled(n.affectedFiles,void 0,n.dot));if(!l._compiler||n.anyFilesAdded||n.anyFilesDeleted)if(l._compiler?n.tsPostprocessorOnly||o.debug("TypeScript language service is being re-created because some tracked files were added or deleted"):o.debug("New TypeScript language service is required"),l._allTrackedFiles=l._filesToBeCompiled(n.allFiles,e=>l._allFiles[e.fullPath]=e,n.dot),l._compiler&&n.tsPostprocessorOnly)n.anyFilesDeleted&&(n.affectedFiles||[]).length===(n.allFiles||[]).length&&(e={});else{if(e=l._allTrackedFiles,_.isEmpty(e))return o.debug("TypeScript postprocessor will be removed because in %s project files none were found by patterns: %s",n.allFiles.length,l._filePatterns),Q.when({removePostprocessor:!0});o.trace("TypeScript compiler options module (before tsconfig.json): %s",(l._opts||{}).module),l._useTsconfigFile&&(l._opts=p.mergeTsConfigOptions(c,l._opts,l._localProjectDir,o),o.trace("TypeScript compiler options module (after tsconfig.json): %s",(l._opts||{}).module)),l._compiler=l._createLanguageService(n.baseDir),l._visitor||(l._visitor=new d(c))}else _.each(e,e=>{var t=l._allTrackedFiles[e.fullPath];t&&(t.ts=e.ts)});var a=[];return _.each(e,e=>{l._orderFilesByReferenceComments&&l._dependencies&&(t=l._dependencies.files[e.path])&&t.hash!==l._getFileDependencies(e).hash&&delete l._dependencies;var t=l._compiler.getEmitOutput(e.fullPath),s=l._compiler.getSyntacticDiagnostics(e.fullPath);if(t.emitSkipped){var r=s.concat(l._compiler.getSemanticDiagnostics(e.fullPath));if(this._logErrors(o,r),l._opts.noEmitOnError)throw new Error(_.reduce(r.concat(l._compiler.getCompilerOptionsDiagnostics()),(e,t)=>{t=p.formatErrorText(c,t);return e[t]||(e[t]=t,e.message+="\n  - "+t),e},{message:"TypeScript compiler errors:"}).message)}else s&&s.length&&this._logErrors(o,s);var r=l._visitor.visit((l._compiler.getSourceFile?l._compiler:l._compiler.getProgram()).getSourceFile(e.fullPath)),i={};t.outputFiles.forEach(e=>{var t=u.extname(e.name);".map"===t?i.sourceMap=e.text:".js"===t||".jsx"===t||".cjs"===t||".mjs"===t?i.code=e.text:o.debug("Unexpected output file: %s",e.name)}),i.sourceMap&&a.push(n.createFile({path:_.isUndefined(l._opts.module)||l._opts.module?l._changeExtToJs(e.path):e.path+".compiled.js",original:e,content:i.code,sourceMap:JSON.parse(i.sourceMap),ranges:r,order:e.order,load:e.initialLoad}))}),l._orderFilesByReferenceComments&&!l._dependencies&&l._updateFileOrder(),Q.all(a)};return e.filePatterns=l._filePatterns,e.ts=!0,e}_logErrors(t,e){e.forEach(e=>{t.error(p.formatErrorText(c,e))})}_updateFileOrder(){var t=this,s=(t._dependencies={files:{},min:Number.POSITIVE_INFINITY},_.each(t._allTrackedFiles,e=>t._orderFilesByReferences(e,t._dependencies,{})),t._dependencies.min);_.each(t._dependencies.files,e=>{e.file.test||e.file.setOrder(s++,!0)})}_orderFilesByReferences(e,t,s){var r,i=this;s[e.path]||(s[e.path]=!0,t.files[e.path])||(e.test||(t.min=Math.min(t.min,e.order)),r=i._getFileDependencies(e),_.each(r.items,e=>i._orderFilesByReferences(e,t,s)),t.files[e.path])||(t.files[e.path]={hash:r.hash,file:e})}_getFileDependencies(t){var e,s=this,r="";try{e=c.preProcessFile(t.getContentSync()).referencedFiles}catch(e){throw new Error("Failed to get file dependencies: "+e.stack)}return{items:_(e).map(e=>s._allTrackedFiles[u.join(u.dirname(t.fullPath),e.fileName)]).filter(e=>!_.isUndefined(e)).map(e=>(r+=e.path,e)).value(),hash:i.quickHash(r)}}_changeExtToJs(e){return e.substr(0,e.lastIndexOf(".")+1)+(_.endsWith(e,".js")?"jsts":"js")}_createLanguageService(r){var i=this;if(!i._opts.noResolve){const a=c.resolveModuleName;c.resolveModuleName=function(e,t){var s=a.apply(this,arguments);if(s&&!s.resolvedModule){arguments[1]=t.replace(c.normalizePath&&c.normalizePath(r)||r,c.normalizePath&&c.normalizePath(i._localProjectDir)||i._localProjectDir);t=a.apply(this,arguments);if(t&&t.resolvedModule)return t}return s}}const n={},o={};return c.createLanguageService({getScriptFileNames:function(){return[...i._opts.typeRoots?i._opts.typeRoots.filter(e=>e.endsWith(".d.ts")):[],...Object.keys(i._allTrackedFiles)]},getScriptVersion:function(e){e=u.normalize(e);e=i._allTrackedFiles[e];return e&&e.ts.toString()},readFile:function(e){return(this.getScriptSnapshot(e)||{}).text},fileExists:function(e){var t,s,r;return e=u.normalize(e),!(i._opts.noResolve||!~e.indexOf(i._localProjectDir))&&(!1===(t=o[e])||t?t:(s=u.dirname(e),!1===(r=n[s])?o[e]=!1:(t=o[e]=l.existsSync(e))?n[s]=!0:r?void 0:(n[s]=l.existsSync(s),!1)))},getScriptSnapshot:function(e){e=u.normalize(e);var t=i._allFiles[e];if(t)return c.ScriptSnapshot.fromString(t.getContentSync());if(i._opts.noEmitOnError||!i._opts.noResolve)try{var s=e.replace(r,i._localProjectDir);if(l.existsSync(s))return c.ScriptSnapshot.fromString(l.readFileSync(s).toString())}catch(e){}},getCurrentDirectory:function(){return r},getCompilationSettings:function(){return i._opts},getDefaultLibFileName:function(e){return c.getDefaultLibFilePath(e)},getCustomTransformers:function(){return i._getCustomTransformers?i._getCustomTransformers(i._compiler.getProgram()):void 0},getProjectVersion:function(){return i._ts}},c.createDocumentRegistry())}_filesToBeCompiled(e,r,i){var n=this;return r=r||function(){},_.reduce(e,function(e,t){const s=0===(t.path||"").indexOf("..")?u.basename(t.path):t.path;return _.find(n._filePatterns,e=>o(s,e,{dot:i}))&&(e[t.fullPath]=t),r(t),e},{})}}e.exports=t=>e=>{if(e.typescript)c=e.typescript;else try{c=i.requireModuleFrom(t,"typescript")}catch(e){try{c=s("typescript")}catch(e){n("Error loading TypeScript: "+e.message)}}if(c&&r.valid(c.version)&&r.lt(c.version,"1.5.3"))throw new Error("TypeScript version for compiler must be >= 1.5.3");return delete e.typescript,new a(e,t).createPostprocessor()}},{"./typeScriptUtils":84,"./typeScriptVisitor":85,"./utils":88,"graceful-fs":void 0,micromatch:void 0,path:void 0,semver:void 0,typescript:void 0}],84:[function(n,e,t){var o=n("path"),a=n("graceful-fs");e.exports={createOptions(e,t,s){t&&(s._orderFilesByReferenceComments||(s._orderFilesByReferenceComments=t.orderFilesByReferenceComments),delete t.orderFilesByReferenceComments,s._useStandardDefaults||(s._useStandardDefaults=t.useStandardDefaults),delete t.useStandardDefaults,s._getCustomTransformers||(s._getCustomTransformers=t.getCustomTransformers),delete t.getCustomTransformers,s._useTsconfigFile&&(s._useTsconfigFile=!1!==t.tsconfig),delete t.tsconfig);var e=this._normaliseOptions(e,t)||{},t={noLib:!0,noResolve:!0,noEmit:!1,removeComments:!1},r={sourceMap:!0,inlineSourceMap:!1,inlineSources:!1,declarationMap:!1,rootDir:void 0,mapRoot:void 0,outFile:void 0,noEmitOnError:!1,composite:!1,declaration:!1};return s._useStandardDefaults&&(delete t.noLib,delete t.noResolve,delete r.declaration,delete r.noEmitOnError,delete r.composite),_.extend(t,e,r)},getCompilerOptions:function(e,t){return this._normaliseOptions(e,e.parseJsonConfigFileContent?e.parseJsonConfigFileContent(e.parseConfigFileTextToJson(t,a.readFileSync(t).toString()).config,e.sys,e.getDirectoryPath(e.normalizePath(t)),{},t).options:e.readConfigFile(t,function(e){return a.readFileSync(e).toString()}).config.compilerOptions)},mergeTsConfigOptions(e,t,s,r={debug:()=>{}}){var i,s=o.join(s,"tsconfig.json");try{i=e.parseJsonConfigFileContent?e.parseJsonConfigFileContent(e.parseConfigFileTextToJson(s,a.readFileSync(s).toString()).config,_.extend(e.createCompilerHost(e.getDefaultCompilerOptions()),{readDirectory:e.sys.readDirectory}),e.getDirectoryPath(e.normalizePath(s)),{},s).options:e.readConfigFile(s,function(e){return a.readFileSync(e).toString()}).config.compilerOptions}catch(e){r.debug("Error parsing tsconfig file "+s+"\n("+e.message+")");try{i=n(s).compilerOptions}catch(e){r.debug("Error reading tsconfig file from "+s+"\n("+e.message+")")}}return(r=i?(i.allowJs&&!t.outDir&&delete t.outDir,_.extend({},this._normaliseOptions(e,i)||{},t)):t).allowJs||delete r.outDir,r},formatErrorText(e,t){var s,e=e.flattenDiagnosticMessageText(t.messageText,"\n");return t.file?(s=t.file.getLineAndCharacterOfPosition(t.start),`Error ${t.file.fileName} (${s.line+1},${s.character+1}): `+e):"Error: "+e},_normaliseOptions(e,r){var i=this;if(e&&r)return this._optionDeclarations||(this._optionDeclarations=_.reduce(e.optionDeclarations,(e,t)=>(e[t.name]=t,e),{})),_.each(r,(e,t)=>{var s=i._optionDeclarations[t];s&&(_.isObject(s.type)&&_.isString(e)?r[t]=i._getNormalisedValue(e,s.type):"list"===s.type&&_.isArray(e)&&s.element&&_.isObject(s.element.type)&&(r[t]=_.map(e,e=>_.isString(e)&&i._getNormalisedValue(e,s.element.type)||e)))}),r},_getNormalisedValue(e,t){return _.isFunction(t.get)?t.get(e.toLowerCase()):t[e.toLowerCase()]}}},{"graceful-fs":void 0,path:void 0}],85:[function(e,t,s){"use strict";t.exports=class{constructor(s,e=0){var r=this,i={};this._ts=s,i[s.SyntaxKind.DoStatement]=i[s.SyntaxKind.WhileStatement]=i[s.SyntaxKind.IfStatement]=i[s.SyntaxKind.SwitchStatement]=function(e){e.expression&&r._pushRange(e.expression)},i[s.SyntaxKind.ForStatement]=function(e){e.condition&&r._pushRange(e.condition)},i[s.SyntaxKind.ForInStatement]=i[s.SyntaxKind.ForOfStatement]=function(e){e.expression&&r._pushRange(e.expression)},i[s.SyntaxKind.BreakStatement]=i[s.SyntaxKind.ContinueStatement]=i[s.SyntaxKind.ThrowStatement]=function(e){r._pushRange(e)},i[s.SyntaxKind.VariableStatement]=function(e){r._parent&&(r._parent.kind===s.SyntaxKind.ForStatement||r._parent.kind===s.SyntaxKind.ForInStatement||r._parent.kind===s.SyntaxKind.ExportAssignment)||r._pushRange(e)},i[s.SyntaxKind.ExpressionStatement]=i[s.SyntaxKind.ReturnStatement]=function(e){r._pushRange(e)},process.env.quokka&&(i[s.SyntaxKind.ImportDeclaration]=function(e){r._pushRange(e)}),i[s.SyntaxKind.ConditionalExpression]=function(e){r._pushRange(e.whenTrue),r._pushRange(e.whenFalse)},i[s.SyntaxKind.BinaryExpression]=function(e){r._pushRange(e.left),r._pushRange(e.right)},i[s.SyntaxKind.ArrowFunction]=function(e){e.body.statements||r._pushRange(e.body)},r._visit=function(e){var t=i[e.kind];t&&t(e),r._parent=e,s.forEachChild(e,r._visit)}}visit(e){return this._ranges=[],this._parent=null,this._sourceFile=e,this._visit(e),this._parent=null,this._sourceFile=null,this._ranges.slice()}_pushRange(e){this._ranges.push(this._getRange(e))}_getRange(e){var t=this._ts.getLineAndCharacterOfPosition(this._sourceFile,e.getStart(this._sourceFile)),e=this._ts.getLineAndCharacterOfPosition(this._sourceFile,e.getEnd());return[t.line+1,t.character,e.line+1,e.character]}}},{}],86:[function(e,t,s){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,s,r){void 0===r&&(r=s);var i=Object.getOwnPropertyDescriptor(t,s);i&&("get"in i?t.__esModule:!i.writable&&!i.configurable)||(i={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,r,i)}:function(e,t,s,r){e[r=void 0===r?s:r]=t[s]}),i=this&&this.__exportStar||function(e,t){for(var s in e)"default"===s||Object.prototype.hasOwnProperty.call(t,s)||r(t,e,s)};Object.defineProperty(s,"__esModule",{value:!0}),s.DiffOperation=void 0,i(e("./shared"),s),s.DiffOperation={DELETE:-1,"-1":"DELETE",INSERT:1,1:"INSERT",EQUAL:0,0:"EQUAL"}},{"./shared":87}],87:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.testKeySeparator=s.createTestKey=s.quokkaProFeatures=void 0,s.quokkaProFeatures=["profiling","codeStory","liveValueDisplay","projectFiles","unlimitedValueExplorer","timeline","allowToInstallImportedModules","allowDebuggerEditAndContinue","snaps"],s.createTestKey=function(e){return e[0]+"_"+e.slice(1).join(s.testKeySeparator)},s.testKeySeparator="☆"},{}],88:[function(g,e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const f=g("path"),a=g("fs");var s=g("./extension/shared/utils");const r=g("util"),i=s.default["normalizePath"],n=g("module")["Module"],o=g("source-map").SourceMapConsumer,l=g("source-map").SourceMapGenerator,c=/^\s*(\/\*\*?(.|\r?\n)*?\*\/)/,u=/^\s*/,p=/[\u001b\u009b][[()#;?]*(?:[0-9]{1,4}(?:;[0-9]{0,4})*)?[0-9A-PRZcf-nqry=><]/g,d=/\/\*[\s\S]*?\*\/|([^\\:]|^)\/\/.*$/gm,h=/(^[\s]*?(fit|fdescribe)[\s]*?|[^.\w\s][\s]*?(fit|fdescribe)[\s]*?|(test|test\.concurrent|it|describe)[\s]*?\.[\s]*?only[\s]*?)((\.each[\s]*?(`[^`]*?`[\s]*?)*?)?\([\s]*?[^)\s])/gm;s=/[#@] sourceMappingURL=([^\s'"]*)/;const m=RegExp("(?:/\\*(?:\\s*\r?\n(?://)?)?(?:"+s.source+")\\s*\\*/|//(?:"+s.source+"))\\s*","g"),v=/data:application\/json[^,]+base64,/;let y=void 0;const b=/\s?<!doctype html>|(<html\b[^>]*>|<body\b[^>]*>|<x-[^>]+>)+/i;let w=/<\/?[a-z][\s\S]*>/i;try{w=new RegExp(["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","label","legend","li","link","main","map","mark","math","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rb","rp","rt","rtc","ruby","s","samp","script","section","select","slot","small","source","span","strong","style","sub","summary","sup","svg","table","tbody","td","template","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr"].map(function(e){return"<"+e+"\\b[^>]*>"}).join("|"),"i")}catch(e){}function k(){if(void 0===y){let t;try{a.statSync("/.dockerenv"),t=!0}catch(e){t=!1}let s;try{s=a.readFileSync("/proc/self/cgroup","utf8").includes("docker")}catch(e){s=!1}y=t||s}return y}const x=(t,e)=>"js"===t||"jsx"===t||"es6"===t||"es7"===t||"mjs"===t||"cjs"===t||e&&e.find(e=>t===e),S=e=>"ts"===e||"tsx"===e||"cts"===e||"mts"===e,P=e=>"vue"===e,F=e=>"svelte"===e,C=(e,t)=>"coffee"===e||/\.(litcoffee|coffee\.md)$/.test(t||""),T={},E={},j=("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".split("").forEach(function(e,t){T[e]=t,E[t]=e}),"_$_$w_id"),R="Expected to find some snaps in the file, but no snaps were found.",I="Expected to find some snaps with code in the file, but only empty snaps were found.",O="Found some snaps with code in the file, but not allowed to run them.";t.default={wallabyRandomIdCommentPostfix:j,randomIdLength:5,selectedTestRegExp:h,snapsNotFoundError:R,snapsAreEmptyError:I,snapsFoundButNoAutoRunError:O,SourceMapConsumer:o,wallabyRandomIdCommentPrefix(e){return".coffee"===f.extname(e)?"\n#":"\n//"},isSnapsNotFoundError(e){return e&&e.message&&e.message.endsWith(R)},isSnapsAreEmptyError(e){return e&&e.message&&e.message.endsWith(I)},isSnapsFoundButNoAutoRunError(e){return e&&e.message&&e.message.endsWith(O)},requireResolve:function(e,t){return n._resolveFilename(e,null,!1,t)},randomId:function(){return Math.random().toString(36).substr(2,5)},addWallabyRandomIdCommentToFileContent:function(e,t,s){return t+this.wallabyRandomIdCommentPrefix(e)+(s||this.randomId())+j},hasWallabyRandomIdComment:function(e){return e.endsWith(j)},removeWallabyRandomIdCommentFromFileContent:function(e,t){return _.endsWith(t,j)?t.slice(0,-(this.wallabyRandomIdCommentPrefix(e).length+5+j.length)):t},addOrReplaceWallabyRandomIdComment(e,t){return this.addWallabyRandomIdCommentToFileContent(e,this.removeWallabyRandomIdCommentFromFileContent(e,t))},noopTrue:function(){return!0},noopTruePromise:function(){return Q.fcall(this.noopTrue)},isPatch:function(e){return e&&2<e.length&&"@"===e[0]&&"@"===e[1]},isLevelUpRelativePath:function(e){return!!e&&"."===e[0]&&"."===e[1]},docBlockComment:function(e){e=e.match(c);return e&&e[0].replace(u,"")||""},normalizePath:function(e){return e&&e.replace("win32"===process.platform?"file:///":"file://","").split(f.sep).join("/")},fileUrl:function(e){e=f.resolve(e).replace(/\\/g,"/");return"/"!==e[0]&&(e="/"+e),encodeURI("file://"+e)},trimSlashes(e){return e&&e.replace(/^\/|\/$/g,"")},platformDependentPath:function(e){return!e||"win32"!==process.platform||~e.indexOf(f.sep)?e:e.split("/").join(f.sep)},getSourceMapFromCode:function(e){for(m.lastIndex=0;null!==(t=m.exec(e));){var t=t?t[1]||t[2]||"":null;if(t)if(v.test(t))return t=t.slice(t.indexOf(",")+1),Buffer.from(t,"base64").toString()}},makeRe:function(e,t){return"string"==typeof e?g("micromatch").makeRe(e,t,!1,!0):e},pathMatchesPattern:function(e,t,s){if(e)return"string"==typeof t?(0,g("micromatch").isMatch)(e,t,s):(e=this.platformDependentPath(s&&s.absolute?"":"./")+this.platformDependentPath(e)).match(t)},escapePathForRegex:function(e){return"\\"===f.sep&&(e=e.replace(/\\/g,"/")),this.replacePathSepForRegex(this.escapeRegExp(e))},escapeRegExp:function(e){return e.replace(/[[\]{}()*+?.\\^$|]/g,"\\$&")},replacePathSepForRegex:function(e){return"\\"===f.sep?e.replace(/(\/|(.)?\\(?![[\]{}()*+?.^$|\\]))/g,(e,t,s)=>s&&"\\"!==s?s+"\\\\":"\\\\"):e},displayTestName:function(e){return e.replace(/\r?\n|\r/g," ").replace(/\s\s+/g," ")},getOriginalLineByGeneratedLine(e,t,s){var r=e[t];if(r){if(0<(r=this._decodeMapping(r)))return r;s&&(s-=1);for(let e=0;e<r.length;e++){if(r[e].column===s)return r[e].line;if(s<r[e].column)return(0===e?r[0]:r[e-1]).line}return r[r.length-1].line}},_decodeMapping(t){if(_.isUndefined(t)||_.isObject(t))return t;if(_.isNumber(t))return t;var s=[];let r=0,i=0,n;for(let e=0;e<t.length;e+=1){var o=T[t[e]],a=32&o;o&=31,i+=o<<r,a?r+=5:(o=1&i,i>>>=1,a=o?0===i?-2147483648:-i:i,n=0<=n?void s.push({line:n,column:a}):a,i=r=0)}return s},_encodeMapping(e,t,s){e=e[t];if(!_.isObject(e))return e;const r=Object.values(e);if(s&&1===r.length&&0===r[0].originalColumn&&0===r[0].generatedColumn&&s[t])return s[t];if(1!==r.length&&r.find(e=>e.originalLine!==r[0].originalLine)){r.sort((e,t)=>e.generatedColumn-t.generatedColumn);let t="",s=(t=(t+=this._encodeInteger(r[0].originalLine))+this._encodeInteger(r[0].generatedColumn),0);for(let e=1;e<r.length;e++)if(r[e].originalLine!==r[e-1].originalLine){if(2e3<++s)return r[0].originalLine;t=(t+=this._encodeInteger(r[e].originalLine))+this._encodeInteger(r[e].generatedColumn)}return t}return r[0].originalLine},_encodeInteger(t){let s="";t<0?t=-t<<1|1:t<<=1;do{let e=31&t;0<(t>>>=5)&&(e|=32),s+=E[e]}while(0<t);return s},generateLineMappings:function(t,s){const r={};return Object.keys(t).forEach(e=>{r[e]=this._encodeMapping(t,e,s)}),r},_previousLineMapNextGreaterThanOrEqualTo(e,t){let s=0,r=e.length-1,i=-1;for(;s<=r;){var n=parseInt((s+r)/2,10);e[n].column<t?s=n+1:(i=n,r=n-1)}return i=-1===(i=0===i?1:i)?e.length:i},_previousLineMapNextGreaterThan(e,t){let s=0,r=e.length-1,i=-1;for(;s<=r;){var n=parseInt((s+r)/2,10);e[n].column<=t?s=n+1:(i=n,r=n-1)}return i=-1===(i=0===i?1:i)?e.length:i},updateFileMap:function(t,e){var n=_.extend({},t);return _.each(e,e=>{var e=new o(e),r={},i=_.isEmpty(n);e.eachMapping(e=>{var t,s;e.originalLine&&e.generatedLine&&(i?(r[e.generatedLine]||(r[e.generatedLine]={}),r[e.generatedLine][e.generatedColumn]&&!e.name||(r[e.generatedLine][e.generatedColumn]=Object.assign({},e))):!n[e.originalLine]||r[e.generatedLine]&&r[e.generatedLine][e.generatedColumn]&&!e.name||(t=n[e.originalLine]=this._decodeMapping(n[e.originalLine]))&&(0<t?(r[e.generatedLine]||(r[e.generatedLine]={}),r[e.generatedLine][e.generatedColumn]=Object.assign(Object.assign({},e),{originalLine:t,originalColumn:0})):(s=this._previousLineMapNextGreaterThan(t,e.originalColumn),r[e.generatedLine]||(r[e.generatedLine]={}),r[e.generatedLine][e.generatedColumn]=Object.assign(Object.assign({},e),{originalLine:t[s-1].line,originalColumn:t[s-1].column}))))}),n=this.generateLineMappings(r,t)}),n},formatInstrumentationError:function(e,t,s,r,i){e=(e&&(e.stack||e.message))+"";let n=this.textLines(e),o=n[0];var a,e=o.match(/^SyntaxError.*\((\d+):(\d+)\)$/);return e&&(a=parseInt(e[1],10),e=parseInt(e[2],10),n=r&&i&&(r=this.mapTransformedRangeToOriginal(r,[a,e,a,e]))?(o=o.replace(/\((\d+):(\d+)\)$/,`(${r[0]}:${r[1]})`),[this.codeFrame(i,r[0],r[1]+1,o)]):[this.codeFrame(t,a,e+1,o)]),Error("Failed to instrument "+s+"\n"+n.join("\n"))},combineSourceMaps:function(e,t){var s,r,i;return e?t?(s=new o(t),r=new o(e),i=new l,s.eachMapping(e=>{var t;null!=e.originalLine&&null!=(t=r.originalPositionFor({line:e.originalLine,column:e.originalColumn})).source&&i.addMapping({original:{line:t.line,column:t.column},generated:{line:e.generatedLine,column:e.generatedColumn},source:t.source,name:t.name||e.name})}),[r,s].forEach(s=>{s.sources.forEach(e=>{i._sources.add(e);var t=s.sourceContentFor(e);null!=t&&i.setSourceContent(e,t)})}),i._sourceRoot=e.sourceRoot,i._file=e.file,JSON.parse(i.toString())):e:t},mapTextPosition:function(e,t){let s;var r;return s=e?t?((r={line:e.line,column:e.column}).source=t.sources&&t.sources[0]||".",r.bias=2,t.generatedPositionFor(r)):e:s},textIndexPosition:function(e,t,s){e=this.textLines(e,t,s);return{line:e.length,column:e[e.length-1].length}},mapTransformedRangeToOriginal:function(e,t){var s,r,i,t={start:{line:t[0],column:t[1]},end:{line:t[2],column:t[3]}},n=(n=e,r=t.start.line,s=t.start.column,null===(i=n.originalPositionFor({line:r,column:s,bias:1})).source?n.originalPositionFor({line:r,column:s,bias:2}):i);r=t.end;let o=null===(r=(s=e).originalPositionFor({line:r.line,column:r.column-1})).source?null:null===(i=s.generatedPositionFor({source:r.source,line:r.line,column:r.column+1,bias:2})).line||s.originalPositionFor(i).line!==r.line?{source:r.source,line:r.line,column:1/0}:s.originalPositionFor(i);return!(n&&o&&n.source&&o.source&&n.source===o.source&&null!==n.line&&null!==n.column&&null!==o.line&&null!==o.column)?null:(n.line===o.line&&n.column===o.column&&((o=e.originalPositionFor({line:t.end.line,column:t.end.column,bias:2})).column=o.column-1),[n.line,n.column,o.line,o.column])},mapOriginalRangeToTransformed:function(e,[t,s,r,i]){if(!e)return[t,s,r,i];t={line:t,column:s},t.source=e.sources&&e.sources[0]||".",s=e.generatedPositionFor(t),t={line:r,column:i},t.source=e.sources&&e.sources[0]||".",t.bias=2,r=e.generatedPositionFor(t);if(s&&r&&null!==s.line&&null!==s.column){if(null===r.line||null===r.column){if(null===s.line||null===s.column)return;r.source=s.source,r.line=s.line,r.column=1/0}return r.line<s.line&&(r.line=s.line),s.line===r.line&&r.column<s.column&&(r.column=1/0),null===s.column&&(s.column=0),null===r.column&&(r.column=0),[s.line,s.column,r.line,r.column]}},mapSnapRanges:function(c,e,t){const d=this.textLines(t),h=(e,t)=>{e=d[e-1];if(e)return e[t]},n=(e,t,s)=>h(e,t)===s,u=(e,t,s,r,i=0)=>{for(;-1<e[s];){if(n(e[t],e[s]-i,r))return e;--e[s]}},p=(e,t,s)=>{let r=!(e=[...e]),i=!1;for(;0<e[0];){for(;0<=e[1];){if(h(e[0],e[1])===t){if(r){i=!0;break}r=!0}e[1]--}if(i)break;var n;e[0]--,0<e[0]&&(n=d[e[0]-1],e[1]=n?n.length-1:0)}let o=!1,a=!1;for(;e[2]<d.length;){for(var l=d[e[2]-1];l&&e[3]<=l.length;){if(h(e[2],e[3])===s){if(o){a=!0;break}o=!0}e[3]++}if(a)break;e[2]++,e[3]=0}if(i&&a)return e[3]+=1,e},g=(e,t,s,r,i)=>{let n=e[2],o=e[3],a=!1;for(;n<d.length;){const c=d[n-1];for(;c&&o<=c.length;){if(h(n,o)===t){a=!0;break}o++}if(a)break;n++,o=0}var e=i||(r?this.textLines(r,void 0,"\n").length:1),l=n+(e-1);const c=d[l-1];let u=c&&c.length?c.length-1:0,p=!1;for(;0<=u;){if(h(l,u)===s){p=!0;break}u--}if(a&&p)return[n,o,l,u+1]},r=(e,t,s,r,i,n)=>{var o=s===r;let a=this.mapTransformedRangeToOriginal(c,e),l=!1;if(a||(e[3]+=1,(a=this.mapTransformedRangeToOriginal(c,e))?(null===a[2]&&(a[2]=a[0],l=!0),a[3]<0&&(a[3]=a[1],l=!0)):t&&(o?a=g(t,s,r,i,n):(n=this.mapTransformedRangeToOriginal(c,t))&&(n[3]=Math.min(n[3],d[n[2]-1].length),a=p(n,s,r)))),!a)throw new Error(`Unable to map snaps${o?" output":""} ranges`);if(l=l||o&&!isFinite(a[3]),a[3]=Math.min(a[3],d[a[2]-1].length),!(a=u(a,0,1,s)))throw new Error(`Unable to map snap${o?" output":""} range start`);if(!(a=u(a,2,3,r,1)))throw new Error(`Unable to map snap${o?" output":""} range end`);if(a[0]>a[2])throw new Error(`Unable to map snap${o?" output":""} range lines correctly`);if(a[0]===a[2]){if(a[1]>a[3]||!o&&a[1]===a[3])throw new Error(`Unable to map snap${o?" output":""} range columns correctly`);if(a[1]===a[3]||l){t=i?i.split("\n").length-1:e[2]-e[0],n=a[0]+t,i=d[n-1].lastIndexOf(r)+1;if(0===i)throw new Error("Unable to map snap output range end correctly");a[2]=n,a[3]=i}if(a[0]===a[2]){e=a[3]-a[1];if((!o&&e<4||o&&e<2)&&(--a[1],!(a=u(a,0,1,s))))throw new Error(`Unable to map snap${o?" output":""} range start`)}}return a};return e.map(e=>{var t=e.body.range,s=e.body.fallbackRange;return e.body.range=r(t,s,"{","}"),e.output&&(t=e.output.range,e.output.range=r(t,e.body.range,"`","`",e.output.content,e.output.lines),delete e.output.content,delete e.output.lines),e}).filter(e=>e.body.range)},textLines:function(e,t,s,r){return(e=_.isUndefined(t)||t===e.length-1?e:e.substr(0,t)).split(_.isUndefined(s)?/\r\n|\r|\n/:s,r)},instrumentableRange:function(e,s){let[r,i,n,o]=s;if(500<n-r)return s;if(!(n<r||n===r&&o<i)){var a=e.value;if(r===n&&i===o&&0<r&&0<=i&&r<=a.length&&i<a[r-1].length+1)return s;r<1&&(r=1),n>a.length&&(n=a.length),i<0&&(i=0);let t=!1;for(let e=r;e<=n;e++){var l=a[e-1],c=(r=e)===n&&o<=l.length?o:l.length;for(let e=i;e<=c;e++)if(i=e,l.charAt(e).trim().length){t=!0;break}if(t)break;i=0}if(t){for(let e=n;e>=r;e--){var u=a[e-1],p=(n!==e&&(n=e,o=u.length),e===r&&0<=r?i:0);let t=!1;for(let e=o;e>=p;e--){if(u.charAt(e).trim().length){t=!0;break}o=e}if(t)break}return[r,i,n,o]}}},instrumentableLogpointRange(e,t){var[s,r,i,n]=t;if(s===i){i=e.value[s-1];if(void 0===i||""===i.trim())return;if(r===n)return n=i.trimEnd().length-1,0===r||n<=r?[s,1+n,s,1+n]:i[r].trim().length?[s,r,s,r]:(n=i.substring(0,r).trimEnd().length)?[s,n-1,s,n-1]:[s,n=i.length-i.substring(r).trimStart().length,s,n]}return this.instrumentableRange(e,t)},verifyLocalOrigin:function(e,t){if(!e)return!0;var s=!1;try{var r=g("url").parse(e).hostname,s="localhost"===r||"0.0.0.0"===r||"127.0.0.1"===r||"::1"===r}catch(e){}return s||t||emitDiagnostic({name:"genericError",message:"wallaby.js refused to accept connection from "+e}),s},patchModule:function(t,s){var e=g("module").Module.prototype,r=e.require;e.require=function(e){return e===t?s(r.bind(this)):r.call(this,e)}},patchModulesCode:function(e,i){const n={},t=(e.forEach(t=>{t.files.forEach(e=>{n[e]=(n[e]||[]).concat(t.replacements)})}),"node_modules/"),o=a.readFileSync;a.readFileSync=function(s){let r=o.apply(this,arguments);var e=(e=s)?(e=(e="string"!=typeof e?"file://"===e.protocol?e.pathname||"":e.toString():e).replace(/\\/g,"/")).substr(e.lastIndexOf(t)+t.length):"",e=n[e];return e&&(r=r.toString(),e.forEach(e=>{var t=r;if(r=r.split(e.from).join(e.to),!e.optional&&r===t){if(process.env.WALLABY_INTEGRATION_TEST_RUN)throw new Error(`${i||"Possibly incompatible/unsupported"} (${s})`);emitDiagnostic({name:"possiblyIncompatiblePatch",message:`${i||"Possibly incompatible/unsupported"} (${s})`})}})),r}},requireModuleFrom:function(t,s){try{return g(f.join(t,"node_modules",s))}catch(e){var r=g("module"),i=new r(".",null);return i.filename=f.join(t,"wallaby.js"),i.paths=r._nodeModulePaths(t),r._load(s,i,!1)}},resolveModulePathFrom:function(e,t){var s=g("module"),r=new s(".",null);return r.filename=f.join(e,"wallaby.js"),r.paths=s._nodeModulePaths(e),s._resolveFilename(t,r,!1)},tryRequireModuleWithPathFrom:function(t,s,r){try{var i=g("module"),n=new i(".",null),o=(n.filename=f.join(t,"wallaby.js"),n.paths=i._nodeModulePaths(t),i._resolveFilename(s,n,!1));let e;return{module:(e=process.env.WALLABY_INTEGRATION_TEST_RUN||process.env.WALLABY_UNIT_TEST_RUN?g(o):i._load(s,n,!1))&&e.default||e,moduleExports:e,path:o}}catch(e){if(r)throw e}},nodeModulesLookup:function(s,t){var e=g("module").Module,r=e.prototype,i=e._nodeModulePaths,n=r.require;e._nodeModulePaths=function(e){var t=i.call(this,e);return s(t,e,i,this),t},t&&(r.require=function(e){return n.call(this,t(e))})},nodeModulePaths:function(e){return g("module")._nodeModulePaths(e)},patchBabelResolve:function(e){const r=this.nodeModulePaths(e);this.patchModule("resolve",e=>{e=e("resolve");const s=e.sync;return e.sync=function(e,t){return~e.indexOf("babel")&&t&&(t.paths=(t.paths||[]).concat(r)),s.apply(this,arguments)},e})},hasAnsi:function(e){return e&&"string"==typeof e&&e.match(p)},removeAnsi:function(e){return e&&"string"==typeof e?e.replace(p,""):e},maybeHtml:function(e){return e=e.trim().slice(0,500),b.test(e)||w.test(e)},copyToClipboard:function(e){var t=e=>e&&emitDiagnostic({name:"genericWarning",message:"May have failed to copy to clipboard. "+("linux"===process.platform?'Linux/Ubuntu environments require "xclip" to be installed. ':"")+(e&&e.message)});try{g("copy-paste").copy(e,t)}catch(e){t(e)}},testFileSelection:function(e,t,s,r){if(_.isString(t)){const c=t;t={test:e=>!!~e.indexOf(c)}}if(_.isString(s)){const u=s;s={test:e=>!!~e.indexOf(u)}}let i=!1,n=!1,o;var a={};for(d.lastIndex=0;null!==(o=d.exec(e));){var l=o.index+o[0].length;for(let e=o.index;e<l;e++)a[e]=1;i=i||t.test(o[0]),n=n||s.test(o[0])}if(!i&&r)for(h.lastIndex=0;null!==(o=h.exec(e));)if(!a[o.index]){i=!0;break}return{includedTestFile:i,excludedTestFile:n}},codeFrame:function(e,t,s,o){e=this.textLines(e),s={start:{column:s,line:t}};const{start:a,end:r,markerLines:l}=function(e,t,s){var r=Object.assign({column:0,line:-1},e.start),e=Object.assign(Object.assign({},r),e.end),{linesAbove:s=2,linesBelow:i=3}=s||{},n=r.line,o=r.column,r=e.line,a=e.column;let l=Math.max(n-(s+1),0),c=Math.min(t.length,r+i);-1===n&&(l=0),-1===r&&(c=t.length);var u=r-n,p={};if(u)for(let e=0;e<=u;e++){var d,h=e+n;o?0===e?(d=t[h-1].length,p[h]=[o,d-o]):e===u?p[h]=[0,a]:(d=t[h-e].length,p[h]=[0,d]):p[h]=!0}else p[n]=o===a?!o||[o,0]:[o,a-o];return{start:l,end:c,markerLines:p}}(s,e);t=s.start&&"number"==typeof s.start.column;const c=String(r).length;let i=e.slice(a,r).map((t,s)=>{var r,s=a+1+s,i=` ${(" "+s).slice(-c)} | `,n=l[s],s=!l[s+1];if(n){let e="";return Array.isArray(n)&&(r=t.slice(0,Math.max(n[0]-1,0)).replace(/[^\t]/g," "),n=n[1]||1,e=["\n ",i.replace(/\d/g," "),r,"^".repeat(n)].join(""),s)&&o&&(e+=" "+o),[">",i,t,e].join("")}return" "+i+t}).join("\n");return i=t?i:""+" ".repeat(c+1)+o+`
`+i},loadJest:async function(t,e,s){let r,i=!1;try{var n=g(f.resolve(t,"package.json")),o=n&&n.scripts,a=n&&n.devDependencies||{},l=n&&n.dependencies||{};i=!!a.jest||!!l["react-scripts"]||!!l.jest,o&&o.test&&-1!==o.test.indexOf("react-app-rewired")?(this.tryRequireModuleWithPathFrom(t,"react-app-rewired/scripts/test"),this.tryRequireModuleWithPathFrom(t,"react-scripts/config/env"),r=this.tryRequireModuleWithPathFrom(t,"react-scripts/scripts/utils/createJestConfig")):!(o&&o.test&&-1!==o.test.indexOf("react-scripts")||!a)&&a.jest||o&&o.test&&-1!==o.test.indexOf("jest")&&-1===o.test.indexOf("react-scripts")||(r=this.tryRequireModuleWithPathFrom(t,"react-scripts/scripts/utils/createJestConfig"),this.tryRequireModuleWithPathFrom(t,"react-scripts/config/env"))}catch(e){r=void 0}let c,u;e=e&&(f.isAbsolute(e)?e:f.resolve(f.join(t,e)));n=(c=e?this.tryRequireModuleWithPathFrom(e,"jest"):r?this.tryRequireModuleWithPathFrom(r.path,"jest"):this.tryRequireModuleWithPathFrom(t,"jest"))?c.path:t;let p,d="x.x.x";const h=this.tryRequireModuleWithPathFrom(n,"jest-cli");if(!h)throw new Error(`Module jest-cli is not found in '${t}'.`);l=h.module.getVersion?()=>h.module.getVersion():c&&c.module.getVersion?()=>c.module.getVersion():void 0;if(!l)throw new Error("Cannot find compatible jest-cli module.");{let e=0;try{d=l(),e=parseInt(d.split(".")[0])}catch(e){throw new Error(`Cannot detect/parse jest-cli module version: ${e.message}.`)}if(e<24)throw new Error(`Only Jest v24.x or higher is supported, but found v${d} at '${h.path}'.`)}if(u=this.tryRequireModuleWithPathFrom(h.path,"jest-config"))try{s=s&&(f.isAbsolute(s)?s:f.resolve(f.join(t,s))),(p=await u.module.readConfigs(s?{config:s}:r?{config:JSON.stringify(r.module(e=>f.resolve(r.path,"../../..",e)))}:{},[t])).globalConfig=Object.assign({},p.globalConfig),p.configs=(p.configs||[]).filter(e=>"jest-runner"===e.runner||~this.normalizePath(e.runner||"").indexOf("node_modules/jest-runner/")||"jest-runner-groups"===e.runner||~this.normalizePath(e.runner||"").indexOf("node_modules/jest-runner-groups/")).map(e=>Object.assign({},e))}catch(e){throw new Error(`Failed to read Jest configuration from '${t}': `+(e.stack||"unknown."))}if(!p)throw new Error(`Failed to read Jest configuration from '${t}'.`);if(p.configs.length)return{jestConfig:p,jestCLI:h,jestConfigLoader:u,isDirectDependency:i,version:d};throw new Error(`Can not find any Jest runner configurations in '${t}'.`)},serializeRegExp:function(e){if(_.isRegExp(e))return"__REGEXP "+e.toString();if(_.isString(e))return e;throw new Error("Must pass a string or a regular expression")},deserializeRegExp:function(e){var t;return 0===e.indexOf("__REGEXP ")?(t=e.split("__REGEXP ")[1].match(/\/(.*)\/(.*)?/),new RegExp(t[1],t[2]||"")):e},generateNodeModulesExcludesForIncludePatterns:function(e){e=e.map(e=>e.split("/")).filter(e=>"node_modules"===e[0]).reduce((e,t)=>{let s=e;for(let e=0;e<t.length;e++)s.has(t[e])||s.set(t[e],new Map),s=s.get(t[e]);return e},new Map);if(0===e.size)return["node_modules/**"];const r=(t,s)=>{var e=Array.from(t.keys());return 0===e.length?[]:[`${s}/!(${e.join("|")})/**`,...e.map(e=>r(t.get(e),s+"/"+e)).reduce((e,t)=>e.concat(t),[])]};return r(e.get("node_modules"),"node_modules")},isJavaScript:x,isTypeScript:S,isVue:P,isSvelte:F,isCoffeeScript:C,isCoverable:(e,t,s)=>!!(x(e,s)||S(e)||P(e)||C(e,t)||F(e)),quickHash:function(e){var t,s,r=0;if(0<e.length)for(t=0,s=e.length;t<s;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;return r},isDocker:k,isWsl:()=>{var e=g("os");if("linux"!==process.platform)return!1;if(e.release().toLowerCase().includes("microsoft"))return!k();try{return!!a.readFileSync("/proc/version","utf8").toLowerCase().includes("microsoft")&&!k()}catch(e){return!1}},wslHostIpAddress:()=>{var e=a.readFileSync("/etc/resolv.conf").toString().split("\n").map(e=>e.split(" ")).filter(e=>"nameserver"===e[0]).map(e=>1<e.length&&e[1]);return 1<=e.length?e[0]:"127.0.0.1"},lazyLoadDependencyReplacement:(e,t,{doubleQuotes:s,dependencyOverride:r,replaceBothDependencyAndDependencyOverride:i,varType:n}={})=>{s=s?`require("${t}")`:`require('${t}')`,t=r||s,r=[{from:""+e,to:e+"()",optional:!0},{from:(n=n||"var")+` ${e}() = ${t};`,to:`var ${e} = function() { const data = ${t}; ${e} = function() { return data; }; return data; }`,optional:!0}];return i&&r.push({from:n+` ${e}() = ${s};`,to:`var ${e} = function() { const data = ${s}; ${e} = function() { return data; }; return data; }`,optional:!0}),r},findFirstFileMatchingContentInDirectory(e,n){return a.existsSync(e)?i(function e(t){for(const i of a.readdirSync(t)){var s=f.resolve(f.join(t,i));if(a.statSync(s).isDirectory()){var r=e(s);if(r)return r}else if((i.endsWith(".js")||i.endsWith(".mjs"))&&-1!==a.readFileSync(s,"utf8").indexOf(n))return s}}(e)):""},mergeDeep(e,...t){return _.merge(e,...t)},jestTsNodePatch:function(){return{files:["jest-config/build/readConfigFileAndSetRootDir.js","jest-config/build/index.js"],replacements:[{from:"const tsNode = await import('ts-node');",to:`const tsNode = require('${i(f.join(f.dirname(process.mainModule.filename),"node_modules","ts-node","dist","index.js"))}');`,optional:!0},{from:"compilerOptions: {",to:`swc: false, transpileOnly: true, transpiler: [ '${i(f.join(f.dirname(process.mainModule.filename),"node_modules","ts-node","dist","transpilers","swc.js"))}', { swc: '${i(f.join(f.dirname(process.mainModule.filename),"node_modules","@swc","wasm"))}' }], compilerOptions: { experimentalDecorators: false, esModuleInterop: true, `,optional:!0}]}},formatWithoutColors(...e){return(0,r.formatWithOptions)({colors:!1},...e)}}},{"./extension/shared/utils":54,"copy-paste":void 0,fs:void 0,micromatch:void 0,module:void 0,os:void 0,path:void 0,"source-map":void 0,url:void 0,util:void 0}],89:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.tokenize=s.formatAsString=void 0;const h=e("../utils"),w=2,g=16,k={type:"linebreak",value:"\n"},x={type:"punctuation",value:","},S={type:"punctuation",value:" "},P={type:"punctuation",value:"["},F={type:"punctuation",value:"]"},C={type:"punctuation",value:"{"},T={type:"punctuation",value:"}"},E={type:"punctuation",value:"..."},f={type:"punctuation",value:"(...)"},m={type:"punctuation",value:"[Circular]"},_={type:"type",value:"λ"},v={type:"type",value:"λ:"},r=new Map,j=e=>{var t=r.get(e);return t||(t={type:"indentation",value:" ".repeat(e)},r.set(e,t),t)},i=Object.freeze({maxDepth:1/0,displayPropLimit:1/0,maxLineLength:80,maxStrLength:1/0,omitTypes:!1});function n(e,t=i){t=Object.assign(Object.assign(Object.assign({},i),t),{indentationLvl:0,currentDepth:0,linePrefixLength:0,map:{}});return{tokens:a(e,t).tokens,map:t.map}}function a(t,s){var e;if(t.functionsNode)return O.empty();if(t.getter)return O.from(f);if(t.circular)return O.from(m);if("function"===t.type)return t.funcName?O.from(v,{type:"function",value:t.funcName}):O.from(_);if(t.error)return O.from({type:"error",value:"❗"+t.error});if(t.timeNode)return O.from({type:"timepoint",value:`⏱️ ${t.value.toFixed(2)} ms`});var r=null==(e=t.type)?void 0:e.toLowerCase(),i=void 0!==t.value?t.value+"":"";switch(r){case"date":return n=t,O.from({type:"new",value:"new "},{type:"class",value:"Date"},{type:"punctuation",value:"("},{type:"string",value:"'"},{type:"string",value:new Date(n.value).toJSON()},{type:"string",value:"'"},{type:"punctuation",value:")"});case"regexp":return O.from({type:"regexp",value:i});case"boolean":return O.from({type:"boolean",value:i});case"string":{var n=t;var o=s;let e=(n.value||(!0===n.capped?"":n.capped)||"")+"";e.length>o.maxStrLength?e=e.substring(0,o.maxStrLength)+"...":"string"!=typeof n.capped&&!0!==n.capped||(e+=` ... (length: ${n.length||"unknown"})`);var n=h.default.removeAnsi(e).replace(/\t/g,"\\t").replace(/\r/g,"\\r").replace(/'/g,"\\'"),a=n.split("\n"),l=O.empty(),c=R(o),u=a[0].length<=c,p=j(o.indentationLvl+2);0<o.indentationLvl&&!u&&l.add(k,p);if(n.length>g&&1<a.length&&n.length>c)for(let e=0;e<a.length;e++){var d=e===a.length-1;l.add({type:"string",value:`'${a[e]}${d?"":"\\n"}'`}),d||l.add({type:"operator",value:" +"},k,p)}else l.add({type:"string",value:`'${a.join("\\n")}'`});return l;return}case"number":return O.from({type:"number",value:function(e){if(e.nan)return"NaN";if(e.positiveInfinity)return"Infinity";if(e.negativeInfinity)return"-Infinity";if(e.negativeZero)return"-0";return e.value+""}(t)});case"bigint":return O.from({type:"number",value:t.value+"n"});case"undefined":return O.from({type:"undefined",value:r});case"null":return O.from({type:"null",value:r});case"unknown":return O.from({type:"error",value:"❗"+(t.error?" "+t.error:"")});case"symbol":return O.from({type:"class",value:i});default:if(void 0!==t.value)return O.from({type:"string",value:i});s.currentDepth++;o=function(e,t){var s="array"===e.type,r=s?[P,F]:[C,T];if(s&&0===e.length)return O.from(...r);var i=function(e){var t;if(!e.error)return"array"===e.type?e.length&&5<e.length?"Array("+e.length+")":"":!(e=e.type)||"string"===(t=e.toLowerCase())||"number"===t||"symbol"===t||"object"===t||"function"===t||"null"===t||"undefined"===t||"boolean"===t||"date"===t||"regexp"===t?void 0:e}(e),n=!t.omitTypes&&i?[{type:"type",value:i+" "}]:[],o=null==(o=null==(o=e.props)?void 0:o[0])?void 0:o.rangeNode,a=o&&!(null!=(a=e.props[0].props)&&a.length),o=o&&!a,l=null==(l=null==(l=e.props)?void 0:l[1])?void 0:l.rangeNode;if(e.capped||t.currentDepth===t.maxDepth||"Promise"===i||a)return r.splice(1,0,E),O.from(...n,...r);var c=null==(i=(o?e.props[0]:e).props)?void 0:i.slice();null!=(a=null==c?void 0:c[0])&&a.callStackNode&&c.shift();if(!c||!c.length)return O.from(...n,...r);var u=t.displayPropLimit,p=O.empty();let d=0;var h=[],g=(t.indentationLvl+=w,t.linePrefixLength=0,R(t));let f=0;for(var m=0;m<c.length&&d<u;m++){var _,v,y=c[m];y.functionsNode?h.push(...y.props||[]):y.getter||"function"===y.type?h.push(y):y.loadActionNode||(_=I(y,t,s),s&&((v=0===m)&&p.add(k,j(t.indentationLvl)),y=null==(y=y.props)?void 0:y.length,f+=_.lengthWithoutMultilineFormatting+L.lengthWithoutMultilineFormatting,y||!v&&f>g?(f=0,_.add(k,j(t.indentationLvl))):_.add(S)),p.add(_),d++)}if(!s&&d<u&&0<h.length)for(const b of h.slice(0,u-d))p.add(I(b,t,!1));c.length>u||e.cappedProps||e.cappedElements||l?p.add(k,j(t.indentationLvl),E):(s&&(p.removeLastToken(e=>"indentation"===e.type),p.removeLastToken(e=>e===k)),p.removeLastToken(e=>e===S),p.removeLastToken(e=>e===x));t.indentationLvl-=w;o=O.from(...n,r[0]).add(p,k,j(t.indentationLvl),...r.slice(1));return o}(t,s);return s.currentDepth--,R(s)>=o.lengthWithoutMultilineFormatting&&o.removeMultilineFormatting(),o}}function R(e){return e.maxLineLength-e.indentationLvl-e.linePrefixLength}function I(e,t,s){let r=0;var i=s?O.empty():O.from(k,j(t.indentationLvl)),n=(null==(n=e.name)?void 0:n.toString())||"",o=(s&&(s=n,(o=Math.floor(Number(s)))!==1/0)&&String(o)===s&&0<=o||(s=O.from({type:"property",value:n+": "}),i.add(s),r+=s.lengthWithoutMultilineFormatting),t.linePrefixLength=r,a(e,t));return i.add(o,x)}function o(e){return"indentation"!==e.type&&(null==(e=e.value)?void 0:e.length)||0}s.formatAsString=function(e,t=i){return n(e,t).tokens.map(e=>e.value).join("")},s.tokenize=n;class O{static empty(){return new O([],0)}static from(...e){return e?new O(e,e.reduce((e,t)=>e+o(t),0)):O.empty()}constructor(e,t){this.tokens=e,this.lengthWithoutMultilineFormatting=t}add(...e){return e.reduce((e,t)=>{var s=t instanceof O;return e.tokens=e.tokens.concat(s?t.tokens:[t]),e.lengthWithoutMultilineFormatting+=s?t.lengthWithoutMultilineFormatting:o(t),e},this)}removeMultilineFormatting(){var e=[];for(const t of this.tokens)"indentation"!==t.type&&("linebreak"===t.type?e.push(S):e.push(t));return this.tokens=e,this}removeLastToken(e){var t=this.tokens[this.tokens.length-1];t&&e(t)&&(e=this.tokens.pop())&&(this.lengthWithoutMultilineFormatting-=o(e))}}const L=O.from(S)},{"../utils":88}],90:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0});const n=e("path"),o=e("fs");s.default=function(s,e=3){if(!s.length)return"";for(let t=0;t<e;t++){var r=[];r.push(s[0]);for(let e=0;e<t;e++)r.push("..");for(let e=1;e<s.length;e++)r.push(s[e]);var i=(0,n.join)(...r);if((0,o.existsSync)(i))return i}return(0,n.join)(...s)}},{fs:void 0,path:void 0}],91:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),e("../../lib/global");const _=e("../../lib/utils");s.default=function(e,i,s){if(e){if(e.isCoverageIgnored)return{isCoverageIgnored:!0};var r={},n={},o=_.default.textLines(i,void 0,"\n");let t=0;for(let e=0;e<o.length;e++){var a=o[e].length;n[e+1]={index:t,length:a},t+=a+1}if(e.liveComments){var l=[];for(const f of e.liveComments){let t=_.default.mapTextPosition(f.position,s),r=!1;if(null===t.line&&f.position){let e=f.position.column;for(;0<e;)if(e--,null!==(t=_.default.mapTextPosition({line:f.position.line,column:e},s)).line){r=!0;break}}var c=n[t.line];if(c){const s=t.column>c.length-1?c.index+c.length-1:c.index+t.column;if(!r||t.column>c.length-1)l.push({index:s,exp:f.exp});else{var u=/[\s;]/,p=c.index+c.length-1;let t=!1;for(let e=s;e<p;e++)if(u.test(i[e])){l.push({index:e,exp:f.exp}),t=!0;break}t||l.push({index:p,exp:f.exp})}}}r.liveComments=l.length?l:void 0}if(e.ignoreComments){var d=[];for(const m of e.ignoreComments){var h=_.default.mapTextPosition(m.position,s),g=n[h.line];if(g){const e=h.column>g.length-1?g.length-1:g.index+h.column;d.push({index:e})}}r.ignoreComments=d.length?d:void 0}return r}}},{"../../lib/global":56,"../../lib/utils":88}],92:[function(e,t,s){t.exports={name:"wallaby-core",version:"1.0.1715",author:"Wallaby.js",license:"Proprietary",homepage:"https://wallabyjs.com",scripts:{prepare:"node .husky/install.mjs",postinstall:"node ./node_modules/grunt/bin/grunt patchNodeModules",test:"npm run test:unit","test:unit":"jest --no-cache --config=jest.unit.config.js --forceExit --detectOpenHandles","test:integration:bootstrap":"cd ./test/samples/integration && node install","test:integration:reset":"cd ./test/samples/integration && node clean && node install","test:integration:isolated":"node ./test/samples/integration/test","test:integration:isolated:updateSnapshot":"node ./test/samples/integration/test --updateSnapshot",build:"npm run eslint && node ./node_modules/grunt/bin/grunt bump-only && node ./node_modules/grunt/bin/grunt",release:"node ./docker/run.js","pre-release":"node ./docker/run.js --pre-release",eslint:"eslint --ext .ts,.js .","ts-check":"node ./node_modules/grunt/bin/grunt ts",format:'npx prettier --write "**/[!.]*.{js,ts,cjs,mjs,css,md}"',"format-check":'npx prettier --check "**/[!.]*.{js,ts,cjs,mjs,css,md}"'},dependencies:{"@babel/parser":"7.21.3","@babel/register":"7.10.3","@swc/helpers":"0.5.3","@swc/wasm":"1.3.105",acorn:"8.7.0","acorn-jsx":"5.3.1","acorn-walk":"8.0.2",arg:"4.1.3",bufferutil:"4.0.8",chokidar:"3.5.2","chrome-launcher":"0.15.2","chrome-remote-interface":"0.32.1","coffee-script":"1.10.0",commander:"2.5.0",compression:"1.7.2","copy-paste":"1.5.3",debug:"4.1.1","escodegen-wallaby":"1.6.44","esm-wallaby":"3.2.32",express:"4.17.1","fs-extra":"6.0.1","graceful-fs":"4.2.4",lodash:"3.0.0","lru-cache":"2.5.0",micromatch:"4.0.5",npmlog:"7.0.1",open:"8.0.7",phantom:"0.7.2",q:"1.5.0","regenerator-runtime":"0.14.0",resolve:"1.22.1",semver:"4.3.3","source-map":"0.4.3","style-loader":"3.3.1","ts-node":"10.9.2","tsconfig-paths":"4.2.0",typescript:"5.3.2","underscore.string":"2.3.3","utf-8-validate":"6.0.3","util.promisify":"1.0.0",uuid:"7.0.3","vite-node":"1.2.0",which:"5.0.0","write-file-atomic":"4.0.1",ws:"8.16.0"},devDependencies:{"@babel/core":"^7.10.4","@babel/generator":"^7.6.4","@babel/preset-env":"^7.12.11","@swc/core":"^1.3.100","@swc/jest":"^0.2.29","@types/chokidar":"^2.1.3","@types/chrome-remote-interface":"^0.31.14","@types/compression":"^1.7.5","@types/express":"^4.17.21","@types/jest":"^29.5.12","@types/lodash":"^4.14.136","@types/micromatch":"^4.0.6","@types/node":"14.18.63","@types/npmlog":"^7.0.0","@types/semver":"^6.0.1","@types/uuid":"^9.0.7","@types/which":"^3.0.4","@types/ws":"^8.5.10","@typescript-eslint/parser":"^7.8.0","adm-zip":"^0.5.5","aws-sdk":"2.333.0","browserify-transform-tools":"1.7.0",chai:"4.2.0","chai-subset":"1.6.0",esbuild:"0.18.14",escodegen:"1.6.1",eslint:"^8.57.0","expect.js":"0.3.1",grunt:"1.0.3","grunt-browserify":"6.0.0","grunt-bump":"0.0.16","grunt-contrib-clean":"0.7.0","grunt-contrib-compress":"2.0.0","grunt-contrib-copy":"0.8.2","grunt-contrib-uglify":"5.2.2","grunt-run":"^0.8.1","grunt-terser":"^2.0.0","grunt-ts":"^6.0.0-beta.22",husky:"^9.0.11","javascript-obfuscator":"4.0.0",jest:"29.7.0","line-column":"^1.0.2","lint-staged":"^15.2.7","node-fetch":"^2.6.0",prettier:"^3.2.5",removeNPMAbsolutePaths:"1.0.4",terser:"^5.15.1"},optionalDependencies:{keytar:"^7.9.0"},private:!0,"lint-staged":{"*.{js,ts,cjs,mjs,css,md}":"prettier --write"}}},{}],93:[function(n,$,N){const o=n("fs");var a,l=n("path");global.wallabyStartTime=Date.now();const e=Object.keys(global.console).reduce((e,t)=>("function"==typeof global.console[t]&&(e[t]=global.console[t]),e),{});try{Error.stackTraceLimit=80}catch(e){}function r(t){var s=n("os").homedir();try{let e=process.cwd();for(;e;){var r=l.join(e,t);if(o.existsSync(r))return r;var i=l.dirname(e);if(i===e||i===s)break;e=i}return null}catch(e){return null}}process.env&&process.env.NODE_MODULES_OVERRIDE&&(e.warn(" ---- Using node modules from: "+process.env.NODE_MODULES_OVERRIDE+" ---- "),n("./lib/utils").default.nodeModulesLookup(function(e){e.unshift(process.env.NODE_MODULES_OVERRIDE)})),function e(t){var s=l.join(t,"node_modules",".pnpm","node_modules"),s=(o.existsSync(s)&&(process.env.NODE_PATH?-1===process.env.NODE_PATH.indexOf(s)&&(process.env.NODE_PATH+=("win32"===process.platform?";":":")+s):process.env.NODE_PATH=s),l.dirname(t));s!==t&&e(s)}(process.cwd()),process.env&&(process.env.WALLABY_ENTRY=!0);var i,c,u,s,t=process.argv[2];if("worker"===t)n("./lib/diagnostic"),process.noDeprecation=!0,n("./lib/global"),process.on("message",function(e){if(e&&"exit"===e.type)process.exit(0);else if("instrumentor"===e.type){var t=n("./lib/instrumentor").default;try{var s=t(e.content,e.opts);process.send(s)}catch(e){process.send({error:{message:e&&e.message,stack:e&&e.stack}})}}else if("preprocessor"===e.type||"compiler"===e.type){t=n("./lib/processor");try{t(e).catch(function(e){process.send({error:{message:e&&e.message,stack:e&&e.stack}})}).then(function(e){e&&process.send(e)})}catch(e){process.send({error:{message:e&&e.message,stack:e&&e.stack}})}}}),process.send("READY");else if("runner"===t)process.env.WALLABY_ENV=!0,(a=process.argv[7])&&!process.env.quokka&&(i=n("fs"),c=process.cwd(),u=l.dirname(a),s=l.join(c,"node_modules"),c!==u)&&n("./lib/utils").default.nodeModulesLookup(function(e,t,s,r){var i=!1;e&&e[0]&&0===e[0].indexOf(c)&&(i=!0,Array.prototype.splice.apply(e,[0,e.length].concat(function(e,t){for(var s=[],r=0;r<t.length;r++)s.push(t[r]),e[r]&&s.push(e[r]);for(;r<e.length;r++)s.push(e[r]);return s}(s.call(r,t.replace(c,u)),e)))),i||e.push(a)},function(e){var t=e.replace(s,a);return t===e||i.existsSync(t)?t:e}),n("./lib/nodeTestWorker")(process.argv[3],process.argv[4],process.argv[5],process.argv[6],a,process.argv[8],process.argv[9],process.argv[10],process.argv[11],process.argv[12]);else if("extractor"===t){if(!process.versions||!process.versions.pnp){var t=["cjs","js"];const o=n("fs");t.reduce((e,t)=>{if(e)return e;e=r(".pnp."+t);if(e)try{return n(e).setup(),!0}catch(e){}return!1},!1)}function p(e,t){var s=n("stream")["Readable"];new s({read(){this.push(t),this.push(null)}}).pipe(e),e.on("end",()=>process.exit())}"vitest"===process.argv[3]&&(n("./lib/diagnostic"),t=n("./lib/configurators/vitest/extract").extract,{moduleFolderPath:E,moduleVersion:I,hooksFileUrl:D,configFile:M}=JSON.parse(process.argv[process.argv.length-1]),t(E,I,D,M).then(e=>{process.exitCode=0,p(process.stdout,e)}).catch(e=>{process.exitCode=1,p(process.stderr,e.message)}))}else{process.versions&&process.versions.pnp||["cjs","js"].reduce((e,t)=>{if(e)return e;e=r(".pnp."+t);if(e)try{n(e).setup(),process.env.WALLABY_PNP="--require "+e;const s=l.join(l.dirname(e),".pnp.loader");return["mjs","js"].reduce((e,t)=>{if(e)return e;o.existsSync(s+"."+t)&&(process.env.WALLABY_PNP_ESM="--experimental-loader "+s+"."+t)},!1),!0}catch(e){}return!1},!1),n("./lib/diagnostic"),process.env.PWD=process.cwd(),process.env.DEBUG="wallaby:.*",process.env.DEBUG_COLORS="no",o.existsSync(l.join(process.cwd(),"node_modules",".bin"))&&(process.env.PATH=l.join(process.cwd(),"node_modules",".bin")+(process.env.PATH?l.delimiter+process.env.PATH:"")),process.noDeprecation=!0,i=n("graceful-fs");var d,h,g,f,m,v,y,b,w,k,x,S,P,F,C,T,A,t=n("./lib/app"),E=n("commander"),j=!1,R=(E.unknownOption=function(){},E.option("-p, --port <port>","specify port").option("-l, --projectCachePath <projectCachePath>","specify project cache location").option("-l, --configPath <configPath>","specify config file location").option("-l, --testsPath <testsPath>","specify tests location",(e,t)=>void 0===t?[e]:t.concat([e]),void 0).option("-l, --smartStart <smartStart>","specify wallaby start start").option("-k, --lkp [lkp]","specify lkp location").option("-c, --client [client]","specify client").option("-q, --quokka [quokka]","specify quokka").option("-q, --editorTypeScript [editorTypeScript]","specify editorTypeScript").option("-q, --homeDir <homeDir>","specify homeDir").option("-q, --cv <cv>","specify cv").option("-q, --ol <true|false>","specify ol").option("-q, --te <te>","specify te").option("-q, --fid <te>","specify fid").option("-q, --snapsOnlyMode <te>","specify mode").option("-q, --snapsAutoRun <te>","specify auto run").option("-q, --waitForInitialRunSignal","waitForInitialRunSignal flag").option("-q, --cli","cli flag").option("-q, --generation <ver>","specify generation").parse(process.argv),{port:47878,location:l.join(__dirname,"lib","project")});if(E.port&&(R.port=E.port),E.smartStart&&(R.testsPath=[]),E.projectCachePath&&!E.quokka)if(E.projectCachePath&&E.projectCachePath.endsWith("-wsl")&&i.existsSync("/run/WSL")&&(I=l.basename(E.projectCachePath),D=l.join(n("os").homedir(),".wallaby"),E.projectCachePath=l.join(D,"projects",I.substr(0,I.length-4)),i.existsSync(D)||i.mkdirSync(D)),R.projectCachePath=E.projectCachePath,"true"!==E.ol){i.existsSync(R.projectCachePath)||(R.projectCachePath?(M=l.dirname(R.projectCachePath),i.existsSync(M)||(M?i.mkdirSync(M):e.error("No project cache parent directory: "+JSON.stringify(Object.assign(Object.assign({},E),{options:void 0})))),i.mkdirSync(R.projectCachePath)):e.error("No project cache directory: "+JSON.stringify(Object.assign(Object.assign({},E),{options:void 0}))));try{R.projectCachePath=i.realpathSync(E.projectCachePath)}catch(e){}}if(E.configPath){R.configPath=E.configPath,"win32"===process.platform&&(R.configPath=R.configPath.split(l.sep).reduce((e,t)=>{var s;return e?(s=i.readdirSync(e+l.sep),e+l.sep+(s.find(e=>e===t)||s.find(e=>e.toLowerCase()===t.toLowerCase())||t)):t.toUpperCase()},""));var I=l.dirname(R.configPath);if(I!==process.cwd())try{process.chdir(l.dirname(I)),process.chdir(I)}catch(e){try{process.chdir(I)}catch(e){throw new Error("Wallaby.js working directory could not be initialized.")}}}if(void 0!==E.testsPath&&(R.testsPath=E.testsPath),"win32"===process.platform&&(R.projectCachePath&&":"===R.projectCachePath[1]&&(R.projectCachePath=R.projectCachePath.charAt(0).toUpperCase()+R.projectCachePath.slice(1)),R.configPath)&&":"===R.configPath[1]&&(R.configPath=R.configPath.charAt(0).toUpperCase()+R.configPath.slice(1)),R.projectCachePath&&!process.env.quokka&&"true"!==E.ol){var q=R.projectCachePath;let e=1;for(;;){var O=l.join(R.projectCachePath,"running"),L={pid:process.pid,date:Date.now()};if(!i.existsSync(R.projectCachePath)){i.mkdirSync(R.projectCachePath),i.writeFileSync(O,JSON.stringify(L));break}if(!i.existsSync(O)){i.writeFileSync(O,JSON.stringify(L));break}{let t=!1;try{var B=JSON.parse(i.readFileSync(O));t=process.kill(B.pid,0)}catch(e){t="EPERM"===e.code}if(!t){i.writeFileSync(O,JSON.stringify(L));break}R.projectCachePath=l.join(l.dirname(q),l.basename(q)+"_"+e),e++}}}E.editorTypeScript&&(R.editorTypeScript=E.editorTypeScript),E.homeDir&&(R.homeDir=E.homeDir),E.cv&&(R.cv=E.cv),E.ol&&(R.ol=E.ol),E.te&&(R.te=parseInt(E.te,10),0<=R.te||delete R.te),E.fid&&(R.fileId=E.fid),R.waitForInitialRunSignal=!!E.waitForInitialRunSignal,R.version=E.generation||"1",(j=E.quokka)&&(R.snapsOnlyMode=!!E.snapsOnlyMode,R.snapsAutoRun=!!E.snapsAutoRun,process.env.quokka=!0),n("./lib/serverUtils").initServerOptions(R),R.intervalAction=!0,j&&(d={},h={},g={},f=function(e){return h[e]||g[l.dirname(e)]||!(!e||!~e.indexOf("quokka_fake_path")&&!~e.indexOf(l.join(process.cwd(),j.substr(0,j.lastIndexOf(".")))))},R.fileStructureCachePromise=function(e){return R.readFilePromise(e).then(function(e){return Q.when(JSON.parse(e))})},m=R.fileStatPromise,R.fileStatPromise=function(e){var t;return f(e)?(t=d[e])?Q.when({size:t.content?t.content.length:0}):Q.reject(new Error("File "+e+" not found")):m(e)},v=R.readFilePromise,R.readFilePromise=function(e){var t;return f(e)?(t=d[e])?Q.when(t.content):Q.reject(new Error("File "+e+" not found")):v(e)},y=R.writeFilePromise,R.writeFilePromise=function(e,t){return f(e)?(d[e]={content:t},Q.when(!0)):y(e,t)},b=R.unlinkFilePromise,R.unlinkFilePromise=function(e){return f(e)?(delete d[e],Q.when(!0)):b(e)},w=R.unlinkFileSync,R.unlinkFileSync=function(e){if(!f(e))return w(e);delete d[e]},k=R.writeFileSync,R.writeFileSync=function(e,t){if(!f(e))return k(e,t);d[e]={content:t}},x=R.readFileSync,R.readFileSync=function(e){if(f(e)){var t=d[e];if(t)return t.content;throw new Error("File "+e+" not found")}return x(e)},S=R.fileExistsSync,R.fileExistsSync=function(e){return f(e)?!!d[e]:S(e)},P=R.realpathSync,R.realpathSync=function(e){return f(e)?e:P(e)},F=R.dirRemovePromise,R.dirRemovePromise=function(e){return f(e)?Q.when(e):F(e)},C=R.dirRemoveSync,R.dirRemoveSync=function(e){return f(e)?e:C(e)},T=R.dirEnsurePromise,R.dirEnsurePromise=function(e){return f(e)?Q.when(e):T(e)},A=R.dirEnsureSync,R.dirEnsureSync=function(e){return f(e)?e:A(e)},R.useMemoryFs=function(e,t){t&&(g[l.dirname(e)]=!0),h[e]=!0;for(var s=e;s!==l.dirname(s);)s=l.dirname(s),h[s]=!0}),R.onStart=_.noop,R.onConnected=_.noop;var M,D=n("ws/lib/sender.fallbacks.js");R._init=D.create,R.coreVersion=n("./package.json").version,R.quokka=j,R.client=E.cli?"CLI":E.client||"Sublime",R.lkp=E.lkp,R.Receiver=D.create(),j?"2"===R.version&&(process.env.WALLABY2="true"):("2"===R.version||"VSCode"!==R.client&&"IntelliJ"!==R.client)&&(process.env.WALLABY2="true"),E.cli?(R.cli=!0,R.configPath||(R.configPath=l.join(process.cwd(),"auto.detect")),R.projectCachePath||(M=l.join(n("os").homedir(),".wallaby"),R.dirEnsureSync(M),I=l.join(M,"cli/projects"),R.dirEnsureSync(I),R.projectCachePath=l.join(I,n("crypto").createHash("md5").update(R.configPath).digest("hex").substr(0,16))),t.start(R),R.onConnected({send:function(e){var t;"notification"!==e.type&&"uiStarted"!==e.type&&"stopped"!==e.type&&"restart"!==e.type&&"ping"!==e.type&&"licenseChanged"!==e.type||null!=(t=process.send)&&t.call(process,e)}})):(new(n("ws").Server)({host:"127.0.0.1",port:R.port,verifyClient:function(e){return _.verifyLocalOrigin(e.origin)}},function(){e.log(R.quokka?"quokka.js started":"wallaby.js started")}).on("connection",function(t){var s={send:function(e){t.send(JSON.stringify(e))},receive:_.noop};R.onConnected(s),t.on("message",function(e){e=JSON.parse(e);"stop"===e.type?process.exit():s.receive(e)}),s.send({type:"started",version:n("./package.json").version})}),t.start(R))}},{"./lib/OutputLogger":1,"./lib/app":9,"./lib/configurators/vitest/extract":48,"./lib/diagnostic":49,"./lib/global":56,"./lib/instrumentor":57,"./lib/nodeTestWorker":60,"./lib/processor":74,"./lib/serverUtils":78,"./lib/utils":88,"./package.json":92,commander:void 0,crypto:void 0,fs:void 0,"graceful-fs":void 0,os:void 0,path:void 0,stream:void 0,"ts-node":void 0,ws:void 0,"ws/lib/sender.fallbacks.js":void 0}]},{},[93]);